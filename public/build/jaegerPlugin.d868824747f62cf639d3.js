"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[890],{84655:(H,x,a)=>{a.d(x,{i:()=>P});var p=a(76932),s=a(31733),t=a(76067);const P=({hideLine:D=!1})=>{const d=(0,t.wW)(R);return D?s.createElement("hr",{className:d.dividerHideLine}):s.createElement("hr",{className:d.divider})},R=D=>({divider:(0,p.css)({margin:D.spacing(4,0)}),dividerHideLine:(0,p.css)({border:"none",margin:D.spacing(3,0)})})},36662:(H,x,a)=>{a.d(x,{I:()=>J});var p=a(76932),s=a(31733),t=a(44992),P=a(98463),R=a(76067),D=a(47701),d=a(41164),g=a(76772),b=a(5936);function F({options:T,onOptionsChange:I}){const O=(0,R.wW)(A);return s.createElement("div",{className:O.container},s.createElement(D.Z,{className:O.row},s.createElement(d._,{tooltip:"Displays the node graph above the trace view. Default: disabled",label:"Enable node graph",labelWidth:26},s.createElement(g.x,{id:"enableNodeGraph",value:T.jsonData.nodeGraph?.enabled,onChange:L=>(0,t.tp)({onOptionsChange:I,options:T},"nodeGraph",{...T.jsonData.nodeGraph,enabled:L.currentTarget.checked})}))))}const J=({options:T,onOptionsChange:I})=>{let O=T.type;return O+=T.type==="tempo"?"/configure-tempo-data-source/#node-graph":"/#node-graph",s.createElement(P._,{title:"Node graph",description:s.createElement(b.W,{description:"Show or hide the node graph visualization.",suffix:O,feature:"the node graph"})},s.createElement(F,{options:T,onOptionsChange:I}))},A=T=>({infoText:(0,p.css)({label:"infoText",paddingBottom:T.spacing(2),color:T.colors.text.secondary}),container:(0,p.css)({label:"container",width:"100%"}),row:(0,p.css)({label:"row",alignItems:"baseline"})})},46898:(H,x,a)=>{a.d(x,{Y:()=>L});var p=a(76932),s=a(31733),t=a(44992),P=a(83717),R=a(76067),D=a(47701),d=a(41164),g=a(51343),b=a(64516),F=a(79228),J=a(5936),A=a(4200),T=a(69256),I=a(42302);function O({options:l,onOptionsChange:f}){const N=(0,R.wW)(Y);return s.createElement("div",{className:(0,p.css)({width:"100%"})},s.createElement(D.Z,{className:N.row},s.createElement(d._,{tooltip:"The Prometheus data source the trace is going to navigate to",label:"Data source",labelWidth:26},s.createElement(F.q,{inputId:"trace-to-metrics-data-source-picker",pluginId:"prometheus",current:l.jsonData.tracesToMetrics?.datasourceUid,noDefault:!0,width:40,onChange:y=>(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,datasourceUid:y.uid})})),l.jsonData.tracesToMetrics?.datasourceUid?s.createElement(g.zx,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,datasourceUid:void 0})}},"Clear"):null),s.createElement(D.Z,null,s.createElement(A.w,{label:(0,I.mH)("start"),tooltip:(0,I.rr)("start","-2m"),value:l.jsonData.tracesToMetrics?.spanStartTimeShift||"",onChange:y=>{(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,spanStartTimeShift:y})},placeholder:"-2m",isInvalidError:I.Ny})),s.createElement(D.Z,null,s.createElement(A.w,{label:(0,I.mH)("end"),tooltip:(0,I.rr)("end","2m"),value:l.jsonData.tracesToMetrics?.spanEndTimeShift||"",onChange:y=>{(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,spanEndTimeShift:y})},placeholder:"2m",isInvalidError:I.Ny})),s.createElement(D.Z,null,s.createElement(d._,{tooltip:"Tags that will be used in the metrics query",label:"Tags",labelWidth:26},s.createElement(T.a,{values:l.jsonData.tracesToMetrics?.tags??[],onChange:y=>(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,tags:y})}))),l.jsonData.tracesToMetrics?.queries?.map((y,B)=>s.createElement("div",{key:B,className:N.queryRow},s.createElement(d._,{label:"Link Label",labelWidth:26,tooltip:"Descriptive label for the linked query"},s.createElement(b.I,{label:"Link Label",type:"text",allowFullScreen:!0,value:y.name,width:40,onChange:U=>{const j=(l.jsonData.tracesToMetrics?.queries??[]).map((C,z)=>z===B?{...C,name:U.currentTarget.value}:C);(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,queries:j})}})),s.createElement(d._,{label:"Query",labelWidth:10,tooltip:"The Prometheus query that will run when navigating from a trace to metrics. Interpolate tags using the `$__tags` keyword",grow:!0},s.createElement(b.I,{label:"Query",type:"text",allowFullScreen:!0,value:y.query,onChange:U=>{const j=(l.jsonData.tracesToMetrics?.queries??[]).map((C,z)=>z===B?{...C,query:U.currentTarget.value}:C);(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,queries:j})}})),s.createElement(g.zx,{variant:"destructive",title:"Remove query",icon:"times",type:"button",onClick:()=>{const U=l.jsonData.tracesToMetrics?.queries.filter((j,C)=>C!==B);(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,queries:U})}}))),s.createElement(g.zx,{variant:"secondary",title:"Add query",icon:"plus",type:"button",onClick:()=>{(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,queries:[...l.jsonData.tracesToMetrics?.queries??[],{query:""}]})}},"Add query"))}const L=({options:l,onOptionsChange:f})=>{let N=l.type;return N+=l.type==="tempo"?"/configure-tempo-data-source/#trace-to-metrics":"/#trace-to-metrics",s.createElement(P.K,{title:"Trace to metrics",description:s.createElement(J.W,{description:"Navigate from a trace span to the selected data source's metrics.",suffix:N,feature:"trace to metrics"}),isCollapsible:!0,isInitiallyOpen:!0},s.createElement(O,{options:l,onOptionsChange:f}))},Y=l=>({infoText:(0,p.css)`
    padding-bottom: ${l.spacing(2)};
    color: ${l.colors.text.secondary};
  `,row:(0,p.css)`
    label: row;
    align-items: baseline;
  `,queryRow:(0,p.css)`
    label: queryRow;
    display: flex;
    flex-flow: wrap;
  `})},31146:(H,x,a)=>{a.r(x),a.d(x,{plugin:()=>Re});var p=a(51023),s=a(76932),t=a(31733),P=a(76067);function R(){const n=(0,P.wW)(D);return t.createElement(t.Fragment,null,t.createElement("h2",{id:"jaeger-cheat-sheet"},"Jaeger Cheat Sheet"),t.createElement("p",null,"This cheat sheet provides a quick overview of the query types that are available. For more details about the Jaeger data source, check out"," ",t.createElement("a",{href:"https://grafana.com/docs/grafana/latest/datasources/jaeger",target:"_blank",rel:"noreferrer",className:n.anchorTag},"the documentation"),"."),t.createElement("hr",null),t.createElement("ul",{className:n.unorderedList},t.createElement("li",null,"Search - filter traces by service name. Addtionally, you can filter by tags or min/max duration, as well as limit the number of traces that are returned."),t.createElement("li",null,"TraceID - if you have a trace ID, simply enter the trace ID to see the trace."),t.createElement("li",null,"JSON File - you can upload a JSON file that contains a single trace to visualize it. If the file has multiple traces then the first trace is used for visualization. An example of a valid JSON file can be found in"," ",t.createElement("a",{href:"https://grafana.com/docs/grafana/latest/datasources/jaeger/#upload-json-trace-file",target:"_blank",rel:"noreferrer",className:n.anchorTag},"this section")," ","of the documentation.")))}const D=n=>({anchorTag:(0,s.css)`
    color: ${n.colors.text.link};
  `,unorderedList:(0,s.css)`
    list-style-type: none;
  `});var d=a(47701),g=a(41164),b=a(59328),F=a(5572),J=a(54679),A=a(79106),T=a(96856),I=a(51343),O=a(84275),L=a(61129),Y=a(49596),l=a(38834),f=a(64516),N=a(7939),y=a(42876),B=a(86573),U=a(63315),j=a.n(U);function C(n){if(!n)return"";const e=j().parse(n);return Object.keys(e).forEach(r=>{const o=e[r];typeof o!="string"&&(e[r]=String(o))}),JSON.stringify(e)}function z(n){if(!n)return"";try{return j().stringify(JSON.parse(n))}catch{return n}}const k="e.g. 1.2s, 100ms, 500us",q="All",se={label:q,value:void 0};function le({datasource:n,query:e,onChange:r}){const[o,E]=(0,t.useState)(),[c,m]=(0,t.useState)(),[u,S]=(0,t.useState)({services:!1,operations:!1}),h=(0,t.useCallback)(async(i,v,G="")=>{S(M=>({...M,[v]:!0}));try{const M=await n.metadataRequest(i);return M?M.sort().map(Q=>({label:Q,value:Q})).filter(Q=>Q.value?(0,Y.C)(Q.value,G).found:!1):[{label:`No ${v} found`,value:`No ${v} found`}]}catch(M){return M instanceof Error&&(0,B.WI)((0,N.$l)((0,y.t_)("Error",M))),[]}finally{S(M=>({...M,[v]:!1}))}},[n]);return(0,t.useEffect)(()=>{(async()=>{const v=await h("/api/services","services");e.service&&(0,L.J)().containsTemplate(e.service)&&v.push((0,O.E)(e.service)),E(v)})()},[n,h,e.service]),(0,t.useEffect)(()=>{const i=async()=>{const v=await h(`/api/services/${encodeURIComponent((0,L.J)().replace(e.service))}/operations`,"operations");e.operation&&(0,L.J)().containsTemplate(e.operation)&&v.push((0,O.E)(e.operation)),m([se,...v])};e.service&&i()},[n,e.service,h,e.operation]),t.createElement("div",{className:(0,s.css)({maxWidth:"500px"})},t.createElement(d.Z,null,t.createElement(g._,{label:"Service Name",labelWidth:14,grow:!0},t.createElement(l.Ph,{inputId:"service",options:o,onOpenMenu:()=>h("/api/services","services"),isLoading:u.services,value:o?.find(i=>i?.value===e.service)||void 0,placeholder:"Select a service",onChange:i=>r({...e,service:i?.value,operation:e.service!==i?.value?void 0:e.operation}),menuPlacement:"bottom",isClearable:!0,"aria-label":"select-service-name",allowCustomValue:!0}))),t.createElement(d.Z,null,t.createElement(g._,{label:"Operation Name",labelWidth:14,grow:!0,disabled:!e.service},t.createElement(l.Ph,{inputId:"operation",options:c,onOpenMenu:()=>h(`/api/services/${encodeURIComponent((0,L.J)().replace(e.service))}/operations`,"operations"),isLoading:u.operations,value:c?.find(i=>i.value===e.operation)||null,placeholder:"Select an operation",onChange:i=>r({...e,operation:i?.value||void 0}),menuPlacement:"bottom",isClearable:!0,"aria-label":"select-operation-name",allowCustomValue:!0}))),t.createElement(d.Z,null,t.createElement(g._,{label:"Tags",labelWidth:14,grow:!0,tooltip:"Values should be in logfmt."},t.createElement(f.I,{id:"tags",value:z(e.tags),placeholder:"http.status_code=200 error=true",onChange:i=>r({...e,tags:i.currentTarget.value})}))),t.createElement(d.Z,null,t.createElement(g._,{label:"Min Duration",labelWidth:14,grow:!0},t.createElement(f.I,{id:"minDuration",name:"minDuration",value:e.minDuration||"",placeholder:k,onChange:i=>r({...e,minDuration:i.currentTarget.value})}))),t.createElement(d.Z,null,t.createElement(g._,{label:"Max Duration",labelWidth:14,grow:!0},t.createElement(f.I,{id:"maxDuration",name:"maxDuration",value:e.maxDuration||"",placeholder:k,onChange:i=>r({...e,maxDuration:i.currentTarget.value})}))),t.createElement(d.Z,null,t.createElement(g._,{label:"Limit",labelWidth:14,grow:!0,tooltip:"Maximum number of returned results"},t.createElement(f.I,{id:"limit",name:"limit",value:e.limit||"",type:"number",onChange:i=>r({...e,limit:i.currentTarget.value?parseInt(i.currentTarget.value,10):void 0})}))))}const Ne=null;function oe({datasource:n,query:e,onChange:r,onRunQuery:o}){const[E,c]=(0,t.useState)(!1),m=(0,P.l4)(),u=(0,P.wW)(ie),S=i=>{const v={...e,query:i};r(v)},h=()=>{switch(e.queryType){case"search":return t.createElement(le,{datasource:n,query:e,onChange:r});default:return t.createElement(d.Z,null,t.createElement(g._,{label:"Trace ID",labelWidth:14,grow:!0},t.createElement(b.q,{query:e.query,onChange:S,onRunQuery:o,placeholder:"Enter a Trace ID (run with Shift+Enter)",portalOrigin:"jaeger"})))}};return t.createElement(t.Fragment,null,t.createElement(F.u,{title:"Upload trace",isOpen:E,onDismiss:()=>c(!1)},t.createElement("div",{className:(0,s.css)({padding:m.spacing(2)})},t.createElement(J.Yo,{options:{multiple:!1},onLoad:i=>{n.uploadedJson=i,r({...e,queryType:"upload"}),c(!1),o()}}))),t.createElement("div",{className:u.container},t.createElement(d.Z,null,t.createElement(g._,{label:"Query type",grow:!0},t.createElement(A.Lh,{spacing:"sm",align:"center",justify:"space-between"},t.createElement(T.S,{options:[{value:"search",label:"Search"},{value:void 0,label:"TraceID"}],value:e.queryType,onChange:i=>r({...e,queryType:i}),size:"md"}),t.createElement(I.zx,{variant:"secondary",size:"sm",onClick:()=>{c(!0)}},"Import trace")))),h()))}const ie=()=>({container:(0,s.css)`
    width: 100%;
  `});var ce=a(85510),me=a(83717),_=a(85498),de=a(69671),$=a(84655),ue=a(36662),ve=a(42302),fe=a(46898),ge=a(18180),Ee=a(44992),he=a(76772);function pe({options:n,onOptionsChange:e}){return t.createElement("div",{className:ee.container},t.createElement("h3",{className:"page-heading"},"Query Trace by ID with Time Params"),t.createElement(d.Z,{className:ee.row},t.createElement(g._,{tooltip:"pass time parameters when querying trace by ID",label:"Enable Time Parameters",labelWidth:26},t.createElement(he.x,{id:"enableTraceIdTimeParams",value:n.jsonData.traceIdTimeParams?.enabled,onChange:r=>(0,Ee.tp)({onOptionsChange:e,options:n},"traceIdTimeParams",{...n.jsonData.traceIdTimeParams,enabled:r.currentTarget.checked})}))))}const ee={container:(0,s.css)`
    label: container;
    width: 100%;
  `,row:(0,s.css)`
    label: row;
    align-items: baseline;
  `},Te=({options:n,onOptionsChange:e})=>{const r=(0,P.wW)(De);return t.createElement("div",{className:r.container},t.createElement(ce.j,{dataSourceName:"Jaeger",docsLink:"https://grafana.com/docs/grafana/latest/datasources/jaeger",hasRequiredFields:!1}),t.createElement($.i,null),t.createElement(de.E,{defaultUrl:"http://localhost:16686",dataSourceConfig:n,showAccessOptions:!1,onChange:e,secureSocksDSProxyEnabled:_.config.secureSocksDSProxyEnabled}),t.createElement(ve.dw,{options:n,onOptionsChange:e}),t.createElement($.i,null),_.config.featureToggles.traceToMetrics?t.createElement(t.Fragment,null,t.createElement(fe.Y,{options:n,onOptionsChange:e}),t.createElement($.i,null)):null,t.createElement(me.K,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!1},t.createElement(ue.I,{options:n,onOptionsChange:e}),t.createElement($.i,{hideLine:!0}),t.createElement(ge.vc,{options:n,onOptionsChange:e}),t.createElement($.i,{hideLine:!0}),t.createElement(pe,{options:n,onOptionsChange:e})))},De=n=>({container:(0,s.css)`
    label: container;
    margin-bottom: ${n.spacing(2)};
    max-width: 900px;
  `});var Z=a(69781),te=a(71892),K=a(86457),X=a(4558),Me=a(56183),Ie=a(91977),ye=a(89026),Se=a(47862),Pe=a(85666),Oe=a(69391),Le=a(89660),W=a(56790),V=a(60226);function ae(n){const{nodes:e,edges:r}=Ce(n),[o,E]=(0,V.np)();for(const c of e)o.add(c);for(const c of r)E.add(c);return[o,E]}function Ce(n){const e=[],r=[],o=We(n.spans),E=(0,V.nO)(c=>{if(c>=n.spans.length)return;const m=n.spans[c];return{span:m,id:m.spanID,parentIds:m.references?.filter(u=>u.refType==="CHILD_OF").map(u=>u.spanID)||[]}});for(const c of n.spans){const m=n.processes[c.processID],u=E[c.spanID].children.map(G=>{const M=E[G].span;return[M.startTime,M.startTime+M.duration]}),S=(0,V.et)(u),h=c.duration-S,i=(0,V.fy)(c.duration/1e3,o/1e3,h/1e3);e.push({[W.z.id]:c.spanID,[W.z.title]:m?.serviceName??"",[W.z.subTitle]:c.operationName,[W.z.mainStat]:i.main,[W.z.secondaryStat]:i.secondary,[W.z.color]:h/o});const v=c.references?.find(G=>G.refType==="CHILD_OF")?.spanID;v&&E[v].span&&r.push({[W.z.id]:v+"--"+c.spanID,[W.z.target]:c.spanID,[W.z.source]:v})}return{nodes:e,edges:r}}function We(n){let e=0,r=1/0;for(const o of n)o.startTime<r&&(r=o.startTime),o.startTime+o.duration>e&&(e=o.startTime+o.duration);return e-r}var w=a(49973);class xe extends p.MF{constructor(e,r=(0,Le.$t)(),o=(0,L.J)()){super(e),this.instanceSettings=e,this.timeSrv=r,this.templateSrv=o,this.uploadedJson=null,this.nodeGraph=e.jsonData.nodeGraph,this.traceIdTimeParams=e.jsonData.traceIdTimeParams}async metadataRequest(e,r){return(await(0,te.n)(this._request(e,r,{hideFromInspector:!0}))).data.data}isSearchFormValid(e){return!!e.service}query(e){const r=e.targets[0];if(!r)return(0,K.of)({data:[ne]});if(r.queryType==="search"&&!this.isSearchFormValid(r))return(0,K.of)({error:{message:"You must select a service."},data:[]});let{start:o,end:E}=this.getTimeRange();if(r.queryType!=="search"&&r.query){let u=`/api/traces/${encodeURIComponent(this.templateSrv.replace(r.query,e.scopedVars))}`;return this.traceIdTimeParams&&(u+=`?start=${o}&end=${E}`),this._request(u).pipe((0,X.U)(S=>{const h=S?.data?.data?.[0];if(!h)return{data:[ne]};let i=[(0,w.xM)(h)];return this.nodeGraph?.enabled&&i.push(...ae(h)),{data:i}}))}if(r.queryType==="upload"){if(!this.uploadedJson)return(0,K.of)({data:[]});try{const u=JSON.parse(this.uploadedJson).data[0];let S=[(0,w.xM)(u)];return this.nodeGraph?.enabled&&S.push(...ae(u)),(0,K.of)({data:S})}catch{return(0,K.of)({error:{message:"The JSON file uploaded is not in a valid Jaeger format"},data:[]})}}let c=(0,Z.pick)(this.applyVariables(r,e.scopedVars),["service","operation","tags","minDuration","maxDuration","limit"]),m=(0,Z.pickBy)(c,Z.identity);return m.operation===q&&(m=(0,Z.omit)(m,"operation")),m.tags&&(m={...m,tags:C(m.tags.toString())}),this._request("/api/traces",{...m,...this.getTimeRange(),lookback:"custom"}).pipe((0,X.U)(u=>({data:[(0,w.Wp)(u.data.data,this.instanceSettings)]})))}interpolateVariablesInQueries(e,r){return!e||e.length===0?[]:e.map(o=>({...o,datasource:this.getRef(),...this.applyVariables(o,r)}))}applyVariables(e,r){let o={...e};return e.tags&&this.templateSrv.containsTemplate(e.tags)&&(o={...e,tags:this.templateSrv.replace(e.tags,r)}),{...o,service:this.templateSrv.replace(e.service??"",r),operation:this.templateSrv.replace(e.operation??"",r),minDuration:this.templateSrv.replace(e.minDuration??"",r),maxDuration:this.templateSrv.replace(e.maxDuration??"",r)}}async testDatasource(){return(0,te.n)(this._request("/api/services").pipe((0,X.U)(e=>(e?.data?.data||[]).length>0?{status:"success",message:"Data source connected and services found."}:{status:"error",message:"Data source connected, but no services received. Verify that Jaeger is configured properly."}),(0,Me.K)(e=>{let r="Jaeger: ";return e.statusText?r+=e.statusText:r+="Cannot connect to Jaeger",e.status&&(r+=`. ${e.status}`),e.data&&e.data.message?r+=`. ${e.data.message}`:e.data&&(r+=`. ${JSON.stringify(e.data)}`),(0,K.of)({status:"error",message:r})})))}getTimeRange(){const e=this.timeSrv.timeRange();return{start:re(e.from,!1),end:re(e.to,!0)}}getQueryDisplayText(e){return e.query||""}_request(e,r,o){const E=r?Ie.Cj.serializeParams(r):"",c=`${this.instanceSettings.url}${e}${E.length?`?${E}`:""}`,m={...o,url:c};return(0,Oe.i)().fetch(m)}}function re(n,e){return typeof n=="string"&&(n=ye.parse(n,e)),n.valueOf()*1e3}const ne=new Se.v({fields:[{name:"trace",type:Pe.fS.trace,values:[]}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"jaeger"}}}),Re=new p.hf(xe).setConfigEditor(Te).setQueryEditor(oe).setQueryEditorHelp(R)}}]);

//# sourceMappingURL=jaegerPlugin.d868824747f62cf639d3.js.map