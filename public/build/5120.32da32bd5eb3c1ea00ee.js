(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5120],{61136:(_e,te,w)=>{"use strict";w.d(te,{zj:()=>C});var C=(P=>(P.CloudAlerting="cloud-alerting",P.UnifiedAlerting="unified-alerting",P.Dashboard="dashboard",P.Explore="explore",P.Correlations="correlations",P.Unknown="unknown",P.PanelEditor="panel-editor",P.PanelViewer="panel-viewer",P))(C||{});class G extends null{constructor(){super(...arguments),this._extensionConfigs=[]}init(O){}setRootPage(O){return this.root=O,this}setComponentsFromLegacyExports(O){if(O.ConfigCtrl&&(this.angularConfigCtrl=O.ConfigCtrl),this.meta&&this.meta.includes){for(const se of this.meta.includes)if(se.type===PluginIncludeType.page&&se.component&&!O[se.component]){console.warn("App Page uses unknown component: ",se.component,this.meta);continue}}}get extensionConfigs(){return this._extensionConfigs}configureExtensionLink(O){return this._extensionConfigs.push({...O,type:PluginExtensionTypes.link}),this}configureExtensionComponent(O){return this._extensionConfigs.push({...O,type:PluginExtensionTypes.component}),this}}var I=(P=>(P.alpha="alpha",P.beta="beta",P))(I||{})},35120:(_e,te,w)=>{"use strict";w.r(te),w.d(te,{plugin:()=>Xn});var C=w(47147);class G{constructor(){this.type=this.__proto__.constructor.type}}class I extends G{constructor(t){super(),this.payload=t}}class P extends I{}P.type="data-hover";class O extends G{}O.type="data-hover-clear";class se extends I{}se.type="data-select";class me extends I{}me.type="annotation-event";class Re extends I{}Re.type="dashboard-loaded";class He extends G{}He.type="datasource-updated-successfully";class _ extends G{}_.type="datasource-test-succeeded";class ve extends G{}ve.type="datasource-test-failed";var Ie=w(1727),o=w(31733),N=w(69781),x=w.n(N);function we(e){return{uid:e.uid,type:e.type}}function X(e){return typeof e=="object"&&typeof e?.uid=="string"}function ce(e){if(X(e))return e.uid;if(isString(e))return e}const ze=(e,t)=>s=>{Ne(e,t,s.currentTarget.value)},pe=(e,t)=>s=>{Z(e,t,s.currentTarget.value)},de=(e,t)=>s=>{De(e,t,s.currentTarget.value)},Ae=(e,t)=>s=>{Z(e,t,s.value)},re=(e,t)=>s=>{Z(e,t,s.currentTarget.checked)},K=(e,t)=>s=>{De(e,t,s.value)},Se=(e,t)=>s=>{Ct(e,t)};function Ne(e,t,s){const r=e.options;e.onOptionsChange({...r,[t]:s})}const Z=(e,t,s)=>{const r=e.options;e.onOptionsChange({...r,jsonData:{...r.jsonData,[t]:s}})},De=(e,t,s)=>{const r=e.options;e.onOptionsChange({...r,secureJsonData:{...r.secureJsonData?r.secureJsonData:{},[t]:s}})},Ct=(e,t)=>{const s=e.options;e.onOptionsChange({...s,secureJsonData:{...s.secureJsonData?s.secureJsonData:{},[t]:""},secureJsonFields:{...s.secureJsonFields,[t]:!1}})};var m=w(76932),k=w(44918),Le=Object.defineProperty,Xe=Object.defineProperties,D=Object.getOwnPropertyDescriptors,ot=Object.getOwnPropertySymbols,xt=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable,it=(e,t,s)=>t in e?Le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,xr=(e,t)=>{for(var s in t||(t={}))xt.call(t,s)&&it(e,s,t[s]);if(ot)for(var s of ot(t))at.call(t,s)&&it(e,s,t[s]);return e},Mr=(e,t)=>Xe(e,D(t));const Rr=({dataSourceName:e,docsLink:t,hasRequiredFields:s=!0,className:r})=>{const a=(0,k.l4)(),i={container:(0,m.css)({p:{margin:0},"p + p":{marginTop:a.spacing(2)}}),text:(0,m.css)(Mr(xr({},a.typography.body),{color:a.colors.text.secondary,a:(0,m.css)({color:a.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})}))};return o.createElement("div",{className:(0,m.cx)(i.container,r)},o.createElement("p",{className:i.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",o.createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),s&&o.createElement("p",{className:i.text},o.createElement("i",null,"Fields marked with * are required")))};var Mt=w(43988),Ir=Object.defineProperty,Dr=Object.defineProperties,Lr=Object.getOwnPropertyDescriptors,ss=Object.getOwnPropertySymbols,Fr=Object.prototype.hasOwnProperty,Pr=Object.prototype.propertyIsEnumerable,rs=(e,t,s)=>t in e?Ir(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Gr=(e,t)=>{for(var s in t||(t={}))Fr.call(t,s)&&rs(e,s,t[s]);if(ss)for(var s of ss(t))Pr.call(t,s)&&rs(e,s,t[s]);return e},Or=(e,t)=>Dr(e,Lr(t));const Qr=({children:e,title:t,description:s,isCollapsible:r=!1,isInitiallyOpen:a=!0,kind:i="section",className:c})=>{const{colors:n,typography:l,spacing:u}=(0,k.l4)(),[p,g]=(0,o.useState)(r?a:!0),b=p?"angle-up":"angle-down",y=i==="sub-section",h=`${p?"Collapse":"Expand"} section ${t}`,f={header:(0,m.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,m.css)({margin:0}),subtitle:(0,m.css)({margin:0,fontWeight:l.fontWeightRegular}),descriptionText:(0,m.css)(Or(Gr({marginTop:u(y?.25:.5),marginBottom:0},l.bodySmall),{color:n.text.secondary})),content:(0,m.css)({marginTop:u(2)})};return o.createElement("div",{className:c},o.createElement("div",{className:f.header},i==="section"?o.createElement("h3",{className:f.title},t):o.createElement("h6",{className:f.subtitle},t),r&&o.createElement(Mt.h,{name:b,onClick:()=>g(!p),type:"button",size:"xl","aria-label":h})),s&&o.createElement("p",{className:f.descriptionText},s),p&&o.createElement("div",{className:f.content},e))};var Vr=Object.defineProperty,Wr=Object.defineProperties,$r=Object.getOwnPropertyDescriptors,nt=Object.getOwnPropertySymbols,os=Object.prototype.hasOwnProperty,as=Object.prototype.propertyIsEnumerable,is=(e,t,s)=>t in e?Vr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Ur=(e,t)=>{for(var s in t||(t={}))os.call(t,s)&&is(e,s,t[s]);if(nt)for(var s of nt(t))as.call(t,s)&&is(e,s,t[s]);return e},Br=(e,t)=>Wr(e,$r(t)),jr=(e,t)=>{var s={};for(var r in e)os.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(e!=null&&nt)for(var r of nt(e))t.indexOf(r)<0&&as.call(e,r)&&(s[r]=e[r]);return s};const ns=e=>{var t=e,{children:s}=t,r=jr(t,["children"]);return o.createElement(Qr,Br(Ur({},r),{kind:"section"}),s)};var Fe=w(61129),Rt=w(69391),fe=w(85498);const It=({direction:e="horizontal",spacing:t=2})=>{const s=(0,k.wW)(_r,t);return e==="vertical"?o.createElement("div",{className:s.verticalDivider}):o.createElement("hr",{className:s.horizontalDivider})};It.displayName="Divider";const _r=(e,t)=>({horizontalDivider:(0,m.css)({borderTop:`1px solid ${e.colors.border.weak}`,margin:e.spacing(t,0),width:"100%"}),verticalDivider:(0,m.css)({borderRight:`1px solid ${e.colors.border.weak}`,margin:e.spacing(0,t),height:"100%"})});var Te=w(54510),Hr=w(8961);const Xr={s:{display:"second"},m:{display:"minute"},h:{display:"hour"},d:{display:"day"},w:{display:"week"},M:{display:"month"},y:{display:"year"}},Jr=[{from:"now/d",to:"now/d",display:"Today"},{from:"now/d",to:"now",display:"Today so far"},{from:"now/w",to:"now/w",display:"This week"},{from:"now/w",to:"now",display:"This week so far"},{from:"now/M",to:"now/M",display:"This month"},{from:"now/M",to:"now",display:"This month so far"},{from:"now/y",to:"now/y",display:"This year"},{from:"now/y",to:"now",display:"This year so far"},{from:"now-1d/d",to:"now-1d/d",display:"Yesterday"},{from:"now-2d/d",to:"now-2d/d",display:"Day before yesterday"},{from:"now-7d/d",to:"now-7d/d",display:"This day last week"},{from:"now-1w/w",to:"now-1w/w",display:"Previous week"},{from:"now-1M/M",to:"now-1M/M",display:"Previous month"},{from:"now-1Q/fQ",to:"now-1Q/fQ",display:"Previous fiscal quarter"},{from:"now-1y/y",to:"now-1y/y",display:"Previous year"},{from:"now-1y/fy",to:"now-1y/fy",display:"Previous fiscal year"},{from:"now-5m",to:"now",display:"Last 5 minutes"},{from:"now-15m",to:"now",display:"Last 15 minutes"},{from:"now-30m",to:"now",display:"Last 30 minutes"},{from:"now-1h",to:"now",display:"Last 1 hour"},{from:"now-3h",to:"now",display:"Last 3 hours"},{from:"now-6h",to:"now",display:"Last 6 hours"},{from:"now-12h",to:"now",display:"Last 12 hours"},{from:"now-24h",to:"now",display:"Last 24 hours"},{from:"now-2d",to:"now",display:"Last 2 days"},{from:"now-7d",to:"now",display:"Last 7 days"},{from:"now-30d",to:"now",display:"Last 30 days"},{from:"now-90d",to:"now",display:"Last 90 days"},{from:"now-6M",to:"now",display:"Last 6 months"},{from:"now-1y",to:"now",display:"Last 1 year"},{from:"now-2y",to:"now",display:"Last 2 years"},{from:"now-5y",to:"now",display:"Last 5 years"},{from:"now/fQ",to:"now",display:"This fiscal quarter so far"},{from:"now/fQ",to:"now/fQ",display:"This fiscal quarter"},{from:"now/fy",to:"now",display:"This fiscal year so far"},{from:"now/fy",to:"now/fy",display:"This fiscal year"}],Kr=[{from:"now",to:"now+1m",display:"Next minute"},{from:"now",to:"now+5m",display:"Next 5 minutes"},{from:"now",to:"now+15m",display:"Next 15 minutes"},{from:"now",to:"now+30m",display:"Next 30 minutes"},{from:"now",to:"now+1h",display:"Next hour"},{from:"now",to:"now+3h",display:"Next 3 hours"},{from:"now",to:"now+6h",display:"Next 6 hours"},{from:"now",to:"now+12h",display:"Next 12 hours"},{from:"now",to:"now+24h",display:"Next 24 hours"},{from:"now",to:"now+2d",display:"Next 2 days"},{from:"now",to:"now+7d",display:"Next 7 days"},{from:"now",to:"now+30d",display:"Next 30 days"},{from:"now",to:"now+90d",display:"Next 90 days"},{from:"now",to:"now+6M",display:"Next 6 months"},{from:"now",to:"now+1y",display:"Next year"},{from:"now",to:"now+2y",display:"Next 2 years"},{from:"now",to:"now+5y",display:"Next 5 years"}],ct={};(0,N.each)(Jr,e=>{ct[e.from+" to "+e.to]=e}),(0,N.each)(Kr,e=>{ct[e.from+" to "+e.to]=e});function cs(e){const t=e.indexOf("+")!==0;e.indexOf("now")===-1&&(e=(t?"now-":"now")+e);let s=ct[e+" to now"];if(s)return s;t?s={from:e,to:"now",display:""}:s={from:"now",to:e,display:""};const r=/^now([-+])(\d+)(\w)/.exec(e);if(r){const a=r[3],i=parseInt(r[2],10),c=Xr[a];c&&(s.display=t?"Last ":"Next ",s.display+=i+" "+c.display,s.section=c.section,i>1&&(s.display+="s"))}else s.display=s.from+" to "+s.to,s.invalid=!0;return s}function ec(e,t){const s=ct[e.from.toString()+" to "+e.to.toString()];if(s)return s.display;const r={timeZone:t};if(isDateTime(e.from)&&isDateTime(e.to))return dateTimeFormat(e.from,r)+" to "+dateTimeFormat(e.to,r);if(isDateTime(e.from)){const a=dateMath.parse(e.to,!0,"utc");return a?dateTimeFormat(e.from,r)+" to "+dateTimeFormatTimeAgo(a,r):""}if(isDateTime(e.to)){const a=dateMath.parse(e.from,!1,"utc");return a?dateTimeFormatTimeAgo(a,r)+" to "+dateTimeFormat(e.to,r):""}return e.to.toString()==="now"?cs(e.from).display:e.from.toString()+" to "+e.to.toString()}const tc=e=>e.indexOf("$")===0||e.indexOf("+$")===0?!0:cs(e).invalid!==!0,sc=(e,t)=>{if(isDateTime(e.from))return timeZoneAbbrevation(e.from,{timeZone:t});const s=dateMath.parse(e.from,!0);return s?timeZoneAbbrevation(s,{timeZone:t}):""},rc=(e,t,s,r)=>{const a=dateTimeParse(e.from,{roundUp:!1,timeZone:t,fiscalYearStartMonth:s,format:r}),i=dateTimeParse(e.to,{roundUp:!0,timeZone:t,fiscalYearStartMonth:s,format:r});return dateMath.isMathString(e.from)||dateMath.isMathString(e.to)?{from:a,to:i,raw:e}:{from:a,to:i,raw:{from:a,to:i}}};function ls(e){return typeof e=="string"?e.indexOf("now")>=0:!1}function oc(e){return typeof e.raw.from=="string"&&e.raw.from.indexOf("f")>0?!0:typeof e.raw.to=="string"&&e.raw.to.indexOf("f")>0}function ac(e){return ls(e.from)||ls(e.to)}function Zr(e){const t=Math.floor(e/31536e3);if(t)return t+"y";const s=Math.floor(e%31536e3/86400);if(s)return s+"d";const r=Math.floor(e%31536e3%86400/3600);if(r)return r+"h";const a=Math.floor(e%31536e3%86400%3600/60);if(a)return a+"m";const i=Math.floor(e%31536e3%86400%3600%60);if(i)return i+"s";const c=Math.floor(e*1e3);return c?c+"ms":"less than a millisecond"}function ic(e){const t=Number((e/1e3).toFixed()),s=Math.floor(t/60/60),r=Math.floor(t/60)-s*60,a=Number((t%60).toFixed());let i=s?s+"h":"",c=r?r+"min":"",n=a?a+"sec":"";return i&&c?i=i+" ":i=i,(c||i)&&n?c=c+" ":c=c,i+c+n||"less than 1sec"}function nc(e,t,s){let r=1;s&&(r=ut(s));let a=qr((e.to.valueOf()-e.from.valueOf())/t);return r>a&&(a=r),{intervalMs:a,interval:Zr(a/1e3)}}const Yr=/(-?\d+(?:\.\d+)?)(ms|[Mwdhmsy])/,lt={y:31536e3,M:2592e3,w:604800,d:86400,h:3600,m:60,s:1,ms:.001};function us(e){if(Number(e))return{sec:lt.s,type:"s",count:parseInt(e,10)};const t=e.match(Yr);if(!t||!(0,N.has)(lt,t[2]))throw new Error(`Invalid interval string, has to be either unit-less or end with one of the following units: "${Object.keys(lt).join(", ")}"`);return{sec:lt[t[2]],type:t[2],count:parseInt(t[1],10)}}function cc(e){const t=us(e);return t.sec*t.count}function ut(e){const t=us(e);return t.sec*1e3*t.count}function qr(e){switch(!0){case e<10:return 1;case e<15:return 10;case e<35:return 20;case e<75:return 50;case e<150:return 100;case e<350:return 200;case e<750:return 500;case e<1500:return 1e3;case e<3500:return 2e3;case e<7500:return 5e3;case e<12500:return 1e4;case e<17500:return 15e3;case e<25e3:return 2e4;case e<45e3:return 3e4;case e<9e4:return 6e4;case e<21e4:return 12e4;case e<45e4:return 3e5;case e<75e4:return 6e5;case e<105e4:return 9e5;case e<15e5:return 12e5;case e<27e5:return 18e5;case e<54e5:return 36e5;case e<9e6:return 72e5;case e<162e5:return 108e5;case e<324e5:return 216e5;case e<864e5:return 432e5;case e<6048e5:return 864e5;case e<18144e5:return 6048e5;case e<36288e5:return 2592e6;default:return 31536e6}}function lc(e,t=dateTime()){const s=t.unix()-e.from.unix(),r=t.unix()-e.to.unix();return{from:s,to:r}}function uc(e,t=dateTime()){const s=dateTime(t).subtract(e.from,"s"),r=e.to===0?dateTime(t):dateTime(t).subtract(e.to,"s");return{from:s,to:r,raw:{from:s,to:r}}}class oe{static createISO8601Duration(t,s){const r=["hour","minute","h","m"];return(0,N.includes)(r,s)?`PT${t}${s[0].toUpperCase()}`:`P${t}${s[0].toUpperCase()}`}static createISO8601DurationFromInterval(t){const s=+t.slice(0,t.length-1),r=t[t.length-1];if(t.indexOf("ms")>-1)return oe.createISO8601Duration(1,"m");if(t[t.length-1]==="s"){let a=s*60%60;return a<1&&(a=1),oe.createISO8601Duration(a,"m")}return oe.createISO8601Duration(s,r)}static findClosestTimeGrain(t,s){const r=(0,N.filter)(s,c=>c!=="auto");let a=r[0];const i=ut(t);for(let c=0;c<r.length;c++)i>ut(r[c])&&(c+1<r.length?a=r[c+1]:a=r[c]);return a}static createTimeGrainFromISO8601Duration(t){let s=1;t.substring(0,2)==="PT"&&(s=2);const r=t.substring(s,t.length-1),a=t.substring(t.length-1);return r+" "+oe.timeUnitToText(+r,a)}static timeUnitToText(t,s){let r="";return s==="S"&&(r="second"),s==="M"&&(r="minute"),s==="H"&&(r="hour"),s==="D"&&(r="day"),t>1?r+"s":r}static createKbnUnitFromISO8601Duration(t){if(t==="auto")return"auto";let s=1;t.substring(0,2)==="PT"&&(s=2);const r=t.substring(s,t.length-1),a=t.substring(t.length-1);return r+oe.timeUnitToKbn(+r,a)}static timeUnitToKbn(t,s){return s==="S"?"s":s==="M"?"m":s==="H"?"h":s==="D"?"d":""}}class Y{static parseResponseValues(t,s,r){const a=[];if(!t)return a;for(let i=0;i<t.value.length;i++)if(!(0,N.find)(a,["value",(0,N.get)(t.value[i],r)])){const c=(0,N.get)(t.value[i],r),n=(0,N.get)(t.value[i],s,c);a.push({text:n,value:c})}return a}static parseResourceNames(t,s){const r=[];if(!t)return r;for(let a=0;a<t.value.length;a++)typeof t.value[a].type=="string"&&(!s||t.value[a].type.toLocaleLowerCase()===s.toLocaleLowerCase())&&r.push({text:t.value[a].name,value:t.value[a].name});return r}static parseMetadata(t,s){const r=["None","Average","Minimum","Maximum","Total","Count"],a=t?.value.find(i=>i.name.value===s);return a?{primaryAggType:a.primaryAggregationType,supportedAggTypes:a.supportedAggregationTypes||r,supportedTimeGrains:[{label:"Auto",value:"auto"},...Y.parseTimeGrains(a.metricAvailabilities??[])],dimensions:Y.parseDimensions(a.dimensions??[])}:{primaryAggType:"",supportedAggTypes:r,supportedTimeGrains:[],dimensions:[]}}static parseTimeGrains(t){const s=[];return t&&t.forEach(r=>{r.timeGrain&&s.push({label:oe.createTimeGrainFromISO8601Duration(r.timeGrain),value:r.timeGrain})}),s}static parseDimensions(t){return t.map(s=>({label:s.localizedValue||s.value,value:s.value}))}static parseSubscriptions(t){const s=[];if(!t)return s;const r="subscriptionId",a="displayName";for(let i=0;i<t.value.length;i++)(0,N.find)(s,["value",(0,N.get)(t.value[i],r)])||s.push({text:`${(0,N.get)(t.value[i],a)}`,value:(0,N.get)(t.value[i],r)});return s}static parseSubscriptionsForSelect(t){const s=[];if(!t)return s;const r="subscriptionId",a="displayName";for(let i=0;i<t.data.value.length;i++)(0,N.find)(s,["value",(0,N.get)(t.data.value[i],r)])||s.push({label:`${(0,N.get)(t.data.value[i],a)} - ${(0,N.get)(t.data.value[i],r)}`,value:(0,N.get)(t.data.value[i],r)});return s}static parseLocations(t){const s=[];if(!t)return s;for(const r of t.value)s.push({name:r.name,displayName:r.displayName,supportsLogs:void 0});return s}}const eo=(e,t)=>e.some(s=>s.options?eo(s.options,t):s.value===t),Dt=(e,t=[])=>{if(t.length===0)return[];const s=t.reduce((r,a)=>(r.add(a),r),new Set);return e.filter(r=>s.has(r.value))},to=e=>({value:e.value,label:e.text}),Ce=(e,t,s)=>{const r=[...e,t],a=e.map(i=>i.value.toLowerCase()).concat(t.options.map(i=>i.value));return s&&!a.includes(s.toLowerCase())&&r.push({label:s,value:s}),r},Pe={azureMonitor:"azuremonitor",logAnalytics:"loganalytics",appInsights:"appinsights",resourceGraph:"resourcegraph"};function mt(e,t){return typeof e=="string"?t.multi||t.includeAll&&!t.allValue?"'"+e+"'":e:typeof e=="number"?e:(0,N.map)(e,r=>typeof e=="number"?e:"'"+r+"'").join(",")}var mc=w(56744);const pc={subscriptions:[]};var d=(e=>(e.AzureMonitor="Azure Monitor",e.AzureResourceGraph="Azure Resource Graph",e.AzureTraces="Azure Traces",e.GrafanaTemplateVariableFn="Grafana Template Variable Function",e.LocationsQuery="Azure Regions",e.LogAnalytics="Azure Log Analytics",e.MetricNamesQuery="Azure Metric Names",e.NamespacesQuery="Azure Namespaces",e.ResourceGroupsQuery="Azure Resource Groups",e.ResourceNamesQuery="Azure Resource Names",e.SubscriptionsQuery="Azure Subscriptions",e.WorkspacesQuery="Azure Workspaces",e))(d||{});const dc={allowedTimeGrainsMs:[],dimensionFilters:[],resources:[]},fc={resources:[]},gc={filters:[],resources:[],traceTypes:[]},hc={filters:[]};var le=(e=>(e.Logs="logs",e.Table="table",e.TimeSeries="time_series",e.Trace="trace",e))(le||{});const bc={filters:[]};var Je=(e=>(e.Public="AzureCloud",e.China="AzureChinaCloud",e.USGovernment="AzureUSGovernment",e.None="",e))(Je||{});const so=Symbol("Concealed client secret");function pt(e){return e.jsonData.azureAuthType?e.jsonData.azureAuthType:e.jsonData.tenantId&&e.jsonData.clientId?"clientsecret":fe.config.azure.managedIdentityEnabled?"msi":"clientsecret"}function Ke(){switch(fe.config.azure.cloud){case Je.Public:case Je.None:case void 0:return"azuremonitor";case Je.China:return"chinaazuremonitor";case Je.USGovernment:return"govazuremonitor";default:throw new Error(`The cloud '${fe.config.azure.cloud}' not supported.`)}}function ms(e){switch(e){case"azuremonitor":return"https://portal.azure.com";case"chinaazuremonitor":return"https://portal.azure.cn";case"govazuremonitor":return"https://portal.azure.us";default:throw new Error("The cloud not supported.")}}function ps(e){switch(pt(e)){case"msi":case"workloadidentity":return Ke();case"clientsecret":return e.jsonData.cloudName||Ke()}}function ro(e){if(e.secureJsonFields.clientSecret)return so;{const t=e.secureJsonData?.clientSecret;return typeof t=="string"&&t.length>0?t:void 0}}function oo(e){switch(e.authType){case"msi":case"workloadidentity":return!0;case"clientsecret":return!!(e.azureCloud&&e.tenantId&&e.clientId&&e.clientSecret)}}function ao(e){const t=pt(e);switch(t){case"msi":case"workloadidentity":return t==="msi"&&fe.config.azure.managedIdentityEnabled||t==="workloadidentity"&&fe.config.azure.workloadIdentityEnabled?{authType:t}:{authType:"clientsecret",azureCloud:Ke()};case"clientsecret":return{authType:"clientsecret",azureCloud:e.jsonData.cloudName||Ke(),tenantId:e.jsonData.tenantId,clientId:e.jsonData.clientId,clientSecret:ro(e)}}}function io(e,t){switch(t.authType){case"msi":case"workloadidentity":if(t.authType==="msi"&&!fe.config.azure.managedIdentityEnabled)throw new Error("Managed Identity authentication is not enabled in Grafana config.");if(t.authType==="workloadidentity"&&!fe.config.azure.workloadIdentityEnabled)throw new Error("Workload Identity authentication is not enabled in Grafana config.");return e={...e,jsonData:{...e.jsonData,azureAuthType:t.authType}},e;case"clientsecret":return e={...e,jsonData:{...e.jsonData,azureAuthType:"clientsecret",cloudName:t.azureCloud||Ke(),tenantId:t.tenantId,clientId:t.clientId},secureJsonData:{...e.secureJsonData,clientSecret:typeof t.clientSecret=="string"?t.clientSecret:void 0},secureJsonFields:{...e.secureJsonFields,clientSecret:typeof t.clientSecret=="symbol"}},e}}var U=w(45193),L=w(69417),B=w(43925),H=w(85552);const M={components:{configEditor:{authType:{select:"data-testid auth-type"},azureCloud:{input:"data-testid azure-cloud"},tenantID:{input:"data-testid tenant-id"},clientID:{input:"data-testid client-id"},clientSecret:{input:"data-testid client-secret"},loadSubscriptions:{button:"data-testid load-subscriptions"},defaultSubscription:{input:"data-testid default-subscription"}},queryEditor:{header:{select:"data-testid azure-monitor-experimental-header"},resourcePicker:{select:{button:"data-testid resource-picker-select"},search:{input:"data-testid resource-picker-search"},apply:{button:"data-testid resource-picker-apply"},cancel:{button:"data-testid resource-picker-cancel"},advanced:{collapse:"data-testid resource-picker-advanced",subscription:{input:"data-testid resource-picker-subscription"},resourceGroup:{input:"data-testid resource-picker-resource-group"},namespace:{input:"data-testid resource-picker-namespace"},region:{input:"data-testid resource-picker-region"},resource:{input:"data-testid resource-picker-resource"}}},metricsQueryEditor:{container:{input:"data-testid azure-monitor-metrics-query-editor-with-experimental-ui"},metricName:{input:"data-testid metric-name"}},logsQueryEditor:{container:{input:"data-testid azure-monitor-logs-query-editor-with-experimental-ui"},formatSelection:{input:"data-testid format-selection"}},argsQueryEditor:{container:{input:"data-testid azure-monitor-arg-query-editor"},subscriptions:{input:"data-testid azure-monitor-args-subscription"}},tracesQueryEditor:{container:{input:"data-testid azure-monitor-traces-query-editor-with-experimental-ui"},traceTypes:{select:"data-testid azure-monitor-traces-query-editor-trace-types"}}},variableEditor:{queryType:{input:"data-testid query-type"},subscription:{input:"data-testid subscription"},resourceGroup:{input:"data-testid resource-group"},namespace:{input:"data-testid namespace"},resource:{input:"data-testid resource"},region:{input:"data-testid region"}}}},no=e=>{const{credentials:t,azureCloudOptions:s,onCredentialsChange:r,disabled:a,managedIdentityEnabled:i,workloadIdentityEnabled:c}=e,n=(0,o.useMemo)(()=>{let h=[{value:"clientsecret",label:"App Registration"}];return i&&h.push({value:"msi",label:"Managed Identity"}),c&&h.push({value:"workloadidentity",label:"Workload Identity"}),h},[i,c]),l=h=>{const f=i?"msi":c?"workloadidentity":"clientsecret",v={...t,authType:h.value||f};r(v)},u=h=>{if(t.authType==="clientsecret"){const f={...t,azureCloud:h.value};r(f)}},p=h=>{if(t.authType==="clientsecret"){const f={...t,tenantId:h.target.value};r(f)}},g=h=>{if(t.authType==="clientsecret"){const f={...t,clientId:h.target.value};r(f)}},b=h=>{if(t.authType==="clientsecret"){const f={...t,clientSecret:h.target.value};r(f)}},y=()=>{if(t.authType==="clientsecret"){const h={...t,clientSecret:""};r(h)}};return o.createElement(ns,{title:"Authentication"},n.length>1&&o.createElement(U.g,{label:"Authentication",description:"Choose the type of authentication to Azure services","data-testid":M.components.configEditor.authType.select,htmlFor:"authentication-type"},o.createElement(L.Ph,{className:"width-15",value:n.find(h=>h.value===t.authType),options:n,onChange:l,disabled:a})),t.authType==="clientsecret"&&o.createElement(o.Fragment,null,s&&o.createElement(U.g,{label:"Azure Cloud","data-testid":M.components.configEditor.azureCloud.input,htmlFor:"azure-cloud-type",disabled:a},o.createElement(L.Ph,{inputId:"azure-cloud-type","aria-label":"Azure Cloud",className:"width-15",value:s.find(h=>h.value===t.azureCloud),options:s,onChange:u})),o.createElement(U.g,{label:"Directory (tenant) ID",required:!0,"data-testid":M.components.configEditor.tenantID.input,htmlFor:"tenant-id",invalid:!t.tenantId,error:"Tenant ID is required"},o.createElement(B.I,{"aria-label":"Tenant ID",className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:t.tenantId||"",onChange:p,disabled:a})),o.createElement(U.g,{label:"Application (client) ID",required:!0,"data-testid":M.components.configEditor.clientID.input,htmlFor:"client-id",invalid:!t.clientId,error:"Client ID is required"},o.createElement(B.I,{className:"width-30","aria-label":"Client ID",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:t.clientId||"",onChange:g,disabled:a})),!a&&(typeof t.clientSecret=="symbol"?o.createElement(U.g,{label:"Client Secret",htmlFor:"client-secret",required:!0},o.createElement("div",{className:"width-30",style:{display:"flex",gap:"4px"}},o.createElement(B.I,{"aria-label":"Client Secret",placeholder:"configured",disabled:!0,"data-testid":"client-secret"}),o.createElement(H.zx,{variant:"secondary",type:"button",onClick:y,disabled:a},"Reset"))):o.createElement(U.g,{label:"Client Secret","data-testid":M.components.configEditor.clientSecret.input,required:!0,htmlFor:"client-secret",invalid:!t.clientSecret,error:"Client secret is required"},o.createElement(B.I,{className:"width-30","aria-label":"Client Secret",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:t.clientSecret||"",onChange:b,id:"client-secret",disabled:a})))),e.children)},vc=null,co=e=>{const{credentials:t,disabled:s,options:r,subscriptions:a,getSubscriptions:i,onSubscriptionChange:c,onSubscriptionsChange:n}=e,l=oo(t),[u,p]=(0,o.useReducer)(y=>y+1,0);(0,o.useEffect)(()=>{if(!i||!l){g([]);return}let y=!1;return i().then(h=>{y||g(h,u)}),()=>{y=!0}},[u]);const g=(y,h=!1)=>{n(y),i&&(h&&!r.subscriptionId&&y.length>0?b(y[0]):r.subscriptionId&&(y.find(v=>v.value===r.subscriptionId)||b(void 0)))},b=y=>c(y?.value);return o.createElement(o.Fragment,null,o.createElement(U.g,{label:"Default Subscription","data-testid":M.components.configEditor.defaultSubscription.input,htmlFor:"default-subscription"},o.createElement("div",{className:"width-30",style:{display:"flex",gap:"4px"}},o.createElement(L.Ph,{inputId:"default-subscription","aria-label":"Default Subscription",value:r.subscriptionId?a.find(y=>y.value===r.subscriptionId):void 0,options:a,onChange:b,disabled:s}),o.createElement(H.zx,{variant:"secondary",type:"button",onClick:p,disabled:!l||s,"data-testid":M.components.configEditor.loadSubscriptions.button},"Load Subscriptions"))))},lo=[{value:"azuremonitor",label:"Azure"},{value:"govazuremonitor",label:"Azure US Government"},{value:"chinaazuremonitor",label:"Azure China"}],uo=e=>{const{updateOptions:t,getSubscriptions:s,options:r}=e,[a,i]=(0,o.useState)([]),c=(0,o.useMemo)(()=>ao(e.options),[e.options]),n=(p,g)=>{g||i([]),t(b=>io({...b,jsonData:{...b.jsonData,subscriptionId:g}},p))},l=p=>i(p),u=p=>t(g=>({...g,jsonData:{...g.jsonData,subscriptionId:p}}));return o.createElement(o.Fragment,null,o.createElement(no,{managedIdentityEnabled:fe.config.azure.managedIdentityEnabled,workloadIdentityEnabled:fe.config.azure.workloadIdentityEnabled,credentials:c,azureCloudOptions:lo,onCredentialsChange:n,disabled:e.options.readOnly},o.createElement(co,{subscriptions:a,credentials:c,getSubscriptions:s,disabled:e.options.readOnly,onSubscriptionsChange:l,onSubscriptionChange:u,options:r.jsonData})))},wc=null;class mo extends o.PureComponent{constructor(t){super(t),this.templateSrv=(0,Fe.J)(),this.updateOptions=s=>{const r=s(this.props.options);this.props.onOptionsChange(r),this.setState({unsaved:!0})},this.saveOptions=async()=>{this.state.unsaved&&(await(0,Rt.i)().put(`/api/datasources/${this.props.options.id}`,this.props.options).then(s=>{Ne(this.props,"version",s.datasource.version)}),this.setState({unsaved:!1}))},this.getSubscriptions=async()=>{await this.saveOptions();const s="?api-version=2019-03-01";try{const r=await(0,Rt.i)().fetch({url:this.baseURL+s,method:"GET"}).toPromise();return this.setState({error:void 0}),Y.parseSubscriptionsForSelect(r)}catch(r){return(0,Rt.kW)(r)&&this.setState({error:{title:"Error requesting subscriptions",description:"Could not request subscriptions from Azure. Check your credentials and try again.",details:r?.data?.message}}),Promise.resolve([])}},this.state={unsaved:!1},this.baseURL=`/api/datasources/${this.props.options.id}/resources/${Pe.azureMonitor}/subscriptions`}render(){const{options:t,onOptionsChange:s}=this.props,{error:r}=this.state;return o.createElement(o.Fragment,null,o.createElement(Rr,{dataSourceName:"Azure Monitor",docsLink:"https://grafana.com/docs/grafana/latest/datasources/azure-monitor/",hasRequiredFields:!0}),o.createElement(It,null),o.createElement(uo,{options:t,updateOptions:this.updateOptions,getSubscriptions:this.getSubscriptions}),r&&o.createElement(Te.b,{severity:"error",title:r.title},o.createElement("p",null,r.description),r.details&&o.createElement("details",{style:{whiteSpace:"pre-wrap"}},r.details)),fe.config.secureSocksDSProxyEnabled&&o.createElement(o.Fragment,null,o.createElement(It,null),o.createElement(ns,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source. This includes Secure Socks Proxy.",isCollapsible:!0,isInitiallyOpen:t.jsonData.enableSecureSocksProxy!==void 0},o.createElement(Hr.i,{options:t,onOptionsChange:s}))))}}const Sc=null;var dt=w(64704),Lt=w(76759);function po(e){return(0,o.isValidElement)(e)?e:$e(e)}function $e(e){if(!e||typeof e!="object")return;if(typeof e.message=="string")return e.message;if(typeof e.data?.error?.message=="string")return e.data.error.message;const t=e.error?.data?.error?.innererror?.innererror?.message||e.error?.data?.error?.innererror?.message||e.error?.data?.error?.message||e.error?.data?.message||e.data?.message||e;if(typeof t=="string")return t;if(t&&t.toString)return t.toString()}function ds(){const[e,t]=(0,o.useState)([]),s=(0,o.useCallback)((a,i)=>{t(c=>{const n=[...c],l=c.findIndex(([u])=>u===a);return l>-1&&n.splice(l,1),i&&n.unshift([a,i]),n})},[]);return[(0,o.useMemo)(()=>{const a=e[0];return a&&po(a[1])},[e]),s]}var fs=Object.getOwnPropertySymbols,fo=Object.prototype.hasOwnProperty,go=Object.prototype.propertyIsEnumerable,ho=(e,t)=>{var s={};for(var r in e)fo.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(e!=null&&fs)for(var r of fs(e))t.indexOf(r)<0&&go.call(e,r)&&(s[r]=e[r]);return s};const ft=e=>{var t=e,{children:s}=t,r=ho(t,["children"]);const a=(0,k.wW)((0,o.useCallback)(i=>bo(i,r),[r]));return o.createElement("div",{className:a.root},s)},bo=(e,t)=>{var s,r,a;return{root:(0,m.css)({display:"flex",flexDirection:(s=t.direction)!=null?s:"row",flexWrap:(r=t.wrap)==null||r?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing((a=t.gap)!=null?a:2),flexGrow:t.flexGrow})}},gt=({children:e})=>o.createElement(ft,{gap:.5,direction:"column"},e),ge=({children:e})=>{const t=(0,k.wW)(yo);return o.createElement("div",{className:t.root},o.createElement(ft,{gap:2},e))},yo=e=>({root:(0,m.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)})}),he=({children:e})=>o.createElement(ft,{gap:1},e),vo=({query:e,onQueryChange:t})=>{const s=(0,o.useCallback)(r=>{t({...e,azureResourceGraph:{...e.azureResourceGraph,query:r}})},[t,e]);return o.createElement(Lt.p,{value:e.azureResourceGraph?.query??"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:s,onSave:s})};var wo=w(10809);const gs=e=>{const t=(0,k.wW)((0,o.useCallback)(s=>So(s,e),[e]));return o.createElement("span",{className:(0,m.cx)(t.wrapper)})};gs.defaultProps={v:0,h:0,layout:"block"};const So=(e,t)=>{var s,r;return{wrapper:(0,m.css)([{paddingRight:e.spacing((s=t.h)!=null?s:0),paddingBottom:e.spacing((r=t.v)!=null?r:0)},t.layout==="inline"&&{display:"inline-block"},t.layout==="block"&&{display:"block"}])}};var Eo=w(97668),Ft=w(76078),j=w(38374),ko=Object.defineProperty,ht=Object.getOwnPropertySymbols,hs=Object.prototype.hasOwnProperty,bs=Object.prototype.propertyIsEnumerable,ys=(e,t,s)=>t in e?ko(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,zo=(e,t)=>{for(var s in t||(t={}))hs.call(t,s)&&ys(e,s,t[s]);if(ht)for(var s of ht(t))bs.call(t,s)&&ys(e,s,t[s]);return e},Ao=(e,t)=>{var s={};for(var r in e)hs.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(e!=null&&ht)for(var r of ht(e))t.indexOf(r)<0&&bs.call(e,r)&&(s[r]=e[r]);return s};const No=e=>{var t;const s=e,{label:r,optional:a,tooltip:i,tooltipInteractive:c,children:n,width:l}=s,u=Ao(s,["label","optional","tooltip","tooltipInteractive","children","width"]),p=(0,k.wW)((0,o.useCallback)(y=>To(y,l),[l])),g=u?.htmlFor||((t=Eo)==null?void 0:t.getChildId(n)),b=o.createElement(o.Fragment,null,o.createElement("label",{className:p.label,htmlFor:g},r,a&&o.createElement("span",{className:p.optional}," - optional"),i&&o.createElement(Ft.u,{placement:"top",content:i,theme:"info",interactive:c},o.createElement(j.J,{tabIndex:0,name:"info-circle",size:"sm",className:p.icon}))),o.createElement(gs,{v:.5}));return o.createElement("div",{className:p.root},o.createElement(U.g,zo({className:p.field,label:b},u),n))},To=(e,t)=>({root:(0,m.css)({minWidth:e.spacing(t??0)}),label:(0,m.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium}),optional:(0,m.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,m.css)({marginBottom:0}),icon:(0,m.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})});var Ee=w(5387);const vs=18,ae=e=>{const{labelWidth:t,inlineField:s,...r}=e;return s?o.createElement(Ee._,{labelWidth:t||vs,...r}):o.createElement(No,{width:t||vs,...r})},Co=({query:e,subscriptions:t,variableOptionGroup:s,onQueryChange:r})=>{const[a,i]=(0,o.useState)(!1),[c,n]=(0,o.useState)([]),l=(0,o.useMemo)(()=>[...t,s],[t,s]);(0,o.useEffect)(()=>{e.subscriptions&&e.subscriptions.length>0?(n(Dt([...t,...s.options],e.subscriptions)),i(!1)):i(!0)},[e.subscriptions,t,s.options]);const u=p=>{if(!p||p.length===0)n([]),r({...e,subscriptions:[]}),i(!0);else{const g=p.map(b=>b.value??"");r({...e,subscriptions:g}),n(Dt([...t,...s.options],g)),i(!1)}};return o.createElement(ae,{label:"Subscriptions","data-testid":M.components.queryEditor.argsQueryEditor.subscriptions.input},o.createElement(o.Fragment,null,o.createElement(L.NU,{isClearable:!0,value:c,inputId:"azure-monitor-subscriptions-field",onChange:u,options:l,width:38}),a?o.createElement(wo.S,null,"At least one subscription must be chosen."):null))},ws="arg-subscriptions";function xo(e,t,s){let r=t||[];r.length===0&&s&&(r=[s]),r.length===0&&e.length&&(r=[e[0]]);const a=r.filter(c=>c.includes("$")),i=(0,N.intersection)(r,e).concat(a);return e.length&&r.length>i.length&&(r=i.length>0?i:[e[0]]),r}const Ss=({query:e,datasource:t,subscriptionId:s,variableOptionGroup:r,onChange:a,setError:i})=>{const[c,n]=(0,o.useState)([]);return(0,o.useMemo)(()=>{t.getSubscriptions().then(l=>{const u=l.map(p=>({label:p.text,value:p.value,description:p.value}));n(u),i(ws,void 0),a({...e,subscriptions:xo(u.map(p=>p.value),e.subscriptions,e.subscription)})}).catch(l=>i(ws,l))},[t]),o.createElement("span",{"data-testid":M.components.queryEditor.argsQueryEditor.container.input},o.createElement(gt,null,o.createElement(ge,null,o.createElement(he,null,o.createElement(Co,{subscriptions:c,query:e,datasource:t,subscriptionId:s,variableOptionGroup:r,onQueryChange:a,setError:i})))),o.createElement(vo,{query:e,datasource:t,subscriptionId:s,variableOptionGroup:r,onQueryChange:a,setError:i}))};var Pt=w(63541);const Es=({query:e,variableOptionGroup:t,onQueryChange:s,inputId:r,options:a,defaultValue:i,setFormatAs:c,resultFormat:n})=>{const l=(0,o.useMemo)(()=>[...a,t],[t,a]),u=(0,o.useCallback)(p=>{const{value:g}=p;if(!g)return;const b=c(e,g);s(b)},[s,e,c]);return(0,Pt.Z)(()=>{n?a.find(p=>p.value===n)||u({value:i}):u({value:i})}),o.createElement(ae,{label:"Format as","data-testid":M.components.queryEditor.logsQueryEditor.formatSelection.input},o.createElement(L.Ph,{inputId:`${r}-format-as-field`,value:n??i,onChange:u,options:l,width:38}))};var Mo=w(16749),ks=w(57353),zs=w(68420),Gt=w(70576),Ro=w(39418);function As(){typeof Gt.default.options.resources!="object"&&Gt.default.use(Ro.Db).init({resources:{},returnEmptyString:!1,lng:"en-US"})}const Nc=e=>(As(),React.createElement(I18NextTrans,{...e})),Io=Gt.default.t,Do=(e,t,s)=>(As(),Io(e,t,s));var Lo=(e=>(e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e))(Lo||{});const Ns=({children:e,orientation:t=0,spacing:s="sm",justify:r="flex-start",align:a="normal",wrap:i=!1,width:c="100%",height:n="100%",...l})=>{const u=(0,k.wW)(Fo,t,s,r,a,i);return o.createElement("div",{className:u.layout,style:{width:c,height:n},...l},o.Children.toArray(e).filter(Boolean).map((p,g)=>o.createElement("div",{className:u.childWrapper,key:g},p)))},Ue=({children:e,spacing:t,justify:s,align:r="center",wrap:a,width:i,height:c})=>o.createElement(Ns,{spacing:t,justify:s,orientation:0,align:r,width:i,height:c,wrap:a},e),Tc=({children:e,spacing:t,justify:s,align:r,width:a,height:i})=>React.createElement(Ns,{spacing:t,justify:s,orientation:1,align:r,width:a,height:i},e),Cc=({children:e,padding:t,margin:s,grow:r,shrink:a})=>{const i=useStyles2(Po,t,s);return React.createElement("div",{className:cx(i.wrapper,r!==void 0&&css({flexGrow:r}),a!==void 0&&css({flexShrink:a}))},e)},Fo=(e,t,s,r,a,i)=>{const c=s!=="none"?e.spacing(Ot[s]):0,n=t===0&&!i||t===1?0:`-${c}`,l=t===1?"vertical-group":"horizontal-group";return{layout:(0,m.css)({label:l,display:"flex",flexDirection:t===1?"column":"row",flexWrap:i?"wrap":"nowrap",justifyContent:r,alignItems:a,height:"100%",maxWidth:"100%",marginBottom:n}),childWrapper:(0,m.css)({label:"layoutChildrenWrapper",marginBottom:t===0&&!i?0:c,marginRight:t===0?c:0,display:"flex",alignItems:a,"&:last-child":{marginBottom:t===1?0:void 0,marginRight:t===0?0:void 0}})}},Ot={none:0,xs:.5,sm:1,md:2,lg:3},Po=(e,t,s)=>{const r=t&&t!=="none"&&e.spacing(Ot[t])||0,a=s&&s!=="none"&&e.spacing(Ot[s])||0;return{wrapper:css({label:"container",margin:a,padding:r})}},Qt=e=>{const t=e.shape.radius.default;return{modal:(0,m.css)({position:"fixed",zIndex:e.zIndex.modal,background:e.colors.background.primary,boxShadow:e.shadows.z3,borderRadius:t,border:`1px solid ${e.colors.border.weak}`,backgroundClip:"padding-box",outline:"none",width:"750px",maxWidth:"100%",left:0,right:0,marginLeft:"auto",marginRight:"auto",top:"10%",maxHeight:"80%",display:"flex",flexDirection:"column"}),modalBackdrop:(0,m.css)({position:"fixed",zIndex:e.zIndex.modalBackdrop,top:0,right:0,bottom:0,left:0,backgroundColor:e.components.overlay.background,backdropFilter:"blur(1px)"}),modalHeader:(0,m.css)({label:"modalHeader",display:"flex",alignItems:"center",minHeight:"42px",margin:e.spacing(1,2,0,2)}),modalHeaderWithTabs:(0,m.css)({borderBottom:`1px solid ${e.colors.border.weak}`}),modalHeaderTitle:(0,m.css)({fontSize:e.typography.size.lg,margin:e.spacing(0,4,0,1),display:"flex",alignItems:"center",position:"relative",top:"2px"}),modalHeaderIcon:(0,m.css)({marginRight:e.spacing(2),fontSize:"inherit","&:before":{verticalAlign:"baseline"}}),modalHeaderClose:(0,m.css)({height:"100%",display:"flex",alignItems:"center",color:e.colors.text.secondary,flexGrow:1,justifyContent:"flex-end"}),modalContent:(0,m.css)({overflow:"auto",padding:e.spacing(3),width:"100%"}),modalButtonRow:(0,m.css)({paddingTop:e.spacing(3)})}},Go=({icon:e,iconTooltip:t,title:s,children:r,id:a})=>{const i=(0,k.wW)(Qt);return o.createElement(o.Fragment,null,o.createElement("h2",{className:i.modalHeaderTitle,id:a},s),r)};function bt(e){const{title:t,children:s,isOpen:r=!1,closeOnEscape:a=!0,closeOnBackdropClick:i=!0,className:c,contentClassName:n,onDismiss:l,onClickBackdrop:u,trapFocus:p=!0}=e,g=(0,k.wW)(Qt),b=(0,o.useRef)(null),{overlayProps:y,underlayProps:h}=(0,zs.Ir)({isKeyboardDismissDisabled:!a,isOpen:r,onClose:l},b),{dialogProps:f,titleProps:v}=(0,Mo.R)({},b);if(!r)return null;const S=(0,m.cx)(g.modalHeader,typeof t!="string"&&g.modalHeaderWithTabs);return o.createElement(zs.Xj,null,o.createElement("div",{role:"presentation",className:g.modalBackdrop,onClick:u||(i?l:void 0),...h}),o.createElement(ks.MT,{contain:p,autoFocus:!0,restoreFocus:!0},o.createElement("div",{className:(0,m.cx)(g.modal,c),ref:b,...y,...f},o.createElement("div",{className:S},typeof t=="string"&&o.createElement(Qo,{...e,title:t,id:v.id}),typeof t!="string"&&t,o.createElement("div",{className:g.modalHeaderClose},o.createElement(Mt.h,{name:"times",size:"xl",onClick:l,"aria-label":Do("grafana-ui.modal.close-tooltip","Close")}))),o.createElement("div",{className:(0,m.cx)(g.modalContent,n)},s))))}function Oo({leftItems:e,children:t}){const s=(0,k.wW)(Qt);return e?o.createElement("div",{className:s.modalButtonRow},o.createElement(Ue,{justify:"space-between"},o.createElement(Ue,{justify:"flex-start",spacing:"md"},e),o.createElement(Ue,{justify:"flex-end",spacing:"md"},t))):o.createElement("div",{className:s.modalButtonRow},o.createElement(Ue,{justify:"flex-end",spacing:"md",wrap:!0},t))}bt.ButtonRow=Oo;function Qo({icon:e,iconTooltip:t,title:s,id:r}){return o.createElement(Go,{icon:e,iconTooltip:t,title:s,id:r})}var Vt=w(26933);const ie=e=>{const t=(0,k.wW)(Vo,e);return o.createElement("span",{className:(0,m.cx)(t.wrapper)})};ie.defaultProps={v:0,h:0,layout:"block"};const Vo=(e,t)=>({wrapper:(0,m.css)([{paddingRight:e.spacing(t.h??0),paddingBottom:e.spacing(t.v??0)},t.layout==="inline"&&{display:"inline-block"},t.layout==="block"&&{display:"block"}])}),Wo=e=>({collapse:(0,m.css)({label:"collapse",marginBottom:e.spacing(1),backgroundColor:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`,position:"relative",borderRadius:e.shape.radius.default,width:"100%",display:"flex",flexDirection:"column",flex:"1 1 0"}),collapseBody:(0,m.css)({label:"collapse__body",padding:e.spacing(e.components.panel.padding),paddingTop:0,flex:1,overflow:"hidden",display:"flex",flexDirection:"column"}),bodyContentWrapper:(0,m.css)({label:"bodyContentWrapper",flex:1,overflow:"hidden"}),loader:(0,m.css)({label:"collapse__loader",height:"2px",position:"relative",overflow:"hidden",background:"none",margin:e.spacing(.5)}),loaderActive:(0,m.css)({label:"collapse__loader_active","&:after":{content:"' '",display:"block",width:"25%",top:0,height:"250%",position:"absolute",animation:"loader 2s cubic-bezier(0.17, 0.67, 0.83, 0.67) 500ms",animationIterationCount:100,left:"-25%",background:e.colors.primary.main},"@keyframes loader":{from:{left:"-25%",opacity:.1},to:{left:"100%",opacity:1}}}),header:(0,m.css)({label:"collapse__header",padding:e.spacing(1,2,1,2),display:"flex",transition:"all 0.1s linear"}),headerCollapsed:(0,m.css)({label:"collapse__header--collapsed",padding:e.spacing(1,2,1,2)}),headerLabel:(0,m.css)({label:"collapse__header-label",fontWeight:e.typography.fontWeightMedium,marginRight:e.spacing(1),fontSize:e.typography.size.md,display:"flex",flex:"0 0 100%"}),icon:(0,m.css)({label:"collapse__icon",margin:e.spacing(.25,1,0,-1)})}),xc=({isOpen:e,onToggle:t,...s})=>{const[r,a]=useState(e);return React.createElement(yt,{isOpen:r,collapsible:!0,...s,onToggle:()=>{a(!r),t&&t(!r)}})},yt=({isOpen:e,label:t,loading:s,collapsible:r,onToggle:a,className:i,children:c})=>{const n=(0,k.wW)(H.gN),l=(0,k.wW)(Wo),u=()=>{a&&a(!e)},p=(0,m.cx)([l.collapse,i]),g=s?(0,m.cx)([l.loader,l.loaderActive]):(0,m.cx)([l.loader]),b=r?(0,m.cx)([l.header]):(0,m.cx)([l.headerCollapsed]);return o.createElement("div",{className:p},o.createElement("button",{type:"button",className:(0,m.cx)(n,b),onClick:u},r&&o.createElement(j.J,{className:l.icon,name:e?"angle-down":"angle-right"}),o.createElement("div",{className:(0,m.cx)([l.headerLabel])},t)),e&&o.createElement("div",{className:(0,m.cx)([l.collapseBody])},o.createElement("div",{className:g}),o.createElement("div",{className:l.bodyContentWrapper},c)))};yt.displayName="Collapse";const $o=({resources:e,onChange:t,renderAdvanced:s})=>{const[r,a]=(0,o.useState)(!!e.length&&JSON.stringify(e).includes("$"));return o.createElement("div",{"data-testid":M.components.queryEditor.resourcePicker.advanced.collapse},o.createElement(yt,{collapsible:!0,label:"Advanced",isOpen:r,onToggle:()=>a(!r)},s(e,t),o.createElement(ie,{v:2})))};var Uo=w(10575),ke=w(95561),Wt=w(33080);const $t=o.forwardRef(({label:e,description:t,value:s,htmlValue:r,onChange:a,disabled:i,className:c,indeterminate:n,invalid:l,...u},p)=>{const g=(0,o.useCallback)(h=>{a&&a(h)},[a]),b=(0,k.wW)(Bo,l),y=n?"mixed":void 0;return o.createElement("label",{className:(0,m.cx)(b.wrapper,c)},o.createElement("div",{className:b.checkboxWrapper},o.createElement("input",{type:"checkbox",className:(0,m.cx)(b.input,n&&b.inputIndeterminate),checked:s,disabled:i,onChange:g,value:r,"aria-checked":y,...u,ref:p}),o.createElement("span",{className:b.checkmark})),e&&o.createElement("span",{className:b.label},e),t&&o.createElement("span",{className:b.description},t))}),Bo=(e,t=!1)=>{const s=(0,Wt.F)(e),r=2,a=1,i=c=>t?e.colors.error.border:c;return{wrapper:(0,m.css)({display:"inline-grid",alignItems:"center",columnGap:e.spacing(a),gridAutoRows:"max-content",position:"relative",verticalAlign:"middle"}),input:(0,m.css)({position:"absolute",zIndex:1,top:0,left:0,width:"100% !important",height:"100%",opacity:0,"&:focus + span, &:focus-visible + span":(0,ke.SV)(e),"&:focus:not(:focus-visible) + span":(0,ke.Cq)(e),"&:checked + span":{background:e.colors.primary.main,border:`1px solid ${i(e.colors.primary.main)}`,"&:hover":{background:e.colors.primary.shade},"&:after":{content:'""',position:"absolute",zIndex:2,left:"4px",top:0,width:"6px",height:"12px",border:`solid ${e.colors.primary.contrastText}`,borderWidth:"0 3px 3px 0",transform:"rotate(45deg)"}},"&:disabled + span":{backgroundColor:e.colors.action.disabledBackground,cursor:"not-allowed",border:`1px solid ${i(e.colors.action.disabledBackground)}`,"&:hover":{backgroundColor:e.colors.action.disabledBackground},"&:after":{borderColor:e.colors.action.disabledText}}}),inputIndeterminate:(0,m.css)({"&[aria-checked='mixed'] + span":{border:`1px solid ${i(e.colors.primary.main)}`,background:e.colors.primary.main,"&:hover":{background:e.colors.primary.shade},"&:after":{content:'""',position:"absolute",zIndex:2,left:"2px",right:"2px",top:"calc(50% - 1.5px)",height:"3px",border:`1.5px solid ${e.colors.primary.contrastText}`,backgroundColor:e.colors.primary.contrastText,width:"auto",transform:"none"}},"&:disabled[aria-checked='mixed'] + span":{backgroundColor:e.colors.action.disabledBackground,border:`1px solid ${i(e.colors.error.transparent)}`,"&:after":{borderColor:e.colors.action.disabledText}}}),checkboxWrapper:(0,m.css)({display:"flex",alignItems:"center",gridColumnStart:1,gridRowStart:1}),checkmark:(0,m.css)({position:"relative",zIndex:2,display:"inline-block",width:e.spacing(r),height:e.spacing(r),borderRadius:e.shape.radius.default,background:e.components.input.background,border:`1px solid ${i(e.components.input.borderColor)}`,"&:hover":{cursor:"pointer",borderColor:i(e.components.input.borderHover)}}),label:(0,m.cx)(s.label,(0,m.css)({gridColumnStart:2,gridRowStart:1,position:"relative",zIndex:2,cursor:"pointer",maxWidth:"fit-content",lineHeight:e.typography.bodySmall.lineHeight,marginBottom:0})),description:(0,m.cx)(s.description,(0,m.css)({gridColumnStart:2,gridRowStart:2,lineHeight:e.typography.bodySmall.lineHeight,marginTop:0}))}};$t.displayName="Checkbox";var F=(e=>(e.Subscription="Subscription",e.ResourceGroup="ResourceGroup",e.Resource="Resource",e.VariableGroup="TemplateVariableGroup",e.Variable="TemplateVariable",e))(F||{});const jo=({isOpen:e,entry:{type:t}})=>{switch(t){case F.Subscription:return o.createElement(j.J,{name:"layer-group"});case F.ResourceGroup:return o.createElement(j.J,{name:e?"folder-open":"folder"});case F.Resource:return o.createElement(j.J,{name:"cube"});case F.VariableGroup:return o.createElement(j.J,{name:"x"});case F.Variable:return o.createElement(j.J,{name:"x"});default:return null}},Ze=e=>({table:(0,m.css)({width:"100%",tableLayout:"fixed",overflow:"scroll"}),scrollableTable:(0,m.css)({overflow:"auto"}),tableScroller:(0,m.css)({maxHeight:"16vh"}),selectedTableScroller:(0,m.css)({maxHeight:"13vh"}),header:(0,m.css)({background:e.colors.background.secondary}),row:(0,m.css)({borderBottom:`1px solid ${e.colors.border.weak}`,"&:last-of-type":{borderBottomColor:e.colors.border.medium}}),disabledRow:(0,m.css)({opacity:.5}),cell:(0,m.css)({padding:e.spacing(1,1,1,0),width:"25%",overflow:"hidden",textOverflow:"ellipsis","&:first-of-type":{width:"50%",padding:e.spacing(1,1,1,2)}}),collapseButton:(0,m.css)({margin:0}),loadingCell:(0,m.css)({textAlign:"center"}),spinner:(0,m.css)({marginBottom:0}),nestedEntry:(0,m.css)({display:"flex",alignItems:"center"}),entryContentItem:(0,m.css)({margin:e.spacing(0,1,0,0)}),truncated:(0,m.css)({minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),resourceField:(0,m.css)({maxWidth:e.spacing(36),overflow:"hidden"}),resourceFieldButton:(0,m.css)({padding:"7px",textAlign:"left"}),nestedRowCheckbox:(0,m.css)({zIndex:0}),selectionFooter:(0,m.css)({background:e.colors.background.primary,paddingTop:e.spacing(2)}),loadingWrapper:(0,m.css)({textAlign:"center",paddingTop:e.spacing(2),paddingBottom:e.spacing(2),color:e.colors.text.secondary}),resultLimit:(0,m.css)({margin:"4px 0",fontStyle:"italic"}),modal:(0,m.css)({width:e.breakpoints.values.lg})}),_o=({entry:e,isSelected:t,isDisabled:s,isOpen:r,isSelectable:a,level:i,scrollIntoView:c,onToggleCollapse:n,onSelectedChange:l})=>{const u=(0,k.l4)(),p=(0,k.wW)(Ze),g=!!e.children,b=(0,o.useCallback)(()=>{n(e)},[n,e]),y=(0,o.useCallback)(f=>{const v=f.target.checked;l(e,v)},[e,l]),h=`${c?"table":"summary"}_checkbox_${e.uri}`;return(0,o.useEffect)(()=>{t&&c&&document.getElementById(h)?.scrollIntoView({behavior:"smooth",block:"center"})},[]),o.createElement("div",{className:p.nestedEntry,style:{marginLeft:i*(3*u.spacing.gridSize)}},g?o.createElement(Mt.h,{className:p.collapseButton,name:r?"angle-down":"angle-right","aria-label":r?`Collapse ${e.name}`:`Expand ${e.name}`,onClick:b,id:e.id}):o.createElement(ie,{layout:"inline",h:2}),o.createElement(ie,{layout:"inline",h:2}),a&&o.createElement(o.Fragment,null,o.createElement($t,{id:h,onChange:y,disabled:s,value:t,className:p.nestedRowCheckbox}),o.createElement(ie,{layout:"inline",h:2})),o.createElement(jo,{entry:e,isOpen:r}),o.createElement(ie,{layout:"inline",h:1}),o.createElement("label",{htmlFor:h,className:(0,m.cx)(p.entryContentItem,p.truncated)},e.name))};var Ho=w(16826);class Ge{static buildResourceUri(t,s,r){const a=[],{subscription:i,resourceGroup:c,metricNamespace:n,resourceName:l}=s;if(i&&(a.push("/subscriptions",i),c&&!r&&(a.push("resourceGroups",c),n&&l))){const u=t.replace(n),p=n.split("/"),g=t.replace(l),b=l.split("/"),y=p.shift();if(y&&a.push("providers",y),u.toLowerCase().startsWith("microsoft.storage/storageaccounts/")&&!g.endsWith("default")&&b.push("default"),b.length>p.length){const h=b.shift();h&&a.push(h)}for(const h in p)a.push(p[h]),a.push(b[h])}return a.join("/")}static buildAzureMonitorGetMetricNamespacesUrl(t,s,r,a,i){let c;if("resourceUri"in r)c=r.resourceUri;else{const{subscription:n,resourceGroup:l,metricNamespace:u,resourceName:p}=r;c=Ge.buildResourceUri(i,{subscription:n,resourceGroup:l,metricNamespace:u,resourceName:p})}return`${t}${c}/providers/microsoft.insights/metricNamespaces?api-version=${s}${a?"&region=global":""}`}static buildAzureMonitorGetMetricNamesUrl(t,s,r,a,i,c){let n;const{customNamespace:l,metricNamespace:u}=r;if("resourceUri"in r)n=r.resourceUri;else{const{subscription:g,resourceGroup:b,metricNamespace:y,resourceName:h}=r;n=Ge.buildResourceUri(a,{subscription:g,resourceGroup:b,metricNamespace:y,resourceName:h},i)}let p=`${t}${n}/providers/microsoft.insights/metricdefinitions?api-version=${s}`;return l&&(p+=`&metricnamespace=${encodeURIComponent(l)}`),i&&!l&&u&&(p+=`&metricnamespace=${encodeURIComponent(u)}`),c&&i&&(p+=`&region=${c}`),p}}const Xo=/\/subscriptions\/(?<subscription>[^/]+)(?:\/resourceGroups\/(?<resourceGroup>[^/]+)(?:\/providers\/(?<metricNamespaceAndResource>.+))?)?/;function Jo(e){if(!e)return{};const t=e.split("/"),s=t.splice(0,2),r=t.splice(0,1);for(;t.length;){const a=t.shift();t.length%2===0?r.push(a):s.push(a)}return{metricNamespace:s.join("/"),resourceName:r.join("/")}}function vt(e){const s=Xo.exec(e)?.groups??{},{subscription:r,resourceGroup:a,metricNamespaceAndResource:i}=s,{metricNamespace:c,resourceName:n}=Jo(i);return{subscription:r,resourceGroup:a,metricNamespace:c,resourceName:n}}function Oe(e,t){return e.map(s=>q(s,t))}function q(e,t){if(typeof e=="string"){const s=vt(e);return t&&(s.region=t),s}return e}function Ut(e){return e.map(t=>wt(t))}function wt(e){return e?typeof e=="string"?e:Ge.buildResourceUri((0,Fe.J)(),e):""}function Ts(e){return!!e.match(/^[A-Z0-9]+/i)}function Ko(e,t,s,r){return s?.startsWith("microsoft.storage/storageaccounts")&&(s="microsoft.storage/storageaccounts",r?.endsWith("/default")&&(r=r.slice(0,-8))),e===s&&t===r}function Cs(e,t){const s=q(t),r=q(e);return r?.subscription===s?.subscription&&r?.resourceGroup?.toLowerCase()===s?.resourceGroup?.toLowerCase()&&Ko(r?.metricNamespace?.toLowerCase(),r?.resourceName,s?.metricNamespace?.toLowerCase(),s?.resourceName)}function Zo(e,t){const s=[];return t.forEach(r=>{const a=Be(e,r);a&&s.push(a)}),s}function Be(e,t){for(const s of e){if(Cs(s.uri,t))return s;if(s.children){const r=Be(s.children,t);if(r)return r}}}function Bt(e,t,s){return(0,Ho.Uy)(e,r=>{const a=Be(r,t);a&&(a.children=s)})}function Yo(e,t,s){if(t==="logs")return{...e,azureLogAnalytics:{...e.azureLogAnalytics,resources:Ut(s).filter(a=>a!=="")}};if(t==="traces")return{...e,azureTraces:{...e.azureTraces,resources:Ut(s).filter(a=>a!=="")}};const r=s.length?q(s[0]):{};return{...e,subscription:r.subscription,azureMonitor:{...e.azureMonitor,metricNamespace:r.metricNamespace?.toLocaleLowerCase(),region:r.region,resources:Oe(s).filter(a=>a.resourceName!==""&&a.metricNamespace!==""&&a.subscription!==""&&a.resourceGroup!==""),metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]}}}const xs=({row:e,selectedRows:t,level:s,requestNestedRows:r,onRowSelectedChange:a,selectableEntryTypes:i,scrollIntoView:c,disableRow:n})=>{const l=(0,k.wW)(Ze),[u,p]=(0,o.useState)("closed"),g=!!t.find(f=>f.uri.toLowerCase()===e.uri.toLowerCase()),b=!g&&n(e,t),y=u==="open",h=async()=>{if(u==="open"){p("closed");return}p("loading"),r(e).then(()=>p("open")).catch(()=>p("closed"))};return(0,o.useEffect)(()=>{const f=t[0];f&&!!Be(e.children??[],f.uri)&&p("open")},[t,e]),o.createElement(o.Fragment,null,o.createElement("tr",{className:(0,m.cx)(l.row,b&&l.disabledRow),key:e.id},o.createElement("td",{className:l.cell},o.createElement(_o,{level:s,isSelected:g,isDisabled:b,isOpen:y,entry:e,onToggleCollapse:h,onSelectedChange:a,isSelectable:i.some(f=>f===e.type),scrollIntoView:c})),o.createElement("td",{className:l.cell},e.typeLabel),o.createElement("td",{className:l.cell},e.location??"-")),y&&e.children&&Object.keys(e.children).length>0&&e.children.map(f=>o.createElement(xs,{key:f.uri,row:f,selectedRows:t,level:s+1,requestNestedRows:r,onRowSelectedChange:a,selectableEntryTypes:i,scrollIntoView:c,disableRow:n})),o.createElement(Uo.n,{visible:u==="loading"},o.createElement("tr",null,o.createElement("td",{className:(0,m.cx)(l.cell,l.loadingCell),colSpan:3},o.createElement(Vt.u,{text:"Loading...",className:l.spinner})))))},Ms=xs,qo=({searchFn:e})=>{const[t,s]=(0,o.useState)(""),r=(0,o.useMemo)(()=>(0,N.debounce)(e,600),[e]);return(0,o.useEffect)(()=>()=>{r.cancel()},[r]),o.createElement(B.I,{"aria-label":"resource search",prefix:o.createElement(j.J,{name:"search"}),value:t,onChange:a=>{const i=a.currentTarget.value;s(i),r(i)},placeholder:"search for a resource","data-testid":M.components.queryEditor.resourcePicker.search.input})},ea=({resourcePickerData:e,resources:t,onApply:s,onCancel:r,selectableEntryTypes:a,queryType:i,disableRow:c,renderAdvanced:n,selectionNotice:l})=>{const u=(0,k.wW)(Ze),[p,g]=(0,o.useState)(!1),[b,y]=(0,o.useState)([]),[h,f]=(0,o.useState)([]),[v,S]=(0,o.useState)(t),[E,A]=(0,o.useState)(void 0),[z,W]=(0,o.useState)(!1),ee=l?.(h);(0,o.useEffect)(()=>{S(t)},[t]);const ne=(0,o.useCallback)(async()=>{if(!p){try{g(!0);const T=await e.fetchInitialRows(i,Oe(v??{}));y(T)}catch(T){A($e(T))}g(!1)}},[v,p,e,i]);(0,Pt.Z)(()=>{ne()});const ye=T=>typeof T=="string"?T!=="":T.subscription&&T.resourceGroup&&T.resourceName&&T.metricNamespace;(0,o.useEffect)(()=>{v||f([]);const T=v.filter($=>ye($)),Q=v&&Zo(b,Ut(T));return T?.length>Q.length?f(e.parseRows(T)):Q&&Q.length?f(Q):f([])},[v,b,e]);const Qe=(0,o.useCallback)(async T=>{if(A(void 0),!T.children?.length)try{const Q=await e.fetchAndAppendNestedRow(b,T,i);y(Q)}catch(Q){throw A($e(Q)),Q}},[e,b,i]),Ve=(0,o.useCallback)((T,Q)=>{if(Q){const $=i==="logs"?T.uri:Oe([T.uri],T.location)[0],Me=v?v.concat($):[$];S(Me.filter(ue=>ye(ue)))}else{const $=v?.filter(Me=>!Cs(wt(Me),T.uri));S($)}},[i,v,S]),et=(0,o.useCallback)(()=>{v&&s(i==="logs"?v:Oe(v))},[i,v,s]),tt=(0,o.useCallback)(async T=>{if(A(void 0),W(!1),!T){ne();return}try{g(!0);const Q=await e.search(T,i);y(Q),Q.length>=e.resultLimit&&W(!0)}catch(Q){A($e(Q))}g(!1)},[ne,e,i]);return o.createElement(o.Fragment,null,o.createElement(qo,{searchFn:tt}),z?o.createElement("p",{className:u.resultLimit},"Showing first ",e.resultLimit," results"):o.createElement(ie,{v:2}),o.createElement("table",{className:u.table},o.createElement("thead",null,o.createElement("tr",{className:(0,m.cx)(u.row,u.header)},o.createElement("td",{className:u.cell},"Scope"),o.createElement("td",{className:u.cell},"Type"),o.createElement("td",{className:u.cell},"Location")))),o.createElement("div",{className:(0,m.cx)(u.scrollableTable,u.tableScroller)},o.createElement("table",{className:u.table},o.createElement("tbody",null,p&&o.createElement("tr",{className:(0,m.cx)(u.row)},o.createElement("td",{className:u.cell},o.createElement(Vt.u,{text:"Loading..."}))),!p&&b.length===0&&o.createElement("tr",{className:(0,m.cx)(u.row)},o.createElement("td",{className:u.cell,"aria-live":"polite"},"No resources found")),!p&&b.map(T=>o.createElement(Ms,{key:T.uri,row:T,selectedRows:h,level:0,requestNestedRows:Qe,onRowSelectedChange:Ve,selectableEntryTypes:a,scrollIntoView:!0,disableRow:c}))))),o.createElement("footer",{className:u.selectionFooter},h.length>0&&o.createElement(o.Fragment,null,o.createElement("h5",null,"Selection"),o.createElement("div",{className:(0,m.cx)(u.scrollableTable,u.selectedTableScroller)},o.createElement("table",{className:u.table},o.createElement("tbody",null,h.map(T=>o.createElement(Ms,{key:T.uri,row:T,selectedRows:h,level:0,requestNestedRows:Qe,onRowSelectedChange:Ve,selectableEntryTypes:a,disableRow:()=>!1}))))),o.createElement(ie,{v:2}),ee?.length?o.createElement(Te.b,{title:"",severity:"info"},ee):null),o.createElement($o,{resources:v,onChange:T=>S(T),renderAdvanced:n}),E&&o.createElement(o.Fragment,null,o.createElement(ie,{v:2}),o.createElement(Te.b,{severity:"error",title:"An error occurred while requesting resources from Azure Monitor"},E)),o.createElement(bt.ButtonRow,null,o.createElement(H.zx,{onClick:r,variant:"secondary",fill:"outline"},"Cancel"),o.createElement(H.zx,{disabled:!!E||!v.every(ye),onClick:et,"data-testid":M.components.queryEditor.resourcePicker.apply.button},"Apply"))))},ta=({query:e,datasource:t,onQueryChange:s,selectableEntryTypes:r,queryType:a,resources:i,inlineField:c,labelWidth:n,disableRow:l,renderAdvanced:u,selectionNotice:p})=>{const g=(0,k.wW)(Ze),[b,y]=(0,o.useState)(!1),h=(0,o.useCallback)(()=>{y(!0)},[]),f=(0,o.useCallback)(()=>{y(!1)},[]),v=(0,o.useCallback)(S=>{s(Yo(e,a,S)),f()},[f,s,e,a]);return o.createElement("span",{"data-testid":M.components.queryEditor.resourcePicker.select.button},o.createElement(bt,{className:g.modal,title:"Select a resource",isOpen:b,onDismiss:f,trapFocus:!1},o.createElement(ea,{resourcePickerData:t.resourcePickerData,resources:i,onApply:v,onCancel:f,selectableEntryTypes:r,queryType:a,disableRow:l,renderAdvanced:u,selectionNotice:p})),o.createElement(ae,{label:"Resource",inlineField:c,labelWidth:n},o.createElement(H.zx,{className:g.resourceFieldButton,variant:"secondary",onClick:h,type:"button"},o.createElement(sa,{resources:i,datasource:t}))))},sa=({resources:e,datasource:t})=>{const[s,r]=(0,o.useState)(Oe(e));return(0,o.useEffect)(()=>{r(Oe(e))},[e]),e.length?o.createElement(ra,{resources:s}):o.createElement(o.Fragment,null,"Select a resource")},ra=({resources:e})=>{const t=(0,k.wW)(Ze);let s="cube";const r=[];return e.forEach(a=>{if(a.resourceName){r.push(a.resourceName.split("/")[0]);return}if(a.resourceGroup){s="folder",r.push(a.resourceGroup);return}if(a.subscription){s="layer-group",r.push(a.subscription);return}}),o.createElement("span",{className:(0,m.cx)(t.truncated,t.resourceField)},o.createElement(j.J,{name:s}),r.join(", "))},jt=ta;var oa=Object.defineProperty,aa=Object.defineProperties,ia=Object.getOwnPropertyDescriptors,St=Object.getOwnPropertySymbols,Rs=Object.prototype.hasOwnProperty,Is=Object.prototype.propertyIsEnumerable,Ds=(e,t,s)=>t in e?oa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,na=(e,t)=>{for(var s in t||(t={}))Rs.call(t,s)&&Ds(e,s,t[s]);if(St)for(var s of St(t))Is.call(t,s)&&Ds(e,s,t[s]);return e},ca=(e,t)=>aa(e,ia(t)),la=(e,t)=>{var s={};for(var r in e)Rs.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(e!=null&&St)for(var r of St(e))t.indexOf(r)<0&&Is.call(e,r)&&(s[r]=e[r]);return s};const Et=e=>{var t=e,{className:s}=t,r=la(t,["className"]);const a=(0,k.wW)(ua);return o.createElement(H.zx,ca(na({},r),{className:(0,m.cx)(s,a.button)}))},ua=e=>({button:(0,m.css)({paddingLeft:e.spacing(3/2),paddingRight:e.spacing(3/2)})}),ma=e=>({resourceList:(0,m.css)({width:"100%",display:"flex",marginBlock:e.spacing(1)})}),Ls=({resources:e,onChange:t})=>{const s=(0,k.wW)(ma);(0,o.useEffect)(()=>{e.length===0&&t([""])},[e,t]);const r=(c,n)=>{const l=[...e];l[c]=n,t(l)},a=c=>{const n=[...e];n.splice(c,1),t(n)},i=()=>{t(e.concat(""))};return o.createElement(o.Fragment,null,o.createElement(Wt._,null,o.createElement("h6",null,"Resource URI(s)"," ",o.createElement(Ft.u,{content:o.createElement(o.Fragment,null,"Manually edit the"," ",o.createElement("a",{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/logs/log-standard-columns#_resourceid",rel:"noopener noreferrer",target:"_blank"},"resource uri"),". Supports the use of multiple template variables (ex: /subscriptions/$subId/resourceGroups/$rg)"),placement:"right",interactive:!0},o.createElement(j.J,{name:"info-circle"})))),e.map((c,n)=>o.createElement("div",{key:`resource-${n+1}`},o.createElement("div",{className:s.resourceList},o.createElement(B.I,{id:`input-advanced-resource-picker-${n+1}`,value:c,onChange:l=>r(n,l.currentTarget.value),placeholder:"ex: /subscriptions/$subId","data-testid":`input-advanced-resource-picker-${n+1}`}),o.createElement(Et,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>a(n),"data-testid":"remove-resource",hidden:e.length===1})))),o.createElement(H.zx,{"aria-label":"Add",icon:"plus",variant:"secondary",onClick:i,type:"button"},"Add resource URI"))};function _t(e,t){return{...e,azureLogAnalytics:{...e.azureLogAnalytics,query:t}}}function pa(e,t){return{...e,azureLogAnalytics:{...e.azureLogAnalytics,resultFormat:t}}}function da(e,t){return{...e,azureLogAnalytics:{...e.azureLogAnalytics,dashboardTime:t}}}function Fs(e,t){return{...e,azureLogAnalytics:{...e.azureLogAnalytics,timeColumn:t}}}const fa=({query:e,onQueryChange:t,schema:s})=>{const[r,a]=(0,o.useState)();(0,o.useEffect)(()=>{if(!s||!r)return;(async({monaco:l,editor:u},p)=>{try{const g=l.languages,b=u.getModel();b&&await(await(await g.kusto.getKustoWorker())(b?.uri)).setSchema(p)}catch(g){console.error(g)}})(r,s).catch(l=>console.error(l))},[s,r]);const i=(0,o.useCallback)((n,l)=>{a({monaco:l,editor:n})},[]),c=(0,o.useCallback)(n=>{t(_t(e,n))},[t,e]);return o.createElement(Lt.p,{value:e.azureLogAnalytics?.query??"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:c,onSave:c,onEditorDidMount:i})};var ga=w(95674);function ha({query:e,onQueryChange:t,schema:s}){const[r,a]=(0,o.useState)(),[i,c]=(0,o.useState)(),n=(0,o.useCallback)(u=>t(Fs(e,u)),[e,t]);(0,o.useEffect)(()=>{if(s&&e.azureLogAnalytics?.dashboardTime){const u=[],p=new Set,g=new Map,b=s.database;if(b)for(const h of b.tables){const f=h.columns.reduce((v,S,E)=>(S.type==="datetime"&&(!h.timespanColumn||h.timespanColumn!==S.name)&&(v.push({value:S.name,label:`${h.name} > ${S.name}`}),p.add(S.name)),v),[]);u.push(...f),h.timespanColumn&&!g.has(h.timespanColumn)&&g.set(h.timespanColumn,{value:h.timespanColumn,label:h.timespanColumn})}c(u);const y=Array.from(g.values());if(a(y),!e.azureLogAnalytics.timeColumn||e.azureLogAnalytics.timeColumn&&!p.has(e.azureLogAnalytics.timeColumn)&&!g.has(e.azureLogAnalytics.timeColumn))if(y&&y.length){n(y[0].value),n(y[0].value);return}else if(u&&u.length){n(u[0].value);return}else{n("TimeGenerated");return}}},[s,e.azureLogAnalytics?.dashboardTime,e.azureLogAnalytics?.timeColumn,n]);const l=(0,o.useCallback)(u=>{if(!u.value)return;const p=Fs(e,u.value);t(p)},[t,e]);return o.createElement(o.Fragment,null,o.createElement(Ee._,{label:"Time-range",tooltip:o.createElement("span",null,"Specifies the time-range used to query. The ",o.createElement("code",null,"Query")," option will only use time-ranges specified in the query. ",o.createElement("code",null,"Dashboard")," will only use the Grafana time-range.")},o.createElement(ga.S,{options:[{label:"Query",value:!1},{label:"Dashboard",value:!0}],value:e.azureLogAnalytics?.dashboardTime??!1,size:"md",onChange:u=>t(da(e,u))})),e.azureLogAnalytics?.dashboardTime&&o.createElement(Ee._,{label:"Time Column",tooltip:o.createElement("span",null,"Specifies the time column used for filtering. Defaults to the first tables ",o.createElement("code",null,"timeSpan")," column, the first ",o.createElement("code",null,"datetime")," column found or ",o.createElement("code",null,"TimeGenerated"),".")},o.createElement(L.Ph,{options:[{label:"Default time columns",options:r??[{value:"TimeGenerated",label:"TimeGenerated"}]},{label:"Other time columns",options:i??[]}],onChange:l,value:e.azureLogAnalytics?.timeColumn?e.azureLogAnalytics?.timeColumn:r?r[0]:i?i[0]:{value:"TimeGenerated",label:"TimeGenerated"},allowCustomValue:!0})))}async function ba(e,t,s){if(t.azureLogAnalytics?.workspace!==void 0&&!t.azureLogAnalytics.resources){const r=Ts(t.azureLogAnalytics.workspace);let a;r?a=await e.resourcePickerData.getResourceURIFromWorkspace(t.azureLogAnalytics.workspace):a=t.azureLogAnalytics.workspace;const i={...t,azureLogAnalytics:{...t.azureLogAnalytics,resource:a,workspace:void 0}};delete i.azureLogAnalytics.workspace,s(i)}}function ya(e,t,s){const[r,a]=(0,o.useState)();return(0,o.useEffect)(()=>{ba(e,t,s).catch(i=>a({title:"Unable to migrate workspace as a resource",message:i.message}))},[e,t,s]),r}const Ps=({query:e,datasource:t,subscriptionId:s,variableOptionGroup:r,onChange:a,setError:i,hideFormatAs:c,timeRange:n,data:l})=>{const u=ya(t,e,a),p=(h,f)=>{if(f.length===0)return!1;const v=q(h.uri,h.location).metricNamespace?.toLowerCase(),S=q(f[0].uri,f[0].location).metricNamespace?.toLowerCase();return v!==S},[g,b]=(0,o.useState)();(0,o.useEffect)(()=>{e.azureLogAnalytics?.resources&&e.azureLogAnalytics.resources.length&&t.azureLogAnalyticsDatasource.getKustoSchema(e.azureLogAnalytics.resources[0]).then(h=>{b(h)})},[e.azureLogAnalytics?.resources,t.azureLogAnalyticsDatasource]);let y=null;if(l?.series){const h=l.series.find(f=>f.refId===e.refId);h&&h.meta?.custom?.azurePortalLink&&(y=o.createElement(o.Fragment,null,o.createElement(H.Qj,{size:"md",target:"_blank",style:{marginTop:"22px"},href:h.meta?.custom?.azurePortalLink},"View query in Azure Portal")))}return o.createElement("span",{"data-testid":M.components.queryEditor.logsQueryEditor.container.input},o.createElement(gt,null,o.createElement(ge,null,o.createElement(he,null,o.createElement(jt,{query:e,datasource:t,inlineField:!0,labelWidth:10,subscriptionId:s,variableOptionGroup:r,onQueryChange:a,setError:i,selectableEntryTypes:[F.Subscription,F.ResourceGroup,F.Resource,F.Variable],resources:e.azureLogAnalytics?.resources??[],queryType:"logs",disableRow:p,renderAdvanced:(h,f)=>o.createElement(Ls,{resources:h,onChange:f}),selectionNotice:()=>"You may only choose items of the same resource type."}),o.createElement(ha,{query:e,datasource:t,variableOptionGroup:r,onQueryChange:a,setError:i,schema:g}))),o.createElement(fa,{query:e,datasource:t,subscriptionId:s,variableOptionGroup:r,onQueryChange:a,setError:i,schema:g}),o.createElement(ge,null,o.createElement(he,null,!c&&o.createElement(Es,{query:e,datasource:t,subscriptionId:s,variableOptionGroup:r,onQueryChange:a,setError:i,inputId:"azure-monitor-logs",options:[{label:"Log",value:le.Logs},{label:"Time series",value:le.TimeSeries},{label:"Table",value:le.Table}],defaultValue:le.Logs,setFormatAs:pa,resultFormat:e.azureLogAnalytics?.resultFormat}),y,u&&o.createElement(Te.b,{title:u.title},u.message)))))};var Gs=w(96561);const va=({children:e,href:t})=>{const{inner:s}=(0,k.wW)(wa);return t?o.createElement("a",{className:s,href:t},e):o.createElement(o.Fragment,null,e)},wa=e=>({inner:(0,m.css)({display:"flex",width:"100%",padding:e.spacing(2)})}),Sa=({children:e,disableEvents:t,disableHover:s,isSelected:r,className:a,href:i,...c})=>{const{oldContainer:n}=(0,k.wW)(Os,t,s,r);return o.createElement("div",{...c,className:(0,m.cx)(n,a)},o.createElement(va,{href:i},e))},Os=(e,t=!1,s=!1,r)=>{const a=r!==void 0;return{container:(0,m.css)({display:"grid",position:"relative",gridTemplateColumns:"auto 1fr auto",gridTemplateRows:"1fr auto auto auto",gridAutoColumns:"1fr",gridAutoFlow:"row",gridTemplateAreas:`
        "Figure Heading Tags"
        "Figure Meta Tags"
        "Figure Description Tags"
        "Figure Actions Secondary"`,width:"100%",padding:e.spacing(2),background:e.colors.background.secondary,borderRadius:e.shape.radius.default,marginBottom:"8px",pointerEvents:t?"none":"auto",transition:e.transitions.create(["background-color","box-shadow","border-color","color"],{duration:e.transitions.duration.short}),...!s&&{"&:hover":{background:e.colors.emphasize(e.colors.background.secondary,.03),cursor:"pointer",zIndex:1},"&:focus":ke.SV(e)},...a&&{cursor:"pointer"},...r&&{outline:`solid 2px ${e.colors.primary.border}`}}),oldContainer:(0,m.css)({display:"flex",width:"100%",background:e.colors.background.secondary,borderRadius:e.shape.radius.default,position:"relative",pointerEvents:t?"none":"auto",marginBottom:e.spacing(1),transition:e.transitions.create(["background-color","box-shadow","border-color","color"],{duration:e.transitions.duration.short}),...!s&&{"&:hover":{background:e.colors.emphasize(e.colors.background.secondary,.03),cursor:"pointer",zIndex:1},"&:focus":ke.SV(e)}})}},Ht=o.createContext(null),be=({disabled:e,href:t,onClick:s,children:r,isSelected:a,className:i,...c})=>{const n=(0,o.useMemo)(()=>o.Children.toArray(r).some(g=>o.isValidElement(g)&&g.type===kt),[r]),l=e||!s&&!t,u=s&&!e?s:void 0,p=(0,k.wW)(Os,e,l,a);return o.createElement(Sa,{disableEvents:e,disableHover:l,isSelected:a,className:(0,m.cx)(p.container,i),...c},o.createElement(Ht.Provider,{value:{href:t,onClick:u,disabled:e,isSelected:a}},!n&&o.createElement(kt,null),r))},kt=({children:e,className:t,"aria-label":s})=>{const r=(0,o.useContext)(Ht),a=(0,k.wW)(Qs),{href:i,onClick:c,isSelected:n}=r??{href:void 0,onClick:void 0,isSelected:void 0};return o.createElement("h2",{className:(0,m.cx)(a.heading,t)},i?o.createElement("a",{href:i,className:a.linkHack,"aria-label":s,onClick:c},e):c?o.createElement("button",{onClick:c,className:a.linkHack,"aria-label":s,type:"button"},e):o.createElement(o.Fragment,null,e),n!==void 0&&o.createElement("input",{"aria-label":"option",type:"radio",checked:n,readOnly:!0}))};kt.displayName="Heading";const Qs=e=>({heading:(0,m.css)({gridArea:"Heading",justifySelf:"start",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",marginBottom:0,fontSize:e.typography.size.md,letterSpacing:"inherit",lineHeight:e.typography.body.lineHeight,color:e.colors.text.primary,fontWeight:e.typography.fontWeightMedium,"& input[readonly]":{cursor:"inherit"}}),linkHack:(0,m.css)({all:"unset","&::after":{position:"absolute",content:'""',top:0,bottom:0,left:0,right:0,borderRadius:e.shape.radius.default},"&:focus-visible":{outline:"none",outlineOffset:0,boxShadow:"none","&::after":{...(0,ke.SV)(e),zIndex:1}}})}),Vs=({children:e,className:t})=>{const s=(0,k.wW)(Ws);return o.createElement("div",{className:(0,m.cx)(s.tagList,t)},e)};Vs.displayName="Tags";const Ws=e=>({tagList:(0,m.css)({position:"relative",gridArea:"Tags",alignSelf:"center"})}),$s=({children:e,className:t})=>{const s=(0,k.wW)(Us);return o.createElement("p",{className:(0,m.cx)(s.description,t)},e)};$s.displayName="Description";const Us=e=>({description:(0,m.css)({width:"100%",gridArea:"Description",margin:e.spacing(1,0,0),color:e.colors.text.secondary,lineHeight:e.typography.body.lineHeight})}),Bs=({children:e,align:t="start",className:s})=>{const r=(0,k.wW)(js);return o.createElement("div",{className:(0,m.cx)(r.media,s,(0,m.css)({alignSelf:t}))},e)};Bs.displayName="Figure";const js=e=>({media:(0,m.css)({position:"relative",gridArea:"Figure",marginRight:e.spacing(2),width:"40px","> img":{width:"100%"},"&:empty":{display:"none"}})}),_s=(0,o.memo)(({children:e,className:t,separator:s="|"})=>{const r=(0,k.wW)(Hs);let a=e;const i=o.Children.toArray(e).filter(Boolean);return i.length?(a=i.map((c,n)=>o.createElement("div",{key:`element_${n}`,className:r.metadataItem},c)),i.length>1&&s&&(a=i.reduce((c,n,l)=>[c,o.createElement("span",{key:`separator_${l}`,className:r.separator},s),n])),o.createElement("div",{className:(0,m.cx)(r.metadata,t)},a)):null});_s.displayName="Meta";const Hs=e=>({metadata:(0,m.css)({gridArea:"Meta",display:"flex",alignItems:"center",width:"100%",fontSize:e.typography.size.sm,color:e.colors.text.secondary,margin:e.spacing(.5,0,0),lineHeight:e.typography.bodySmall.lineHeight,overflowWrap:"anywhere"}),metadataItem:(0,m.css)({zIndex:0}),separator:(0,m.css)({margin:`0 ${e.spacing(1)}`})}),Xs=({children:e,disabled:t,variant:s,className:r})=>{const a=(0,k.wW)(Js),c=(0,o.useContext)(Ht)?.disabled||t,n=s==="primary"?a.actions:a.secondaryActions;return o.createElement("div",{className:(0,m.cx)(n,r)},o.Children.map(e,l=>o.isValidElement(l)?(0,o.cloneElement)(l,{disabled:c,...l.props}):null))},Js=e=>({actions:(0,m.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",gap:e.spacing(1),gridArea:"Actions",marginTop:e.spacing(2)}),secondaryActions:(0,m.css)({alignSelf:"center",color:e.colors.text.secondary,display:"flex",flexDirection:"row",flexWrap:"wrap",gap:e.spacing(1),gridArea:"Secondary",marginTop:e.spacing(2)})}),Ks=({children:e,disabled:t,className:s})=>o.createElement(Xs,{variant:"primary",disabled:t,className:s},e);Ks.displayName="Actions";const Zs=({children:e,disabled:t,className:s})=>o.createElement(Xs,{variant:"secondary",disabled:t,className:s},e);Zs.displayName="SecondaryActions";const Gc=e=>({inner:css({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",flexWrap:"wrap"}),...Qs(e),...Hs(e),...Us(e),...js(e),...Js(e),...Ws(e)});be.Heading=kt,be.Tags=Vs,be.Figure=Bs,be.Meta=_s,be.Actions=Ks,be.SecondaryActions=Zs,be.Description=$s;var Ea=w(72470),ka=w.n(Ea);function za({query:e,lang:t,className:s}){const r=(0,k.l4)(),a=Aa(r),i=ka().highlight(e,t.grammar,t.name);return o.createElement("div",{className:(0,m.cx)(a.editorField,"prism-syntax-highlight",s),"aria-label":"selector",dangerouslySetInnerHTML:{__html:i}})}const Aa=e=>({editorField:(0,m.css)({fontFamily:e.typography.fontFamilyMonospace,fontSize:e.typography.bodySmall.fontSize})}),Na=[{label:"fields",documentation:"Retrieves the specified fields from log events"},{label:"display",documentation:"Specifies which fields to display in the query results"},{label:"filter",documentation:"Filters the results of a query based on one or more conditions"},{label:"stats",documentation:"Calculates aggregate statistics based on the values of log fields"},{label:"sort",documentation:"Sorts the retrieved log events"},{label:"limit",documentation:"Specifies the number of log events returned by the query"},{label:"parse",documentation:"Extracts data from a log field, creating one or more ephemeral fields that you can process further in the query"}],Oc=null,Qc=null,Ta=[{label:"abs",detail:"abs(a)",documentation:"Absolute value."},{label:"ceil",detail:"ceil(a)",documentation:"Round to ceiling (the smallest integer that is greater than the value of a)."},{label:"floor",detail:"floor(a)",documentation:"Round to floor (the largest integer that is smaller than the value of a)."},{label:"greatest",detail:"greatest(a,b, ... z)",documentation:"Returns the largest value."},{label:"least",detail:"least(a, b, ... z)",documentation:"Returns the smallest value."},{label:"log",detail:"log(a)",documentation:"Natural logarithm."},{label:"sqrt",detail:"sqrt(a)",documentation:"Square root."}],Ca=[{label:"ispresent",detail:"ispresent(fieldname)",documentation:"Returns true if the field exists."},{label:"coalesce",detail:"coalesce(fieldname1, fieldname2, ... fieldnamex)",documentation:"Returns the first non-null value from the list."}],xa=[{label:"isempty",detail:"isempty(fieldname)",documentation:"Returns true if the field is missing or is an empty string."},{label:"isblank",detail:"isblank(fieldname)",documentation:"Returns true if the field is missing, an empty string, or contains only white space."},{label:"concat",detail:"concat(string1, string2, ... stringz)",documentation:"Concatenates the strings."},{label:"ltrim",detail:"ltrim(string) or ltrim(string1, string2)",documentation:"Remove white space from the left of the string. If the function has a second string argument, it removes the characters of string2 from the left of string1."},{label:"rtrim",detail:"rtrim(string) or rtrim(string1, string2)",documentation:"Remove white space from the right of the string. If the function has a second string argument, it removes the characters of string2 from the right of string1."},{label:"trim",detail:"trim(string) or trim(string1, string2)",documentation:"Remove white space from both ends of the string. If the function has a second string argument, it removes the characters of string2 from both sides of string1."},{label:"strlen",detail:"strlen(string)",documentation:"Returns the length of the string in Unicode code points."},{label:"toupper",detail:"toupper(string)",documentation:"Converts the string to uppercase."},{label:"tolower",detail:"tolower(string)",documentation:"Converts the string to lowercase."},{label:"substr",detail:"substr(string1, x), or substr(string1, x, y)",documentation:"Returns a substring from the index specified by the number argument to the end of the string. If the function has a second number argument, it contains the length of the substring to be retrieved."},{label:"replace",detail:"replace(string1, string2, string3)",documentation:"Replaces all instances of string2 in string1 with string3."},{label:"strcontains",detail:"strcontains(string1, string2)",documentation:"Returns 1 if string1 contains string2 and 0 otherwise."}],Ma=[{label:"bin",detail:"bin(period)",documentation:"Rounds the value of @timestamp to the given period and then truncates."},{label:"datefloor",detail:"datefloor(a, period)",documentation:"Truncates the timestamp to the given period."},{label:"dateceil",detail:"dateceil(a, period)",documentation:"Rounds up the timestamp to the given period and then truncates."},{label:"fromMillis",detail:"fromMillis(fieldname)",documentation:"Interprets the input field as the number of milliseconds since the Unix epoch and converts it to a timestamp."},{label:"toMillis",detail:"toMillis(fieldname)",documentation:"Converts the timestamp found in the named field into a number representing the milliseconds since the Unix epoch."}],Ys=[{label:"isValidIp",detail:"isValidIp(fieldname)",documentation:"Returns true if the field is a valid v4 or v6 IP address."},{label:"isValidIpV4",detail:"isValidIpV4(fieldname)",documentation:"Returns true if the field is a valid v4 IP address."},{label:"isValidIpV6",detail:"isValidIpV6(fieldname)",documentation:"Returns true if the field is a valid v6 IP address."},{label:"isIpInSubnet",detail:"isIpInSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v4 or v6 IP address within the specified v4 or v6 subnet."},{label:"isIpv4InSubnet",detail:"isIpv4InSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v4 IP address within the specified v4 subnet."},{label:"isIpv6InSubnet",detail:"isIpv6InSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v6 IP address within the specified v6 subnet."}],Vc=[{label:"ispresent",detail:"ispresent(fieldname)",documentation:"Returns true if the field exists."},{label:"isempty",detail:"isempty(fieldname)",documentation:"Returns true if the field is missing or is an empty string."},{label:"isblank",detail:"isblank(fieldname)",documentation:"Returns true if the field is missing, an empty string, or contains only white space."},{label:"strcontains",detail:"strcontains(string1, string2)",documentation:"Returns 1 if string1 contains string2 and 0 otherwise."},...Ys],Ra=[{label:"avg",detail:"avg(NumericFieldname)",documentation:"The average of the values in the specified field."},{label:"count",detail:"count(fieldname) or count(*)",documentation:"Counts the log records."},{label:"count_distinct",detail:"count_distinct(fieldname)",documentation:"Returns the number of unique values for the field."},{label:"max",detail:"max(fieldname)",documentation:"The maximum of the values for this log field in the queried logs."},{label:"min",detail:"min(fieldname)",documentation:"The minimum of the values for this log field in the queried logs."},{label:"pct",detail:"pct(fieldname, value)",documentation:"A percentile indicates the relative standing of a value in a datas."},{label:"stddev",detail:"stddev(NumericFieldname)",documentation:"The standard deviation of the values in the specified field."},{label:"sum",detail:"sum(NumericFieldname)",documentation:"The sum of the values in the specified field."}],Ia=[{label:"earliest",detail:"earliest(fieldname)",documentation:"Returns the value of fieldName from the log event that has the earliest time stamp in the queried logs."},{label:"latest",detail:"latest(fieldname)",documentation:"Returns the value of fieldName from the log event that has the latest time stamp in the queried logs."},{label:"sortsFirst",detail:"sortsFirst(fieldname)",documentation:"Returns the value of fieldName that sorts first in the queried logs."},{label:"sortsLast",detail:"sortsLast(fieldname)",documentation:"Returns the value of fieldName that sorts last in the queried logs."}],Da=[...Ra,...Ia],La=["as","like","by","in","desc","asc"],Fa=[...[...Ta,...Ca,...xa,...Ma,...Ys],...Da],Pa={comment:{pattern:/^#.*/,greedy:!0},backticks:{pattern:/`.*?`/,alias:"string",greedy:!0},quote:{pattern:/".*?"/,alias:"string",greedy:!0},regex:{pattern:/\/.*?\/(?=\||\s*$|,)/,greedy:!0},"query-command":{pattern:new RegExp(`\\b(?:${Na.map(e=>e.label).join("|")})\\b`,"i"),alias:"function"},function:{pattern:new RegExp(`\\b(?:${Fa.map(e=>e.label).join("|")})\\b`,"i")},keyword:{pattern:new RegExp(`(\\s+)(${La.join("|")})(?=\\s+)`,"i"),lookbehind:!0},"log-group-name":{pattern:/[\.\-_/#A-Za-z0-9]+/},"field-name":{pattern:/(@?[_a-zA-Z]+[_.0-9a-zA-Z]*)|(`((\\`)|([^`]))*?`)/,greedy:!0},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,"command-separator":{pattern:/\|/,alias:"punctuation"},"comparison-operator":{pattern:/([<>]=?)|(!?=)/},punctuation:/[{}()`,.]/,whitespace:/\s+/},Ga=e=>{const[t,s]=(0,o.useState)(null),[r,a]=(0,o.useState)({}),[i,c]=(0,o.useState)(null),[n,l]=(0,o.useState)(!0),[u,p]=(0,o.useState)(""),g=(0,k.wW)(Oa),b={grammar:Pa,name:"kql"},y=(0,o.useMemo)(()=>t?Object.keys(t).map(S=>({label:S,value:S})):[],[t]),h=async()=>{await e.datasource.getAzureLogAnalyticsCheatsheetQueries().then(S=>{S.categories.sort((A,z)=>A.displayName.toLowerCase()===z.displayName.toLowerCase()?0:A.displayName.toLowerCase()<z.displayName.toLowerCase()?-1:1);const E=S.categories.reduce((A,z)=>{const W=z.related.queries.map(ee=>S.queries.find(ne=>ne.id===ee));return A[z.displayName]=W,a({...r,[z.id]:!1}),A},{});return s(E),c(E),l(!1),E})};(0,o.useEffect)(()=>{t||h()});const f=S=>{const E=Object.keys(i);if(S.length>0&&t){const A=Object.keys(t).reduce((z,W)=>{const ee=t[W].filter(ne=>ne.displayName.toLowerCase().includes(S.toLowerCase()));return E.includes(W)&&(z[W]=ee),z},{});return c(A),A}else return Object.keys(i).length!==Object.keys(t).length?(c(i),i):(c(t),t)},v=S=>{if(S.length>0){const A=S.map(z=>z.label).reduce((z,W)=>(z[W]=t[W],z),{});c(A)}else c(t)};return o.createElement("div",null,!n&&i?o.createElement("div",null,o.createElement("div",{className:g.filterAlignment},o.createElement(B.I,{value:u,onChange:S=>{p(S.currentTarget.value);const E=f(S.currentTarget.value);c(E)},placeholder:"Search Logs queries",width:40}),o.createElement(U.g,{label:"Categories",className:g.categoryDropdown},o.createElement(L.Ph,{options:y,value:"",onChange:S=>v(S),allowCustomValue:!1,backspaceRemovesValue:!0,placeholder:"All categories",isClearable:!0,noOptionsMessage:"Unable to list all categories",formatCreateLabel:S=>`Category: ${S}`,isSearchable:!0,isMulti:!0,width:40}))),o.createElement("div",{className:g.spacing},"Query results:"," ",Object.keys(i).reduce((S,E)=>(S=i[E].length+S,S),0)),o.createElement(Gs.$,{showScrollIndicators:!0,autoHeightMax:"350px"},Object.keys(i).map(S=>{if(i[S].length)return o.createElement(yt,{label:S+` (${i[S].length})`,collapsible:!0,isOpen:r[S],onToggle:E=>a({...r,[S]:E}),key:S},i[S].map(E=>o.createElement(be,{className:g.card,key:E.id},o.createElement(be.Heading,null,E.displayName),o.createElement(Gs.$,{showScrollIndicators:!0,autoHeightMax:"100px"},o.createElement(za,{"aria-label":`${E.displayName} raw query`,query:E.body,lang:b,className:g.rawQuery})),o.createElement(be.Actions,null,o.createElement(H.zx,{size:"sm","aria-label":"use this query button",onClick:()=>{e.onChange({refId:"A",queryType:d.LogAnalytics,azureLogAnalytics:{query:E.body},datasource:e.datasource}),(0,dt.ff)("grafana_azure_cheatsheet_logs_query_selected",{id:E.id,queryName:E.displayName,query:E.body,queryCategories:E.related.categories})}},"Use this query")))))}))):o.createElement(Vt.u,{text:"Loading..."}))},Oa=e=>({card:(0,m.css)({width:"90%",display:"flex",flexDirection:"column"}),rawQuery:(0,m.css)({backgroundColor:`${e.colors.background.primary}`,padding:`${e.spacing(1)}`,marginTop:`${e.spacing(1)}`}),spacing:(0,m.css)({marginBottom:`${e.spacing(1)}`}),filterAlignment:(0,m.css)({display:"flex"}),categoryDropdown:(0,m.css)({margin:"0 0 10px 10px",display:"flex",flexDirection:"row",alignItems:"center"})}),Qa=e=>{const{isOpen:t,onClose:s,datasource:r,onChange:a}=e;return o.createElement(bt,{"aria-label":"Kick start your query modal",isOpen:t,title:"Kick start your query",onDismiss:s},o.createElement(Ga,{onChange:i=>{a(i),s()},query:{refId:"A"},datasource:r}))},Xt={"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems":"Backup Items","microsoft.resources/subscriptions":"Subscriptions","microsoft.resources/subscriptions/resourcegroups":"Resource groups","citrix.services/xenappessentials":"Citrix Virtual Apps Essentials","citrix.services/xendesktopessentials":"Citrix Virtual Desktops Essentials","dynatrace.observability/monitors":"Dynatrace","github.enterprise/accounts":"GitHub AE","microsoft.aad/domainservices":"Azure AD Domain Services","microsoft.aadiam/privatelinkforazuread":"Private Link for Azure AD","microsoft.agfoodplatform/farmbeats":"Azure FarmBeats","microsoft.analysisservices/servers":"Analysis Services","microsoft.anybuild/clusters":"AnyBuild clusters","microsoft.apimanagement/service":"API Management services","microsoft.appconfiguration/configurationstores":"App Configuration","microsoft.appplatform/spring":"Azure Spring Cloud","microsoft.attestation/attestationproviders":"Attestation providers","microsoft.authorization/resourcemanagementprivatelinks":"Resource management private links","microsoft.automation/automationaccounts":"Automation Accounts","microsoft.automation/automationaccounts/runbooks":"Runbook","microsoft.autonomoussystems/workspaces":"Bonsai","microsoft.avs/privateclouds":"AVS Private clouds","microsoft.azureactivedirectory/b2cdirectories":"B2C Tenants","microsoft.azureactivedirectory/guestusages":"Guest Usages","microsoft.azurearcdata/datacontrollers":"Azure Arc data controllers","microsoft.azurearcdata/postgresinstances":"Azure Arc-enabled PostgreSQL Hyperscale server groups","microsoft.azurearcdata/sqlmanagedinstances":"SQL managed instances - Azure Arc","microsoft.azurearcdata/sqlserverinstances":"SQL Server - Azure Arc","microsoft.azuredata/sqlserverregistrations":"SQL Server registries","microsoft.azurepercept/accounts":"Azure Percept accounts","microsoft.azurestackhci/clusters":"Azure Stack HCI","microsoft.azurestackhci/virtualmachines":"Azure Stack HCI virtual machine - Azure Arc","microsoft.baremetal/crayservers":"Cray Servers","microsoft.baremetal/monitoringservers":"Monitoring Servers","microsoft.baremetalinfrastructure/baremetalinstances":"BareMetal Instances","microsoft.batch/batchaccounts":"Batch accounts","microsoft.bing/accounts":"Bing Resources","microsoft.botservice/botservices":"Bot Services","microsoft.cache/redis":"Azure Cache for Redis","microsoft.cache/redisenterprise":"Redis Enterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies":"Content Delivery Network WAF policies","microsoft.cdn/profiles (front doors standard/premium":"Preview)","microsoft.cdn/profiles/afdendpoints":"Endpoints","microsoft.cdn/profiles/endpoints":"Endpoints","microsoft.certificateregistration/certificateorders":"App Service Certificates","microsoft.chaos/chaosexperiments":"Chaos Experiments (Classic)","microsoft.chaos/experiments":"Chaos Experiments","microsoft.classiccompute/domainnames":"Cloud services (classic)","microsoft.classiccompute/virtualmachines":"Virtual machines (classic)","microsoft.classicnetwork/networksecuritygroups":"Network security groups (classic)","microsoft.classicnetwork/reservedips":"Reserved IP addresses (classic)","microsoft.classicnetwork/virtualnetworks":"Virtual networks (classic)","microsoft.classicstorage/storageaccounts":"Storage accounts (classic)","microsoft.cloudtest/accounts":"CloudTest Accounts","microsoft.cloudtest/hostedpools":"1ES Hosted Pools","microsoft.cloudtest/images":"CloudTest Images","microsoft.cloudtest/pools":"CloudTest Pools","microsoft.clusterstor/nodes":"ClusterStors","microsoft.cognitiveservices/accounts":"Cognitive Services","microsoft.compute/availabilitysets":"Availability sets","microsoft.compute/capacityreservationgroups":"Capacity Reservation Groups","microsoft.compute/cloudservices":"Cloud services (extended support)","microsoft.compute/diskaccesses":"Disk Accesses","microsoft.compute/diskencryptionsets":"Disk Encryption Sets","microsoft.compute/disks":"Disks","microsoft.compute/galleries":"Azure compute galleries","microsoft.compute/galleries/applications":"VM application definitions","microsoft.compute/galleries/applications/versions":"VM application versions","microsoft.compute/galleries/images":"VM image definitions","microsoft.compute/galleries/images/versions":"VM image versions","microsoft.compute/hostgroups":"Host groups","microsoft.compute/hostgroups/hosts":"Hosts","microsoft.compute/images":"Images","microsoft.compute/proximityplacementgroups":"Proximity placement groups","microsoft.compute/restorepointcollections":"Restore Point Collections","microsoft.compute/snapshots":"Snapshots","microsoft.compute/sshpublickeys":"SSH keys","microsoft.compute/virtualmachines":"Virtual machines","microsoft.compute/virtualmachinescalesets":"Virtual machine scale sets","microsoft.confidentialledger/ledgers":"Confidential Ledgers","microsoft.confluent/organizations":"Confluent organizations","microsoft.connectedcache/cachenodes":"Connected Cache Resources","microsoft.connectedcache/enterprisecustomers":"Connected Cache Resources","microsoft.connectedvehicle/platformaccounts":"Connected Vehicle Platforms","microsoft.connectedvmwarevsphere/vcenters":"VMware vCenters","microsoft.connectedvmwarevsphere/virtualmachines":"VMware + AVS virtual machines","microsoft.containerinstance/containergroups":"Container instances","microsoft.containerregistry/registries":"Container registries","microsoft.containerregistry/registries/replications":"Container registry replications","microsoft.containerregistry/registries/webhooks":"Container registry webhooks","microsoft.containerservice/managedclusters":"Kubernetes services","microsoft.dashboard/grafana":"Grafana Workspaces","microsoft.databox/jobs":"Azure Data Box","microsoft.databoxedge/databoxedgedevices":"Azure Stack Edge / Data Box Gateway","microsoft.databricks/workspaces":"Azure Databricks Services","microsoft.datacatalog/catalogs":"Data Catalog","microsoft.datacollaboration/workspaces":"Project CI","microsoft.datadog/monitors":"Datadog","microsoft.datafactory/datafactories":"Data factories","microsoft.datafactory/factories":"Data factories (V2)","microsoft.datalakeanalytics/accounts":"Data Lake Analytics","microsoft.datalakestore/accounts":"Data Lake Storage Gen1","microsoft.datamigration/services":"Azure Database Migration Services","microsoft.datamigration/services/projects":"Azure Database Migration Projects","microsoft.datamigration/sqlmigrationservices":"Azure Database Migration Services","microsoft.dataprotection/backupvaults":"Backup vaults","microsoft.dataprotection/resourceguards":"Resource Guards (Preview)","microsoft.datareplication/replicationvaults":"Site Recovery Vaults","microsoft.datashare/accounts":"Data Shares","microsoft.dbformariadb/servers":"Azure Database for MariaDB servers","microsoft.dbformysql/flexibleservers":"Azure Database for MySQL flexible servers","microsoft.dbformysql/servers":"Azure Database for MySQL servers","microsoft.dbforpostgresql/flexibleservers":"Azure Database for PostgreSQL flexible servers","microsoft.dbforpostgresql/servergroups":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servergroupsv2":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servers":"Azure Database for PostgreSQL servers","microsoft.dbforpostgresql/serversv2":"Azure Database for PostgreSQL servers v2","microsoft.deploymentmanager/rollouts":"Rollouts","microsoft.desktopvirtualization/applicationgroups":"Application groups","microsoft.desktopvirtualization/hostpools":"Host pools","microsoft.desktopvirtualization/scalingplans":"Scaling plans","microsoft.desktopvirtualization/workspaces":"Workspaces","microsoft.devices/iothubs":"IoT Hub","microsoft.devices/provisioningservices":"Device Provisioning Services","microsoft.deviceupdate/accounts":"Device Update for IoT Hubs","microsoft.devops/pipelines":"DevOps Starter","microsoft.devtestlab/labs":"DevTest Labs","microsoft.devtestlab/labs/virtualmachines":"Virtual machines","microsoft.digitaltwins/digitaltwinsinstances":"Azure Digital Twins","microsoft.documentdb/cassandraclusters":"Azure Managed Instance for Apache Cassandra","microsoft.documentdb/databaseaccounts":"Azure Cosmos DB accounts","microsoft.domainregistration/domains":"App Service Domains","microsoft.edgeorder/addresses":"Azure Edge Hardware Center Address","microsoft.edgeorder/orderitems":"Azure Edge Hardware Center","microsoft.elastic/monitors":"Elasticsearch (Elastic Cloud)","microsoft.eventgrid/domains":"Event Grid Domains","microsoft.eventgrid/partnernamespaces":"Event Grid Partner Namespaces","microsoft.eventgrid/partnerregistrations":"Event Grid Partner Registrations","microsoft.eventgrid/partnertopics":"Event Grid Partner Topics","microsoft.eventgrid/systemtopics":"Event Grid System Topics","microsoft.eventgrid/topics":"Event Grid Topics","microsoft.eventhub/clusters":"Event Hubs Clusters","microsoft.eventhub/namespaces":"Event Hubs Namespaces","microsoft.experimentation/experimentworkspaces":"Experiment Workspaces","microsoft.extendedlocation/customlocations":"Custom locations","microsoft.fidalgo/devcenters":"Fidalgo DevCenters","microsoft.fidalgo/networksettings":"Network Configurations","microsoft.fidalgo/projects":"Fidalgo Projects","microsoft.fidalgo/projects/environments":"Fidalgo Environments","microsoft.fluidrelay/fluidrelayservers":"Fluid Relay","microsoft.genomics/accounts":"Genomics accounts","microsoft.hanaonazure/hanainstances":"SAP HANA on Azure","microsoft.hanaonazure/sapmonitors":"Azure Monitors for SAP Solutions","microsoft.hdinsight/clusterpools":"HDInsight cluster pools","microsoft.hdinsight/clusterpools/clusters":"HDInsight gen2 clusters","microsoft.hdinsight/clusterpools/clusters/sessionclusters":"HDInsight session clusters","microsoft.hdinsight/clusters":"HDInsight clusters","microsoft.healthbot/healthbots":"Azure Health Bot","microsoft.healthcareapis/services":"Azure API for FHIR","microsoft.healthcareapis/workspaces":"Healthcare APIs Workspaces","microsoft.healthcareapis/workspaces/dicomservices":"DICOM services","microsoft.healthcareapis/workspaces/fhirservices":"FHIR services","microsoft.healthcareapis/workspaces/iotconnectors":"IoT connectors","microsoft.hpcworkbench/instances":"HPC Workbenches (preview)","microsoft.hpcworkbench/instances/chambers":"Chambers (preview)","microsoft.hpcworkbench/instances/chambers/accessprofiles":"Chamber Profiles (preview)","microsoft.hpcworkbench/instances/chambers/workloads":"Chamber VMs (preview)","microsoft.hpcworkbench/instances/consortiums":"Consortiums (preview)","microsoft.hybridcompute/machines":"Servers - Azure Arc","microsoft.hybridcompute/privatelinkscopes":"Azure Arc Private Link Scopes","microsoft.hybridcontainerservice/provisionedclusters":"Provisioned clusters","microsoft.hybriddata/datamanagers":"StorSimple Data Managers","microsoft.hybridnetwork/devices":"Azure Network Function Manager \u2013 Devices","microsoft.hybridnetwork/networkfunctions":"Azure Network Function Manager \u2013 Network Functions","microsoft.importexport/jobs":"Import/export jobs","microsoft.insights/components":"Application Insights","microsoft.insights/datacollectionendpoints":"Data collection endpoints","microsoft.insights/datacollectionrules":"Data collection rules","microsoft.insights/privatelinkscopes":"Azure Monitor Private Link Scopes","microsoft.insights/webtests":"Availability tests","microsoft.insights/workbooks":"Azure Workbooks","microsoft.insights/workbooktemplates":"Azure Workbook Templates","microsoft.iotcentral/iotapps":"IoT Central Applications","microsoft.keyvault/vaults":"Key vaults","microsoft.kubernetes/connectedclusters":"Kubernetes - Azure Arc","microsoft.kusto/clusters":"Azure Data Explorer Clusters","microsoft.kusto/clusters/databases":"Azure Data Explorer Databases","microsoft.labservices/labaccounts":"Lab accounts","microsoft.labservices/labplans":"Lab plans","microsoft.labservices/labs":"Labs","microsoft.loadtestservice/loadtests":"Azure Load Testing","microsoft.logic/integrationaccounts":"Integration accounts","microsoft.logic/integrationserviceenvironments":"Integration Service Environments","microsoft.logic/integrationserviceenvironments/managedapis":"Managed Connector","microsoft.logic/workflows":"Logic apps","microsoft.logz/monitors":"Logz main account","microsoft.logz/monitors/accounts":"Logz sub account","microsoft.logz/monitors/metricssource":"Logz metrics data source","microsoft.machinelearning/commitmentplans":"Machine Learning Studio (classic) web service plans","microsoft.machinelearning/webservices":"Machine Learning Studio (classic) web services","microsoft.machinelearning/workspaces":"Machine Learning Studio (classic) workspaces","microsoft.machinelearningservices/workspaces":"Machine learning","microsoft.machinelearningservices/workspaces/onlineendpoints":"Machine learning online endpoints","microsoft.machinelearningservices/workspaces/onlineendpoints/deployments":"Machine learning online deployments","microsoft.maintenance/maintenanceconfigurations":"Maintenance Configurations","microsoft.managedidentity/userassignedidentities":"Managed Identities","microsoft.maps/accounts":"Azure Maps Accounts","microsoft.maps/accounts/creators":"Azure Maps Creator Resources","microsoft.media/mediaservices":"Media Services","microsoft.media/mediaservices/liveevents":"Live events","microsoft.media/mediaservices/streamingendpoints":"Streaming Endpoints","microsoft.media/videoanalyzers":"Video Analyzers","microsoft.migrate/projects":"Migration projects","microsoft.mixedreality/objectanchorsaccounts":"Object Anchors Accounts","microsoft.mixedreality/objectunderstandingaccounts":"Object Understanding Accounts","microsoft.mixedreality/remoterenderingaccounts":"Remote Rendering Accounts","microsoft.mixedreality/spatialanchorsaccounts":"Spatial Anchors Accounts","microsoft.mobilenetwork/mobilenetworks":"Mobile Networks","microsoft.mobilenetwork/mobilenetworks/datanetworks":"Data Networks","microsoft.mobilenetwork/mobilenetworks/services":"Services","microsoft.mobilenetwork/mobilenetworks/simpolicies":"Sim Policies","microsoft.mobilenetwork/mobilenetworks/sites":"Mobile Network Sites","microsoft.mobilenetwork/mobilenetworks/slices":"Slices","microsoft.mobilenetwork/packetcorecontrolplanes":"Packet Core Control Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes":"Packet Core Data Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes/attacheddatanetworks":"Attached Data Networks","microsoft.mobilenetwork/sims":"Sims","microsoft.netapp/netappaccounts":"NetApp accounts","microsoft.netapp/netappaccounts/capacitypools":"Capacity pools","microsoft.netapp/netappaccounts/capacitypools/volumes":"Volumes","microsoft.netapp/netappaccounts/capacitypools/volumes/snapshots":"Snapshots","microsoft.netapp/netappaccounts/snapshotpolicies":"Snapshot policies","microsoft.network/applicationgateways":"Application gateways","microsoft.network/applicationgatewaywebapplicationfirewallpolicies":"Application Gateway WAF policies","microsoft.network/applicationsecuritygroups":"Application security groups","microsoft.network/azurefirewalls":"Firewalls","microsoft.network/bastionhosts":"Bastions","microsoft.network/connections":"Connections","microsoft.network/customipprefixes":"Custom IP Prefixes","microsoft.network/ddosprotectionplans":"DDoS protection plans","microsoft.network/dnsforwardingrulesets":"Dns Forwarding Rulesets","microsoft.network/dnsresolvers":"DNS Private Resolvers","microsoft.network/dnszones":"DNS zones","microsoft.network/expressroutecircuits":"ExpressRoute circuits","microsoft.network/expressrouteports":"ExpressRoute Direct","microsoft.network/firewallpolicies":"Firewall Policies","microsoft.network/frontdoors":"Front Doors","microsoft.network/frontdoorwebapplicationfirewallpolicies":"Web Application Firewall policies (WAF)","microsoft.network/ipgroups":"IP Groups","microsoft.network/loadbalancers":"Load balancers","microsoft.network/localnetworkgateways":"Local network gateways","microsoft.network/natgateways":"NAT gateways","microsoft.network/networkexperimentprofiles":"Internet Analyzer profiles","microsoft.network/networkinterfaces":"Network interfaces","microsoft.network/networkmanagers":"Network Managers","microsoft.network/networksecuritygroups":"Network security groups","microsoft.network/networkwatchers":"Network Watchers","microsoft.network/networkwatchers/connectionmonitors":"Connection Monitors","microsoft.network/networkwatchers/flowlogs":"NSG Flow Logs","microsoft.network/privatednszones":"Private DNS zones","microsoft.network/privateendpoints":"Private endpoints","microsoft.network/privatelinkservices":"Private link services","microsoft.network/publicipaddresses":"Public IP addresses","microsoft.network/publicipprefixes":"Public IP Prefixes","microsoft.network/routefilters":"Route filters","microsoft.network/routetables":"Route tables","microsoft.network/serviceendpointpolicies":"Service endpoint policies","microsoft.network/trafficmanagerprofiles":"Traffic Manager profiles","microsoft.network/virtualnetworkgateways":"Virtual network gateways","microsoft.network/virtualnetworks":"Virtual networks","microsoft.network/virtualwans":"Virtual WANs","microsoft.notificationhubs/namespaces":"Notification Hub Namespaces","microsoft.notificationhubs/namespaces/notificationhubs":"Notification Hubs","microsoft.openenergyplatform/energyservices":"Project Oak Forest","microsoft.openlogisticsplatform/workspaces":"Open Supply Chain Platform","microsoft.operationalinsights/querypacks":"Log Analytics query packs","microsoft.operationalinsights/workspaces":"Log Analytics workspaces","microsoft.operationsmanagement/solutions":"Solutions","microsoft.orbital/contactprofiles":"Contact Profiles","microsoft.orbital/edgesites":"Edge Sites","microsoft.orbital/groundstations":"Ground Stations","microsoft.orbital/l2connections":"L2 Connections","microsoft.orbital/spacecrafts":"Spacecrafts","microsoft.peering/peerings":"Peerings","microsoft.peering/peeringservices":"Peering Services","microsoft.playfab/playeraccountpools":"PlayFab player account pools","microsoft.playfab/titles":"PlayFab titles","microsoft.portal/dashboards":"Shared dashboards","microsoft.powerbidedicated/capacities":"Power BI Embedded","microsoft.purview/accounts":"Microsoft Purview accounts","microsoft.quantum/workspaces":"Quantum Workspaces","microsoft.recommendationsservice/accounts":"Intelligent Recommendations Accounts","microsoft.recommendationsservice/accounts/modeling":"Modeling","microsoft.recommendationsservice/accounts/serviceendpoints":"Service Endpoints","microsoft.recoveryservices/vaults":"Recovery Services vaults","microsoft.redhatopenshift/openshiftclusters":"Azure Red Hat OpenShift","microsoft.relay/namespaces":"Relays","microsoft.resourceconnector/appliances":"Resource bridges","microsoft.resourcegraph/queries":"Resource Graph queries","microsoft.resources/deploymentscripts":"Deployment Scripts","microsoft.resources/templatespecs":"Template specs","microsoft.saas/applications":"Software as a Service (classic)","microsoft.saas/resources":"SaaS","microsoft.scom/managedinstances":"Aquila Instances","microsoft.scvmm/virtualmachines":"SCVMM virtual machine - Azure Arc","microsoft.scvmm/vmmservers":"SCVMM management servers","microsoft.search/searchservices":"Search services","microsoft.securitydetonation/chambers":"Security Detonation Chambers","microsoft.servicebus/namespaces":"Service Bus Namespaces","microsoft.servicefabric/clusters":"Service Fabric clusters","microsoft.servicefabric/managedclusters":"Service Fabric managed clusters","microsoft.serviceshub/connectors":"Services Hub Connectors","microsoft.signalrservice/signalr":"SignalR","microsoft.signalrservice/webpubsub":"Web PubSub Service","microsoft.solutions/applicationdefinitions":"Service catalog managed application definitions","microsoft.solutions/applications":"Managed applications","microsoft.sql/instancepools":"Instance pools","microsoft.sql/managedinstances":"SQL managed instances","microsoft.sql/managedinstances/databases":"Managed databases","microsoft.sql/servers":"SQL servers","microsoft.sql/servers/databases":"SQL databases","microsoft.sql/servers/elasticpools":"SQL elastic pools","microsoft.sql/servers/jobagents":"Elastic Job agents","microsoft.sql/virtualclusters":"Virtual clusters","microsoft.sqlvirtualmachine/sqlvirtualmachines":"SQL virtual machines","microsoft.storage/storageaccounts":"Storage accounts","microsoft.storagecache/amlfilesystems":"Lustre File Systems","microsoft.storagecache/caches":"HPC caches","microsoft.storagepool/diskpools":"Disk Pools","microsoft.storagesync/storagesyncservices":"Storage Sync Services","microsoft.storagesyncdev/storagesyncservices":"Storage Sync Services","microsoft.storagesyncint/storagesyncservices":"Storage Sync Services","microsoft.storsimple/managers":"StorSimple Device Managers","microsoft.streamanalytics/clusters":"Stream Analytics clusters","microsoft.streamanalytics/streamingjobs":"Stream Analytics jobs","microsoft.synapse/privatelinkhubs":"Azure Synapse Analytics (private link hubs)","microsoft.synapse/workspaces":"Azure Synapse Analytics","microsoft.synapse/workspaces/bigdatapools":"Apache Spark pools","microsoft.synapse/workspaces/kustopools":"Data Explorer pools (preview)","microsoft.synapse/workspaces/sqlpools":"Dedicated SQL pools","microsoft.testbase/testbaseaccounts":"Test Base Accounts","microsoft.testbase/testbaseaccounts/packages":"Test Base Packages","microsoft.timeseriesinsights/environments":"Time Series Insights environments","microsoft.timeseriesinsights/environments/eventsources":"Time Series Insights event sources","microsoft.timeseriesinsights/environments/referencedatasets":"Time Series Insights reference data sets","microsoft.videoindexer/accounts":"Video Analyzer for Media","microsoft.virtualmachineimages/imagetemplates":"Image Templates","microsoft.visualstudio/account":"Azure DevOps organizations","microsoft.visualstudio/account/project":"DevOps Starter","microsoft.vmwarecloudsimple/dedicatedcloudnodes":"CloudSimple Nodes","microsoft.vmwarecloudsimple/dedicatedcloudservices":"CloudSimple Services","microsoft.vmwarecloudsimple/virtualmachines":"CloudSimple Virtual Machines","microsoft.vsonline/plans":"Visual Studio Online Plans","microsoft.web/connectiongateways":"On-premises data gateways","microsoft.web/connections":"API Connections","microsoft.web/containerapps":"Container Apps","microsoft.web/customapis":"Logic Apps Custom Connector","microsoft.web/hostingenvironments":"App Service Environments","microsoft.web/kubeenvironments":"App Service Kubernetes Environments","microsoft.web/serverfarms":"App Service plans","microsoft.web/sites":"App Services","microsoft.web/sites/slots":"App Service (Slots)","microsoft.web/staticsites":"Static Web Apps","microsoft.windowsesu/multipleactivationkeys":"Windows Multiple Activation Keys","microsoft.windowsiot/deviceservices":"Windows 10 IoT Core Services","microsoft.workloads/monitors":"Azure Monitors for SAP Solutions (v2)","microsoft.workloads/phpworkloads":"Scalable WordPress on Linux","microsoft.workloads/sapvirtualinstances":"SAP Virtual Instances","microsoft.workloads/sapvirtualinstances/applicationinstances":"SAP app server instances","microsoft.workloads/sapvirtualinstances/centralinstances":"SAP central server instances","microsoft.workloads/sapvirtualinstances/databaseinstances":"SAP database server instances","nginx.nginxplus/nginxdeployments":"NGINX Deployment","providers.test/statefulibizaengines":"VLCentral Help","wandisco.fusion/fusiongroups":"LiveData Planes","wandisco.fusion/fusiongroups/azurezones":"Azure Zones","wandisco.fusion/fusiongroups/azurezones/plugins":"Plugins","wandisco.fusion/fusiongroups/hivereplicationrules":"Hive Replication Rules","wandisco.fusion/fusiongroups/managedonpremzones":"On-premises Zones","wandisco.fusion/fusiongroups/replicationrules":"Replication Rules","wandisco.fusion/migrators":"LiveData Migrators","wandisco.fusion/migrators/exclusiontemplates":"Exclusions","wandisco.fusion/migrators/livedatamigrations":"Migrations","wandisco.fusion/migrators/metadatamigrations":"Metadata Migrations","wandisco.fusion/migrators/metadatatargets":"Metadata Targets","wandisco.fusion/migrators/pathmappings":"Path Mappings","wandisco.fusion/migrators/targets":"Targets","microsoft.security/insights/classification":"Data Sensitivity Security Insights (Preview)","microsoft.security/locations/alerts":"Security Alerts"},Va={"microsoft.cache/redis":!0,"microsoft.dbforpostgresql/flexibleservers":!0,"microsoft.storagecache/amlfilesystems":!0,"microsoft.databoxedge/databoxedgedevices":!0,"microsoft.dataprotection/backupvaults":!0,"microsoft.netapp/netappaccounts/capacitypools":!0,"microsoft.network/networkwatchers/connectionmonitors":!0,"microsoft.keyvault/vaults":!0,"microsoft.recoveryservices/vaults":!0,"microsoft.sql/servers/databases":!0,"microsoft.sql/servers/elasticpools":!0,"microsoft.compute/virtualmachinescalesets":!0,"microsoft.compute/virtualmachines":!0,"microsoft.signalrservice/webpubsub":!0},Wa=["microsoft.aad/domainservices","microsoft.aadiam/azureadmetrics","microsoft.analysisservices/servers","microsoft.apimanagement/service","microsoft.app/containerapps","microsoft.app/managedenvironments","microsoft.appconfiguration/configurationstores","microsoft.appplatform/spring","microsoft.automation/automationaccounts","microsoft.avs/privateclouds","microsoft.azuresphere/catalogs","microsoft.azurestackhci/clusters","microsoft.azurestackresourcemonitor/storageaccountmonitor","microsoft.batch/batchaccounts","microsoft.batchai/workspaces","microsoft.bing/accounts","microsoft.botservice/botservices","microsoft.botservice/botservices/channels","microsoft.botservice/botservices/connections","microsoft.botservice/checknameavailability","microsoft.botservice/hostsettings","microsoft.botservice/listauthserviceproviders","microsoft.botservice/listqnamakerendpointkeys","microsoft.cache/redis","microsoft.cache/redisenterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies","microsoft.cdn/profiles","microsoft.classiccompute/domainnames","microsoft.classiccompute/domainnames/slots/roles","microsoft.classiccompute/virtualmachines","microsoft.classicstorage/storageaccounts","microsoft.classicstorage/storageaccounts/blobservices","microsoft.classicstorage/storageaccounts/fileservices","microsoft.classicstorage/storageaccounts/queueservices","microsoft.classicstorage/storageaccounts/tableservices","microsoft.cloudtest/hostedpools","microsoft.cloudtest/pools","microsoft.clusterstor/nodes","microsoft.codesigning/codesigningaccounts","microsoft.cognitiveservices/accounts","microsoft.communication/communicationservices","microsoft.compute/cloudservices","microsoft.compute/cloudservices/roles","microsoft.compute/disks","microsoft.compute/virtualmachines","microsoft.compute/virtualmachinescalesets","microsoft.compute/virtualmachinescalesets/virtualmachines","microsoft.connectedcache/cachenodes","microsoft.connectedcache/enterprisemcccustomers","microsoft.connectedcache/ispcustomers","microsoft.connectedvehicle/platformaccounts","microsoft.containerinstance/containergroups","microsoft.containerinstance/containerscalesets","microsoft.containerregistry/registries","microsoft.containerservice/managedclusters","microsoft.customerinsights/hubs","microsoft.customproviders/resourceproviders","microsoft.dashboard/grafana","microsoft.databoxedge/databoxedgedevices","microsoft.datacollaboration/workspaces","microsoft.datafactory/datafactories","microsoft.datafactory/factories","microsoft.datalakeanalytics/accounts","microsoft.datalakestore/accounts","microsoft.dataprotection/backupvaults","microsoft.datashare/accounts","microsoft.dbformariadb/servers","microsoft.dbformysql/flexibleservers","microsoft.dbformysql/servers","microsoft.dbforpostgresql/flexibleservers","microsoft.dbforpostgresql/servergroupsv2","microsoft.dbforpostgresql/servers","microsoft.dbforpostgresql/serversv2","microsoft.devices/iothubs","microsoft.devices/provisioningservices","microsoft.digitaltwins/digitaltwinsinstances","microsoft.documentdb/cassandraclusters","microsoft.documentdb/databaseaccounts","microsoft.documentdb/mongoclusters","microsoft.edgezones/edgezones","microsoft.enterpriseknowledgegraph/services","microsoft.eventgrid/domains","microsoft.eventgrid/eventsubscriptions","microsoft.eventgrid/extensiontopics","microsoft.eventgrid/namespaces","microsoft.eventgrid/partnernamespaces","microsoft.eventgrid/partnertopics","microsoft.eventgrid/systemtopics","microsoft.eventgrid/topics","microsoft.eventhub/clusters","microsoft.eventhub/namespaces","microsoft.fabric.admin/fabriclocations","microsoft.hdinsight/clusters","microsoft.healthcareapis/services","microsoft.healthcareapis/workspaces/dicomservices","microsoft.healthcareapis/workspaces/fhirservices","microsoft.healthcareapis/workspaces/iotconnectors","microsoft.healthmodel/healthmodels","microsoft.hybridcontainerservice/provisionedclusters","microsoft.hybridnetwork/networkfunctions","microsoft.hybridnetwork/virtualnetworkfunctions","microsoft.insights/autoscalesettings","microsoft.insights/components","microsoft.iotcentral/iotapps","microsoft.iotspaces/graph","microsoft.keyvault/managedhsms","microsoft.keyvault/vaults","microsoft.kubernetes/connectedclusters","microsoft.kubernetesconfiguration/extensions","microsoft.kusto/clusters","microsoft.logic/integrationserviceenvironments","microsoft.logic/workflows","microsoft.machinelearningservices/workspaces","microsoft.machinelearningservices/workspaces/onlineendpoints","microsoft.machinelearningservices/workspaces/onlineendpoints/deployments","microsoft.managednetworkfabric/internetgateways","microsoft.managednetworkfabric/l3isolationdomains","microsoft.managednetworkfabric/networkdevices","microsoft.maps/accounts","microsoft.media/mediaservices","microsoft.media/mediaservices/liveevents","microsoft.media/mediaservices/streamingendpoints","microsoft.media/videoanalyzers","microsoft.mixedreality/remoterenderingaccounts","microsoft.mixedreality/spatialanchorsaccounts","microsoft.mobilenetwork/packetcorecontrolplanes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes","microsoft.monitor/accounts","microsoft.netapp/netappaccounts/capacitypools","microsoft.netapp/netappaccounts/capacitypools/volumes","microsoft.network/applicationgateways","microsoft.network/azurefirewalls","microsoft.network/bastionhosts","microsoft.network/connections","microsoft.network/dnsforwardingrulesets","microsoft.network/dnsresolvers","microsoft.network/dnszones","microsoft.network/expressroutecircuits","microsoft.network/expressroutecircuits/peerings","microsoft.network/expressroutegateways","microsoft.network/expressrouteports","microsoft.network/frontdoors","microsoft.network/loadbalancers","microsoft.network/natgateways","microsoft.network/networkinterfaces","microsoft.network/networkmanagers/ipampools","microsoft.network/networkvirtualappliances","microsoft.network/networkwatchers","microsoft.network/networkwatchers/connectionmonitors","microsoft.network/p2svpngateways","microsoft.network/privatednszones","microsoft.network/privateendpoints","microsoft.network/privatelinkservices","microsoft.network/publicipaddresses","microsoft.network/publicipprefixes","microsoft.network/trafficmanagerprofiles","microsoft.network/virtualhubs","microsoft.network/virtualnetworkgateways","microsoft.network/virtualnetworks","microsoft.network/virtualrouters","microsoft.network/vpngateways","microsoft.networkanalytics/dataconnectors","microsoft.networkcloud/baremetalmachines","microsoft.networkcloud/clusters","microsoft.networkcloud/storageappliances","microsoft.networkfunction/azuretrafficcollectors","microsoft.notificationhubs/namespaces/notificationhubs","microsoft.operationalinsights/workspaces","microsoft.operationsmanagement/solutions","microsoft.orbital/contactprofiles","microsoft.orbital/l2connections","microsoft.orbital/spacecrafts","microsoft.orbital/terminals","microsoft.peering/peerings","microsoft.peering/peeringservices","microsoft.playfab/titles","microsoft.powerbidedicated/capacities","microsoft.purview/accounts","microsoft.recoveryservices/vaults","microsoft.relay/namespaces","microsoft.resources/subscriptions","microsoft.search/searchservices","microsoft.securitydetonation/chambers","microsoft.securitydetonation/securitydetonationchambers","microsoft.servicebus/namespaces","microsoft.servicefabricmesh/applications","microsoft.servicenetworking/trafficcontrollers","microsoft.signalrservice/signalr","microsoft.signalrservice/signalr/replicas","microsoft.signalrservice/webpubsub","microsoft.signalrservice/webpubsub/replicas","microsoft.singularity/accounts","microsoft.sql/managedinstances","microsoft.sql/servers/databases","microsoft.sql/servers/elasticpools","microsoft.sql/servers/jobagents","microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/objectreplicationpolicies","microsoft.storage/storageaccounts/queueservices","microsoft.storage/storageaccounts/storagetasks","microsoft.storage/storageaccounts/tableservices","microsoft.storage/storagetasks","microsoft.storagecache/amlfilesystems","microsoft.storagecache/caches","microsoft.storagemover/storagemovers","microsoft.storagesync/storagesyncservices","microsoft.storagetasks/storagetasks","microsoft.streamanalytics/streamingjobs","microsoft.synapse/workspaces","microsoft.synapse/workspaces/bigdatapools","microsoft.synapse/workspaces/kustopools","microsoft.synapse/workspaces/scopepools","microsoft.synapse/workspaces/sqlpools","microsoft.timeseriesinsights/environments","microsoft.timeseriesinsights/environments/eventsources","microsoft.vmwarecloudsimple/virtualmachines","microsoft.voiceservices/communicationsgateways","microsoft.web/containerapps","microsoft.web/hostingenvironments","microsoft.web/hostingenvironments/multirolepools","microsoft.web/hostingenvironments/workerpools","microsoft.web/serverfarms","microsoft.web/sites","microsoft.web/sites/slots","microsoft.web/staticsites","nginx.nginxplus/nginxdeployments","wandisco.fusion/migrators","wandisco.fusion/migrators/datatransferagents","wandisco.fusion/migrators/livedatamigrations","wandisco.fusion/migrators/metadatamigrations"],$a=["microsoft.aad/domainservices","microsoft.aadiam/azureadmetrics","microsoft.aadiam/tenants","microsoft.agfoodplatform/farmbeats","microsoft.analysisservices/servers","microsoft.apimanagement/service","microsoft.appconfiguration/configurationstores","microsoft.appplatform/spring","microsoft.attestation/attestationproviders","microsoft.automation/automationaccounts","microsoft.autonomousdevelopmentplatform/accounts","microsoft.autonomousdevelopmentplatform/datapools","microsoft.autonomousdevelopmentplatform/workspaces","microsoft.avs/privateclouds","microsoft.azurestackresourcemonitor/storageaccountmonitor","microsoft.batch/batchaccounts","microsoft.batchai/workspaces","microsoft.blockchain/blockchainmembers","microsoft.blockchain/cordamembers","microsoft.botservice/botservices","microsoft.cache/redis","microsoft.cache/redisenterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies","microsoft.cdn/profiles","microsoft.cdn/profiles/endpoints","microsoft.classiccompute/domainnames","microsoft.classiccompute/virtualmachines","microsoft.classicnetwork/networksecuritygroups","microsoft.classicstorage/storageaccounts","microsoft.cognitiveservices/accounts","microsoft.communication/communicationservices","microsoft.compute/disks","microsoft.compute/virtualmachines","microsoft.compute/virtualmachinescalesets","microsoft.connectedcache/cachenodes","microsoft.connectedvehicle/platformaccounts","microsoft.containerinstance/containergroups","microsoft.containerregistry/registries","microsoft.containerservice/managedclusters","microsoft.customerinsights/hubs","microsoft.customproviders/resourceproviders","microsoft.d365customerinsights/instances","microsoft.dashboard/grafana","microsoft.databoxedge/databoxedgedevices","microsoft.databricks/workspaces","microsoft.datacollaboration/workspaces","microsoft.datafactory/datafactories","microsoft.datafactory/factories","microsoft.datalakeanalytics/accounts","microsoft.datalakestore/accounts","microsoft.datashare/accounts","microsoft.dbformariadb/servers","microsoft.dbformysql/flexibleservers","microsoft.dbformysql/servers","microsoft.dbforpostgresql/flexibleservers","microsoft.dbforpostgresql/servergroupsv2","microsoft.dbforpostgresql/servers","microsoft.dbforpostgresql/serversv2","microsoft.desktopvirtualization/applicationgroups","microsoft.desktopvirtualization/hostpools","microsoft.desktopvirtualization/scalingplans","microsoft.desktopvirtualization/workspaces","microsoft.devices/elasticpools/iothubtenants","microsoft.devices/iothubs","microsoft.devices/provisioningservices","microsoft.digitaltwins/digitaltwinsinstances","microsoft.documentdb/cassandraclusters","microsoft.documentdb/databaseaccounts","microsoft.eventgrid/domains","microsoft.eventgrid/partnernamespaces","microsoft.eventgrid/partnertopics","microsoft.eventgrid/systemtopics","microsoft.eventgrid/topics","microsoft.eventhub/clusters","microsoft.eventhub/namespaces","microsoft.experimentation/experimentworkspaces","microsoft.fabric.admin/fabriclocations","microsoft.hdinsight/clusters","microsoft.healthcareapis/services","microsoft.healthcareapis/workspaces/dicomservices","microsoft.healthcareapis/workspaces/fhirservices","microsoft.insights/autoscalesettings","microsoft.insights/components","microsoft.insights/qos","microsoft.iotcentral/iotapps","microsoft.keyvault/managedhsms","microsoft.keyvault/vaults","microsoft.kubernetes/connectedclusters","microsoft.kusto/clusters","microsoft.loadtestservice/loadtests","microsoft.logic/integrationaccounts","microsoft.logic/integrationserviceenvironments","microsoft.logic/workflows","microsoft.machinelearningservices/workspaces","microsoft.media/mediaservices","microsoft.media/mediaservices/liveevents","microsoft.media/mediaservices/streamingendpoints","microsoft.media/videoanalyzers","microsoft.netapp/netappaccounts/capacitypools","microsoft.netapp/netappaccounts/capacitypools/volumes","microsoft.network/applicationgateways","microsoft.network/azurefirewalls","microsoft.network/bastionhosts","microsoft.network/connections","microsoft.network/dnszones","microsoft.network/expressroutecircuits","microsoft.network/expressroutegateways","microsoft.network/expressrouteports","microsoft.network/frontdoors","microsoft.network/loadbalancers","microsoft.network/natgateways","microsoft.network/networkinterfaces","microsoft.network/networksecuritygroups","microsoft.network/networksecurityperimeters","microsoft.network/networkvirtualappliances","microsoft.network/networkwatchers","microsoft.network/networkwatchers/connectionmonitors","microsoft.network/p2svpngateways","microsoft.network/privateendpoints","microsoft.network/privatelinkservices","microsoft.network/publicipaddresses","microsoft.network/trafficmanagerprofiles","microsoft.network/virtualnetworkgateways","microsoft.network/virtualnetworks","microsoft.network/vpngateways","microsoft.networkfunction/azuretrafficcollectors","microsoft.notificationhubs/namespaces","microsoft.notificationhubs/namespaces/notificationhubs","microsoft.openlogisticsplatform/workspaces","microsoft.operationalinsights/workspaces","microsoft.operationsmanagement/solutions","microsoft.peering/peeringservices","microsoft.powerbi/tenants","microsoft.powerbi/tenants/workspaces","microsoft.powerbidedicated/capacities","microsoft.purview/accounts","microsoft.recoveryservices/vaults","microsoft.relay/namespaces","microsoft.resources/subscriptions","microsoft.resources/subscriptions/resourcegroups","microsoft.search/searchservices","microsoft.security/antimalwaresettings","microsoft.securityinsights/settings","microsoft.servicebus/namespaces","microsoft.signalrservice/signalr","microsoft.signalrservice/webpubsub","microsoft.singularity/accounts","microsoft.sql/managedinstances","microsoft.sql/managedinstances/databases","microsoft.sql/servers/databases","microsoft.sql/servers/elasticpools","microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/queueservices","microsoft.storage/storageaccounts/tableservices","microsoft.storagecache/caches","microsoft.storagesync/storagesyncservices","microsoft.streamanalytics/streamingjobs","microsoft.synapse/workspaces","microsoft.synapse/workspaces/bigdatapools","microsoft.synapse/workspaces/kustopools","microsoft.synapse/workspaces/scopepools","microsoft.synapse/workspaces/sqlpools","microsoft.timeseriesinsights/environments","microsoft.timeseriesinsights/environments/eventsources","microsoft.videoindexer/accounts","microsoft.vmwarecloudsimple/virtualmachines","microsoft.web/hostingenvironments","microsoft.web/hostingenvironments/workerpools","microsoft.web/serverfarms","microsoft.web/sites","microsoft.web/sites/slots"],Ua=e=>({resourceList:(0,m.css)({display:"flex",columnGap:e.spacing(1),flexWrap:"wrap",marginBottom:e.spacing(1)}),resource:(0,m.css)({flex:"0 0 auto"}),resourceLabel:(0,m.css)({padding:e.spacing(1)}),resourceGroupAndName:(0,m.css)({display:"flex",columnGap:e.spacing(.5)})}),Ba=({resources:e,onChange:t})=>{const s=(0,k.wW)(Ua);(0,o.useEffect)(()=>{e.length===0&&t([{}])},[e,t]);const r=(n,l)=>{const u=[...e];u[n]=l,t(u)},a=n=>{const l=[...e];l.splice(n,1),t(l)},i=()=>{t(e.concat({subscription:e[0]?.subscription,metricNamespace:e[0]?.metricNamespace,resourceGroup:"",resourceName:""}))},c=n=>{t(e.map(l=>({...l,...n})))};return o.createElement(o.Fragment,null,o.createElement(Ee._,{label:"Subscription",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-subscription",labelWidth:15,"data-testid":M.components.queryEditor.resourcePicker.advanced.subscription.input},o.createElement(B.I,{id:"input-advanced-resource-picker-subscription",value:e[0]?.subscription??"",onChange:n=>c({subscription:n.currentTarget.value}),placeholder:"aaaaaaaa-bbbb-cccc-dddd-eeeeeeee"})),o.createElement(Ee._,{label:"Namespace",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-metricNamespace",labelWidth:15,"data-testid":M.components.queryEditor.resourcePicker.advanced.namespace.input},o.createElement(B.I,{id:"input-advanced-resource-picker-metricNamespace",value:e[0]?.metricNamespace??"",onChange:n=>c({metricNamespace:n.currentTarget.value}),placeholder:"Microsoft.Insights/metricNamespaces"})),o.createElement(Ee._,{label:"Region",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-region",labelWidth:15,"data-testid":M.components.queryEditor.resourcePicker.advanced.region.input,tooltip:"The code region of the resource. Optional for one resource but mandatory when selecting multiple ones."},o.createElement(B.I,{id:"input-advanced-resource-picker-region",value:e[0]?.region??"",onChange:n=>c({region:n.currentTarget.value}),placeholder:"northeurope"})),o.createElement("div",{className:s.resourceList},e.map((n,l)=>o.createElement("div",{key:`resource-${l+1}`,className:s.resource},e.length!==1&&o.createElement(Wt._,{className:s.resourceLabel},"Resource ",l+1),o.createElement(Ee._,{label:"Resource Group",transparent:!0,htmlFor:`input-advanced-resource-picker-resourceGroup-${l+1}`,labelWidth:15,"data-testid":M.components.queryEditor.resourcePicker.advanced.resourceGroup.input},o.createElement("div",{className:s.resourceGroupAndName},o.createElement(B.I,{id:`input-advanced-resource-picker-resourceGroup-${l+1}`,value:n?.resourceGroup??"",onChange:u=>r(l,{...n,resourceGroup:u.currentTarget.value}),placeholder:"resource-group"}),o.createElement(Et,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>a(l),hidden:e.length===1,"data-testid":"remove-resource"}))),o.createElement(Ee._,{label:"Resource Name",transparent:!0,htmlFor:`input-advanced-resource-picker-resourceName-${l+1}`,labelWidth:15,"data-testid":M.components.queryEditor.resourcePicker.advanced.resource.input},o.createElement(B.I,{id:`input-advanced-resource-picker-resourceName-${l+1}`,value:n?.resourceName??"",onChange:u=>r(l,{...n,resourceName:u.currentTarget.value}),placeholder:"name"}))))),o.createElement(H.zx,{"aria-label":"Add",icon:"plus",variant:"secondary",onClick:i,type:"button"},"Add resource"))};function qs(e,t){return e.azureMonitor?.customNamespace===t?e:t?.toLowerCase().startsWith("microsoft.storage/storageaccounts/")?{...e,azureMonitor:{...e.azureMonitor,metricNamespace:t,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]}}:{...e,azureMonitor:{...e.azureMonitor,customNamespace:t,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]}}}function ja(e,t){return e.azureMonitor?.metricName===t?e:{...e,azureMonitor:{...e.azureMonitor,metricName:t,aggregation:void 0,timeGrain:"",dimensionFilters:[]}}}function _a(e,t){return e.azureMonitor?.aggregation===t?e:{...e,azureMonitor:{...e.azureMonitor,aggregation:t}}}function er(e,t){return e.azureMonitor?.timeGrain===t?e:{...e,azureMonitor:{...e.azureMonitor,timeGrain:t}}}function zt(e,t){return e.azureMonitor?.dimensionFilters===t?e:{...e,azureMonitor:{...e.azureMonitor,dimensionFilters:t}}}function Ha(e,t="",s="eq",r=[]){const a=e.azureMonitor?.dimensionFilters??[];return zt(e,[...a,{dimension:t,operator:s,filters:r}])}function jc(e,t){const r=[...e.azureMonitor?.dimensionFilters??[]];return r.splice(t,1),zt(e,r)}function _c(e,t,s,r){const i=[...e.azureMonitor?.dimensionFilters??[]],c=i[t];return c[s]=r,(s==="dimension"||s==="operator")&&(c.filters=[]),zt(e,i)}function Xa(e,t){return e.azureMonitor?.top===t?e:{...e,azureMonitor:{...e.azureMonitor,top:t}}}function Ja(e,t){return e.azureMonitor?.alias===t?e:{...e,azureMonitor:{...e.azureMonitor,alias:t}}}const Ka=({query:e,variableOptionGroup:t,onQueryChange:s,aggregationOptions:r,isLoading:a})=>{const i=(0,o.useCallback)(n=>{if(!n.value)return;const l=_a(e,n.value);s(l)},[s,e]),c=Ce(r,t,e.azureMonitor?.aggregation);return o.createElement(ae,{label:"Aggregation"},o.createElement(L.Ph,{inputId:"azure-monitor-metrics-aggregation-field",value:e.azureMonitor?.aggregation||null,onChange:i,options:c,isLoading:a}))},tr=o.forwardRef(function({items:t,renderItem:s,onChange:r},a){const i=()=>{const l=[...t,{}];r(l)},c=(l,u)=>{const p=[...t];p[l]=u,r(p)},n=l=>{const u=[...t];u.splice(l,1),r(u)};return o.createElement(ft,null,t.map((l,u)=>o.createElement("div",{key:u},s(l,p=>c(u,p),()=>n(u)))),o.createElement(H.zx,{ref:a,onClick:i,variant:"secondary",size:"md",icon:"plus","aria-label":"Add",type:"button"}))}),Za=(e,t)=>{const[s,r]=(0,o.useState)({});return(0,o.useEffect)(()=>{let a={};if(e?.series?.length){const n=e.series.flat().filter(l=>l.refId===t.refId).flatMap(l=>l.fields).map(l=>l.labels).flat().filter(l=>l!=null);for(const l of n)for(const[u,p]of Object.entries(l)){const g=u.toLowerCase();a[g]?a[g].add(p):a[g]=new Set([p])}}r(i=>{const c={},n=Object.keys(a);if(n.length===0)return i;for(const l of n)i[l]&&a[l].size<i[l].size?c[l]=i[l]:c[l]=a[l];return c})},[e?.series,t.refId]),s},Ya=({data:e,query:t,dimensionOptions:s,onQueryChange:r})=>{const a=(0,o.useMemo)(()=>t.azureMonitor?.dimensionFilters??[],[t.azureMonitor?.dimensionFilters]),i=Za(e,t),c=[{label:"==",value:"eq"},{label:"!=",value:"ne"},{label:"starts with",value:"sw"}],n=(0,o.useMemo)(()=>{let f=s;return a.length&&(f=s.filter(v=>!a.some(S=>S.dimension===v.value))),f},[a,s]),l=(f,v,S,E)=>{v[f]=S,E(v)},u=f=>n.concat(s.filter(v=>v.value===f)),p=(f,v)=>{const S=Array.from(i[v.toLowerCase()]??[]);return S.find(E=>E===f)?S.map(E=>({value:E,label:E})):[...S,...f&&f!=="*"?[f]:[]].map(E=>({value:E,label:E}))},g=(f,v)=>{const S=p(void 0,v);if(f)for(const E of f)S.find(A=>A.value===E)||S.push({value:E,label:E});return S},b=f=>c.find(v=>v.value===f)?c:[...c,...f?[{label:f,value:f}]:[]],y=f=>{const v=f.map(S=>({dimension:S.dimension??"",operator:S.operator??"eq",filters:S.filters??[]}));r(zt(t,v))},h=(f,v,S)=>o.createElement(Ue,{spacing:"none"},o.createElement(L.Ph,{menuShouldPortal:!0,placeholder:"Field",value:f.dimension,options:u(f.dimension||""),onChange:E=>l("dimension",f,E.value??"",v)}),o.createElement(L.Ph,{menuShouldPortal:!0,placeholder:"Operation",value:f.operator,options:b(f.operator||"eq"),onChange:E=>l("operator",f,E.value??"",v),allowCustomValue:!0}),f.operator==="eq"||f.operator==="ne"?o.createElement(L.NU,{menuShouldPortal:!0,placeholder:"Select value(s)",value:f.filters,options:g(f.filters,f.dimension??""),onChange:E=>l("filters",f,E.map(A=>A.value??""),v),"aria-label":"dimension-labels-select",allowCustomValue:!0}):o.createElement(L.Ph,{menuShouldPortal:!0,placeholder:"Select value",value:f.filters?f.filters[0]:"",allowCustomValue:!0,options:p(f.filters?f.filters[0]:"",f.dimension??""),onChange:E=>l("filters",f,[E?.value??""],v),isClearable:!0}),o.createElement(Et,{"aria-label":"Remove",icon:"times",variant:"secondary",onClick:S,type:"button"}));return o.createElement(ae,{label:"Dimensions"},o.createElement(tr,{items:a,onChange:y,renderItem:h}))},qa=({onQueryChange:e,query:t})=>{const[s,r]=(0,o.useState)(t.azureMonitor?.alias??""),a=(0,o.useCallback)(c=>{c.target instanceof HTMLInputElement&&r(c.target.value)},[]),i=(0,o.useCallback)(()=>{const c=Ja(t,s);e(c)},[e,t,s]);return o.createElement(ae,{label:"Legend format"},o.createElement(B.I,{id:"azure-monitor-metrics-legend-field",placeholder:"Alias patterns",value:s,onChange:a,onBlur:i,width:38}))},ei=({metricNames:e,query:t,variableOptionGroup:s,onQueryChange:r})=>{const a=(0,o.useCallback)(c=>{if(!c.value)return;const n=ja(t,c.value);r(n)},[r,t]),i=Ce(e,s,t.azureMonitor?.metricName);return o.createElement(ae,{label:"Metric","data-testid":M.components.queryEditor.metricsQueryEditor.metricName.input},o.createElement(L.Ph,{inputId:"azure-monitor-metrics-metric-field",value:t.azureMonitor?.metricName??null,onChange:a,options:i,allowCustomValue:!0}))},ti=({metricNamespaces:e,query:t,variableOptionGroup:s,onQueryChange:r})=>{const a=(0,o.useCallback)(n=>{if(!n.value)return;const l=qs(t,n.value);r(l)},[r,t]),i=t.azureMonitor?.customNamespace||t.azureMonitor?.metricNamespace,c=Ce(e,s,i);return o.createElement(ae,{label:"Metric namespace"},o.createElement(L.Ph,{inputId:"azure-monitor-metrics-metric-namespace-field",value:i||null,onChange:a,options:c,allowCustomValue:!0}))},si=({query:e,timeGrainOptions:t,variableOptionGroup:s,onQueryChange:r})=>{const a=(0,o.useCallback)(c=>{if(!c.value)return;const n=er(e,c.value);r(n)},[r,e]),i=(0,o.useMemo)(()=>{const c=oe.findClosestTimeGrain("1m",t.map(u=>oe.createKbnUnitFromISO8601Duration(u.value))||["1m","5m","15m","30m","1h","6h","12h","1d"]),n=t.map(u=>u.value==="auto"?{...u,description:c}:u);return Ce(n,s,e.azureMonitor?.timeGrain)},[t,s,e.azureMonitor?.timeGrain]);return o.createElement(ae,{label:"Time grain"},o.createElement(L.Ph,{inputId:"azure-monitor-metrics-time-grain-field",value:e.azureMonitor?.timeGrain,onChange:a,options:i}))},ri=({onQueryChange:e,query:t})=>{const[s,r]=(0,o.useState)(t.azureMonitor?.top??""),a=(0,o.useCallback)(c=>{c.target instanceof HTMLInputElement&&r(c.target.value)},[]),i=(0,o.useCallback)(()=>{const c=Xa(t,s);e(c)},[e,t,s]);return o.createElement(ae,{label:"Top"},o.createElement(B.I,{id:"azure-monitor-metrics-top-field",value:s,onChange:a,onBlur:i,width:16}))};function sr(e,t,s){const[r]=(0,o.useState)(()=>Math.random()),[a,i]=(0,o.useState)(),c=(0,o.useMemo)(()=>a??[],[a]);return(0,o.useEffect)(()=>{e().then(n=>{i(n),t(r,void 0)}).catch(n=>{t(r,n)})},s),c}const Jt=e=>!e||!e.length?{resourceGroup:"",resourceName:""}:{resourceGroup:e[0].resourceGroup??"",resourceName:e[0].resourceName??""},oi=(e,t,s,r)=>{const{subscription:a}=e,{metricNamespace:i,resources:c}=e.azureMonitor??{},{resourceGroup:n,resourceName:l}=Jt(c);return sr(async()=>{if(!a||!n||!l)return;const p=await t.azureMonitorDatasource.getMetricNamespaces({subscription:a,metricNamespace:i,resourceGroup:n,resourceName:l},!1),g=or(p,i);return!i&&g.length&&s(qs(e,g[0].value)),g},r,[a,i,n,l])},ai=(e,t,s,r)=>{const{subscription:a}=e,{metricNamespace:i,metricName:c,resources:n,customNamespace:l}=e.azureMonitor??{},{resourceGroup:u,resourceName:p}=Jt(n),g=(n&&n.length>1)??!1,b=e.azureMonitor?.region??"";return sr(async()=>{if(!a||!i||!u||!p)return;const y=await t.azureMonitorDatasource.getMetricNames({subscription:a,resourceGroup:u,resourceName:p,metricNamespace:i,customNamespace:l},g,b);return or(y,c)},r,[a,u,p,i,l,g])},rr={aggOptions:[],timeGrains:[],dimensions:[],isLoading:!1,supportedAggTypes:[],primaryAggType:void 0},ii=(e,t,s)=>{const[r,a]=(0,o.useState)(rr),{subscription:i}=e,{resources:c,metricNamespace:n,metricName:l,aggregation:u,timeGrain:p,customNamespace:g,region:b}=e.azureMonitor??{},{resourceGroup:y,resourceName:h}=Jt(c),f=(c&&c.length>1)??!1;return(0,o.useEffect)(()=>{if(!i||!y||!h||!n||!l){a(rr);return}t.azureMonitorDatasource.getMetricMetadata({subscription:i,resourceGroup:y,resourceName:h,metricNamespace:n,metricName:l,customNamespace:g},f,b).then(v=>{const S=(v.supportedAggTypes||[v.primaryAggType]).map(E=>({label:E,value:E}));a({aggOptions:S,timeGrains:v.supportedTimeGrains,dimensions:v.dimensions,isLoading:!1,supportedAggTypes:v.supportedAggTypes??[],primaryAggType:v.primaryAggType})})},[b,t,i,y,h,n,l,g,f]),(0,o.useEffect)(()=>{const v=u||r.primaryAggType,S=p||"auto";(v!==u||S!==p)&&s({...e,azureMonitor:{...e.azureMonitor,aggregation:v,timeGrain:S,allowedTimeGrainsMs:r.timeGrains.filter(E=>E.value!=="auto").map(E=>ut(oe.createKbnUnitFromISO8601Duration(E.value)))}})},[s,r,u,p,e]),r};function or(e,t){const s=e.map(to);return t&&!s.find(r=>r.value===t.toLowerCase())&&s.push({label:t,value:t}),s}const ni=({data:e,query:t,datasource:s,variableOptionGroup:r,onChange:a,setError:i})=>{const c=ii(t,s,a),n=oi(t,s,a,i),l=ai(t,s,a,i),u=t.azureMonitor?.resources?.map(y=>({subscription:t.subscription,resourceGroup:y.resourceGroup,metricNamespace:t.azureMonitor?.metricNamespace,resourceName:y.resourceName,region:t.azureMonitor?.region}))??[],p=y=>Va[y?.toLocaleLowerCase()??""]??!1,g=(y,h)=>{if(h.length===0)return!1;const f=q(y.uri,y.location),v=q(h[0].uri,h[0].location);return f.subscription!==v.subscription||f.region!==v.region||f.metricNamespace?.toLocaleLowerCase()!==v.metricNamespace?.toLocaleLowerCase()||!p(f.metricNamespace)},b=y=>{if(y.length===0)return"";const h=q(y[0].uri,y[0].location);return p(h.metricNamespace)?"You can select items of the same resource type and location. To select resources of a different resource type or location, please first uncheck your current selection.":""};return o.createElement("span",{"data-testid":M.components.queryEditor.metricsQueryEditor.container.input},o.createElement(gt,null,o.createElement(ge,null,o.createElement(he,null,o.createElement(jt,{query:t,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i,selectableEntryTypes:[F.Resource],resources:u??[],queryType:"metrics",disableRow:g,renderAdvanced:(y,h)=>o.createElement(Ba,{resources:y,onChange:h}),selectionNotice:b}),o.createElement(ti,{metricNamespaces:n,query:t,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i}),o.createElement(ei,{metricNames:l,query:t,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i}),o.createElement(Ka,{query:t,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i,aggregationOptions:c?.aggOptions??[],isLoading:c.isLoading}),o.createElement(si,{query:t,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i,timeGrainOptions:c?.timeGrains??[]}))),o.createElement(ge,null,o.createElement(he,null,o.createElement(Ya,{data:e,query:t,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i,dimensionOptions:c?.dimensions??[]}))),o.createElement(ge,null,o.createElement(he,null,o.createElement(ri,{query:t,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i}),o.createElement(qa,{query:t,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i})))))},ci=({children:e})=>{const t=(0,k.wW)(li);return o.createElement("div",{className:t.root},e)},li=e=>({root:(0,m.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:e.spacing(3),minHeight:e.spacing(4)})});var ui=w(9261),mi=Object.defineProperty,pi=Object.defineProperties,di=Object.getOwnPropertyDescriptors,At=Object.getOwnPropertySymbols,ar=Object.prototype.hasOwnProperty,ir=Object.prototype.propertyIsEnumerable,nr=(e,t,s)=>t in e?mi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,cr=(e,t)=>{for(var s in t||(t={}))ar.call(t,s)&&nr(e,s,t[s]);if(At)for(var s of At(t))ir.call(t,s)&&nr(e,s,t[s]);return e},lr=(e,t)=>pi(e,di(t)),fi=(e,t)=>{var s={};for(var r in e)ar.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(e!=null&&At)for(var r of At(e))t.indexOf(r)<0&&ir.call(e,r)&&(s[r]=e[r]);return s};function gi(e){var t=e,{label:s}=t,r=fi(t,["label"]);const a=(0,k.wW)(Kt),[i]=(0,o.useState)(()=>Math.random().toString(16).slice(2)),c={SelectContainer:hi,ValueContainer:ur,SingleValue:ur};return o.createElement("div",{className:a.root},s&&o.createElement("label",{className:a.label,htmlFor:i},s,":","\xA0"),o.createElement(L.Ph,lr(cr({openMenuOnFocus:!0,inputId:i},r),{components:c})))}const hi=e=>{const{children:t}=e,s=(0,k.wW)(Kt);return o.createElement(ui.e,lr(cr({},e),{className:(0,m.cx)(e.className,s.container)}),t)},ur=e=>{const{className:t,children:s}=e,r=(0,k.wW)(Kt);return o.createElement("div",{className:(0,m.cx)(t,r.valueContainer)},s)},Kt=e=>({root:(0,m.css)({display:"flex",fontSize:12,alignItems:"center"}),label:(0,m.css)({color:e.colors.text.secondary,whiteSpace:"nowrap"}),container:(0,m.css)({background:"none",borderColor:"transparent"}),valueContainer:(0,m.css)({display:"flex",alignItems:"center",flex:"initial",color:e.colors.text.secondary,fontSize:12})}),bi=({query:e,onQueryChange:t})=>{const s=[{value:d.AzureMonitor,label:"Metrics"},{value:d.LogAnalytics,label:"Logs"},{value:d.AzureTraces,label:"Traces"},{value:d.AzureResourceGraph,label:"Azure Resource Graph"}],r=(0,o.useCallback)(a=>{a.value&&a.value!==e.queryType&&t({refId:e.refId,datasource:e.datasource,queryType:a.value})},[t,e]);return o.createElement("span",{"data-testid":M.components.queryEditor.header.select},o.createElement(ci,null,o.createElement(gi,{label:"Service",value:e.queryType,placeholder:"Service...",allowCustomValue:!0,options:s,onChange:r})))};function yi(e){var t=(0,o.useRef)();return(0,o.useEffect)(function(){t.current=e}),t.current}var mr=w(71892),vi=w(61136),pr=w(60297);const tl=null,sl="YYYY-MM-DD HH:mm:ss";function wi(){const e=(0,pr.CQ)();return{from:(0,pr.CQ)(e).subtract(6,"hour"),to:e,raw:{from:"now-6h",to:"now"}}}function rl(){return{from:600,to:0}}var Si=w(55126),Zt=w(67537),Nt=w(69710),Ei=w(8496);function ki(){const e=(0,k.wW)(zi);return o.createElement("div",{className:e.divider})}const zi=e=>({divider:(0,m.css)({height:1,backgroundColor:e.colors.border.weak,margin:e.spacing(.5,0)})}),dr=({label:e,ariaLabel:t,children:s})=>{const r=(0,k.wW)(Ai),a=`group-label-${(0,N.uniqueId)()}`;return o.createElement("div",{role:"group","aria-labelledby":!t&&e?a:void 0,"aria-label":t},e&&o.createElement("label",{id:a,className:r.groupLabel,"aria-hidden":!0},e),s)};dr.displayName="MenuGroup";const Ai=e=>({groupLabel:(0,m.css)({color:e.colors.text.secondary,fontSize:e.typography.size.sm,padding:e.spacing(.5,1)})});var Ni=w(67717),Yt=w(21568),Ti=w(26124);const fr=(e,t)=>(e%t+t)%t,gr=-1,hr=({localRef:e,isMenuOpen:t,openedWithArrow:s,setOpenedWithArrow:r,close:a,onOpen:i,onClose:c,onKeyDown:n})=>{const[l,u]=(0,o.useState)(gr);return(0,o.useEffect)(()=>{t&&s&&(u(0),r?.(!1))},[t,s,r]),(0,o.useEffect)(()=>{const g=e?.current?.querySelectorAll('[data-role="menuitem"]:not([data-disabled])');g?.[l]?.focus(),g?.forEach((b,y)=>{b.tabIndex=y===l?0:-1})},[e,l]),(0,Ti.Z)(()=>{i?.(u)}),[g=>{const b=e?.current?.querySelectorAll('[data-role="menuitem"]:not([data-disabled])'),y=b?.length??0;switch(g.key){case"ArrowUp":g.preventDefault(),g.stopPropagation(),u(fr(l-1,y));break;case"ArrowDown":g.preventDefault(),g.stopPropagation(),u(fr(l+1,y));break;case"ArrowLeft":g.preventDefault(),g.stopPropagation(),u(gr),a?.();break;case"Home":g.preventDefault(),g.stopPropagation(),u(0);break;case"End":g.preventDefault(),g.stopPropagation(),u(y-1);break;case"Enter":g.preventDefault(),g.stopPropagation(),b?.[l]?.click();break;case"Escape":c?.();break;case"Tab":g.preventDefault(),c?.();break;default:break}n?.(g)}]},Ci=e=>{if(!e)return!1;const t=e.parentElement.getBoundingClientRect(),s=e.getBoundingClientRect();return s.width!==0&&t.right+s.width+10>window.innerWidth},br=o.memo(({items:e,isOpen:t,openedWithArrow:s,setOpenedWithArrow:r,close:a,customStyle:i})=>{const c=(0,k.wW)(xi),n=(0,o.useRef)(null),[l]=hr({localRef:n,isMenuOpen:t,openedWithArrow:s,setOpenedWithArrow:r,close:a}),[u,p]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{t&&n.current&&p(Ci(n.current))},[t]),o.createElement(o.Fragment,null,o.createElement("div",{className:c.iconWrapper,"aria-hidden":!0,"data-testid":Yt.wl.components.Menu.SubMenu.icon},o.createElement(j.J,{name:"angle-right",className:c.icon})),t&&o.createElement("div",{ref:n,className:(0,m.cx)(c.subMenu,{[c.pushLeft]:u}),"data-testid":Yt.wl.components.Menu.SubMenu.container,style:i},o.createElement("div",{tabIndex:-1,className:c.itemsWrapper,role:"menu",onKeyDown:l},e)))});br.displayName="SubMenu";const xi=e=>({iconWrapper:(0,m.css)({display:"flex",flex:1,justifyContent:"end"}),icon:(0,m.css)({opacity:.7,marginLeft:e.spacing(1),color:e.colors.text.secondary}),itemsWrapper:(0,m.css)({background:e.colors.background.primary,boxShadow:e.shadows.z3,display:"inline-block",borderRadius:e.shape.radius.default}),pushLeft:(0,m.css)({right:"100%",left:"unset"}),subMenu:(0,m.css)({position:"absolute",top:0,left:"100%",zIndex:e.zIndex.dropdown})}),qt=o.memo(o.forwardRef((e,t)=>{const{url:s,icon:r,label:a,description:i,ariaLabel:c,ariaChecked:n,target:l,onClick:u,className:p,active:g,disabled:b,destructive:y,childItems:h,role:f="menuitem",tabIndex:v=-1,customSubMenuContainerStyles:S,shortcut:E,testId:A}=e,z=(0,k.wW)(Mi),[W,ee]=(0,o.useState)(g),[ne,ye]=(0,o.useState)(!1),[Qe,Ve]=(0,o.useState)(!1),et=(0,o.useCallback)(()=>{b||(ye(!0),ee(!0))},[b]),tt=(0,o.useCallback)(()=>{b||(ye(!1),ee(!1))},[b]),T=h&&h.length>0,Q=T?"div":s===void 0?"button":"a",$=(0,m.cx)({[z.item]:!0,[z.active]:W,[z.disabled]:b,[z.destructive]:y&&!b},p),Me={[Q==="button"?"disabled":"aria-disabled"]:b,...Q==="a"&&b&&{href:void 0,onClick:void 0},...b&&{tabIndex:-1,["data-disabled"]:b}},ue=(0,o.useRef)(null);(0,o.useImperativeHandle)(t,()=>ue.current);const J=rt=>{switch(rt.key){case"ArrowRight":rt.preventDefault(),rt.stopPropagation(),T&&(ye(!0),Ve(!0),ee(!0));break;default:break}},We=()=>{ye(!1),ee(!1),ue?.current?.focus()},st=!!(E&&E.length>0);return o.createElement(Q,{target:l,className:$,rel:l==="_blank"?"noopener noreferrer":void 0,href:s,onClick:u,onMouseEnter:et,onMouseLeave:tt,onKeyDown:J,role:s===void 0?f:void 0,"data-role":"menuitem",ref:ue,"data-testid":A,"aria-label":c,"aria-checked":n,tabIndex:v,...Me},o.createElement(Ni.K,{direction:"row",justifyContent:"flex-start",alignItems:"center"},r&&o.createElement(j.J,{name:r,className:z.icon,"aria-hidden":!0}),o.createElement("span",{className:z.ellipsis},a),o.createElement("div",{className:(0,m.cx)(z.rightWrapper,{[z.withShortcut]:st})},st&&o.createElement("div",{className:z.shortcut},o.createElement(j.J,{name:"keyboard",title:"keyboard shortcut"}),E),T&&o.createElement(br,{items:h,isOpen:ne,openedWithArrow:Qe,setOpenedWithArrow:Ve,close:We,customStyle:S}))),i&&o.createElement("div",{className:(0,m.cx)(z.description,z.ellipsis,{[z.descriptionWithIcon]:r!==void 0})},i))}));qt.displayName="MenuItem";const Mi=e=>({item:(0,m.css)({background:"none",cursor:"pointer",whiteSpace:"nowrap",color:e.colors.text.primary,display:"flex",flexDirection:"column",alignItems:"stretch",padding:e.spacing(.5,2),minHeight:e.spacing(4),margin:0,border:"none",width:"100%",position:"relative","&:hover, &:focus, &:focus-visible":{background:e.colors.action.hover,color:e.colors.text.primary,textDecoration:"none"},"&:focus-visible":(0,ke.SV)(e)}),active:(0,m.css)({background:e.colors.action.hover}),destructive:(0,m.css)({color:e.colors.error.text,svg:{color:e.colors.error.text},"&:hover, &:focus, &:focus-visible":{background:e.colors.error.main,color:e.colors.error.contrastText,svg:{color:e.colors.error.contrastText}}}),disabled:(0,m.css)({color:e.colors.action.disabledText,label:"menu-item-disabled","&:hover, &:focus, &:focus-visible":{cursor:"not-allowed",background:"none",color:e.colors.action.disabledText}}),icon:(0,m.css)({opacity:.7,color:e.colors.text.secondary}),rightWrapper:(0,m.css)({display:"flex",alignItems:"center",marginLeft:"auto"}),withShortcut:(0,m.css)({minWidth:e.spacing(10.5)}),shortcut:(0,m.css)({display:"flex",alignItems:"center",gap:e.spacing(1),marginLeft:e.spacing(2),color:e.colors.text.secondary,opacity:.7}),description:(0,m.css)({...e.typography.bodySmall,color:e.colors.text.secondary,textAlign:"start"}),descriptionWithIcon:(0,m.css)({marginLeft:e.spacing(3)}),ellipsis:(0,m.css)({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"})}),yr=o.forwardRef(({header:e,children:t,ariaLabel:s,onOpen:r,onClose:a,onKeyDown:i,...c},n)=>{const l=(0,k.wW)(Ii),u=(0,o.useRef)(null);(0,o.useImperativeHandle)(n,()=>u.current);const[p]=hr({localRef:u,onOpen:r,onClose:a,onKeyDown:i});return o.createElement("div",{...c,tabIndex:-1,ref:u,className:l.wrapper,role:"menu","aria-label":s,onKeyDown:p},e&&o.createElement("div",{className:(0,m.cx)(l.header,!!t&&o.Children.toArray(t).length>0&&l.headerBorder)},e),t)});yr.displayName="Menu";const Ri=Object.assign(yr,{Item:qt,Divider:ki,Group:dr}),Ii=e=>({header:(0,m.css)({padding:`${e.spacing(.5,1,1,1)}`}),headerBorder:(0,m.css)({borderBottom:`1px solid ${e.colors.border.weak}`}),wrapper:(0,m.css)({background:`${e.colors.background.primary}`,boxShadow:`${e.shadows.z3}`,display:"inline-block",borderRadius:`${e.shape.radius.default}`,padding:`${e.spacing(.5,0)}`})});var Di=w(7820);const vr=(0,o.forwardRef)(({tooltip:e,icon:t,iconSize:s,className:r,children:a,imgSrc:i,imgAlt:c,fullWidth:n,isOpen:l,narrow:u,variant:p="default",iconOnly:g,"aria-label":b,isHighlighted:y,...h},f)=>{const v=(0,k.wW)(Pi),S=(0,m.cx)({[v.button]:!0,[v.buttonFullWidth]:n,[v.narrow]:u},v[p],r),E=(0,m.cx)({[v.content]:!0,[v.contentWithIcon]:!!t,[v.contentWithRightIcon]:l!==void 0}),A=o.createElement("button",{ref:f,className:S,"aria-label":Li(b,e),"aria-expanded":l,...h},Fi(t,s),i&&o.createElement("img",{className:v.img,src:i,alt:c??""}),a&&!g&&o.createElement("div",{className:E},a),l===!1&&o.createElement(j.J,{name:"angle-down"}),l===!0&&o.createElement(j.J,{name:"angle-up"}),y&&o.createElement("div",{className:v.highlight}));return e?o.createElement(Ft.u,{ref:f,content:e,placement:"bottom"},A):A});vr.displayName="ToolbarButton";function Li(e,t){return e||(t?Yt.wl.components.PageToolbar.item(t):void 0)}function Fi(e,t){return e?(0,Di.Mo)(e)?o.createElement(j.J,{name:e,size:`${t||"lg"}`}):e:null}const Pi=e=>{const t=(0,H.c9)(e,"primary","solid"),s=(0,H.c9)(e,"destructive","solid"),r=(0,m.css)({color:e.colors.text.primary,background:e.colors.secondary.main,"&:hover":{color:e.colors.text.primary,background:e.colors.secondary.shade,border:`1px solid ${e.colors.border.medium}`}});return{button:(0,m.css)({label:"toolbar-button",position:"relative",display:"flex",alignItems:"center",height:e.spacing(e.components.height.md),padding:e.spacing(0,1),borderRadius:e.shape.radius.default,lineHeight:`${e.components.height.md*e.spacing.gridSize-2}px`,fontWeight:e.typography.fontWeightMedium,border:`1px solid ${e.colors.secondary.border}`,whiteSpace:"nowrap",transition:e.transitions.create(["background","box-shadow","border-color","color"],{duration:e.transitions.duration.short}),"&:focus, &:focus-visible":{...(0,ke.SV)(e),zIndex:1},"&:focus:not(:focus-visible)":(0,ke.Cq)(e),"&:hover":{boxShadow:e.shadows.z1},"&[disabled], &:disabled":{cursor:"not-allowed",opacity:e.colors.action.disabledOpacity,background:e.colors.action.disabledBackground,boxShadow:"none","&:hover":{color:e.colors.text.disabled,background:e.colors.action.disabledBackground,boxShadow:"none"}}}),default:(0,m.css)({color:e.colors.text.secondary,background:"transparent",border:"1px solid transparent","&:hover":{color:e.colors.text.primary,background:e.colors.background.secondary}}),canvas:r,active:(0,m.cx)(r,(0,m.css)({"&::before":{display:"block",content:'" "',position:"absolute",left:0,right:0,height:"2px",bottom:0,borderRadius:e.shape.radius.default,backgroundImage:e.colors.gradients.brandHorizontal}})),primary:(0,m.css)(t),destructive:(0,m.css)(s),narrow:(0,m.css)({padding:e.spacing(0,.5)}),img:(0,m.css)({width:"16px",height:"16px",marginRight:e.spacing(1)}),buttonFullWidth:(0,m.css)({flexGrow:1}),content:(0,m.css)({flexGrow:1}),contentWithIcon:(0,m.css)({display:"none",paddingLeft:e.spacing(1),[`@media ${ke._Q(e.v1.breakpoints.md)}`]:{display:"block"}}),contentWithRightIcon:(0,m.css)({paddingRight:e.spacing(.5)}),highlight:(0,m.css)({backgroundColor:e.colors.success.main,borderRadius:e.shape.radius.circle,width:"6px",height:"6px",position:"absolute",top:"-3px",right:"-3px",zIndex:1})}},wr=e=>{const{className:t,options:s,value:r,onChange:a,narrow:i,variant:c,...n}=e,l=(0,k.wW)(Oi),[u,p]=(0,o.useState)(!1),g=[(0,Zt.cv)(0),(0,Zt.RR)({fallbackAxisSideDirection:"end",crossAxis:!1,boundary:document.body}),(0,Zt.uY)()],{context:b,refs:y,floatingStyles:h}=(0,Nt.YF)({open:u,placement:"bottom-end",onOpenChange:p,middleware:g,whileElementsMounted:Ei.Me}),f=(0,Nt.eS)(b),v=(0,Nt.bQ)(b),{getReferenceProps:S,getFloatingProps:E}=(0,Nt.NI)([v,f]),A=z=>{a(z),p(!1)};return o.createElement("div",{className:l.wrapper},o.createElement(vr,{className:t,isOpen:u,narrow:i,variant:c,ref:y.setReference,...S(),...n},r?.label||(r?.value!=null?String(r?.value):null)),u&&o.createElement("div",{className:l.menuWrapper,ref:y.setFloating,...E(),style:h},o.createElement(ks.MT,{contain:!0,autoFocus:!0,restoreFocus:!0},o.createElement(Ri,{tabIndex:-1,onClose:()=>p(!1)},s.map(z=>o.createElement(qt,{key:`${z.value}`,label:z.label??String(z.value),onClick:()=>A(z),active:z.value===r?.value,ariaChecked:z.value===r?.value,ariaLabel:z.ariaLabel||z.label,role:"menuitemradio"}))))))};wr.displayName="ButtonSelect";const Gi=o.memo(wr),Oi=e=>({wrapper:(0,m.css)({position:"relative",display:"inline-flex"}),menuWrapper:(0,m.css)({zIndex:e.zIndex.dropdown})}),Tt=(e,t,s,r)=>{e==="filters"?t[e]=s.map(a=>a.value):(t[e]=s.value,e==="property"&&(t.filters=[])),r(t)},Qi=async(e,t,s,r,a,i,c)=>{const{azureTraces:n}=e;if(!n)return[];const{resources:l}=n;if(!l||!i)return[];const u=i.property;if(!u)return[];const p=`let ${u} = toscalar(union isfuzzy=true ${s.join(",")}
  | where $__timeFilter(timestamp)
  | summarize count=count() by ${u}
  | summarize make_list(pack_all()));
  print properties = bag_pack("${u}", ${u});`,g=await(0,mr.n)(t.azureLogAnalyticsDatasource.query({requestId:"azure-traces-properties-req",interval:"",intervalMs:0,scopedVars:{},timezone:"",startTime:0,app:vi.zj.Unknown,targets:[{...e,azureLogAnalytics:{resources:l,query:p},queryType:d.LogAnalytics}],range:c||wi()}));if(g.data.length>0){const b=g.data[0];if(b.fields.length>0){const h=JSON.parse(b.fields[0].values.toArray()[0])[u].map(f=>{let v=f[u];return f[u]===""&&(v="<Empty>"),{label:v.toString(),value:f[u].toString(),count:f.count}});return r.set(u,h),a(r),h}}return[]};function Vi(e){function t(s,r,a){return o.createElement($i,{...e,item:s,onChange:r,onDelete:a})}return t}const Wi=e=>{const{data:t,innerProps:s,innerRef:r,isFocused:a,isSelected:i}=e,c=(0,k.l4)(),n=(0,Si.D)(c),l=u=>{e.selectOption({...t}),u.stopPropagation(),u.preventDefault()};return o.createElement("div",{ref:r,className:(0,m.cx)(n.option,a&&n.optionFocused,i&&n.optionSelected,t.isDisabled&&n.optionDisabled),...s,"aria-label":"Select option",title:t.title,onClick:l,onKeyDown:l,role:"checkbox","aria-checked":i,tabIndex:0},o.createElement("div",{className:n.optionBody},o.createElement($t,{value:i,label:t.label?`${t.label} - (${t.count})`:""})))},$i=e=>{const{query:t,datasource:s,propertyMap:r,setPropertyMap:a,queryTraceTypes:i,properties:c,item:n,onChange:l,onDelete:u,variableOptionGroup:p,range:g}=e,[b,y]=(0,o.useState)(!1),[h,f]=(0,o.useState)(Ce(r.get(n.property??"")??[],p)),[v,S]=(0,o.useState)(n.filters?n.filters.map(A=>({value:A,label:A===""?"<Empty>":A})):[]),E=async()=>{if(y(!0),n.property&&n.property!==""){const z=r.get(n.property??"");if(z)return f(Ce(z,p)),y(!1),Promise.resolve(z);{const W=await Qi(t,s,i,r,a,n,g);return f(Ce(W,p)),y(!1),W}}const A=[];return Promise.resolve(A)};return o.createElement(Ue,{spacing:"none"},o.createElement(L.Ph,{menuShouldPortal:!0,placeholder:"Property",value:n.property?{value:n.property,label:n.property}:null,options:Ce(c.map(A=>({label:A,value:A})),p),onChange:A=>Tt("property",n,A,l),width:25}),o.createElement(Gi,{placeholder:"Operator",value:n.operation?{label:n.operation==="eq"?"=":"!=",value:n.operation}:void 0,options:[{label:"=",value:"eq"},{label:"!=",value:"ne"}],onChange:A=>Tt("operation",n,A,l),defaultValue:"eq"}),o.createElement(L.M8,{blurInputOnSelect:!1,menuShouldPortal:!0,placeholder:"Value",value:v,loadOptions:E,isLoading:b,onOpenMenu:E,onChange:A=>{S(A),A.length===0&&Tt("filters",n,v,l)},width:35,defaultOptions:h,isClearable:!0,components:{Option:Wi},closeMenuOnSelect:!1,onCloseMenu:()=>Tt("filters",n,v,l),hideSelectedOptions:!1}),o.createElement(Et,{"aria-label":"Remove filter",icon:"times",variant:"secondary",onClick:u,type:"button"}))},ol=null,Ui={availabilityResults:{label:"Availablity Results",description:"Availability test results."},dependencies:{label:"Dependencies",description:"Calls your application makes to other services such as databases or REST APIs."},customEvents:{label:"Custom Events",description:"Calls to TrackEvent that are inserted to monitor usage."},exceptions:{label:"Exceptions",description:"Exceptions that are logged via TrackException, or uncaught exceptions."},pageViews:{label:"Page Views",description:"Web client telemetry to create page view reports."},requests:{label:"Requests",description:"HTTP requests received by the application."},traces:{label:"Traces",description:"Diagnostic logs emitted using TrackTrace and similar methods. Note: Traces are not visualised if the result format is set to Trace"}},al={AppAvailabilityResults:"availabilityResults",AppDependencies:"dependencies",AppEvents:"events",AppExceptions:"exceptions",AppPageViews:"pageViews",AppRequests:"requests",AppTraces:"traces"},Bi=["operationId","duration","id","name","problemId","operation_ParentId","timestamp","customDimensions","operation_Name"],Ye={appId:"ResourceGUID",application_Version:"AppVersion",appName:"_ResourceId",client_Browser:"ClientBrowser",client_City:"ClientCity",client_CountryOrRegion:"ClientCountryOrRegion",client_IP:"ClientIP",client_Model:"ClientModel",client_OS:"ClientOS",client_StateOrProvince:"ClientStateOrProvince",client_Type:"ClientType",cloud_RoleInstance:"AppRoleInstance",cloud_RoleName:"AppRoleName",customDimensions:"Properties",customMeasurements:"Measurements",duration:"DurationMs",id:"Id",iKey:"IKey",itemCount:"ItemCount",itemId:"_ItemId",itemType:"Type",name:"Name",operation_Id:"OperationId",operation_Name:"OperationName",operation_ParentId:"OperationParentId",operation_SyntheticSource:"OperationSyntheticSource",performanceBucket:"PerformanceBucket",sdkVersion:"SDKVersion",session_Id:"SessionId",success:"Success",timestamp:"TimeGenerated",user_AccountId:"UserAccountId",user_AuthenticatedId:"UserAuthenticatedId",user_Id:"UserId"},ji={...Ye,location:"Location",message:"Message",size:"Size"},_i={...Ye,data:"Data",resultCode:"ResultCode",target:"Target",type:"DependencyType"},Hi=(0,N.omit)(Ye,["duration","id","success","performanceBucket"]),Xi=(0,N.omit)({...Ye,url:"Url"},["success"]),Ji={resultCode:"ResultCode",source:"Source",url:"Url"},Ki=(0,N.omit)({...Ye,assembly:"Assembly",details:"Details",handledAt:"HandledAt",innermostAssembly:"InnermostAssembly",innermostMessage:"InnermostMessage",innermostMethod:"InnermostMethod",innermostType:"InnermostType",message:"Message",method:"Method",outerAssembly:"OuterAssembly",outerMessage:"OuterMessage",outerMethod:"OuterMethod",outerType:"OuterType",problemId:"ProblemId",severityLevel:"SeverityLevel",type:"ExceptionType"},["duration","id","name","performanceBucket","success"]),Zi=(0,N.omit)({message:"Message",severityLevel:"SeverityLevel"},["duration","id","name","performanceBucket","success"]),es={availabilityResults:ji,dependencies:_i,customEvents:Hi,exceptions:Ki,pageViews:Xi,requests:Ji,traces:Zi},il=Object.entries(es).reduce((e,[t,s])=>({...e,[t]:Object.keys((0,N.omit)(s,Bi)).join(",")}),{});function Yi(e,t){return{...e,azureTraces:{...e.azureTraces,operationId:t}}}function qi(e,t){return{...e,azureTraces:{...e.azureTraces,resultFormat:t}}}function Sr(e,t){return{...e,azureTraces:{...e.azureTraces,traceTypes:t}}}function en(e,t){return{...e,azureTraces:{...e.azureTraces,filters:t}}}const tn=({query:e,datasource:t,onQueryChange:s,variableOptionGroup:r,range:a})=>{const{azureTraces:i}=e,c=i?.traceTypes?i.traceTypes:Object.keys(es),n=new Set(["customDimensions","customMeasurements","details","duration","id","itemId","operation_Id","operation_ParentId","timestamp"]),l=(0,N.uniq)(c.map(f=>Object.keys(es[f])).flat()).filter(f=>!n.has(f)),[u,p]=(0,o.useState)(new Map),g=(0,o.useMemo)(()=>e.azureTraces?.filters??[],[e.azureTraces?.filters]),[b,y]=(0,o.useState)(g);(0,o.useEffect)(()=>{p(new Map)},[e.azureTraces?.resources,e.azureTraces?.traceTypes,e.azureTraces?.operationId]);const h=f=>{let v=!1;const S=f.map(E=>(E.property!==""&&E.filters&&E.filters.length>0&&E.operation!==""?v=!0:v=!1,{property:E.property??"",filters:E.filters??[],operation:E.operation??"eq"}));y(S),(v||g.length>0&&S.length===0)&&s(en(e,S))};return o.createElement(U.g,{label:"Filters"},o.createElement(tr,{items:b,onChange:h,renderItem:Vi({query:e,datasource:t,propertyMap:u,setPropertyMap:p,queryTraceTypes:c,properties:l,variableOptionGroup:r,range:a})}))},sn=({query:e,variableOptionGroup:t,onQueryChange:s})=>{const r=Object.entries(Ui).map(([n,l])=>({label:l.label,description:l.description,value:n})),a=(0,o.useCallback)(n=>{const l=Sr(e,n.map(u=>u.value??""));s(l)},[s,e]),i=(0,o.useMemo)(()=>[...r,t],[r,t]),c=()=>{const n=r.map(u=>u.value),l=Sr(e,n);return s(l),n};return o.createElement(ae,{label:"Event Type"},o.createElement(L.NU,{placeholder:"Choose event types",inputId:"azure-monitor-traces-type-field",value:Dt([...r,...t.options],e.azureTraces?.traceTypes??c()),onChange:a,options:i,allowCustomValue:!0,isClearable:!0,"aria-label":M.components.queryEditor.tracesQueryEditor.traceTypes.select}))},rn=({query:e,datasource:t,subscriptionId:s,variableOptionGroup:r,onChange:a,setError:i,range:c})=>{const n=(y,h)=>{if(h.length===0)return!1;const f=q(y.uri,y.location).metricNamespace?.toLowerCase(),v=q(h[0].uri,h[0].location).metricNamespace?.toLowerCase();return f!==v},[l,u]=(0,o.useState)(e.azureTraces?.operationId??""),p=yi(e.azureTraces?.operationId);(0,o.useEffect)(()=>{e.azureTraces?.operationId&&p!==e.azureTraces.operationId&&u(e.azureTraces.operationId)},[u,p,e,l]);const g=(0,o.useCallback)(y=>{y.target instanceof HTMLInputElement&&u(y.target.value)},[]),b=(0,o.useCallback)(y=>{const h=Yi(e,l);a(h)},[a,l,e]);return o.createElement("span",{"data-testid":M.components.queryEditor.tracesQueryEditor.container.input},o.createElement(gt,null,o.createElement(ge,null,o.createElement(he,null,o.createElement(jt,{query:e,datasource:t,subscriptionId:s,variableOptionGroup:r,onQueryChange:a,setError:i,selectableEntryTypes:[F.Subscription,F.ResourceGroup,F.Resource,F.Variable],resources:e.azureTraces?.resources??[],queryType:"traces",disableRow:n,renderAdvanced:(y,h)=>o.createElement(Ls,{resources:y,onChange:h}),selectionNotice:()=>"You may only choose items of the same resource type.",range:c}))),o.createElement(ge,null,o.createElement(he,null,o.createElement(sn,{datasource:t,onQueryChange:a,query:e,setError:i,variableOptionGroup:r,range:c}),o.createElement(ae,{label:"Operation ID"},o.createElement(B.I,{id:"azure-monitor-traces-operation-id-field",value:l,onChange:g,onBlur:b,width:40})))),o.createElement(ge,null,o.createElement(he,null,o.createElement(tn,{datasource:t,onQueryChange:a,query:e,setError:i,variableOptionGroup:r,range:c}))),o.createElement(ge,null,o.createElement(he,null,o.createElement(Es,{datasource:t,setError:i,query:e,variableOptionGroup:r,onQueryChange:a,inputId:"azure-monitor-traces",options:[{label:"Table",value:le.Table},{label:"Trace",value:le.Trace}],defaultValue:le.Table,setFormatAs:qi,resultFormat:e.azureTraces?.resultFormat,range:c})))))};var on=w(89162),an=w.n(on);const nn="select";function ts(e){let t=e;return t.queryType||(t={...t,queryType:d.AzureMonitor}),t=ln(t),t.queryType===d.AzureMonitor&&t.azureMonitor&&(t=cn(t),t=un(t),t=mn(t),t=pn(t),t=dn(t)),(t.azureMonitor?.resourceGroup||t.azureMonitor?.resourceName)&&(t=fn(t)),t.azureLogAnalytics?.resource&&(t={...t,azureLogAnalytics:{...t.azureLogAnalytics,resources:[t.azureLogAnalytics.resource]}},delete t.azureLogAnalytics?.resource),t.azureLogAnalytics&&t.azureLogAnalytics.dashboardTime===void 0&&(t.azureLogAnalytics.intersectTime?t={...t,azureLogAnalytics:{...t.azureLogAnalytics,dashboardTime:!0}}:t={...t,azureLogAnalytics:{...t.azureLogAnalytics,dashboardTime:!1}}),t}function cn(e){let t=e;if(t.azureMonitor?.timeGrainUnit&&t.azureMonitor.timeGrain!=="auto"){const s=oe.createISO8601Duration(t.azureMonitor.timeGrain??"auto",t.azureMonitor.timeGrainUnit);t=er(t,s),delete t.azureMonitor?.timeGrainUnit}return t}function ln(e){let t=e;return t.azureLogAnalytics?.query?.match(/\$__from\s/gi)&&(t=_t(t,t.azureLogAnalytics.query.replace(/\$__from\s/gi,"$__timeFrom() "))),t.azureLogAnalytics?.query?.match(/\$__to\s/gi)&&(t=_t(t,t.azureLogAnalytics.query.replace(/\$__to\s/gi,"$__timeTo() "))),t}function un(e){return!(e.azureMonitor?.metricNamespace&&e.azureMonitor.metricNamespace!==nn)&&e.azureMonitor?.metricDefinition?{...e,azureMonitor:{...e.azureMonitor,metricNamespace:e.azureMonitor.metricDefinition,metricDefinition:void 0}}:e}function mn(e){let t=e;const s=t.azureMonitor?.dimension;return s&&s!=="None"&&(t=Ha(t,s,"eq",[t.azureMonitor?.dimensionFilter||""])),delete t.azureMonitor?.dimension,delete t.azureMonitor?.dimensionFilter,t}function pn(e){const t=e.azureMonitor;if(!t)return e;const s=[],r=t.dimensionFilters;return r&&r.length>0&&(r.forEach(a=>{const i={dimension:a.dimension,operator:a.operator};if(!a.filters&&a.filter)s.push({...i,filters:[a.filter]});else{let c=!1;if(a.filters&&a.filter){for(const n of a.filters)if(a.filter===n){c=!0;break}!c&&a.filter!=="*"&&a.filters.push(a.filter),s.push({...i,filters:a.filters})}}}),s.length>0)?{...e,azureMonitor:{...t,dimensionFilters:s}}:e}function dn(e){if(e.azureMonitor?.resourceUri&&!e.azureMonitor.resourceUri.startsWith("$")){const t=q(e.azureMonitor.resourceUri),s=t?.subscription&&t?.resourceGroup&&t?.resourceName;return{...e,subscription:t?.subscription,azureMonitor:{...e.azureMonitor,resources:[{resourceGroup:t?.resourceGroup,resourceName:t?.resourceName}],metricNamespace:t?.metricNamespace,resourceUri:s?void 0:e.azureMonitor.resourceUri}}}return e}function fn(e){let t=e;return t.azureMonitor?.resourceGroup&&t.azureMonitor?.resourceName&&(t={...t,azureMonitor:{...t.azureMonitor,resources:[{resourceGroup:t.azureMonitor.resourceGroup,resourceName:t.azureMonitor.resourceName}]}},delete t.azureMonitor?.resourceGroup,delete t.azureMonitor?.resourceName),t}const gn={queryType:d.AzureMonitor},hn=e=>{const t=(0,N.defaults)({},e,gn),s=ts(t);return an()(s,e)?e:s},bn=(e,t)=>{const s=(0,o.useMemo)(()=>hn(e),[e]);return(0,o.useEffect)(()=>{s!==e&&t(s)},[s,e,t]),s},yn=({query:e,datasource:t,onChange:s,onRunQuery:r,data:a,range:i})=>{const[c,n]=ds(),l=(0,o.useMemo)(()=>(0,N.debounce)(r,500),[r]),[u,p]=(0,o.useState)(!1),g=(0,o.useCallback)(f=>{s(f),l()},[s,l]),b=bn(e,g),y=b.subscription||t.azureMonitorDatasource.defaultSubscriptionId,h={label:"Template Variables",options:t.getVariables().map(f=>({label:f,value:f}))};return o.createElement("div",{"data-testid":"azure-monitor-query-editor"},o.createElement(Qa,{datasource:t.azureLogAnalyticsDatasource,isOpen:u,onClose:()=>p(!1),onChange:f=>s({...f,queryType:d.LogAnalytics})}),o.createElement("div",{className:(0,m.css)({display:"flex",alignItems:"center"})},o.createElement(bi,{query:b,onQueryChange:g}),b.queryType===d.LogAnalytics&&o.createElement(H.zx,{"aria-label":"Azure logs kick start your query button",variant:"secondary",size:"sm",onClick:()=>{p(f=>!f),(0,dt.ff)("grafana_azure_logs_query_patterns_opened",{version:"v2",editorMode:b.azureLogAnalytics})}},"Kick start your query")),o.createElement(vn,{data:a,subscriptionId:y,query:b,datasource:t,onChange:g,variableOptionGroup:h,setError:n,range:i}),c&&o.createElement(o.Fragment,null,o.createElement(ie,{v:2}),o.createElement(Te.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor"},c instanceof Error?c.message:c)))},vn=({data:e,subscriptionId:t,query:s,datasource:r,variableOptionGroup:a,onChange:i,setError:c,range:n})=>{switch(s.queryType){case d.AzureMonitor:return o.createElement(ni,{data:e,query:s,datasource:r,onChange:i,variableOptionGroup:a,setError:c});case d.LogAnalytics:return o.createElement(Ps,{data:e,subscriptionId:t,query:s,datasource:r,onChange:i,variableOptionGroup:a,setError:c,timeRange:n});case d.AzureResourceGraph:return o.createElement(Ss,{subscriptionId:t,query:s,datasource:r,onChange:i,variableOptionGroup:a,setError:c});case d.AzureTraces:return o.createElement(rn,{subscriptionId:t,query:s,datasource:r,onChange:i,variableOptionGroup:a,setError:c,range:n});default:const l=s.queryType;return o.createElement(Te.b,{title:"Unknown query type"},(l==="Application Insights"||l==="Insights Analytics")&&o.createElement(o.Fragment,null,l," was deprecated in Grafana 9. See the"," ",o.createElement("a",{href:"https://grafana.com/docs/grafana/latest/datasources/azuremonitor/deprecated-application-insights/",target:"_blank",rel:"noreferrer"},"deprecation notice")," ","to get more information about how to migrate your queries. This is the current query definition:",o.createElement(Lt.p,{height:"200px",readOnly:!0,language:"json",value:JSON.stringify(s,null,4)})))}},wn=yn;var Sn=w(44130),En=w(86457),kn=w(4558),Er=w(53797),qe=w(65821);const zn=/([\w\W]+):([\w]+)(?:\s?=\s?([\w\W]+))?/;function An(e){return e.functions?e.functions.map(t=>{const s=t.parameters&&t.parameters.split(", ").map(r=>{const a=r.match(zn);if(!a)return;const[,i,c,n]=a;return{name:i,type:c,defaultValue:n,cslDefaultValue:n}}).filter(r=>!!r);return{name:t.name,body:t.body,inputParameters:s||[]}}):[]}function Nn(e,t,s){const r={name:t,tables:e.tables,functions:An(e),majorVersion:0,minorVersion:0};r.functions.push({name:"$__timeFilter",body:"{ true }",inputParameters:[{name:"timeColumn",type:"System.String",defaultValue:'""',cslDefaultValue:'""'}]},{name:"$__timeFrom",body:"{ datetime(2018-06-05T18:09:58.907Z) }",inputParameters:[]},{name:"$__timeTo",body:"{ datetime(2018-06-05T20:09:58.907Z) }",inputParameters:[]},{name:"$__escapeMulti",body:"{ @'\\grafana-vmNetwork(eth0)Total', @'\\hello!'}",inputParameters:[{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]},{name:"$__contains",body:"{ colName in ('value1','value2') }",inputParameters:[{name:"colName",type:"System.String",defaultValue:"colName",cslDefaultValue:"colName"},{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]});const a=s.map(i=>({name:`$${i.name}`,type:"dynamic"}));return{clusterType:"Engine",cluster:{connectionString:t,databases:[r]},database:r,globalScalarParameters:a}}class Tn extends qe.CK{constructor(t,s=(0,Fe.J)()){super(t),this.instanceSettings=t,this.templateSrv=s,this.resourcePath=`${Pe.logAnalytics}`,this.azureMonitorPath=`${Pe.azureMonitor}/subscriptions`;const r=ps(t);this.azurePortalUrl=ms(r),this.defaultSubscriptionId=this.instanceSettings.jsonData.subscriptionId||""}isConfigured(){return!this.validateDatasource()}filterQuery(t){return t.hide!==!0&&(!!t.azureLogAnalytics?.query&&(!!t.azureLogAnalytics.resources?.length||!!t.azureLogAnalytics.workspace)||!!t.azureTraces?.resources?.length)}async getSubscriptions(){if(!this.isConfigured())return[];const t=`${this.azureMonitorPath}?api-version=2019-03-01`;return await this.getResource(t).then(s=>Y.parseSubscriptions(s))}async getWorkspaces(t){const s=await this.getWorkspaceList(t);return(0,N.map)(s.value,r=>({text:r.name,value:r.id}))||[]}getWorkspaceList(t){const s=this.templateSrv.replace(t||this.defaultSubscriptionId),r=this.azureMonitorPath+`/${s}/providers/Microsoft.OperationalInsights/workspaces?api-version=2017-04-26-preview`;return this.getResource(r)}async getMetadata(t){const s=`${this.resourcePath}/v1${t}/metadata`;return await this.getResource(s)}async getKustoSchema(t){const s=this.templateSrv.replace(t,{},mt),r=await this.getMetadata(s);return Nn(r,s,this.templateSrv.getVariables())}applyTemplateVariables(t,s){let r;if(t.queryType===d.LogAnalytics&&t.azureLogAnalytics){r=t.azureLogAnalytics;const a=this.expandResourcesForMultipleVariables(r.resources,s);let i=this.templateSrv.replace(r.workspace,s);!i&&!a&&this.firstWorkspace&&(i=this.firstWorkspace);const c=this.templateSrv.replace(r.query,s,mt);return{...t,queryType:t.queryType||d.LogAnalytics,azureLogAnalytics:{resultFormat:r.resultFormat,query:c,resources:a,workspace:i,dashboardTime:r.dashboardTime,timeColumn:this.templateSrv.replace(r.timeColumn,s)}}}if(t.queryType===d.AzureTraces&&t.azureTraces){r=t.azureTraces;const a=this.expandResourcesForMultipleVariables(r.resources,s),i=this.templateSrv.replace(r.query,s,mt),c=r.traceTypes?.map(l=>this.templateSrv.replace(l,s)),n=(r.filters??[]).filter(l=>!!l.property).map(l=>{const u=l.filters?.map(p=>this.templateSrv.replace(p??"",s));return{property:this.templateSrv.replace(l.property,s),operation:l.operation||"eq",filters:u||[]}});return{...t,queryType:t.queryType||d.AzureTraces,azureTraces:{resultFormat:r.resultFormat,query:i,resources:a,operationId:this.templateSrv.replace(t.azureTraces?.operationId,s),filters:n,traceTypes:c}}}return t}expandResourcesForMultipleVariables(t,s){if(!t)return;const r=[];return t.forEach(a=>{this.templateSrv.replace(a,s,"raw").split(",").forEach(n=>{r.push(n)})}),r}getDeprecatedDefaultWorkSpace(){return this.instanceSettings.jsonData.logAnalyticsDefaultWorkspace}async getDefaultOrFirstSubscription(){return this.defaultSubscriptionId?this.defaultSubscriptionId:(await this.getSubscriptions())[0]?.value}async getFirstWorkspace(){if(this.firstWorkspace)return this.firstWorkspace;const t=await this.getDefaultOrFirstSubscription();if(!t)return;const r=(await this.getWorkspaces(t))[0]?.value;return r&&(this.firstWorkspace=r),r}validateDatasource(){if(pt(this.instanceSettings)==="clientsecret"){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(t){return typeof t=="string"&&t.length>0}async getAzureLogAnalyticsCheatsheetQueries(){return await this.getResource(`${this.resourcePath}/v1/metadata`)}}const Cn="select";function je(e){return!!(e&&e!==Cn)}class xn extends qe.CK{constructor(t,s=(0,Fe.J)()){super(t),this.instanceSettings=t,this.templateSrv=s,this.apiVersion="2018-01-01",this.apiPreviewVersion="2017-12-01-preview",this.listByResourceGroupApiVersion="2021-04-01",this.providerApiVersion="2021-04-01",this.locationsApiVersion="2020-01-01",this.defaultSubscriptionId=t.jsonData.subscriptionId;const r=ps(t);this.resourcePath=Pe.azureMonitor,this.azurePortalUrl=ms(r)}isConfigured(){return!this.validateDatasource()}filterQuery(t){const s=t?.azureMonitor?.resources&&t.azureMonitor.resources.length>0&&t.azureMonitor.resources.every(a=>je(a.resourceGroup)&&je(a.resourceName))&&je(t?.azureMonitor?.metricDefinition||t?.azureMonitor?.metricNamespace),r=je(t.azureMonitor?.resourceUri);return!!(t.hide!==!0&&(s||r)&&je(t?.azureMonitor?.metricName)&&je(t?.azureMonitor?.aggregation))}applyTemplateVariables(t,s){const r=t.azureMonitor;if(!r)throw new Error("Query is not a valid Azure Monitor Metrics query");r.resourceUri&&(r.resourceUri=this.templateSrv.replace(r.resourceUri,s)),r.metricDefinition&&(r.metricDefinition=this.templateSrv.replace(r.metricDefinition,s)),r.timeGrain&&r.timeGrainUnit&&r.timeGrain!=="auto"&&(r.timeGrain=oe.createISO8601Duration(r.timeGrain,r.timeGrainUnit));const a=ts(t),i=a.azureMonitor;if(!i)throw new Error("Query is not a valid Azure Monitor Metrics query");const c=this.templateSrv.replace(a.subscription||this.defaultSubscriptionId,s),n=i.resources?.map(f=>this.replaceTemplateVariables(f,s)).flat(),l=this.templateSrv.replace(i.metricNamespace,s),u=this.templateSrv.replace(i.customNamespace,s),p=this.templateSrv.replace((i.timeGrain||"").toString(),s),g=this.templateSrv.replace(i.aggregation,s),b=this.templateSrv.replace(i.top||"",s),y=(i.dimensionFilters??[]).filter(f=>f.dimension&&f.dimension!=="None").map(f=>{const v=f.filters?.map(S=>this.templateSrv.replace(S??"",s));return{dimension:this.templateSrv.replace(f.dimension,s),operator:f.operator||"eq",filters:v||[]}}),h={...i,resources:n,metricNamespace:l,customNamespace:u,timeGrain:p,allowedTimeGrainsMs:i.allowedTimeGrainsMs,metricName:this.templateSrv.replace(i.metricName,s),region:this.templateSrv.replace(i.region,s),aggregation:g,dimensionFilters:y,top:b||"10",alias:i.alias};return{...t,subscription:c,queryType:d.AzureMonitor,azureMonitor:h}}async getSubscriptions(){return this.isConfigured()?this.getResource(`${this.resourcePath}/subscriptions?api-version=2019-03-01`).then(t=>Y.parseSubscriptions(t)):[]}getResourceGroups(t){return this.getResource(`${this.resourcePath}/subscriptions/${t}/resourceGroups?api-version=${this.listByResourceGroupApiVersion}`).then(s=>Y.parseResponseValues(s,"name","name"))}async getResourceNames(t,s){const r=this.replaceTemplateVariables(t).map(({metricNamespace:a,subscriptionId:i,resourceGroup:c,region:n})=>{const l=(0,N.startsWith)(a?.toLowerCase(),"microsoft.storage/storageaccounts/")?"microsoft.storage/storageaccounts":a;let u=`${this.resourcePath}/subscriptions/${i}`;c&&(u+=`/resourceGroups/${c}`),u+=`/resources?api-version=${this.listByResourceGroupApiVersion}`;const p=[];return l&&p.push(`resourceType eq '${l}'`),n&&p.push(`location eq '${n}'`),p.length>0&&(u+=`&$filter=${p.join(" and ")}`),s&&(u+=`&$skiptoken=${s}`),this.getResource(u).then(async g=>{let b=[];if((0,N.startsWith)(a?.toLowerCase(),"microsoft.storage/storageaccounts/")){b=Y.parseResourceNames(g,"microsoft.storage/storageaccounts");for(let y=0;y<b.length;y++)b[y].text+="/default",b[y].value+="/default"}else b=Y.parseResourceNames(g,a);if(g.nextLink){const h=new URL(g.nextLink).searchParams.get("$skiptoken");if(!h)throw Error("unable to request the next page of resources");const f=await this.getResourceNames({metricNamespace:a,subscriptionId:i,resourceGroup:c},h);b=b.concat(f)}return b})});return(await Promise.all(r)).flat()}getMetricNamespaces(t,s){const r=Ge.buildAzureMonitorGetMetricNamespacesUrl(this.resourcePath,this.apiPreviewVersion,this.replaceSingleTemplateVariables(t),s,this.templateSrv);return this.getResource(r).then(a=>Y.parseResponseValues(a,"properties.metricNamespaceName","properties.metricNamespaceName")).then(a=>{if(r.toLowerCase().includes("microsoft.storage/storageaccounts")){const i=["microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/tableservices","microsoft.storage/storageaccounts/queueservices"];for(const c of i)(0,N.find)(a,["value",c.toLowerCase()])||a.push({value:c,text:c})}return a})}getMetricNames(t,s,r){const a=s?this.apiPreviewVersion:this.apiVersion,i=Ge.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,a,this.replaceSingleTemplateVariables(t),this.templateSrv,s,r);return this.getResource(i).then(c=>Y.parseResponseValues(c,"name.localizedValue","name.value"))}getMetricMetadata(t,s,r){const{metricName:a}=t,i=s?this.apiPreviewVersion:this.apiVersion,c=Ge.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,i,this.replaceSingleTemplateVariables(t),this.templateSrv,s,r);return this.getResource(c).then(n=>Y.parseMetadata(n,this.templateSrv.replace(a)))}validateDatasource(){if(pt(this.instanceSettings)==="clientsecret"){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(t){return typeof t=="string"&&t.length>0}replaceSingleTemplateVariables(t,s){return this.replaceTemplateVariables(t,s)[0]}replaceTemplateVariables(t,s){const r=[{...t}];return Object.keys(t).forEach(i=>{const c=this.templateSrv.replace(r[0][i],s,"raw");if(c.includes(",")){const n=c.split(","),l=[...r];n.forEach((u,p)=>{l.forEach(g=>{p===0?g[i]=u:r.push({...g,[i]:u})})})}else r.forEach(n=>{n[i]=c})}),r}async getProvider(t){return await this.getResource(`${Pe.azureMonitor}/providers/${t}?api-version=${this.providerApiVersion}`)}async getLocations(t){const s=new Map;for(const r of t){const a=Y.parseLocations(await this.getResource(`${Pe.azureMonitor}/subscriptions/${this.templateSrv.replace(r)}/locations?api-version=${this.locationsApiVersion}`));for(const i of a)s.set(i.name,i)}return s}}class Mn extends qe.CK{filterQuery(t){return!!t.azureResourceGraph?.query&&!!t.subscriptions&&t.subscriptions.length>0}applyTemplateVariables(t,s){const r=(0,Fe.J)(),a=t.azureResourceGraph;if(!a)return t;const i=r.getVariables().map(p=>`$${p.name}`),c=x().find(t.subscriptions,p=>x().includes(i,p)),l=[...r.replace(c,s,p=>p).split(",").filter(p=>p.length>0),...x().filter(t.subscriptions,p=>!x().includes(i,p))],u=r.replace(a.query,s,mt);return{...t,queryType:d.AzureResourceGraph,subscriptions:l,azureResourceGraph:{resultFormat:"table",query:u}}}}const Rn="/providers/Microsoft.ResourceGraph/resources?api-version=2021-03-01",In=$a.map(e=>`"${e}"`).join(",");class Dn extends qe.CK{constructor(t,s){super(t),this.resultLimit=200,this.supportedMetricNamespaces="",this.search=async(r,a)=>{let i="resources";a==="logs"&&(i+=`
      | union resourcecontainers`),i+=`
        | where id contains "${r}"
        ${await this.filterByType(a)}
        | order by tolower(name) asc
        | limit ${this.resultLimit}
      `;const{data:c}=await this.makeResourceGraphRequest(i);return c.map(n=>{const l=vt(n.id);if(!l||!(l.resourceName||l.resourceGroup||l.subscription))throw new Error("unable to fetch resource details");let u=l.subscription??"",p=F.Subscription;return l.resourceName?(u=l.resourceName,p=F.Resource):l.resourceGroup&&(u=l.resourceGroup,p=F.ResourceGroup),{name:n.name,id:u,uri:n.id,resourceGroupName:n.resourceGroup,type:p,typeLabel:Xt[n.type]||n.type,location:n.location}})},this.filterByType=async r=>(this.supportedMetricNamespaces===""&&r!=="logs"&&await this.fetchAllNamespaces(),r==="logs"?`| where type in (${In})`:`| where type in (${this.supportedMetricNamespaces})`),this.resourcePath=`${Pe.resourceGraph}`,this.azureMonitorDatasource=s}async fetchInitialRows(t,s){const r=await this.getSubscriptions();if(!s)return r;let a=r;const i=s.map(c=>async()=>{if(c.subscription){const n=`/subscriptions/${c.subscription}/resourceGroups/${c.resourceGroup}`;if(c.resourceGroup&&!Be(a,n)){const u=await this.getResourceGroupsBySubscriptionId(c.subscription,t);a=Bt(a,`/subscriptions/${c.subscription}`,u)}const l=wt(c);if(c.resourceName&&!Be(a,l)){const u=await this.getResourcesForResourceGroup(n,t);a=Bt(a,n,u)}}});for(const c of i)await c();return a}async fetchAndAppendNestedRow(t,s,r){const a=s.type===F.Subscription?await this.getResourceGroupsBySubscriptionId(s.id,r):await this.getResourcesForResourceGroup(s.id,r);return Bt(t,s.uri,a)}async getSubscriptions(){const t=`
    resources
    | join kind=inner (
              ResourceContainers
                | where type == 'microsoft.resources/subscriptions'
                | project subscriptionName=name, subscriptionURI=id, subscriptionId
              ) on subscriptionId
    | summarize count() by subscriptionName, subscriptionURI, subscriptionId
    | order by subscriptionName desc
  `;let s=[],r=!1,a;for(;!r;){let i={};a&&(i={$skipToken:a});const c=await this.makeResourceGraphRequest(t,1,i);if(!c.data.length)throw new Error("No subscriptions were found");s=s.concat(c.data),a=c.$skipToken,r=!a}return s.map(i=>({name:i.subscriptionName,id:i.subscriptionId,uri:`/subscriptions/${i.subscriptionId}`,typeLabel:"Subscription",type:F.Subscription,children:[]}))}async getResourceGroupsBySubscriptionId(t,s){const r=`
    resources
     | join kind=inner (
       ResourceContainers
       | where type == 'microsoft.resources/subscriptions/resourcegroups'
       | project resourceGroupURI=id, resourceGroupName=name, resourceGroup, subscriptionId
     ) on resourceGroup, subscriptionId

     ${await this.filterByType(s)}
     | where subscriptionId == '${t}'
     | summarize count() by resourceGroupName, resourceGroupURI
     | order by resourceGroupURI asc`;let a=[],i=!1,c;for(;!i;){let n={};c&&(n={$skipToken:c});const l=await this.makeResourceGraphRequest(r,1,n);a=a.concat(l.data),c=l.$skipToken,i=!c}return a.map(n=>{const l=vt(n.resourceGroupURI);if(!l||!l.resourceGroup)throw new Error("unable to fetch resource groups");return{name:n.resourceGroupName,uri:n.resourceGroupURI,id:l.resourceGroup,type:F.ResourceGroup,typeLabel:"Resource Group",children:[]}})}async getResourcesForResourceGroup(t,s){const{data:r}=await this.makeResourceGraphRequest(`
      resources
      | where id hasprefix "${t}"
      ${await this.filterByType(s)}
    `);return r.map(a=>{const i=vt(a.id);if(!i||!i.resourceName)throw new Error("unable to fetch resource details");return{name:a.name,id:i.resourceName,uri:a.id,resourceGroupName:a.resourceGroup,type:F.Resource,typeLabel:Xt[a.type]||a.type,locationDisplayName:a.location,location:a.location}})}async getResourceURIDisplayProperties(t){const{subscription:s,resourceGroup:r,resourceName:a}=q(t)??{};if(!s)throw new Error("Invalid resource URI passed");const i=`/subscriptions/${s}`,c=`${i}/resourceGroups/${r}`,n=`
    resourcecontainers
    | where type == "microsoft.resources/subscriptions"
    | where id =~ "${i}"
    | project subscriptionName=name, subscriptionId

    | join kind=leftouter (
      resourcecontainers            
            | where type == "microsoft.resources/subscriptions/resourcegroups"
            | where id =~ "${c}"
            | project resourceGroupName=name, resourceGroup, subscriptionId
        ) on subscriptionId

        | join kind=leftouter (
          resources
            | where id =~ "${t}"
            | project resourceName=name, subscriptionId
        ) on subscriptionId

        | project subscriptionName, resourceGroupName, resourceName
    `,{data:l}=await this.makeResourceGraphRequest(n);if(!l.length)throw new Error("unable to fetch resource details");const{subscriptionName:u,resourceGroupName:p,resourceName:g}=l[0];return{subscription:u||s,resourceGroup:p||r,resourceName:g||a}}async getResourceURIFromWorkspace(t){const{data:s}=await this.makeResourceGraphRequest(`
      resources
      | where properties['customerId'] == "${t}"
      | project id
    `);if(!s.length)throw new Error("unable to find resource for workspace "+t);return s[0].id}async makeResourceGraphRequest(t,s=1,r){try{return await this.postResource(this.resourcePath+Rn,{query:t,options:{resultFormat:"objectArray",...r}})}catch(a){if(s>0)return this.makeResourceGraphRequest(t,s-1);throw a}}async fetchAllNamespaces(){const t=await this.getSubscriptions();(0,dt.ff)("grafana_ds_azuremonitor_subscriptions_loaded",{subscriptions:t.length});let s=[];for await(const r of t){const a=await this.azureMonitorDatasource.getMetricNamespaces({resourceUri:`/subscriptions/${r.id}`},!0);if(a){const i=a.map(c=>`"${c.value.toLocaleLowerCase()}"`);s=s.concat(i)}}if(s.length===0)throw new Error("Unable to resolve a list of valid metric namespaces. Validate the datasource configuration is correct and required permissions have been granted for all subscriptions. Grafana requires at least the Reader role to be assigned.");this.supportedMetricNamespaces=(0,N.uniq)(s.concat(Wa.map(r=>`"${r}"`))).join(",")}parseRows(t){const s=Oe(t),r=[];return s.forEach((a,i)=>{let c=a.resourceName,n=a.resourceName,l=F.Resource;c||(c=a.resourceGroup,n=a.resourceGroup,l=F.ResourceGroup,c||(c=a.subscription,n=a.subscription,l=F.Subscription)),r.push({id:c??"",name:n??"",type:l,uri:wt(a),typeLabel:Xt[a.metricNamespace?.toLowerCase()??""]??a.metricNamespace??"",location:a.region})}),r}}function Ln(e){const t=typeof e.rawQuery=="string"?e.rawQuery:null,s=typeof e.workspace=="string"?e.workspace:null;if(!(t&&s&&!e.target?.azureLogAnalytics?.query))return e;const r={...e.target??{},refId:e.target?.refId??"Anno",queryType:d.LogAnalytics,azureLogAnalytics:{query:t,resources:[s]}};return{...e,rawQuery:void 0,workspace:void 0,subscription:void 0,queryType:void 0,target:r}}var Fn=w(57298),Pn=w(57212),xe=w(55704);const kr=e=>({subscriptions:e.match(/^Subscriptions\(\)/i),resourceGroups:e.match(/^ResourceGroups\(\)/i),resourceGroupsWithSub:e.match(/^ResourceGroups\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespaces:e.match(/^Namespaces\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespacesWithSub:e.match(/^Namespaces\(([^,]+?),\s?([^,]+?)\)/i),resourceNames:e.match(/^ResourceNames\(([^,]+?),\s?([^,]+?)\)/i),resourceNamesWithSub:e.match(/^ResourceNames\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),metricNamespace:e.match(/^MetricNamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamespaceWithSub:e.match(/^metricnamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNames:e.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamesWithSub:e.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),appInsightsMetricNameQuery:e.match(/^AppInsightsMetricNames\(\)/i),appInsightsGroupByQuery:e.match(/^AppInsightsGroupBys\(([^\)]+?)(,\s?([^,]+?))?\)/i),workspacesQuery:e.match(/^workspaces\(\)/i),workspacesQueryWithSub:e.match(/^workspaces\(["']?([^\)]+?)["']?\)/i)}),Gn=e=>{const t=kr(e);return Object.keys(t).some(s=>!!t[s])},On=(e,t)=>{const s=kr(e),r=t.azureMonitorDatasource.defaultSubscriptionId,a=()=>s.appInsightsMetricNameQuery?{rawQuery:e,kind:"AppInsightsMetricNameQuery"}:s.appInsightsGroupByQuery?{kind:"AppInsightsGroupByQuery",rawQuery:e,metricName:s.appInsightsGroupByQuery[1]}:s.subscriptions?{kind:"SubscriptionsQuery",rawQuery:e}:s.resourceGroupsWithSub?{kind:"ResourceGroupsQuery",rawQuery:e,subscription:s.resourceGroupsWithSub[1]}:s.resourceGroups&&r?{kind:"ResourceGroupsQuery",rawQuery:e,subscription:r}:s.namespacesWithSub?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:s.namespacesWithSub[1],resourceGroup:s.namespacesWithSub[2]}:s.namespaces&&r?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:r,resourceGroup:s.namespaces[1]}:s.resourceNamesWithSub?{kind:"ResourceNamesQuery",rawQuery:e,subscription:s.resourceNamesWithSub[1],resourceGroup:s.resourceNamesWithSub[2],metricNamespace:s.resourceNamesWithSub[3]}:s.resourceNames&&r?{kind:"ResourceNamesQuery",rawQuery:e,subscription:r,resourceGroup:s.resourceNames[1],metricNamespace:s.resourceNames[2]}:s.metricNamespaceWithSub?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:s.metricNamespaceWithSub[1],resourceGroup:s.metricNamespaceWithSub[2],metricNamespace:s.metricNamespaceWithSub[3],resourceName:s.metricNamespaceWithSub[4]}:s.metricNamespace&&r?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:r,resourceGroup:s.metricNamespace[1],metricNamespace:s.metricNamespace[2],resourceName:s.metricNamespace[3]}:s.metricNames&&r&&s.metricNames[3].indexOf(",")===-1?{kind:"MetricNamesQuery",rawQuery:e,subscription:r,resourceGroup:s.metricNames[1],metricNamespace:s.metricNames[2],resourceName:s.metricNames[3]}:s.metricNamesWithSub?{kind:"MetricNamesQuery",rawQuery:e,subscription:s.metricNamesWithSub[1],resourceGroup:s.metricNamesWithSub[2],metricNamespace:s.metricNamesWithSub[3],resourceName:s.metricNamesWithSub[4]}:s.workspacesQueryWithSub?{kind:"WorkspacesQuery",rawQuery:e,subscription:(s.workspacesQueryWithSub[1]||"").trim()}:s.workspacesQuery&&r?{kind:"WorkspacesQuery",rawQuery:e,subscription:r}:{kind:"SubscriptionsQuery",rawQuery:e};return{refId:"A",queryType:d.GrafanaTemplateVariableFn,grafanaTemplateVariableFn:a(),subscription:r}},Qn=async(e,t)=>{const s=t.azureMonitorDatasource.defaultSubscriptionId;let r="";if(e){const a=t.azureLogAnalyticsDatasource.getDeprecatedDefaultWorkSpace();a?Ts(a)?r=await t.resourcePickerData.getResourceURIFromWorkspace(a):r=a:r=await t.azureLogAnalyticsDatasource.getFirstWorkspace()||""}return{refId:"A",queryType:d.LogAnalytics,azureLogAnalytics:{query:e,resources:r?[r]:[]},subscription:s}},Vn=e=>{const{queryType:t,grafanaTemplateVariableFn:s}=e;if(t!==d.GrafanaTemplateVariableFn||!s)return e;const r={...e};switch("subscription"in s&&(r.subscription=s.subscription),"resourceGroup"in s&&(r.resourceGroup=s.resourceGroup),"metricNamespace"in s&&(r.namespace=s.metricNamespace),"resourceName"in s&&(r.resource=s.resourceName),s.kind){case"SubscriptionsQuery":r.queryType=d.SubscriptionsQuery;break;case"ResourceGroupsQuery":r.queryType=d.ResourceGroupsQuery;break;case"ResourceNamesQuery":r.queryType=d.ResourceNamesQuery;break;case"MetricNamespaceQuery":r.queryType=d.NamespacesQuery;break;case"MetricDefinitionsQuery":r.queryType=d.NamespacesQuery;break;case"MetricNamesQuery":r.queryType=d.MetricNamesQuery;break;case"WorkspacesQuery":r.queryType=d.WorkspacesQuery;break}return r},zr=async(e,t)=>typeof e!="string"?e:Gn(e)?On(e,t.datasource):Qn(e,t.datasource),Ar=async(e,t)=>{let s=await zr(e,t);return s.queryType===d.GrafanaTemplateVariableFn&&(s=Vn(s)),s},Wn=({query:e,updateQuery:t,datasource:s})=>{const[r,a]=(0,o.useState)("");(0,o.useEffect)(()=>{a(e.grafanaTemplateVariableFn?.rawQuery||"")},[e.grafanaTemplateVariableFn?.rawQuery]);const i=(0,o.useCallback)(n=>{zr(n,{datasource:s}).then(l=>{l.queryType===d.GrafanaTemplateVariableFn?t(l):t({...e,grafanaTemplateVariableFn:{kind:"UnknownQuery",rawQuery:n}})})},[s,e,t]),c=n=>{a(n.target.value)};return o.createElement(Ee._,{label:"Grafana template variable function"},o.createElement(B.I,{placeholder:"type a grafana template variable function, ex: Subscriptions()",value:r,onChange:c,onBlur:()=>i(r)}))},Nr={label:"-",value:""},$n=e=>{const{query:t,onChange:s,datasource:r}=e,a=[{label:"Subscriptions",value:d.SubscriptionsQuery},{label:"Resource Groups",value:d.ResourceGroupsQuery},{label:"Namespaces",value:d.NamespacesQuery},{label:"Regions",value:d.LocationsQuery},{label:"Resource Names",value:d.ResourceNamesQuery},{label:"Metric Names",value:d.MetricNamesQuery},{label:"Workspaces",value:d.WorkspacesQuery},{label:"Resource Graph",value:d.AzureResourceGraph},{label:"Logs",value:d.LogAnalytics}];typeof e.query=="object"&&e.query.queryType===d.GrafanaTemplateVariableFn&&a.push({label:"Grafana Query Function",value:d.GrafanaTemplateVariableFn});const[i,c]=(0,o.useState)({label:"Template Variables",options:[]}),[n,l]=(0,o.useState)(!1),[u,p]=(0,o.useState)(!1),[g,b]=(0,o.useState)(!1),[y,h]=(0,o.useState)(!1),[f,v]=(0,o.useState)(!1),[S,E]=(0,o.useState)(!1),[A,z]=(0,o.useState)(!1),[W,ee]=(0,o.useState)([]),[ne,ye]=(0,o.useState)([]),[Qe,Ve]=(0,o.useState)([]),[et,tt]=(0,o.useState)([]),[T,Q]=(0,o.useState)([]),[$,Me]=ds(),ue=typeof t=="string"?"":t.queryType;(0,o.useEffect)(()=>{Ar(t,{datasource:r}).then(R=>{(0,N.isEqual)(t,R)||s(R)})},[t,r,s]),(0,o.useEffect)(()=>{switch(l(!1),p(!1),b(!1),v(!1),E(!1),z(!1),ue){case d.ResourceGroupsQuery:case d.WorkspacesQuery:l(!0);break;case d.NamespacesQuery:l(!0),p(!0);break;case d.ResourceNamesQuery:l(!0),p(!0),b(!0),h(!0);break;case d.MetricNamesQuery:l(!0),v(!0),E(!0),z(!0);break;case d.LocationsQuery:l(!0);break}},[ue]),(0,o.useEffect)(()=>{const R=[];r.getVariablesRaw().forEach(V=>{(0,N.get)(V,"query.queryType")!==ue&&R.push({label:V.label||V.name,value:`$${V.name}`})}),c({label:"Template Variables",options:R})},[r,ue]),(0,Pt.Z)(()=>{r.getSubscriptions().then(R=>{ee(R.map(V=>({label:V.text,value:V.value})))})});const J=typeof t=="object"&&t.subscription;(0,o.useEffect)(()=>{J&&r.getResourceGroups(J).then(R=>{ye(R.map(V=>({label:V.text,value:V.value})))})},[r,J]);const We=typeof t=="object"&&t.resourceGroup||"";(0,o.useEffect)(()=>{J&&r.getMetricNamespaces(J,We).then(R=>{Ve(R.map(V=>({label:V.text,value:V.value})))})},[r,J,We]),(0,o.useEffect)(()=>{J&&r.azureMonitorDatasource.getLocations([J]).then(R=>{const V=[];R.forEach(Cr=>V.push({label:Cr.displayName,value:Cr.name})),Q(V)})},[r,J,We]);const st=typeof t=="object"&&t.namespace||"";if((0,o.useEffect)(()=>{J&&r.getResourceNames(J,We,st).then(R=>{tt(R.map(V=>({label:V.text,value:V.value})))})},[r,J,We,st]),typeof t=="string")return null;const rt=R=>{R.value&&s({...t,queryType:R.value,subscription:void 0,resourceGroup:void 0,namespace:void 0,resource:void 0})},Jn=R=>{R.value&&s({...t,subscription:R.value,resourceGroup:void 0,namespace:void 0,resource:void 0})},Kn=R=>{s({...t,resourceGroup:R.value,namespace:void 0,resource:void 0})},Zn=R=>{s({...t,namespace:R.value,resource:void 0})},Yn=R=>{s({...t,region:R.value})},qn=R=>{s({...t,resource:R.value})},Tr=R=>{s(R)};return o.createElement(o.Fragment,null,o.createElement(U.g,{label:"Query Type","data-testid":M.components.variableEditor.queryType.input},o.createElement(L.Ph,{"aria-label":"select query type",onChange:rt,options:a,width:25,value:ue})),t.queryType===d.LogAnalytics&&o.createElement(o.Fragment,null,o.createElement(Ps,{subscriptionId:t.subscription,query:t,datasource:r,onChange:Tr,variableOptionGroup:i,setError:Me,hideFormatAs:!0}),$&&o.createElement(o.Fragment,null,o.createElement(ie,{v:2}),o.createElement(Te.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor"},$ instanceof Error?$.message:$))),t.queryType===d.GrafanaTemplateVariableFn&&o.createElement(Wn,{query:t,updateQuery:e.onChange,datasource:r}),n&&o.createElement(U.g,{label:"Subscription","data-testid":M.components.variableEditor.subscription.input},o.createElement(L.Ph,{"aria-label":"select subscription",onChange:Jn,options:W.concat(i),width:25,value:t.subscription||null})),(f||u)&&o.createElement(U.g,{label:"Resource Group","data-testid":M.components.variableEditor.resourceGroup.input},o.createElement(L.Ph,{"aria-label":"select resource group",onChange:Kn,options:f?ne.concat(i):ne.concat(i,Nr),width:25,value:t.resourceGroup||null,placeholder:f?void 0:"Optional"})),(S||g)&&o.createElement(U.g,{label:"Namespace","data-testid":M.components.variableEditor.namespace.input},o.createElement(L.Ph,{"aria-label":"select namespace",onChange:Zn,options:S?Qe.concat(i):Qe.concat(i,Nr),width:25,value:t.namespace||null,placeholder:S?void 0:"Optional"})),y&&o.createElement(U.g,{label:"Region","data-testid":M.components.variableEditor.region.input},o.createElement(L.Ph,{"aria-label":"select region",onChange:Yn,options:T.concat(i),width:25,value:t.region||null,placeholder:"Optional"})),A&&o.createElement(U.g,{label:"Resource","data-testid":M.components.variableEditor.resource.input},o.createElement(L.Ph,{"aria-label":"select resource",onChange:qn,options:et.concat(i),width:25,value:t.resource||null})),t.queryType===d.AzureResourceGraph&&o.createElement(o.Fragment,null,o.createElement(Ss,{subscriptionId:r.azureLogAnalyticsDatasource.defaultSubscriptionId,query:t,datasource:r,onChange:Tr,variableOptionGroup:i,setError:Me}),$&&o.createElement(o.Fragment,null,o.createElement(ie,{v:2}),o.createElement(Te.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor"},$ instanceof Error?$.message:$))))};class Un extends Pn.Mg{constructor(t,s=(0,Fe.J)()){super(),this.datasource=t,this.templateSrv=s,this.editor=$n,this.datasource=t}hasValue(...t){return t.every(s=>!!this.templateSrv.replace(s))}query(t){const s=async()=>{const r=await Ar(t.targets[0],{datasource:this.datasource});try{switch(r.queryType){case d.SubscriptionsQuery:const a=await this.datasource.getSubscriptions();return{data:a?.length?[(0,xe.g0)(a)]:[]};case d.ResourceGroupsQuery:if(r.subscription&&this.hasValue(r.subscription)){const c=await this.datasource.getResourceGroups(r.subscription);return{data:c?.length?[(0,xe.g0)(c)]:[]}}return{data:[]};case d.NamespacesQuery:if(r.subscription&&this.hasValue(r.subscription)){const c=await this.datasource.getMetricNamespaces(r.subscription,r.resourceGroup);return{data:c?.length?[(0,xe.g0)(c)]:[]}}return{data:[]};case d.ResourceNamesQuery:if(r.subscription&&this.hasValue(r.subscription)){const c=await this.datasource.getResourceNames(r.subscription,r.resourceGroup,r.namespace,r.region);return{data:c?.length?[(0,xe.g0)(c)]:[]}}return{data:[]};case d.MetricNamesQuery:if(r.subscription&&r.resourceGroup&&r.namespace&&r.resource&&this.hasValue(r.subscription,r.resourceGroup,r.namespace,r.resource)){const c=await this.datasource.getMetricNames(r.subscription,r.resourceGroup,r.namespace,r.resource);return{data:c?.length?[(0,xe.g0)(c)]:[]}}return{data:[]};case d.WorkspacesQuery:if(r.subscription&&this.hasValue(r.subscription)){const c=await this.datasource.getAzureLogAnalyticsWorkspaces(r.subscription);return{data:c?.length?[(0,xe.g0)(c)]:[]}}return{data:[]};case d.GrafanaTemplateVariableFn:if(r.grafanaTemplateVariableFn){const c=await this.callGrafanaTemplateVariableFn(r.grafanaTemplateVariableFn);return{data:c?.length?[(0,xe.g0)(c)]:[]}}return{data:[]};case d.LocationsQuery:if(r.subscription&&this.hasValue(r.subscription)){const c=await this.datasource.azureMonitorDatasource.getLocations([r.subscription]),n=[];return c.forEach(l=>{n.push({text:l.displayName,value:l.name})}),{data:n?.length?[(0,xe.g0)(n)]:[]}}default:t.targets[0]=r;const i=await(0,mr.n)(this.datasource.query(t));return{data:i.data,error:i.error?new Error($e(i.error)):void 0}}}catch(a){return{data:[],error:new Error($e(a))}}};return(0,Fn.D)(s())}callGrafanaTemplateVariableFn(t){return t.kind==="SubscriptionsQuery"?this.datasource.getSubscriptions():t.kind==="ResourceGroupsQuery"?this.datasource.getResourceGroups(this.replaceVariable(t.subscription)):t.kind==="ResourceNamesQuery"?this.datasource.getResourceNames(this.replaceVariable(t.subscription),this.replaceVariable(t.resourceGroup),this.replaceVariable(t.metricNamespace)):t.kind==="MetricNamespaceQuery"?this.datasource.azureMonitorDatasource.getMetricNamespaces(t,!0):t.kind==="MetricNamesQuery"?this.datasource.azureMonitorDatasource.getMetricNames(t):t.kind==="WorkspacesQuery"?this.datasource.azureLogAnalyticsDatasource.getWorkspaces(this.replaceVariable(t.subscription)):null}replaceVariable(t){return this.templateSrv.replace((t||"").trim())}}class Bn extends qe.CK{constructor(t,s=(0,Fe.J)()){super(t),this.templateSrv=s,this.annotations={prepareAnnotation:Ln},this.pseudoDatasource={},this.azureMonitorDatasource=new xn(t),this.azureLogAnalyticsDatasource=new Tn(t),this.azureResourceGraphDatasource=new Mn(t),this.resourcePickerData=new Dn(t,this.azureMonitorDatasource),this.pseudoDatasource={[d.AzureMonitor]:this.azureMonitorDatasource,[d.LogAnalytics]:this.azureLogAnalyticsDatasource,[d.AzureResourceGraph]:this.azureResourceGraphDatasource},this.variables=new Un(this)}filterQuery(t){return t.queryType?this.pseudoDatasource[t.queryType]?.filterQuery?.(t)??!0:!1}query(t){const s=new Map;for(const a of t.targets){const i=ts(a);if(!i.queryType||i.hide||!jn(i))continue;if(!s.has(i.queryType)){const n=(0,N.cloneDeep)(t);n.requestId=`${n.requestId}-${i.refId}`,n.targets=[],s.set(i.queryType,n)}s.get(i.queryType)?.targets.push(i)}const r=Array.from(s.entries()).map(([a,i])=>{const c=a===d.AzureTraces?d.LogAnalytics:a,n=this.pseudoDatasource[c];if(!n)throw new Error("Data source not created for query type "+a);return n.query(i)});return r.length===1?r[0]:r.length>1?(0,Sn.D)(r).pipe((0,kn.U)(a=>{const i=[];for(const c of a)for(const n of c.data)i.push(n);return{state:Er.Gu.Done,data:i}})):(0,En.of)({state:Er.Gu.Done,data:[]})}targetContainsTemplate(t){if(t.subscription&&this.templateSrv.containsTemplate(t.subscription))return!0;let s;return t.queryType===d.AzureMonitor?s=JSON.stringify(t.azureMonitor):t.queryType===d.LogAnalytics?s=JSON.stringify(t.azureLogAnalytics):t.queryType===d.AzureResourceGraph&&(s=JSON.stringify([t.azureResourceGraph,t.subscriptions])),!!s&&this.templateSrv.containsTemplate(s)}getResourceGroups(t){return this.azureMonitorDatasource.getResourceGroups(this.templateSrv.replace(t))}getMetricNamespaces(t,s){let r=`/subscriptions/${t}`;return s&&(r+=`/resourceGroups/${s};`),this.azureMonitorDatasource.getMetricNamespaces({resourceUri:r},!0)}getResourceNames(t,s,r,a){return this.azureMonitorDatasource.getResourceNames({subscriptionId:t,resourceGroup:s,metricNamespace:r,region:a})}getMetricNames(t,s,r,a){return this.azureMonitorDatasource.getMetricNames({subscription:t,resourceGroup:s,metricNamespace:r,resourceName:a})}getAzureLogAnalyticsWorkspaces(t){return this.azureLogAnalyticsDatasource.getWorkspaces(t)}getSubscriptions(){return this.azureMonitorDatasource.getSubscriptions()}interpolateVariablesInQueries(t,s){return t.map(a=>{if(!a.queryType)return a;const i=a.queryType===d.AzureTraces?d.LogAnalytics:a.queryType,c=this.pseudoDatasource[i];return{datasource:c?.getRef(),...c?.applyTemplateVariables(a,s)??a}})}getVariables(){return this.templateSrv.getVariables().map(t=>`$${t.name}`)}getVariablesRaw(){return this.templateSrv.getVariables()}modifyQuery(t,s){if(!s.options)return t;let r=t.azureLogAnalytics?.query;if(r===void 0)return t;switch(s.type){case"ADD_FILTER":{r+=`
| where ${s.options.key} == "${s.options.value}"`;break}case"ADD_FILTER_OUT":{r+=`
| where ${s.options.key} != "${s.options.value}"`;break}}return{...t,azureLogAnalytics:{...t.azureLogAnalytics,query:r}}}}function jn(e){switch(e.queryType){case d.AzureMonitor:return!!e.azureMonitor;case d.LogAnalytics:return!!e.azureLogAnalytics;case d.AzureResourceGraph:return!!e.azureResourceGraph;case d.AzureTraces:return!!e.azureTraces;case d.GrafanaTemplateVariableFn:return!!e.grafanaTemplateVariableFn;default:return!1}}var _n=w(62105);const Hn=e=>{(0,dt.ff)("grafana_ds_azuremonitor_dashboard_loaded",e)},Xn=new C.hf(Bn).setConfigEditor(mo).setQueryEditor(wn);(0,Ie.N$)().subscribe(Re,({payload:{dashboardId:e,orgId:t,userId:s,grafanaVersion:r,queries:a}})=>{const i=a[_n.id],c={hidden:0,visible:0,multiResource:0,count:0};let n={[d.AzureMonitor]:{...c},[d.LogAnalytics]:{...c,grafanaTime:0,queryTime:0},[d.AzureResourceGraph]:{...c},[d.AzureTraces]:{...c,table:0,trace:0,operationIdSpecified:0,eventTypesSpecified:0,filtersSpecified:0},[d.SubscriptionsQuery]:{...c},[d.ResourceGroupsQuery]:{...c},[d.NamespacesQuery]:{...c},[d.ResourceNamesQuery]:{...c},[d.MetricNamesQuery]:{...c},[d.WorkspacesQuery]:{...c},[d.GrafanaTemplateVariableFn]:{...c},[d.LocationsQuery]:{...c},unknown:{...c}};i.forEach(l=>{switch(l.queryType===d.AzureMonitor&&(n[d.AzureMonitor][l.hide?"hidden":"visible"]++,l.azureMonitor?.resources&&l.azureMonitor.resources.length>1&&n[d.AzureMonitor].multiResource++),l.queryType===d.LogAnalytics&&(n[d.LogAnalytics][l.hide?"hidden":"visible"]++,n[d.LogAnalytics][l.azureLogAnalytics?.dashboardTime?"grafanaTime":"queryTime"]++,l.azureLogAnalytics?.resources&&l.azureLogAnalytics.resources.length>1&&n[d.LogAnalytics].multiResource++),l.queryType===d.AzureResourceGraph&&(n[d.AzureResourceGraph][l.hide?"hidden":"visible"]++,l.subscriptions&&l.subscriptions.length>1&&n[d.AzureResourceGraph].multiResource++),l.queryType===d.AzureTraces&&(n[d.AzureTraces][l.hide?"hidden":"visible"]++,l.azureTraces&&(l.azureTraces.resultFormat&&n[d.AzureTraces][l.azureTraces.resultFormat===le.Trace?le.Trace:le.Table]++,l.azureTraces.resources&&l.azureTraces.resources.length>1&&n[d.AzureTraces].multiResource++,l.azureTraces.operationId&&l.azureTraces.operationId!==""&&n[d.AzureTraces].operationIdSpecified++,l.azureTraces.traceTypes&&l.azureTraces.traceTypes.length>0&&n[d.AzureTraces].eventTypesSpecified++,l.azureTraces.filters&&l.azureTraces.filters.length>0&&n[d.AzureTraces].filtersSpecified++)),l.queryType){case d.AzureMonitor:case d.LogAnalytics:case d.AzureResourceGraph:case d.AzureTraces:case d.SubscriptionsQuery:case d.ResourceGroupsQuery:case d.NamespacesQuery:case d.ResourceNamesQuery:case d.MetricNamesQuery:case d.WorkspacesQuery:case d.GrafanaTemplateVariableFn:case d.LocationsQuery:n[l.queryType].count++;break;default:n.unknown.count++}}),i&&i.length>0&&Hn({grafana_version:r,dashboard_id:e,org_id:t,azure_monitor_queries:n[d.AzureMonitor].visible,azure_monitor_queries_hidden:n[d.AzureMonitor].hidden,azure_monitor_multiple_resource:n[d.AzureMonitor].multiResource,azure_monitor_query:n[d.AzureMonitor].count,azure_log_analytics_queries:n[d.LogAnalytics].visible,azure_log_analytics_queries_hidden:n[d.LogAnalytics].hidden,azure_log_multiple_resource:n[d.LogAnalytics].multiResource,azure_log_analytics_queries_grafana_time:n[d.LogAnalytics].grafanaTime,azure_log_analytics_queries_query_time:n[d.LogAnalytics].queryTime,azure_log_query:n[d.LogAnalytics].count,azure_resource_graph_queries:n[d.AzureResourceGraph].visible,azure_resource_graph_queries_hidden:n[d.AzureResourceGraph].hidden,azure_resource_graph_multiple_subscription:n[d.AzureResourceGraph].multiResource,azure_resource_graph_query:n[d.AzureResourceGraph].count,azure_traces_queries:n[d.AzureTraces].visible,azure_traces_queries_hidden:n[d.AzureTraces].hidden,azure_traces_multiple_resource:n[d.AzureTraces].multiResource,azure_traces_table:n[d.AzureTraces].table,azure_traces_trace:n[d.AzureTraces].trace,azure_traces_operation_id_specified:n[d.AzureTraces].operationIdSpecified,azure_traces_event_type_specified:n[d.AzureTraces].eventTypesSpecified,azure_traces_filters:n[d.AzureTraces].filtersSpecified,azure_traces_query:n[d.AzureTraces].count,azure_subscriptions_query:n[d.SubscriptionsQuery].count,azure_resource_groups_query:n[d.ResourceGroupsQuery].count,azure_namespaces_query:n[d.NamespacesQuery].count,azure_resource_names_query:n[d.ResourceNamesQuery].count,azure_metric_names_query:n[d.MetricNamesQuery].count,azure_workspaces_query:n[d.WorkspacesQuery].count,azure_grafana_template_variable_query:n[d.GrafanaTemplateVariableFn].count,azure_locations_query:n[d.LocationsQuery].count,azure_unknown_query:n.unknown.count})})},56744:()=>{},8961:(_e,te,w)=>{"use strict";w.d(te,{i:()=>P});var C=w(31733),G=w(48458),I=w(5387);function P({options:O,onOptionsChange:se}){return C.createElement(C.Fragment,null,C.createElement("h3",{className:"page-heading"},"Secure Socks Proxy"),C.createElement("div",{className:"gf-form-group"},C.createElement("div",{className:"gf-form-inline"},C.createElement("div",{className:"gf-form"},C.createElement(I._,{labelWidth:26,label:"Enabled",tooltip:"Connect to this datasource via the secure socks proxy."},C.createElement(G.x,{value:O.jsonData.enableSecureSocksProxy??!1,onChange:me=>se({...O,jsonData:{...O.jsonData,enableSecureSocksProxy:me.currentTarget.checked}})}))))))}},45193:(_e,te,w)=>{"use strict";w.d(te,{g:()=>me});var C=w(76932),G=w(31733),I=w(44918),P=w(97668),O=w(10809),se=w(33080);const me=G.forwardRef(({label:_,description:ve,horizontal:Ie,invalid:o,loading:N,disabled:x,required:we,error:X,children:ce,className:ze,validationMessageHorizontalOverflow:pe,htmlFor:de,...Ae},re)=>{const K=(0,I.wW)(He),Se=de??(0,P.getChildId)(ce),Ne=typeof _=="string"?G.createElement(se._,{htmlFor:Se,description:ve},`${_}${we?" *":""}`):_,Z=Re({invalid:o,disabled:x,loading:N});return G.createElement("div",{className:(0,C.cx)(K.field,Ie&&K.fieldHorizontal,ze),...Ae},Ne,G.createElement("div",null,G.createElement("div",{ref:re},G.cloneElement(ce,Z)),o&&X&&!Ie&&G.createElement("div",{className:(0,C.cx)(K.fieldValidationWrapper,{[K.validationMessageHorizontalOverflow]:!!pe})},G.createElement(O.S,null,X))),o&&X&&Ie&&G.createElement("div",{className:(0,C.cx)(K.fieldValidationWrapper,K.fieldValidationWrapperHorizontal,{[K.validationMessageHorizontalOverflow]:!!pe})},G.createElement(O.S,null,X)))});me.displayName="Field";function Re(_){for(const ve in _)_[ve]===void 0&&delete _[ve];return _}const He=_=>({field:(0,C.css)({display:"flex",flexDirection:"column",marginBottom:_.spacing(2)}),fieldHorizontal:(0,C.css)({flexDirection:"row",justifyContent:"space-between",flexWrap:"wrap"}),fieldValidationWrapper:(0,C.css)({marginTop:_.spacing(.5)}),fieldValidationWrapperHorizontal:(0,C.css)({flex:"1 1 100%"}),validationMessageHorizontalOverflow:(0,C.css)({width:0,overflowX:"visible","& > *":{whiteSpace:"nowrap"}})})},95674:(_e,te,w)=>{"use strict";w.d(te,{S:()=>o});var C=w(76932),G=w(69781),I=w(31733),P=w(7820),O=w(44918),se=w(38374),me=w(21568),Re=w(95561),He=w(76078),_=w(89357);const ve=I.forwardRef(({children:x,active:we=!1,disabled:X=!1,size:ce="md",onChange:ze,onClick:pe,id:de,name:Ae=void 0,description:re,fullWidth:K,"aria-label":Se},Ne)=>{const Z=(0,O.wW)(Ie,ce,K),De=I.createElement("input",{type:"radio",className:Z.radio,onChange:ze,onClick:pe,disabled:X,id:de,checked:we,name:Ae,"aria-label":Se,ref:Ne});return re?I.createElement("div",{className:Z.radioOption,"data-testid":me.wl.components.RadioButton.container},I.createElement(He.u,{content:re,placement:"bottom"},De),I.createElement("label",{className:Z.radioLabel,htmlFor:de,title:re||Se},x)):I.createElement("div",{className:Z.radioOption,"data-testid":me.wl.components.RadioButton.container},De,I.createElement("label",{className:Z.radioLabel,htmlFor:de,title:re||Se},x))});ve.displayName="RadioButton";const Ie=(x,we,X)=>{const{fontSize:ce,height:ze,padding:pe}=(0,_.iL)(we,x),de=x.colors.text.secondary,Ae=x.colors.text.primary,re=ze*x.spacing.gridSize-4-2;return{radioOption:(0,C.css)({display:"flex",justifyContent:"space-between",position:"relative",flex:X?"1 0 0":"none",textAlign:"center"}),radio:(0,C.css)({position:"absolute",opacity:0,zIndex:2,width:"100% !important",height:"100%",cursor:"pointer","&:checked + label":{color:x.colors.text.primary,fontWeight:x.typography.fontWeightMedium,background:x.colors.action.selected,zIndex:1},"&:focus + label, &:focus-visible + label":(0,Re.SV)(x),"&:focus:not(:focus-visible) + label":(0,Re.Cq)(x),"&:disabled + label":{color:x.colors.text.disabled,cursor:"not-allowed"}}),radioLabel:(0,C.css)({display:"flex",alignItems:"center",justifyContent:"center",fontSize:ce,height:`${re}px`,lineHeight:`${re}px`,color:de,padding:x.spacing(0,pe),borderRadius:x.shape.radius.default,background:x.colors.background.primary,cursor:"pointer",userSelect:"none",whiteSpace:"nowrap",flexGrow:1,"&:hover":{color:Ae}})}};function o({options:x,value:we,onChange:X,onClick:ce,disabled:ze,disabledOptions:pe,size:de="md",id:Ae,className:re,fullWidth:K=!1,autoFocus:Se=!1,"aria-label":Ne,invalid:Z=!1}){const De=(0,I.useCallback)(D=>()=>{X&&X(D.value)},[X]),Ct=(0,I.useCallback)(D=>()=>{ce&&ce(D.value)},[ce]),m=Ae??(0,G.uniqueId)("radiogroup-"),k=(0,I.useRef)(m),Le=(0,O.wW)(N),Xe=(0,I.useRef)(null);return(0,I.useEffect)(()=>{Se&&Xe.current&&Xe.current.focus()},[Se]),I.createElement("div",{role:"radiogroup","aria-label":Ne,className:(0,C.cx)(Le.radioGroup,K&&Le.fullWidth,Z&&Le.invalid,re)},x.map((D,ot)=>{const xt=pe&&D.value&&pe.includes(D.value),at=D.icon?(0,P.iJ)(D.icon):void 0,it=!!(D.imgUrl||D.label||D.component);return I.createElement(ve,{size:de,disabled:xt||ze,active:we===D.value,key:`o.label-${ot}`,"aria-label":D.ariaLabel,onChange:De(D),onClick:Ct(D),id:`option-${D.value}-${m}`,name:k.current,description:D.description,fullWidth:K,ref:we===D.value?Xe:void 0},at&&I.createElement(se.J,{name:at,className:(0,C.cx)(it&&Le.icon)}),D.imgUrl&&I.createElement("img",{src:D.imgUrl,alt:D.label,className:Le.img}),D.label," ",D.component?I.createElement(D.component,null):null)}))}o.displayName="RadioButtonGroup";const N=x=>({radioGroup:(0,C.css)({display:"inline-flex",flexDirection:"row",flexWrap:"nowrap",border:`1px solid ${x.components.input.borderColor}`,borderRadius:x.shape.radius.default,padding:"2px"}),fullWidth:(0,C.css)({display:"flex"}),icon:(0,C.css)({marginRight:"6px"}),img:(0,C.css)({width:x.spacing(2),height:x.spacing(2),marginRight:x.spacing(1)}),invalid:(0,C.css)({border:`1px solid ${x.colors.error.border}`})})},63541:(_e,te,w)=>{"use strict";w.d(te,{Z:()=>I});var C=w(31733),G=function(P){(0,C.useEffect)(P,[])};const I=G}}]);

//# sourceMappingURL=5120.32da32bd5eb3c1ea00ee.js.map