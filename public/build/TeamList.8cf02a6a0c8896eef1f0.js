"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9671],{27170:(Z,v,e)=>{e.d(v,{f:()=>P});var O=e(31733),t=e(41710),r=e(75923),T=e(42342),M=e(23323),f=e(59256);const P=({teamId:A,roleOptions:m,disabled:s,roles:c,onApplyRoles:d,pendingRoles:_,apply:L=!1,maxWidth:y,width:K,isLoading:p})=>{const[{loading:$,value:g=c||[]},E]=(0,t.Z)(async()=>{try{if(c)return c;if(L&&_?.length)return _;if(r.Vt.hasPermission(T.AccessControlAction.ActionTeamsRolesList))return await(0,f._C)(A)}catch(R){console.error("Error loading options",R)}return[]},[A,_,c]);(0,O.useEffect)(()=>{E()},[E]);const I=async R=>{L?d&&d(R):(await(0,f.u7)(R,A),await E())},C=r.Vt.hasPermission(T.AccessControlAction.ActionTeamsRolesAdd)&&r.Vt.hasPermission(T.AccessControlAction.ActionTeamsRolesRemove);return O.createElement(M.I,{apply:L,onRolesChange:I,roleOptions:m,appliedRoles:g,isLoading:$||p,disabled:s,basicRoleDisabled:!0,canUpdateRoles:C,maxWidth:y,width:K})}},37489:(Z,v,e)=>{e.r(v),e.d(v,{TeamList:()=>j,default:()=>B});var O=e(76932),t=e(31733),r=e(49876),T=e(55024),M=e(76067),f=e(10851),P=e(37739),A=e(58037),m=e(49311),s=e(94719),c=e(51343),d=e(41164),_=e(76804),L=e(77543),y=e(47808),K=e(88511),p=e(50186),$=e(59256),g=e(56811),E=e(42342),I=e(27170),C=e(19691);const R=new Array(3).fill(null).map((u,h)=>({id:h,memberCount:0,name:"",orgId:0,permission:0})),j=({teams:u,query:h,noTeams:N,hasFetched:D,loadTeams:W,deleteTeam:U,changeQuery:X,totalPages:z,page:Y,rolesLoading:V,changePage:w,changeSort:F})=>{const[G,k]=(0,t.useState)([]),S=(0,M.wW)(b);(0,t.useEffect)(()=>{W(!0)},[W]),(0,t.useEffect)(()=>{g.contextSrv.licensedAccessControlEnabled()&&g.contextSrv.hasPermission(E.AccessControlAction.ActionRolesList)&&(0,$.ul)().then(i=>k(i))},[]);const Q=g.contextSrv.hasPermission(E.AccessControlAction.ActionTeamsCreate),H=a(),q=(0,t.useMemo)(()=>[{id:"avatarUrl",header:"",disableGrow:!0,cell:({cell:{value:i}})=>D?i&&t.createElement(f.q,{src:i,alt:"User avatar"}):t.createElement(r.Z,{containerClassName:S.blockSkeleton,width:24,height:24,circle:!0})},{id:"name",header:"Name",cell:({cell:{value:i}})=>D?i:t.createElement(r.Z,{width:100}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:i}})=>D?i:t.createElement(r.Z,{width:60}),sortType:"string"},{id:"memberCount",header:"Members",disableGrow:!0,cell:({cell:{value:i}})=>D?i:t.createElement(r.Z,{width:40}),sortType:"number"},...H?[{id:"role",header:"Role",cell:({cell:{value:i},row:{original:x}})=>D?g.contextSrv.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsRolesList,x)&&t.createElement(I.f,{teamId:x.id,roles:x.roles||[],isLoading:V,roleOptions:G,width:40}):t.createElement(r.Z,{width:320,height:32,containerClassName:S.blockSkeleton})}]:[],{id:"actions",header:"",disableGrow:!0,cell:({row:{original:i}})=>{if(!D)return t.createElement(P.K,{direction:"row",justifyContent:"flex-end",alignItems:"center"},t.createElement(r.Z,{containerClassName:S.blockSkeleton,width:16,height:16}),t.createElement(r.Z,{containerClassName:S.blockSkeleton,width:22,height:24}));const x=g.contextSrv.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsRead,i),J=g.contextSrv.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsDelete,i);return t.createElement(P.K,{direction:"row",justifyContent:"flex-end"},x&&t.createElement(A.u,{content:"Edit team"},t.createElement("a",{href:`org/teams/edit/${i.id}`,"aria-label":`Edit team ${i.name}`},t.createElement(m.J,{name:"pen"}))),t.createElement(s.m,{"aria-label":`Delete team ${i.name}`,size:"sm",disabled:!J,onConfirm:()=>U(i.id)}))}}],[H,D,V,G,U,S]);return t.createElement(p.T,{navId:"teams",actions:t.createElement(c.Qj,{href:Q?"org/teams/new":"#",disabled:!Q},"New Team")},t.createElement(p.T.Contents,null,N?t.createElement(K.Z,{title:"You haven't created any teams yet.",buttonIcon:"users-alt",buttonLink:"org/teams/new",buttonTitle:" New team",buttonDisabled:!g.contextSrv.hasPermission(E.AccessControlAction.ActionTeamsCreate),proTip:"Assign folder and dashboard permissions to teams instead of users to ease administration.",proTipLink:"",proTipLinkTitle:"",proTipTarget:"_blank"}):t.createElement(t.Fragment,null,t.createElement("div",{className:"page-action-bar"},t.createElement(d._,{grow:!0},t.createElement(_.H,{placeholder:"Search teams",value:h,onChange:X}))),t.createElement(P.K,{direction:"column",gap:2},t.createElement(L.e,{columns:q,data:D?u:R,getRowId:i=>String(i.id),fetchData:F}),t.createElement(P.K,{justifyContent:"flex-end"},t.createElement(y.t,{hideWhenSinglePage:!0,currentPage:Y,numberOfPages:z,onNavigate:w}))))))};function a(){return g.contextSrv.licensedAccessControlEnabled()&&g.contextSrv.hasPermission(E.AccessControlAction.ActionTeamsRolesList)&&g.contextSrv.hasPermission(E.AccessControlAction.ActionRolesList)}function n(u){return{teams:u.teams.teams,query:u.teams.query,perPage:u.teams.perPage,page:u.teams.page,noTeams:u.teams.noTeams,totalPages:u.teams.totalPages,hasFetched:u.teams.hasFetched,rolesLoading:u.teams.rolesLoading}}const o={loadTeams:C.jI,deleteTeam:C.fC,changePage:C.oO,changeQuery:C.R5,changeSort:C.nt},B=(0,T.connect)(n,o)(j),b=u=>({blockSkeleton:(0,O.css)({lineHeight:1,display:"flex"})})},19691:(Z,v,e)=>{e.d(v,{A_:()=>C,P5:()=>R,QX:()=>d,R5:()=>L,fC:()=>_,fs:()=>E,jI:()=>s,j_:()=>I,nt:()=>K,oO:()=>y});var O=e(69781),t=e.n(O),r=e(69391),T=e(7939),M=e(75923),f=e(10704),P=e(42342),A=e(47663),m=e(44730);function s(a=!1){return async(n,o)=>{const{query:l,page:B,perPage:b,sort:u}=o().teams;if(!M.Vt.hasPermission(P.AccessControlAction.ActionTeamsRead)){n((0,m.PL)({teams:[],totalCount:0,page:1,perPage:b,noTeams:!0}));return}const h=await(0,r.i)().get("/api/teams/search",(0,f.y)({query:l,page:B,perpage:b,sort:u}));let N=!1;if(a&&(N=h.teams.length===0),M.Vt.licensedAccessControlEnabled()&&M.Vt.hasPermission(P.AccessControlAction.ActionTeamsRolesList)){n((0,m.Fy)());const D=h?.teams.map(U=>U.id),W=await(0,r.i)().post("/api/access-control/teams/roles/search",{teamIds:D});h.teams.forEach(U=>{U.roles=W?W[U.id]||[]:[]}),n((0,m.BR)())}n((0,m.PL)({noTeams:N,...h}))}}const c=(0,O.debounce)(a=>a(s()),500);function d(a){return async n=>{const o=await(0,r.i)().get(`/api/teams/${a}`,(0,f.y)());n((0,m.y$)(o)),n((0,T.RL)((0,A.B)(o)))}}function _(a){return async n=>{await(0,r.i)().delete(`/api/teams/${a}`),await M.Vt.fetchUserPermissions(),n(s())}}function L(a){return async n=>{n((0,m.aj)(a)),c(n)}}function y(a){return async n=>{n((0,m.PJ)(a)),n(s())}}function K({sortBy:a}){const n=a.length?`${a[0].id}-${a[0].desc?"desc":"asc"}`:void 0;return async o=>{o((0,m.UL)(n)),o(s())}}function p(){return async(a,n)=>{const o=n().team.team,l=await getBackendSrv().get(`/api/teams/${o.id}/members`);a(teamMembersLoaded(l))}}function $(a){return async(n,o)=>{const l=o().team.team;await getBackendSrv().post(`/api/teams/${l.id}/members`,{userId:a}),n(p())}}function g(a){return async(n,o)=>{const l=o().team.team;await getBackendSrv().delete(`/api/teams/${l.id}/members/${a}`),n(p())}}function E(a,n){return async(o,l)=>{const B=l().team.team;await(0,r.i)().put(`/api/teams/${B.id}`,{name:a,email:n}),o(d(B.id))}}function I(){return async(a,n)=>{const o=n().team.team,l=await(0,r.i)().get(`/api/teams/${o.id}/groups`);a((0,m.iI)(l))}}function C(a){return async(n,o)=>{const l=o().team.team;await(0,r.i)().post(`/api/teams/${l.id}/groups`,{groupId:a}),n(I())}}function R(a){return async(n,o)=>{const l=o().team.team;await(0,r.i)().delete(`/api/teams/${l.id}/groups?groupId=${encodeURIComponent(a)}`),n(I())}}function j(a){return async n=>{await getBackendSrv().put(`/api/teams/${a.teamId}/members/${a.userId}`,{permission:a.permission}),n(p())}}},47663:(Z,v,e)=>{e.d(v,{B:()=>A,o:()=>m});var O=e(28298),t=e(13807),r=e(83811),T=e(56811),M=e(48436),f=e(42342);const P={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:f.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function A(s){const c={img:s.avatarUrl,id:"team-"+s.id,subTitle:"Manage members and settings",url:"",text:s.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${s.id}`,text:"Settings",url:`org/teams/edit/${s.id}/settings`}]};(s===P||T.contextSrv.hasPermissionInMetadata(f.AccessControlAction.ActionTeamsPermissionsRead,s))&&c.children.unshift({active:!1,icon:"users-alt",id:`team-members-${s.id}`,text:"Members",url:`org/teams/edit/${s.id}/members`});const d={active:!1,icon:"sync",id:`team-groupsync-${s.id}`,text:"External group sync",url:`org/teams/edit/${s.id}/groupsync`},_=s===P;return(0,M.d5)()&&(d.tabSuffix=()=>(0,t.Z)({experimentId:_?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,O.v)("teamsync")?(_||T.contextSrv.hasPermissionInMetadata(f.AccessControlAction.ActionTeamsPermissionsRead,s))&&c.children.push(d):r.default.featureToggles.featureHighlights&&c.children.push({...d,tabSuffix:()=>(0,t.Z)({experimentId:_?"":"feature-highlights-team-sync-badge"})}),c}function m(s){const c=A(P);let d;for(const _ of c.children)if(_.id.indexOf(s)>0){_.active=!0,d=_;break}return{main:c,node:d}}}}]);

//# sourceMappingURL=TeamList.8cf02a6a0c8896eef1f0.js.map