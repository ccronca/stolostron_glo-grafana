"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7323],{78710:(k,T,t)=>{t.d(T,{Z:()=>X,v:()=>J});var e=t(76932),n=t(31733),b=t(26857),S=t(44343),P=t(21568),R=t(64704),K=t(85498),W=t(17618),N=t(97216),y=t(85765),h=t(38834),o=t(36667),F=t(60100),w=t(55048),s=t(23006),L=t(51343),O=t(33227),Z=t(66368),c=t(53166),H=t(70441),Q=t(29272),a=t(85649);function r(){const A=H.a2.map(l=>({value:l.code,label:l.name}));return[{value:"",label:(0,c.t)("common.locale.default","Default")},...A]}class J extends n.PureComponent{constructor(E){super(E),this.onSubmitForm=async()=>{if(this.props.onConfirm?await this.props.onConfirm():!0){const{homeDashboardUID:V,theme:$,timezone:j,weekStart:G,language:x,queryHistory:B}=this.state;await this.service.update({homeDashboardUID:V,theme:$,timezone:j,weekStart:G,language:x,queryHistory:B}),window.location.reload()}},this.onThemeChanged=l=>{this.setState({theme:l.value}),l.value&&(0,a.L)(l.value,!0)},this.onTimeZoneChanged=l=>{typeof l=="string"&&this.setState({timezone:l})},this.onWeekStartChanged=l=>{this.setState({weekStart:l})},this.onHomeDashboardChanged=l=>{this.setState({homeDashboardUID:l})},this.onLanguageChanged=l=>{this.setState({language:l}),(0,R.ff)("grafana_preferences_language_changed",{toLanguage:l,preferenceType:this.props.preferenceType})},this.service=new Q.y(E.resourceUri),this.state={theme:"",timezone:"",weekStart:"",language:"",queryHistory:{homeTab:""}},this.themeOptions=(0,b.d)(K.config.featureToggles.extraThemes).map(l=>({value:l.id,label:Y(l)})),this.themeOptions.unshift({value:"",label:(0,c.t)("shared-preferences.theme.default-label","Default")})}async componentDidMount(){const E=await this.service.load();this.setState({homeDashboardUID:E.homeDashboardUID,theme:E.theme,timezone:E.timezone,weekStart:E.weekStart,language:E.language,queryHistory:E.queryHistory})}render(){const{theme:E,timezone:l,weekStart:V,homeDashboardUID:$,language:j}=this.state,{disabled:G}=this.props,x=_(),B=r(),te=this.themeOptions.find(p=>p.value===E)??this.themeOptions[0];return n.createElement(W.l,{onSubmit:this.onSubmitForm},()=>n.createElement(n.Fragment,null,n.createElement(N.C,{label:n.createElement(c.cC,{i18nKey:"shared-preferences.title"},"Preferences"),disabled:G},n.createElement(y.g,{label:(0,c.t)("shared-preferences.fields.theme-label","Interface theme")},n.createElement(h.Ph,{options:this.themeOptions,value:te,onChange:this.onThemeChanged,inputId:"shared-preferences-theme-select"})),n.createElement(y.g,{label:n.createElement(o._,{htmlFor:"home-dashboard-select"},n.createElement("span",{className:x.labelText},n.createElement(c.cC,{i18nKey:"shared-preferences.fields.home-dashboard-label"},"Home Dashboard"))),"data-testid":"User preferences home dashboard drop down"},n.createElement(Z.o,{value:$,onChange:p=>this.onHomeDashboardChanged(p?.uid??""),defaultOptions:!0,isClearable:!0,placeholder:(0,c.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})),n.createElement(y.g,{label:(0,c.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":P.wl.components.TimeZonePicker.containerV2},n.createElement(F.O,{includeInternal:!0,value:l,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})),n.createElement(y.g,{label:(0,c.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":P.wl.components.WeekStartPicker.containerV2},n.createElement(w.z,{value:V||"",onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})),n.createElement(y.g,{label:n.createElement(o._,{htmlFor:"locale-select"},n.createElement("span",{className:x.labelText},n.createElement(c.cC,{i18nKey:"shared-preferences.fields.locale-label"},"Language")),n.createElement(s.a,{featureState:S.CQ.beta})),"data-testid":"User preferences language drop down"},n.createElement(h.Ph,{value:B.find(p=>p.value===j),onChange:p=>this.onLanguageChanged(p.value??""),options:B,placeholder:(0,c.t)("shared-preferences.fields.locale-placeholder","Choose language"),inputId:"locale-select"}))),n.createElement(L.zx,{type:"submit",variant:"primary","data-testid":P.wl.components.UserProfile.preferencesSaveButton},n.createElement(c.cC,{i18nKey:"common.save"},"Save"))))}}const X=J,_=(0,O.B)(()=>({labelText:(0,e.css)`
      margin-right: 6px;
    `}));function Y(A){switch(A.id){case"dark":return(0,c.t)("shared.preferences.theme.dark-label","Dark");case"light":return(0,c.t)("shared.preferences.theme.light-label","Light");case"system":return(0,c.t)("shared.preferences.theme.system-label","System preference");default:return A.name}}},98484:(k,T,t)=>{t.r(T),t.d(T,{UserProfileEditPage:()=>ae,default:()=>de});var e=t(31733),n=t(55024),b=t(81716),S=t(90384),P=t(21568),R=t(33500),K=t(79106),W=t(37739),N=t(88062),y=t(4981),h=t(31805),o=t(50186),F=t(78710),w=t(297),s=t(53166),L=t(61375),O=t(51343);class Z extends e.PureComponent{render(){const{isLoading:v,orgs:f,user:g}=this.props;return v?e.createElement(L.u,{text:"Loading organizations..."}):f.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},e.createElement(s.cC,{i18nKey:"user-orgs.title"},"Organizations")),e.createElement("table",{className:"filter-table form-inline","data-testid":P.wl.components.UserProfile.orgsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(s.cC,{i18nKey:"user-orgs.name-column"},"Name")),e.createElement("th",null,e.createElement(s.cC,{i18nKey:"user-orgs.role-column"},"Role")),e.createElement("th",null))),e.createElement("tbody",null,f.map((d,m)=>e.createElement("tr",{key:m},e.createElement("td",null,d.name),e.createElement("td",null,d.role),e.createElement("td",{className:"text-right"},d.orgId===g?.orgId?e.createElement(O.zx,{variant:"secondary",size:"sm",disabled:!0},e.createElement(s.cC,{i18nKey:"user-orgs.current-org-button"},"Current")):e.createElement(O.zx,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(d)}},e.createElement(s.cC,{i18nKey:"user-orgs.select-org-button"},"Select organisation"))))))))}}const c=Z;var H=t(17618),Q=t(97216),a=t(85765),r=t(64516),J=t(58037),X=t(49311),_=t(83811);const{disableLoginForm:Y}=_.default,E=({user:u,isSavingUser:v,updateProfile:f})=>{const g=U=>{f(U)},d=(u&&u.isExternal)??!1,m=d&&u&&u.authLabels?u.authLabels[0]:"",C=m?` (Synced via ${m})`:"",D=Y||d;return e.createElement(H.l,{onSubmit:g,validateOn:"onBlur"},({register:U,errors:z})=>e.createElement(e.Fragment,null,e.createElement(Q.C,null,e.createElement(a.g,{label:(0,s.t)("user-profile.fields.name-label","Name")+C,invalid:!!z.name,error:e.createElement(s.cC,{i18nKey:"user-profile.fields.name-error"},"Name is required"),disabled:D},e.createElement(r.I,{...U("name",{required:!0}),id:"edit-user-profile-name",placeholder:(0,s.t)("user-profile.fields.name-label","Name"),defaultValue:u?.name??"",suffix:e.createElement(l,null)})),e.createElement(a.g,{label:(0,s.t)("user-profile.fields.email-label","Email")+C,invalid:!!z.email,error:e.createElement(s.cC,{i18nKey:"user-profile.fields.email-error"},"Email is required"),disabled:D},e.createElement(r.I,{...U("email",{required:!0}),id:"edit-user-profile-email",placeholder:(0,s.t)("user-profile.fields.email-label","Email"),defaultValue:u?.email??"",suffix:e.createElement(l,null)})),e.createElement(a.g,{label:(0,s.t)("user-profile.fields.username-label","Username")+C,disabled:D},e.createElement(r.I,{...U("login"),id:"edit-user-profile-username",defaultValue:u?.login??"",placeholder:(0,s.t)("user-profile.fields.username-label","Username")+C,suffix:e.createElement(l,null)}))),e.createElement(O.zx,{variant:"primary",disabled:v||D,"data-testid":P.wl.components.UserProfile.profileSaveButton,type:"submit"},e.createElement(s.cC,{i18nKey:"common.save"},"Save"))))},l=()=>Y?e.createElement(J.u,{content:"Login details locked because they are managed in another system."},e.createElement(X.J,{name:"lock"})):null;var V=t(76932),$=t(70576);class j extends e.PureComponent{render(){const{isLoading:v,sessions:f,revokeUserSession:g}=this.props,d=G();return v?e.createElement(L.u,{text:e.createElement(s.cC,{i18nKey:"user-sessions.loading"},"Loading sessions...")}):e.createElement("div",{className:d.wrapper},f.length>0&&e.createElement(e.Fragment,null,e.createElement("h3",{className:"page-sub-heading"},"Sessions"),e.createElement("table",{className:"filter-table form-inline","data-testid":P.wl.components.UserProfile.sessionsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(s.cC,{i18nKey:"user-session.seen-at-column"},"Last seen")),e.createElement("th",null,e.createElement(s.cC,{i18nKey:"user-session.created-at-column"},"Logged on")),e.createElement("th",null,e.createElement(s.cC,{i18nKey:"user-session.ip-column"},"IP address")),e.createElement("th",null,e.createElement(s.cC,{i18nKey:"user-session.browser-column"},"Browser & OS")),e.createElement("th",null))),e.createElement("tbody",null,f.map((m,C)=>e.createElement("tr",{key:C},m.isActive?e.createElement("td",null,"Now"):e.createElement("td",null,m.seenAt),e.createElement("td",null,(0,s.$q)(m.createdAt,{dateStyle:"long"})),e.createElement("td",null,m.clientIp),e.createElement("td",null,m.browser," on ",m.os," ",m.osVersion),e.createElement("td",null,e.createElement(O.zx,{size:"sm",variant:"destructive",onClick:()=>g(m.id),"aria-label":(0,$.t)("user-session.revoke","Revoke user session")},e.createElement(X.J,{name:"power"})))))))))}}const G=()=>({wrapper:(0,V.css)({maxWidth:"100%"})}),x=j;class B extends e.PureComponent{render(){const{isLoading:v,teams:f}=this.props;return v?e.createElement(L.u,{text:"Loading teams..."}):f.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},"Teams"),e.createElement("table",{className:"filter-table form-inline","aria-label":"User teams table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Name"),e.createElement("th",null,"Email"),e.createElement("th",null,"Members"))),e.createElement("tbody",null,f.map((g,d)=>e.createElement("tr",{key:d},e.createElement("td",{className:"width-4 text-center"},e.createElement("img",{className:"filter-table__avatar",src:g.avatarUrl,alt:""})),e.createElement("td",null,g.name),e.createElement("td",null,g.email),e.createElement("td",null,g.memberCount))))))}}const te=null;var p=t(96083);const ne="tab",q="general";function ce(u){const v=u.user,{user:f,teams:g,orgs:d,sessions:m,teamsAreLoading:C,orgsAreLoading:D,sessionsAreLoading:U,isUpdating:z}=v;return{orgsAreLoading:D,sessionsAreLoading:U,teamsAreLoading:C,orgs:d,sessions:m,teams:g,isUpdating:z,user:f}}const me={initUserProfilePage:p.PA,revokeUserSession:p.cc,changeUserOrg:p.hz,updateUserProfile:p.Lj},ue=(0,n.connect)(ce,me);function ae({orgsAreLoading:u,sessionsAreLoading:v,teamsAreLoading:f,initUserProfilePage:g,orgs:d,sessions:m,teams:C,isUpdating:D,user:U,revokeUserSession:z,changeUserOrg:Ee,updateUserProfile:fe}){const[ge,he]=(0,w.K)(),re=ge[ne],[ee,pe]=(0,e.useState)(typeof re=="string"?re:q);(0,b.Z)(()=>g());const se=(0,e.useMemo)(()=>{const{extensions:i}=(0,R.QK)({extensionPointId:S.y.UserProfileTab,context:{}});return i},[]),le=se.reduce((i,I)=>{const{title:M}=I;return i[M]?i[M].push(I):i[M]=[I],i},{}),oe=i=>i.toLowerCase(),Pe=se.length>0,ve=[{id:q,title:(0,s.t)("user-profile.tabs.general","General")},...Object.keys(le).map(i=>({id:oe(i),title:i}))],ie=()=>e.createElement(K.wc,{spacing:"md"},e.createElement(E,{updateProfile:fe,isSavingUser:D,user:U}),e.createElement(F.Z,{resourceUri:"user",preferenceType:"user"}),e.createElement(W.K,{direction:"column",gap:6},e.createElement(B,{isLoading:f,teams:C}),e.createElement(c,{isLoading:u,setUserOrg:Ee,orgs:d,user:U}),e.createElement(x,{isLoading:v,revokeUserSession:z,sessions:m}))),Ue=()=>e.createElement("div",{"data-testid":P.wl.components.UserProfile.extensionPointTabs},e.createElement(K.wc,{spacing:"md"},e.createElement(N.J,null,ve.map(({id:i,title:I})=>e.createElement(y.O,{key:i,label:I,active:ee===i,onChangeTab:()=>{pe(i),he({[ne]:i})},"data-testid":P.wl.components.UserProfile.extensionPointTab(i)}))),e.createElement(h.I,null,ee===q&&e.createElement(ie,null),Object.entries(le).map(([i,I])=>{const M=oe(i);return ee===M?e.createElement(e.Fragment,{key:M},I.map(({component:Ce},ye)=>e.createElement(Ce,{key:`${M}-${ye}`}))):null}))));return e.createElement(o.T,{navId:"profile/settings"},e.createElement(o.T.Contents,{isLoading:!U},Pe?e.createElement(Ue,null):e.createElement(ie,null)))}const de=ue(ae)},96083:(k,T,t)=>{t.d(T,{Cp:()=>F,hz:()=>H,PA:()=>w,II:()=>s,cc:()=>c,Lj:()=>Q});var e=t(85498),n=t(69391);async function b(a){try{await(0,n.i)().put("/api/user/password",a)}catch(r){console.error(r)}}function S(){return(0,n.i)().get("/api/user")}function P(){return(0,n.i)().get("/api/user/teams")}function R(){return(0,n.i)().get("/api/user/orgs")}function K(){return(0,n.i)().get("/api/user/auth-tokens")}async function W(a){await(0,n.i)().post("/api/user/revoke-auth-token",{authTokenId:a})}async function N(a){await(0,n.i)().post("/api/user/using/"+a.orgId,{})}async function y(a){try{await(0,n.i)().put("/api/user",a)}catch(r){console.error(r)}}const h={changePassword:b,revokeUserSession:W,loadUser:S,loadSessions:K,loadOrgs:R,loadTeams:P,setUserOrg:N,updateUserProfile:y};var o=t(58838);function F(a){return async function(r){r((0,o.zc)({updating:!0})),await h.changePassword(a),r((0,o.zc)({updating:!1}))}}function w(){return async function(a){await a(s()),a(L()),a(O()),a(Z())}}function s(){return async function(a){const r=await h.loadUser();a((0,o.aw)({user:r}))}}function L(){return async function(a){a((0,o.qD)());const r=await h.loadTeams();a((0,o.PL)({teams:r}))}}function O(){return async function(a){a((0,o.$S)());const r=await h.loadOrgs();a((0,o.Ns)({orgs:r}))}}function Z(){return async function(a){a((0,o.Uk)());const r=await h.loadSessions();a((0,o.z0)({sessions:r}))}}function c(a){return async function(r){r((0,o.zc)({updating:!0})),await h.revokeUserSession(a),r((0,o.p$)({tokenId:a}))}}function H(a){return async function(r){r((0,o.zc)({updating:!0})),await h.setUserOrg(a),window.location.href=e.config.appSubUrl+"/profile"}}function Q(a){return async function(r){r((0,o.zc)({updating:!0})),await h.updateUserProfile(a),await r(s()),r((0,o.zc)({updating:!1}))}}},81716:(k,T,t)=>{t.d(T,{Z:()=>b});var e=t(26124),n=function(S){(0,e.Z)(function(){S()})};const b=n}}]);

//# sourceMappingURL=UserProfileEditPage.c6bd673d63d371b0c77c.js.map