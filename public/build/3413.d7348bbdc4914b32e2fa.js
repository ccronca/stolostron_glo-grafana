"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3413],{33413:(V,m,a)=>{a.r(m),a.d(m,{default:()=>I,groupStateByLabels:()=>g,matchKey:()=>E});var o=a(76932),h=a(69781),e=a(31733),y=a(40137),d=a(76067),S=a(61375),x=a(25111),T=a(85765),C=a(36667),L=a(37739),A=a(58037),u=a(49311),b=a(64516),K=a(42342),W=a(84415),z=a(68144);function B(t){const l=(0,K.useDispatch)(),n=(0,z._)(r=>r.managedAlertStateHistory);return(0,e.useEffect)(()=>{l((0,W.Ms)(t))},[l,t]),n}var F=a(12788),H=a(25899),N=a(48859);const R=({alertId:t})=>{const[l,n]=(0,e.useState)(""),r=(0,e.useCallback)(s=>{n(s.currentTarget.value)},[]),{loading:c,error:i,result:J=[]}=B(t),f=(0,d.wW)(v);if(c&&!i)return e.createElement(S.u,{text:"Loading history..."});if(i&&!c)return e.createElement(x.b,{title:"Failed to fetch alert state history"},i.message);const O=[{id:"state",label:"State",size:"max-content",renderCell:M},{id:"value",label:"",size:"auto",renderCell:G},{id:"timestamp",label:"Time",size:"max-content",renderCell:P}],X=Object.entries(g(J)).sort().filter(([s])=>E(s,l)).map(([s,j])=>{const U=j.map(p=>({id:p.id,data:p}));return e.createElement("div",{key:s},e.createElement("header",{className:f.tableGroupKey},e.createElement("code",{className:f.goupKeyText,"aria-label":s},s)),e.createElement(H.t,{cols:O,items:U,pagination:{itemsPerPage:25}}))});return e.createElement("div",null,e.createElement("nav",null,e.createElement(T.g,{label:e.createElement(C._,null,e.createElement(L.K,{gap:.5},e.createElement("span",null,"Filter group"),e.createElement(A.u,{content:e.createElement("div",null,"Filter each state history group either by exact match or a regular expression, ex:"," ",e.createElement("code",null,"region=eu-west-1")," or ",e.createElement("code",null,"/region=us-.+/"))},e.createElement(u.J,{name:"info-circle",size:"sm"}))))},e.createElement(b.I,{prefix:e.createElement(u.J,{name:"search"}),onChange:r,placeholder:"Search"}))),X)};function g(t){const l=t.map(n=>{const r=/{.*?}/g,c=n.text.match(r)?.at(-1)??"";return{id:String(n.id),state:n.newState,text:n.text.replace(c,""),data:n.data,timestamp:n.updated,stringifiedLabels:c}});return(0,h.groupBy)(l,n=>n.stringifiedLabels)}function E(t,l){if(l==="")return!0;if(!(l.startsWith("/")&&l.endsWith("/")))return t.includes(l);try{return new RegExp(l.slice(1,-1)).test(t)}catch{return!1}}function G(t){const l=t.data.data?.evalMatches??[];return e.createElement(e.Fragment,null,t.data.text,e.createElement($,null,l.map(n=>e.createElement(F.i,{key:n.metric,labelKey:n.metric,value:String(n.value)}))))}function M(t){return e.createElement(N.l,{state:t.data.state})}function P(t){return e.createElement("div",{className:D},t.data.timestamp&&e.createElement("span",null,(0,y.dq)(t.data.timestamp)))}const $=({children:t})=>{const{wrapper:l}=(0,d.wW)(v);return e.createElement("div",{className:l},t)},D=(0,o.css)`
  display: flex;
  align-items: flex-end;
  flex-direction: column;
`,v=t=>({wrapper:(0,o.css)`
    & > * {
      margin-right: ${t.spacing(1)};
    }
  `,tableGroupKey:(0,o.css)`
    margin-top: ${t.spacing(2)};
    margin-bottom: ${t.spacing(2)};
  `,goupKeyText:(0,o.css)({overflowX:"auto",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block"})}),I=R}}]);

//# sourceMappingURL=3413.d7348bbdc4914b32e2fa.js.map