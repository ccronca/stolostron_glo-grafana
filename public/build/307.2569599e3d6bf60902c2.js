"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[307],{76787:(z,P,a)=>{a.d(P,{K:()=>f});var n=a(76932),t=a(31733),E=a(76067);const f=({children:u})=>{const c=(0,E.wW)(B);return t.createElement("div",{className:c.root},u)},B=u=>({root:(0,n.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:u.spacing(3),minHeight:u.spacing(4)})})},10359:(z,P,a)=>{a.d(P,{B:()=>t});var n=a(31733);const t=({grow:E,shrink:f})=>n.createElement("div",{style:{display:"block",flexGrow:E,flexShrink:f}})},69328:(z,P,a)=>{a.d(P,{Hk:()=>v,U9:()=>c,_z:()=>C,aC:()=>I,iS:()=>s,k:()=>L,rf:()=>f,tU:()=>p});var n=a(76621);function t(l){return E(l/1e3)}function E(l){return Math.floor(l/60)}function f(l,o){if(l&&o){const R=t(l.from.valueOf())===t(o.from.valueOf()),b=t(l.to.valueOf())===t(o.to.valueOf());return!(R&&b)}return!1}const B=/[*+?()|\\.\[\]{}^$]/g;function u(l){return l.replace(B,"\\$&")}function c(l){return l.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function s(l){return l.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function p(l){return c(u(l))}function v(l,o){return C(o)?p(l):c(l)}function C(l){return!!(l&&(l.includes("=~")||l.includes("!~")))}function I(l){const o=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],R=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${o.join("|")})$`);return!!l.match(R)}function L(l,o,R){if(!o||R===void 0)return null;const b=o.fields.find(M=>M.name==="labelTypes")?.values[R];if(!b)return null;switch(b[l]){case"I":return n.JG.Indexed;case"S":return n.JG.StructuredMetadata;case"P":return n.JG.Parsed;default:return null}}},76621:(z,P,a)=>{a.d(P,{JG:()=>u,sb:()=>f,EM:()=>t,Z3:()=>c,$o:()=>E});var n=(s=>(s.Builder="builder",s.Code="code",s))(n||{}),t=(s=>(s.Instant="instant",s.Range="range",s.Stream="stream",s))(t||{}),E=(s=>(s.DataSample="dataSample",s.LogsSample="logsSample",s.LogsVolume="logsVolume",s))(E||{}),f=(s=>(s.Backward="backward",s.Forward="forward",s))(f||{}),B=(s=>(s.Stream="streams",s.Vector="vector",s.Matrix="matrix",s))(B||{}),u=(s=>(s.Indexed="I",s.StructuredMetadata="S",s.Parsed="P",s))(u||{}),c=(s=>(s[s.LabelNames=0]="LabelNames",s[s.LabelValues=1]="LabelValues",s))(c||{})},41820:(z,P,a)=>{a.d(P,{P:()=>ge});var n=a(76932),t=a(31733),E=a(4113),f=a(99640),B=a(31621),u=a(76067),c=a(37739),s=a(3166),p=a(51343),v=a(58037),C=a(49311),I=a(41164),L=a(19207),l=a(9184),o=a(58239),R=a(10359),b=a(38834),M=a(67537),K=a(69710),V=a(8496),U=a(51133),J=a(25108);const G=t.memo(({def:e,operation:r})=>{const i=(0,u.wW)(q),[m,g]=(0,t.useState)(!1),D=[(0,M.cv)(16),(0,M.RR)({fallbackAxisSideDirection:"end",crossAxis:!1,boundary:document.body}),(0,M.uY)()],{context:_,refs:A,floatingStyles:y}=(0,K.YF)({open:m,placement:"top",onOpenChange:g,middleware:D,whileElementsMounted:V.Me}),F=(0,K.eS)(_),H=(0,K.bQ)(_),{getReferenceProps:O,getFloatingProps:T}=(0,K.NI)([H,F]);return t.createElement(t.Fragment,null,t.createElement(p.zx,{title:"Click to show description",ref:A.setReference,icon:"info-circle",size:"sm",variant:"secondary",fill:"text",...O()}),m&&t.createElement(J.h_,null,t.createElement("div",{ref:A.setFloating,style:y,...T(),className:i.docBox},t.createElement("div",{className:i.docBoxHeader},t.createElement("span",null,e.renderer(r,e,"<expr>")),t.createElement(R.B,{grow:1}),t.createElement(p.zx,{icon:"times",onClick:()=>g(!1),fill:"text",variant:"secondary",title:"Remove operation"})),t.createElement("div",{className:i.docBoxBody,dangerouslySetInnerHTML:{__html:ee(e,r)}}))))});G.displayName="OperationDocs";const q=e=>({docBox:(0,n.css)({overflow:"hidden",background:e.colors.background.primary,border:`1px solid ${e.colors.border.strong}`,boxShadow:e.shadows.z3,maxWidth:"600px",padding:e.spacing(1),borderRadius:e.shape.radius.default,zIndex:e.zIndex.tooltip}),docBoxHeader:(0,n.css)({fontSize:e.typography.h5.fontSize,fontFamily:e.typography.fontFamilyMonospace,paddingBottom:e.spacing(1),display:"flex",alignItems:"center"}),docBoxBody:(0,n.css)({marginBottom:e.spacing(-1),color:e.colors.text.secondary})});function ee(e,r){return(0,U.a)(e.explainHandler?e.explainHandler(r,e):e.documentation??"no docs")}const X=t.memo(({operation:e,def:r,index:i,onChange:m,onRemove:g,queryModeller:D,dragHandleProps:_})=>{const A=(0,u.wW)(te),[y,F]=(0,t.useState)({}),H=()=>{if(y.isOpen)F({...y,isOpen:!1});else{const O=D.getAlternativeOperations(r.alternativesKey).map(T=>({label:T.name,value:T}));F({isOpen:!0,alternatives:O})}};return t.createElement("div",{className:A.header},!y.isOpen&&t.createElement(t.Fragment,null,t.createElement("div",{..._},r.name??r.id),t.createElement(R.B,{grow:1}),t.createElement("div",{className:`${A.operationHeaderButtons} operation-header-show-on-hover`},t.createElement(p.zx,{icon:"angle-down",size:"sm",onClick:H,fill:"text",variant:"secondary",title:"Click to view alternative operations"}),t.createElement(G,{def:r,operation:e}),t.createElement(p.zx,{icon:"times",size:"sm",onClick:()=>g(i),fill:"text",variant:"secondary",title:"Remove operation"}))),y.isOpen&&t.createElement("div",{className:A.selectWrapper},t.createElement(b.Ph,{autoFocus:!0,openMenuOnFocus:!0,placeholder:"Replace with",options:y.alternatives,isOpen:!0,onCloseMenu:H,onChange:O=>{if(O.value){const T=D.getOperationDef(O.value.id),$=[...T.defaultParams];for(let w=0;w<Math.min(e.params.length,$.length);w++)T.params[w].type===r.params[w].type&&($[w]=e.params[w]);const Q={...e,params:$,id:O.value.id};m(i,r.changeTypeHandler?r.changeTypeHandler(Q,T):Q)}}})))});X.displayName="OperationHeader";const te=e=>({header:(0,n.css)({borderBottom:`1px solid ${e.colors.border.medium}`,padding:e.spacing(.5,.5,.5,1),display:"flex",alignItems:"center"}),operationHeaderButtons:(0,n.css)({opacity:1}),selectWrapper:(0,n.css)({paddingRight:e.spacing(2)})});var ae=a(84275),ne=a(1537),re=a(36356);function se(e){if(e.editor)return e.editor;if(e.options)return ie;switch(e.type){case"boolean":return le;case"number":case"string":default:return oe}}function oe(e){return t.createElement(ne.H,{id:(0,o.i1)(e.operationId,e.index),defaultValue:e.value?.toString(),minWidth:e.paramDef.minWidth,placeholder:e.paramDef.placeholder,title:e.paramDef.description,maxWidth:(e.paramDef.minWidth||20)*3,onCommitChange:r=>{e.onChange(e.index,r.currentTarget.value),e.paramDef.runQueryOnEnter&&r.type==="keydown"&&e.onRunQuery()}})}function le(e){return t.createElement(re.X,{id:(0,o.i1)(e.operationId,e.index),value:!!e.value,onChange:r=>e.onChange(e.index,r.currentTarget.checked)})}function ie({paramDef:e,value:r,index:i,operationId:m,onChange:g}){const D=(0,u.wW)(ce);let _=e.options;_[0]?.label||(_=e.options.map(y=>({label:y.toString(),value:y})));let A=_.find(y=>y.value===r)??(0,ae.E)(r);return!r&&e.optional?t.createElement("div",{className:D.optionalParam},t.createElement(p.zx,{size:"sm",variant:"secondary",title:`Add ${e.name}`,icon:"plus",onClick:()=>g(i,_[0].value)},e.name)):t.createElement(c.K,{gap:.5,direction:"row",alignItems:"center"},t.createElement(b.Ph,{id:(0,o.i1)(m,i),value:A,options:_,placeholder:e.placeholder,allowCustomValue:!0,onChange:y=>g(i,y.value),width:e.minWidth||"auto"}),e.optional&&t.createElement(p.zx,{"data-testid":`operations.${i}.remove-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${e.name}`,onClick:()=>g(i,"")}))}const ce=e=>({optionalParam:(0,n.css)({marginTop:e.spacing(1)})});function de({operation:e,index:r,onRemove:i,onChange:m,onRunQuery:g,queryModeller:D,query:_,datasource:A,flash:y,highlight:F,timeRange:H}){const O=D.getOperationDef(e.id),T=me(y),$=(0,t.useId)(),Q=e.id===l.B5.LabelFilter&&(0,L.ZO)(e,_.operations),w=(0,u.l4)(),S=pe(w,Q);if(!O)return t.createElement("span",null,"Operation ",e.id," not found");const j=(d,W)=>{const Z={...e,params:[...e.params]};Z.params[d]=W,Y(O,Z,r,d,m)},x=()=>{const d={...e,params:[...e.params,""]};Y(O,d,r,e.params.length,m)},h=d=>{const W={...e,params:[...e.params.slice(0,d),...e.params.slice(d+1)]};Y(O,W,r,d,m)},N=[];for(let d=0;d<e.params.length;d++){const W=O.params[Math.min(O.params.length-1,d)],Z=se(W);N.push(t.createElement("div",{className:S.paramRow,key:`${d}-1`},!W.hideName&&t.createElement("div",{className:S.paramName},t.createElement("label",{htmlFor:(0,o.i1)($,d)},W.name),W.description&&t.createElement(v.u,{placement:"top",content:W.description,theme:"info"},t.createElement(C.J,{name:"info-circle",size:"sm",className:S.infoIcon}))),t.createElement("div",{className:S.paramValue},t.createElement(c.K,{gap:.5,direction:"row",alignItems:"center"},t.createElement(Z,{index:d,paramDef:W,value:e.params[d],operation:e,operationId:$,onChange:j,onRunQuery:g,query:_,datasource:A,timeRange:H}),W.restParam&&(e.params.length>O.params.length||W.optional)&&t.createElement(p.zx,{"data-testid":`operations.${r}.remove-rest-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${W.name}`,onClick:()=>h(d)})))))}let k;if(O.params.length>0){const d=O.params[O.params.length-1];d.restParam&&(k=ue(d,x,r,e.params.length,S))}const ye=d=>{if(!d)return Q?!0:void 0},Oe=({provided:d})=>t.createElement("div",{className:(0,n.cx)(S.card,(T||F)&&S.cardHighlight,Q&&S.cardError),ref:d.innerRef,...d.draggableProps,"data-testid":`operations.${r}.wrapper`},t.createElement(X,{operation:e,dragHandleProps:d.dragHandleProps,def:O,index:r,onChange:m,onRemove:i,queryModeller:D}),t.createElement("div",{className:S.body},N),k,r<_.operations.length-1&&t.createElement("div",{className:S.arrow},t.createElement("div",{className:S.arrowLine}),t.createElement("div",{className:S.arrowArrow})));return t.createElement(E._l,{draggableId:`operation-${r}`,index:r},(d,W)=>t.createElement(I._,{error:"You have conflicting label filters",invalid:ye(W.isDragging),className:(0,n.cx)(S.error,S.cardWrapper)},t.createElement(Oe,{provided:d})))}function me(e){const[r,i]=(0,t.useState)(!0);return(0,t.useEffect)(()=>{let m;return e?m=setTimeout(()=>{i(!1)},1e3):i(!0),()=>clearTimeout(m)},[e]),r&&e}function ue(e,r,i,m,g){return t.createElement("div",{className:g.restParam,key:`${m}-2`},t.createElement(p.zx,{size:"sm",icon:"plus",title:`Add ${e.name}`.trimEnd(),variant:"secondary",onClick:r,"data-testid":`operations.${i}.add-rest-param`},e.name))}function Y(e,r,i,m,g){e.paramChangedHandler?g(i,e.paramChangedHandler(m,r,e)):g(i,r)}const pe=(e,r)=>({cardWrapper:(0,n.css)({alignItems:"stretch"}),error:(0,n.css)({marginBottom:e.spacing(1)}),card:(0,n.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.medium}`,cursor:"grab",borderRadius:e.shape.radius.default,position:"relative",transition:"all 0.5s ease-in 0s",height:r?"auto":"100%"}),cardError:(0,n.css)({boxShadow:`0px 0px 4px 0px ${e.colors.warning.main}`,border:`1px solid ${e.colors.warning.main}`}),cardHighlight:(0,n.css)({boxShadow:`0px 0px 4px 0px ${e.colors.primary.border}`,border:`1px solid ${e.colors.primary.border}`}),infoIcon:(0,n.css)({marginLeft:e.spacing(.5),color:e.colors.text.secondary,":hover":{color:e.colors.text.primary}}),body:(0,n.css)({margin:e.spacing(1,1,.5,1),display:"table"}),paramRow:(0,n.css)({label:"paramRow",display:"table-row",verticalAlign:"middle"}),paramName:(0,n.css)({display:"table-cell",padding:e.spacing(0,1,0,0),fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,verticalAlign:"middle",height:"32px"}),paramValue:(0,n.css)({label:"paramValue",display:"table-cell",verticalAlign:"middle"}),restParam:(0,n.css)({padding:e.spacing(0,1,1,1)}),arrow:(0,n.css)({position:"absolute",top:"0",right:"-18px",display:"flex"}),arrowLine:(0,n.css)({height:"2px",width:"8px",backgroundColor:e.colors.border.strong,position:"relative",top:"14px"}),arrowArrow:(0,n.css)({width:0,height:0,borderTop:"5px solid transparent",borderBottom:"5px solid transparent",borderLeft:`7px solid ${e.colors.border.strong}`,position:"relative",top:"10px"})});function ge({query:e,datasource:r,queryModeller:i,onChange:m,onRunQuery:g,highlightedOp:D,timeRange:_}){const A=(0,u.wW)(ve),{operations:y}=e,F=Ee(y),[H,O]=(0,t.useState)(!1),T=(x,h)=>{const N=[...y];N.splice(x,1,h),m({...e,operations:N})},$=x=>{const h=[...y.slice(0,x),...y.slice(x+1)];m({...e,operations:h})},Q=i.getCategories().map(x=>({value:x,label:x,items:i.getOperationsForCategory(x).map(h=>({value:h.id,label:h.name,isLeaf:!0}))})),w=x=>{const h=i.getOperationDef(x);h&&(m(h.addOperationHandler(h,e,i)),O(!1))},S=x=>{if(!x.destination)return;const h=[...y],N=h[x.source.index];h.splice(x.source.index,1),h.splice(x.destination.index,0,N),m({...e,operations:h})},j=()=>{O(!1)};return t.createElement(c.K,{gap:1,direction:"column"},t.createElement(c.K,{gap:1},y.length>0&&t.createElement(E.Z5,{onDragEnd:S},t.createElement(E.bK,{droppableId:"sortable-field-mappings",direction:"horizontal"},x=>t.createElement("div",{className:A.operationList,ref:x.innerRef,...x.droppableProps},y.map((h,N)=>t.createElement(de,{key:h.id+JSON.stringify(h.params)+N,queryModeller:i,index:N,operation:h,query:e,datasource:r,onChange:T,onRemove:$,onRunQuery:g,flash:F[N],highlight:D===h,timeRange:_})),x.placeholder))),t.createElement("div",{className:A.addButton},H?t.createElement(s.v,{options:Q,onSelect:w,onBlur:j,autoFocus:!0,alwaysOpen:!0,hideActiveLevelLabel:!0,placeholder:"Search"}):t.createElement(p.zx,{icon:"plus",variant:"secondary",onClick:()=>O(!0),title:"Add operation"},"Operations"))))}function Ee(e){const r=(0,f.Z)(),i=(0,B.Z)(e);if(!r())return e.map(()=>!1);if(!i)return e.map(()=>!0);let m=[];if(i.length-1===e.length&&e.every(g=>i.includes(g)))return e.map(()=>!1);if(i.length+1===e.length&&i.every(g=>e.includes(g))){const g=e.find(D=>!i.includes(D));m=e.map(D=>D===g)}else m=e.map((g,D)=>!fe(g.id,i[D]?.id));return m}function fe(e,r){return e===r||`__${e}_by`===r||e===`__${r}_by`}const ve=e=>({heading:(0,n.css)({label:"heading",fontSize:12,fontWeight:e.typography.fontWeightMedium,marginBottom:0}),operationList:(0,n.css)({label:"operationList",display:"flex",flexWrap:"wrap",gap:e.spacing(2)}),addButton:(0,n.css)({label:"addButton",width:126,paddingBottom:e.spacing(1)})})},35887:(z,P,a)=>{a.d(P,{B:()=>B});var n=a(76932),t=a(31733),E=a(76067),f=a(37739);function B({children:c}){const s=(0,E.wW)(u);return t.createElement("div",{className:s.root},t.createElement(f.K,{gap:1},c))}const u=c=>({root:(0,n.css)({padding:c.spacing(1,1,0,1),backgroundColor:c.colors.background.secondary,borderRadius:c.shape.radius.default})})},48733:(z,P,a)=>{a.d(P,{L:()=>c});var n=a(76932),t=a(31733),E=a(64704),f=a(76067),B=a(58037),u=a(51343);const c=({datasource:p,query:v,onChange:C,data:I,queryModeller:L,buildVisualQueryFromString:l})=>{const[o,R]=(0,t.useState)([]),b=(0,f.wW)(s);return(0,t.useEffect)(()=>{const M={expr:L.renderQuery(v),refId:""},K=p.getQueryHints(M,I?.series||[]).filter(V=>V.fix?.action);R(K)},[p,v,I,L]),t.createElement(t.Fragment,null,o.length>0&&t.createElement("div",{className:b.container},o.map(M=>t.createElement(B.u,{content:`${M.label} ${M.fix?.label}`,key:M.type},t.createElement(u.zx,{onClick:()=>{if((0,E.ff)("grafana_query_builder_hints_clicked",{hint:M.type,datasourceType:p.type}),M?.fix?.action){const K={expr:L.renderQuery(v),refId:""},V=p.modifyQuery(K,M.fix.action),U=l(V.expr);return C(U.query)}},fill:"outline",size:"sm",className:b.hint},"hint: ",M.fix?.title||M.fix?.action?.type.toLowerCase().replace("_"," "))))))};c.displayName="QueryBuilderHints";const s=p=>({container:(0,n.css)`
      display: flex;
      align-items: start;
    `,hint:(0,n.css)`
      margin-right: ${p.spacing(1)};
    `})},29580:(z,P,a)=>{a.d(P,{k:()=>B});var n=a(31733),t=a(96856),E=a(28015);const f=[{label:"Builder",value:E.c.Builder},{label:"Code",value:E.c.Code}];function B({mode:u,onChange:c}){return n.createElement("div",{"data-testid":"QueryEditorModeToggle"},n.createElement(t.S,{options:f,size:"sm",value:u,onChange:c}))}},41197:(z,P,a)=>{a.d(P,{n:()=>s});var n=a(76932),t=a(69781),E=a.n(t),f=a(31733),B=a(76067),u=a(37739),c=a(76772);function s({label:v,...C}){const I=v.replace(" ","-"),L=(0,f.useRef)((0,t.uniqueId)(`switch-${I}`)),l=(0,B.wW)(p);return f.createElement(u.K,{gap:1},f.createElement("label",{htmlFor:L.current,className:l.switchLabel},v),f.createElement(c.r,{...C,id:L.current}))}const p=v=>({switchLabel:(0,n.css)({color:v.colors.text.secondary,cursor:"pointer",fontSize:v.typography.bodySmall.fontSize,"&:hover":{color:v.colors.text.primary}})})},46675:(z,P,a)=>{a.d(P,{d:()=>C});var n=a(76932),t=a(31733),E=a(83870),f=a(86850),B=a(85498),u=a(76067),c=a(27218),s=a(37739),p=a(58037),v=a(49311);function C({title:o,children:R,collapsedInfo:b,queryStats:M}){const[K,V]=(0,E.Z)(!1),U=(0,u.wW)(I);return t.createElement("div",{className:U.wrapper},t.createElement(c.U,{className:U.collapse,collapsible:!0,isOpen:K,onToggle:V,label:t.createElement(s.K,{gap:0},t.createElement("h6",{className:U.title},o),!K&&t.createElement("div",{className:U.description},b.map((J,G)=>t.createElement("span",{key:G},J))))},t.createElement("div",{className:U.body},R)),M&&B.config.featureToggles.lokiQuerySplitting&&t.createElement(p.u,{content:"Note: the query will be split into multiple parts and executed in sequence. Query limits will only apply each individual part."},t.createElement(v.J,{tabIndex:0,name:"info-circle",className:U.tooltip,size:"sm"})),M&&t.createElement("p",{className:U.stats},L(M)))}const I=o=>({collapse:(0,n.css)({backgroundColor:"unset",border:"unset",marginBottom:0,["> button"]:{padding:o.spacing(0,1)}}),wrapper:(0,n.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,n.css)({flexGrow:1,overflow:"hidden",fontSize:o.typography.bodySmall.fontSize,fontWeight:o.typography.fontWeightMedium,margin:0}),description:(0,n.css)({color:o.colors.text.secondary,fontSize:o.typography.bodySmall.fontSize,fontWeight:o.typography.bodySmall.fontWeight,paddingLeft:o.spacing(2),gap:o.spacing(2),display:"flex"}),body:(0,n.css)({display:"flex",gap:o.spacing(2),flexWrap:"wrap"}),stats:(0,n.css)({margin:"0px",color:o.colors.text.secondary,fontSize:o.typography.bodySmall.fontSize}),tooltip:(0,n.css)({marginRight:o.spacing(.25)})}),L=o=>o.message?o.message:`This query will process approximately ${l(o)}.`,l=o=>{const{text:R,suffix:b}=(0,f.Cf)("bytes")(o.bytes,1);return R+b}},40243:(z,P,a)=>{a.d(P,{P5:()=>p,ar:()=>E,iS:()=>B});var n=a(31733),t=a(39357);const E="PrometheusQueryEditorExplainDefault",f="PrometheusQueryEditorRawQueryDefault",B="LokiQueryEditorExplainDefault",u="LokiQueryEditorRawQueryDefault";function c(v,C=!1){const I=t.Z.get(v);return I===void 0?C:!!parseInt(I,10)}function s(v,C){t.Z.set(v,C?"1":"0")}function p(v,C=!1){const[I,L]=(0,n.useState)(c(v,C)),l=(0,n.useCallback)(o=>{s(v,o),L(o)},[v]);return{flag:I,setFlag:l}}}}]);

//# sourceMappingURL=307.2569599e3d6bf60902c2.js.map