"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2341],{79092:(K,h,t)=>{t.r(h),t.d(h,{PlaylistEditPage:()=>C,default:()=>D});var e=t(31733),p=t(59326),M=t(19690),b=t(50186),m=t(53166),P=t(29821),I=t(81039);const C=({match:A})=>{const O=(0,I.K9)(),l=(0,p.Z)(()=>O.getPlaylist(A.params.uid),[A.params]),x=async g=>{await O.updatePlaylist(g),M.E1.push("/playlists")},E={text:(0,m.t)("playlist-edit.title","Edit playlist"),subTitle:(0,m.t)("playlist-edit.sub-title","A playlist rotates through a pre-selected list of dashboards. A playlist can be a great way to build situational awareness, or just show off your metrics to your team or visitors.")};return e.createElement(b.T,{navId:"dashboards/playlists",pageNav:E},e.createElement(b.T.Contents,{isLoading:l.loading},l.error&&e.createElement("div",null,e.createElement(m.cC,{i18nKey:"playlist-edit.error-prefix"},"Error loading playlist:"),JSON.stringify(l.error)),l.value&&e.createElement(P.H,{onSubmit:x,playlist:l.value})))},D=C},29821:(K,h,t)=>{t.d(h,{H:()=>V});var e=t(31733),p=t(21568),M=t(85498),b=t(17618),m=t(85765),P=t(64516),I=t(97216),C=t(79106),D=t(51343),A=t(66368),O=t(41374),l=t(53166),x=t(4502),E=t(4113),g=t(76932),S=t(86504),F=t.n(S),L=t(76067),N=t(89719),B=t(49311),R=t(41354),U=t(61504);const $=({items:d,onDelete:n})=>{const i=(0,L.wW)(W);if(!d?.length)return e.createElement("div",null,e.createElement("em",null,e.createElement(l.cC,{i18nKey:"playlist-edit.form.table-empty"},"Playlist is empty. Add dashboards below.")));const y=a=>{let c=a.type==="dashboard_by_tag"?"apps":"tag-alt";const r=[],s=a.dashboards?.[0];return a.dashboards?a.type==="dashboard_by_tag"?(r.push(e.createElement(U.e,{key:a.value,label:a.value,removeIcon:!1,count:0})),s?r.push(e.createElement("span",{key:"info"},"\xA0 ",F()("dashboard",a.dashboards.length,!0))):(c="exclamation-triangle",r.push(e.createElement("span",{key:"info"},"\xA0 No dashboards found")))):s?r.push(a.dashboards.length>1?e.createElement("span",{key:"info"},"Multiple items found: $",a.value):e.createElement("span",{key:"info"},s.name??a.value)):(c="exclamation-triangle",r.push(e.createElement("span",{key:"info"},"\xA0 Not found: ",a.value))):r.push(e.createElement(N.$,{key:"spinner"})),e.createElement(e.Fragment,null,e.createElement(B.J,{name:c,className:i.rightMargin,key:"icon"}),r)};return e.createElement(e.Fragment,null,d.map((a,c)=>e.createElement(E._l,{key:`${c}/${a.value}`,draggableId:`${c}`,index:c},r=>e.createElement("div",{className:i.row,ref:r.innerRef,...r.draggableProps,...r.dragHandleProps,role:"row"},e.createElement("div",{className:i.actions,role:"cell","aria-label":`Playlist item, ${a.type}, ${a.value}`},y(a)),e.createElement("div",{className:i.actions},e.createElement(R.h,{name:"times",size:"md",onClick:()=>n(c),"data-testid":p.wl.pages.PlaylistForm.itemDelete,tooltip:(0,l.t)("playlist-edit.form.table-delete","Delete playlist item")}),e.createElement(B.J,{title:(0,l.t)("playlist-edit.form.table-drag","Drag and drop to reorder"),name:"draggabledots",size:"md"}))))))};function W(d){return{row:(0,g.css)`
      padding: 6px;
      background: ${d.colors.background.secondary};
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 3px;

      border: 1px solid ${d.colors.border.medium};
      &:hover {
        border: 1px solid ${d.colors.border.strong};
      }
    `,rightMargin:(0,g.css)`
      margin-right: 5px;
    `,actions:(0,g.css)`
      align-items: center;
      justify-content: center;
      display: flex;
    `,settings:(0,g.css)`
      label: settings;
      text-align: right;
    `}}const z=({items:d,deleteItem:n,moveItem:i})=>{const y=a=>{a.destination&&i(a.source.index,a.destination?.index)};return e.createElement(I.C,{label:(0,l.t)("playlist-edit.form.table-heading","Dashboards")},e.createElement(E.Z5,{onDragEnd:y},e.createElement(E.bK,{droppableId:"playlist-list",direction:"vertical"},a=>e.createElement("div",{ref:a.innerRef,...a.droppableProps},e.createElement($,{items:d,onDelete:n}),a.placeholder))))};var j=t(59326),H=t(81039);function J(d){const[n,i]=(0,e.useState)(d??[]);(0,j.Z)(async()=>{for(const s of n)if(!s.dashboards){i(await(0,H.jc)(n));return}},[n]);const y=(0,e.useCallback)(s=>{s&&i([...n,{type:"dashboard_by_uid",value:s.uid}])},[n]),a=(0,e.useCallback)(s=>{const o=s[0];if(!o||n.find(v=>v.value===o))return;const u={type:"dashboard_by_tag",value:o};i([...n,u])},[n]),c=(0,e.useCallback)((s,o)=>{if(s===o||!n[s])return;const u=Array.from(n),[v]=u.splice(s,1);u.splice(o,0,v),i(u)},[n]),r=(0,e.useCallback)(s=>{const o=n.slice();o.splice(s,1),i(o)},[n]);return{items:n,addByUID:y,addByTag:a,deleteItem:r,moveItem:c}}const V=({onSubmit:d,playlist:n})=>{const[i,y]=(0,e.useState)(!1),{name:a,interval:c,items:r}=n,s=(0,e.useMemo)(()=>()=>(0,x.getGrafanaSearcher)().tags({kind:["dashboard"]}),[]),{items:o,addByUID:u,addByTag:v,deleteItem:Z,moveItem:G}=J(r),Q=T=>{y(!0),d({...T,items:o,uid:n.uid})};return e.createElement("div",null,e.createElement(b.l,{onSubmit:Q,validateOn:"onBlur"},({register:T,errors:f})=>{const X=o.length===0||Object.keys(f).length>0;return e.createElement(e.Fragment,null,e.createElement(m.g,{label:(0,l.t)("playlist-edit.form.name-label","Name"),invalid:!!f.name,error:f?.name?.message},e.createElement(P.I,{type:"text",...T("name",{required:(0,l.t)("playlist-edit.form.name-required","Name is required")}),placeholder:(0,l.t)("playlist-edit.form.name-placeholder","Name"),defaultValue:a,"aria-label":p.wl.pages.PlaylistForm.name})),e.createElement(m.g,{label:(0,l.t)("playlist-edit.form.interval-label","Interval"),invalid:!!f.interval,error:f?.interval?.message},e.createElement(P.I,{type:"text",...T("interval",{required:(0,l.t)("playlist-edit.form.interval-required","Interval is required")}),placeholder:(0,l.t)("playlist-edit.form.interval-placeholder","5m"),defaultValue:c??"5m","aria-label":p.wl.pages.PlaylistForm.interval})),e.createElement(z,{items:o,deleteItem:Z,moveItem:G}),e.createElement(I.C,{label:(0,l.t)("playlist-edit.form.heading","Add dashboards")},e.createElement(m.g,{label:(0,l.t)("playlist-edit.form.add-title-label","Add by title")},e.createElement(A.o,{id:"dashboard-picker",onChange:u,key:o.length})),e.createElement(m.g,{label:(0,l.t)("playlist-edit.form.add-tag-label","Add by tag")},e.createElement(O.D,{isClearable:!0,tags:[],hideValues:!0,tagOptions:s,onChange:v,placeholder:(0,l.t)("playlist-edit.form.add-tag-placeholder","Select a tag")}))),e.createElement(C.Lh,null,e.createElement(D.zx,{type:"submit",variant:"primary",disabled:X,icon:i?"spinner":void 0},e.createElement(l.cC,{i18nKey:"playlist-edit.form.save"},"Save")),e.createElement(D.Qj,{variant:"secondary",href:`${M.config.appSubUrl}/playlists`},e.createElement(l.cC,{i18nKey:"playlist-edit.form.cancel"},"Cancel"))))}))}}}]);

//# sourceMappingURL=PlaylistEditPage.c3346f750008d34ec13d.js.map