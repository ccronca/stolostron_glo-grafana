"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9782],{27031:(Jt,Me,c)=>{c.d(Me,{D:()=>G,o:()=>N});var d=c(63908),e=c(53166);function G(oe){switch(oe){case d.sN.Logfmt:return{label:(0,e.t)("correlations.trans-details.logfmt-label","Logfmt"),value:d.sN.Logfmt,description:(0,e.t)("correlations.trans-details.logfmt-description","Parse provided field with logfmt to get variables"),expressionDetails:{show:!1},mapValueDetails:{show:!1}};case d.sN.Regex:return{label:(0,e.t)("correlations.trans-details.regex-label","Regular expression"),value:d.sN.Regex,description:(0,e.t)("correlations.trans-details.regex-description","Field will be parsed with regex. Use named capture groups to return multiple variables, or a single unnamed capture group to add variable to named map value. Regex is case insensitive."),expressionDetails:{show:!0,required:!0,helpText:(0,e.t)("correlations.trans-details.regex-expression","Use capture groups to extract a portion of the field.")},mapValueDetails:{show:!0,required:!1,helpText:(0,e.t)("correlations.trans-details.regex-map-values","Defines the name of the variable if the capture group is not named.")}};default:return{label:oe,value:oe,expressionDetails:{show:!1},mapValueDetails:{show:!1}}}}const N=()=>Object.values(d.sN).map(oe=>{const Fe=G(oe);return{label:Fe.label,value:Fe.value,description:Fe.description}})},3564:(Jt,Me,c)=>{c.r(Me),c.d(Me,{default:()=>wi});var d=c(76932),e=c(31733),G=c(85498),N=c(76067),oe=c(8310),Fe=c(26635),je=c(79999),Xt=c(63082),O=c(42342),_n=c(97890),ot=c(86319),eo=function(t,o){t===void 0&&(t=!0);var n=(0,e.useCallback)(function(s){var a=typeof t=="function"?t():!0;if(a)return s.preventDefault(),o&&(s.returnValue=o),o},[t,o]);(0,e.useEffect)(function(){if(t)return(0,ot.on)(window,"beforeunload",n),function(){return(0,ot.S1)(window,"beforeunload",n)}},[t,n])};const _t=eo;var to=c(19367),wt=c(77081),H=c(64704),no=c(79106),me=c(58037),he=c(49311),V=c(51343),Pe=c(5572);const oo=({onSave:t,onDiscard:o,onCancel:n,message:s})=>e.createElement(Pe.u,{isOpen:!0,title:"Unsaved changes to correlation",onDismiss:n,icon:"exclamation-triangle",className:(0,d.css)({width:"600px"})},e.createElement("h5",null,s),e.createElement(Pe.u.ButtonRow,null,e.createElement(V.zx,{variant:"secondary",onClick:n,fill:"outline"},"Cancel"),e.createElement(V.zx,{variant:"destructive",onClick:o},"Continue without saving"),e.createElement(V.zx,{variant:"primary",onClick:t},"Save correlation")));var ie=c(69781),so=(t=>(t.SOURCE_TARGET_CHANGE="cause the query in the right pane to be re-ran and links added to that data",t.FULL_QUERY_LOSS="lose the changed query",t.FULL_CORR_LOSS="cause the correlation in progress to be lost",t.INVALID_VAR="remove the variables, and your changed query may no longer be valid",t))(so||{});const ao=(t,o,n,s)=>{const a=(0,ie.template)("<%= actionStr %> will <%= consequenceStr %>. Would you like to save before continuing?");let r="",i="";if(t===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE)if(r="Closing the pane",o)if(n)i="cause the correlation in progress to be lost";else if(s)i="cause the query in the right pane to be re-ran and links added to that data";else return;else if(n)i="cause the correlation in progress to be lost";else if(s)i="lose the changed query";else return;else if(t===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE)if(r="Changing the datasource",o)if(n)i="cause the correlation in progress to be lost";else return;else if(s)i="lose the changed query";else return;else if(t===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR)if(r="Closing the editor",n)i="cause the correlation in progress to be lost";else if(s)i="remove the variables, and your changed query may no longer be valid";else return;return a({actionStr:r,consequenceStr:i})};var ro=c(30863),ke=c(36255),Ce=c(41655),U=c(15359),Q=c(93372),te=c(69856);const io=({panes:t})=>{const o=(0,O.useDispatch)(),n=(0,N.wW)(lo),s=(0,O.useSelector)(te.z7),a=(0,O.useSelector)(te.UP),[r,i]=(0,e.useState)(void 0);_t(s?.correlationDirty||!1,"Save correlation?"),_t(!s?.correlationDirty&&s?.queryEditorDirty||!1,"The query editor was changed. Save correlation before continuing?"),(0,e.useEffect)(()=>{if(s?.isExiting){const{correlationDirty:p,queryEditorDirty:g}=s;let f,y;s.postConfirmAction?(f=s.postConfirmAction.isActionLeft,y=s.postConfirmAction.action):(y=O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR,f=!1);const v=ao(y,f,p,g);if(v!==void 0)i(v);else if(y===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&s.postConfirmAction){const{exploreId:x,changeDatasourceUid:b}=s?.postConfirmAction;x&&b&&(o((0,ke.zU)({exploreId:x,datasource:b,options:{importQueries:!0}})),o((0,U.Hg)({isExiting:!1})))}else if(y===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE&&s.postConfirmAction){const{exploreId:x}=s?.postConfirmAction;x!==void 0&&(o((0,U.YV)(x)),o((0,U.Hg)({isExiting:!1})))}else y===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR&&o((0,U.Hg)({editorMode:!1}))}},[s,o,a]),(0,to.Z)(()=>{o((0,U.Hg)({editorMode:!1,isExiting:!1,correlationDirty:!1,label:void 0,description:void 0,canSave:!1})),t.forEach(p=>{o((0,Ce.Oj)({exploreId:p[0],correlationEditorHelperData:void 0})),o((0,Q.aA)({exploreId:p[0]}))})});const l=()=>{o((0,U.Hg)({editorMode:!0,isExiting:!1,correlationDirty:!1,label:void 0,description:void 0,canSave:!1})),t.forEach(p=>{o((0,Ce.Oj)({exploreId:p[0],correlationEditorHelperData:void 0})),o((0,Q.aA)({exploreId:p[0]}))})},u=p=>{i(void 0),o((0,U.YV)(p)),(0,H.ff)("grafana_explore_split_view_closed")},h=(p,g)=>{i(void 0),o((0,ke.zU)({exploreId:p,datasource:g,options:{importQueries:!0}}))},m=p=>{if(o((0,ro.Q)(s?.label,s?.description,s?.transformations)),!p&&s?.postConfirmAction!==void 0){const{exploreId:g,action:f,changeDatasourceUid:y}=s?.postConfirmAction;f===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE?(u(g),l()):f===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&y!==void 0&&((0,ke.zU)({exploreId:g,datasource:y}),l())}else o((0,U.Hg)({editorMode:!1,correlationDirty:!1,isExiting:!1}))};return e.createElement(e.Fragment,null,e.createElement(_n.NL,{message:p=>p.pathname!=="/explore"&&s?.editorMode&&s?.correlationDirty?"You have unsaved correlation data. Continue?":!0}),r!==void 0&&e.createElement(oo,{onDiscard:()=>{if(s?.postConfirmAction!==void 0){const{exploreId:p,action:g,changeDatasourceUid:f}=s?.postConfirmAction;g===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE?u(p):g===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&f!==void 0&&h(p,f),o((0,U.Hg)({isExiting:!1}))}else o((0,U.Hg)({editorMode:!1,correlationDirty:!1,isExiting:!1}))},onCancel:()=>{o((0,U.Hg)({isExiting:!1})),i(void 0)},onSave:()=>{m(!1)},message:r}),e.createElement("div",{className:n.correlationEditorTop},e.createElement(no.Lh,{spacing:"md",justify:"flex-end"},e.createElement(me.u,{content:"Correlations editor in Explore is an experimental feature."},e.createElement(he.J,{className:n.iconColor,name:"info-circle",size:"xl"})),e.createElement(V.zx,{variant:"secondary",disabled:!s?.canSave,fill:"outline",className:s?.canSave?n.buttonColor:n.disabledButtonColor,onClick:()=>{m(!0)}},"Save"),e.createElement(V.zx,{variant:"secondary",fill:"outline",className:n.buttonColor,icon:"times",onClick:()=>{o((0,U.Hg)({isExiting:!0})),(0,H.ff)("grafana_explore_correlation_editor_exit_pressed")}},"Exit correlation editor"))))},lo=t=>{const o=t.colors.getContrastText(t.colors.primary.main),n=wt.lighten(t.colors.primary.main,.1),s=wt.darken(t.colors.primary.main,.2),a=wt.darken(o,.2);return{correlationEditorTop:(0,d.css)({backgroundColor:t.colors.primary.main,marginTop:"3px",padding:t.spacing(1)}),iconColor:(0,d.css)({color:o}),buttonColor:(0,d.css)({color:o,borderColor:o,"&:hover":{color:o,borderColor:o,backgroundColor:n}}),disabledButtonColor:(0,d.css)({color:`${a} !important`,backgroundColor:`${s} !important`})}};var Rt=c(26093),st=c(56811),Tt=c(24608);const co=()=>{const[t,o]=(0,e.useState)([]),{query:n}=(0,Rt.useKBar)(),s=(0,O.useDispatch)(),a=(0,O.useSelector)(te.Ky),r=(0,O.useSelector)(te.pd),i=st.contextSrv.hasPermission(O.AccessControlAction.DataSourcesWrite);return(0,e.useEffect)(()=>{const l=Object.keys(a),u={name:"Explore",priority:Rt.Priority.HIGH+1},h=[];if(r)h.push({id:"explore/run-query-left",name:"Run query (left)",keywords:"query left",perform:()=>{s((0,Q.aA)({exploreId:l[0]}))},section:u}),a[1],h.push({id:"explore/run-query-right",name:"Run query (right)",keywords:"query right",perform:()=>{s((0,Q.aA)({exploreId:l[1]}))},section:u}),h.push({id:"explore/split-view-close-left",name:"Close split view left",keywords:"split",perform:()=>{s((0,U.YV)(l[0]))},section:u}),h.push({id:"explore/split-view-close-right",name:"Close split view right",keywords:"split",perform:()=>{s((0,U.YV)(l[1]))},section:u});else{const m=Object.values(a).some(p=>p?.datasourceInstance?.uid===Tt.D);G.config.featureToggles.correlations&&i&&!m&&h.push({id:"explore/correlations-editor",name:"Correlations editor",perform:()=>{s((0,U.Hg)({editorMode:!0})),s((0,Q.aA)({exploreId:l[0]}))},section:u}),h.push({id:"explore/run-query",name:"Run query",keywords:"query",perform:()=>{s((0,Q.aA)({exploreId:l[0]}))},section:u}),h.push({id:"explore/split-view-open",name:"Open split view",keywords:"split",perform:()=>{s((0,U.bW)())},section:u})}o(h)},[a,r,n,s,i]),(0,Rt.useRegisterActions)(n?t:[],[t,n]),null};var ge=c(55024),uo=c(83994),at=c(21568),rt=c(37758),Lt=c(82866),$e=c(90093),po=c(43741),Z=c(68387),K=c(20298),Be=c(66261),Ft=c(94319),it=c(94361),Ge=c(87649),ho=c(42618),lt=c(1066),en=c(83870),mo=c(61248),go=function(t){var o=(0,mo.Z)({x:0,y:0}),n=o[0],s=o[1];return(0,e.useEffect)(function(){var a=function(){t.current&&s({x:t.current.scrollLeft,y:t.current.scrollTop})};return t.current&&(0,ot.on)(t.current,"scroll",a,{capture:!1,passive:!0}),function(){t.current&&(0,ot.S1)(t.current,"scroll",a)}},[t]),n};const fo=go,tn=(0,e.createContext)(void 0),yo=({children:t})=>{const[o,n]=(0,e.useState)([]),s=(0,e.useCallback)(({title:r,icon:i,ref:l})=>{const u=(0,ie.uniqueId)(`${r}-${i}_`);return n(h=>[...h,{id:u,title:r,icon:i,ref:l}].sort((p,g)=>{if(p.ref&&g.ref){const f=p.ref.compareDocumentPosition(g.ref);if(f===Node.DOCUMENT_POSITION_PRECEDING)return 1;if(f===Node.DOCUMENT_POSITION_FOLLOWING)return-1}return 0})),u},[]),a=(0,e.useCallback)(r=>{n(i=>i.filter(l=>l.id!==r))},[]);return e.createElement(tn.Provider,{value:{outlineItems:o,register:s,unregister:a}},t)};function nn(){const t=(0,e.useContext)(tn);if(!t)throw new Error("useContentOutlineContext must be used within a ContentOutlineContextProvider");return t}var vo=c(7820);function on({title:t,icon:o,tooltip:n,className:s,isActive:a,...r}){const i=(0,N.wW)(Eo),l=(0,d.cx)(i.button,s),u=e.createElement("button",{className:(0,d.cx)(l,{[i.active]:a}),"aria-label":n,...r},bo(o),t);return n?e.createElement(me.u,{content:n,placement:"bottom"},u):u}function bo(t){return t?(0,vo.Mo)(t)?e.createElement(he.J,{name:t,size:"lg"}):t:null}const Eo=t=>({button:(0,d.css)({label:"content-outline-item-button",display:"flex",flexGrow:1,alignItems:"center",height:t.spacing(t.components.height.md),padding:t.spacing(0,1),gap:t.spacing(1),color:t.colors.text.secondary,background:"transparent",border:"none",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap","&:hover":{color:t.colors.text.primary,background:t.colors.background.secondary,textDecoration:"underline"}}),active:(0,d.css)({backgroundColor:t.colors.background.secondary,borderTopRightRadius:t.shape.radius.default,borderBottomRightRadius:t.shape.radius.default,position:"relative","&::before":{backgroundImage:t.colors.gradients.brandVertical,borderRadius:t.shape.radius.default,content:'" "',display:"block",height:"100%",position:"absolute",transform:"translateX(-50%)",width:t.spacing(.5),left:"2px"}})}),xo=t=>({wrapper:(0,d.css)({label:"wrapper",position:"relative",display:"flex",justifyContent:"center",marginRight:t.spacing(1),height:"100%",backgroundColor:t.colors.background.primary}),content:(0,d.css)({label:"content",top:0}),buttonStyles:(0,d.css)({textAlign:"left",width:"100%",padding:t.spacing(0,1.5)})});function So({scroller:t,panelId:o}){const{outlineItems:n}=nn(),[s,a]=(0,en.Z)(!1),[r,i]=(0,e.useState)(n[0]?.id),l=(0,N.wW)(g=>xo(g)),u=(0,e.useRef)(t||null),{y:h}=fo(u),m=(g,f)=>{let y=0,v=g;do y+=v?.offsetTop||0,v=v?.offsetParent;while(v&&v!==t);t?.scroll({top:y,behavior:"smooth"}),(0,H.ff)("explore_toolbar_contentoutline_clicked",{item:"select_section",type:f})},p=()=>{a(),(0,H.ff)("explore_toolbar_contentoutline_clicked",{item:"outline",type:s?"minimize":"expand"})};return(0,e.useEffect)(()=>{const g=n.find(f=>{const y=f?.ref?.getBoundingClientRect().top;return y?y>=0:!1});g&&i(g.id)},[n,h]),e.createElement(Ft.l,{className:l.wrapper,id:o},e.createElement(rt.$,null,e.createElement("div",{className:l.content},e.createElement(on,{title:s?"Collapse outline":void 0,icon:s?"angle-left":"angle-right",onClick:p,tooltip:s?void 0:"Expand content outline",className:l.buttonStyles,"aria-expanded":s}),n.map(g=>e.createElement(on,{key:g.id,title:s?g.title:void 0,className:l.buttonStyles,icon:g.icon,onClick:()=>m(g.ref,g.title),tooltip:s?void 0:g.title,isActive:r===g.id})))))}function fe({title:t,icon:o,children:n,className:s}){const{register:a,unregister:r}=nn(),i=(0,e.useRef)(null);return(0,e.useEffect)(()=>{const l=a({title:t,icon:o,ref:i.current});return()=>r(l)},[t,o,a,r]),e.createElement("div",{className:s,ref:i},n)}var sn=c(54126),It=c(59326),Ze=c(25111),ct=c(27218),Ke=c(37739),we=c(85765),Ye=c(64516),ut=c(96305),We=c(41354),Co=c(94719),Ot=c(38159),wo=c(33242),Ro=c(82732),To=c.n(Ro),Lo=c(36667),an=c(32901),Ie=c(38834),Dt=c(27031);const rn=({label:t,tooltipText:o})=>e.createElement(Ke.K,{gap:1,direction:"row",wrap:"wrap",alignItems:"flex-start"},e.createElement(Lo._,null,t),e.createElement(me.u,{content:o},e.createElement(he.J,{name:"info-circle",size:"sm"}))),Fo=({onSave:t,onCancel:o,fieldList:n,transformationToEdit:s})=>{const[a,r]=(0,e.useState)(void 0),[i,l]=(0,e.useState)({}),[u,h]=(0,e.useState)({mapValueDetails:{show:!1},expressionDetails:{show:!1}}),[m,p]=(0,e.useState)(!1),[g,f]=(0,e.useState)(!1),{getValues:y,control:v,register:x,watch:b}=(0,sn.cI)({defaultValues:(0,e.useMemo)(()=>{if(s){const F=n[s?.field];r(F),s?.expression&&p(!0);const T=(0,Dt.D)(s?.type);h({mapValueDetails:T.mapValueDetails,expressionDetails:T.expressionDetails});const L=(0,Ot.Y)({type:s?.type,expression:s?.expression,mapValue:s?.mapValue},F||"",s?.field);return l({...L}),f(!0),{type:s?.type,field:s?.field,mapValue:s?.mapValue,expression:s?.expression}}else return},[n,s])}),C=(0,e.useId)();return(0,e.useEffect)(()=>{const F=b(T=>{const L=T.expression;let I=!1;if(L!==void 0){I=!0;try{new RegExp(L)}catch{I=!1}}else I=!u.expressionDetails.show;p(I);let P=[];if(T.type){const M=(0,Ot.Y)({type:T.type,expression:I?L:"",mapValue:T.mapValue},n[T.field]||"",T.field);P=Object.keys(M),l(P.length>0?{...M}:{})}P.length===0||!I?f(!1):f(!0)});return()=>F.unsubscribe()},[n,u.expressionDetails.show,b]),e.createElement(Pe.u,{isOpen:!0,title:`${s?"Edit":"Add"} transformation`,onDismiss:o,className:(0,d.css)({width:"700px"})},e.createElement("p",null,"A transformation extracts variables out of a single field. These variables will be available along with your field variables."),e.createElement(we.g,{label:"Field"},e.createElement(an.g,{control:v,render:({field:{onChange:F,ref:T,...L}})=>e.createElement(Ie.Ph,{...L,onChange:I=>{I.value&&(F(I.value),r(n[I.value]))},options:Object.entries(n).map(I=>({label:I[0],value:I[0]})),"aria-label":"field"}),name:"field"})),a&&e.createElement(e.Fragment,null,e.createElement("pre",null,e.createElement(To(),{textToHighlight:a,searchWords:[m?y("expression")??"":""],autoEscape:!1})),e.createElement(we.g,{label:"Type"},e.createElement(an.g,{control:v,render:({field:{onChange:F,ref:T,...L}})=>e.createElement(Ie.Ph,{...L,onChange:I=>{F(I.value);const P=(0,Dt.D)(I.value);h({mapValueDetails:P.mapValueDetails,expressionDetails:P.expressionDetails})},options:(0,Dt.o)(),"aria-label":"type"}),name:"type"})),u.expressionDetails.show&&e.createElement(we.g,{label:u.expressionDetails.helpText?e.createElement(rn,{label:"Expression",tooltipText:u.expressionDetails.helpText}):"Expression",htmlFor:`${C}-expression`,required:u.expressionDetails.required},e.createElement(Ye.I,{...x("expression"),id:`${C}-expression`})),u.mapValueDetails.show&&e.createElement(we.g,{label:u.mapValueDetails.helpText?e.createElement(rn,{label:"Variable Name",tooltipText:u.mapValueDetails.helpText}):"Variable Name",htmlFor:`${C}-mapValue`},e.createElement(Ye.I,{...x("mapValue"),id:`${C}-mapValue`})),Object.entries(i).length>0&&e.createElement(e.Fragment,null,"This transformation will add the following variables:",e.createElement("pre",null,Object.entries(i).map(F=>`\${${F[0]}} = ${F[1]?.value}
`)))),e.createElement(Pe.u.ButtonRow,null,e.createElement(V.zx,{variant:"secondary",onClick:o,fill:"outline"},"Cancel"),e.createElement(V.zx,{variant:"primary",onClick:()=>t(y()),disabled:!g},s?"Edit transformation":"Add transformation to correlation")))},Io=({exploreId:t,correlations:o})=>{const n=(0,O.useDispatch)(),s=(0,N.wW)(Oo),a=(0,O.useSelector)(te.Ky),r=Object.values(a),{value:i,loading:l}=(0,It.Z)(async()=>await(0,wo.eo)(r[0],r[1]),[r[0]?.datasourceInstance,r[0]?.queries[0].datasource,r[1]?.datasourceInstance,r[1]?.queries[0].datasource]),{register:u,watch:h,getValues:m,setValue:p}=(0,sn.cI)(),[g,f]=(0,e.useState)(!1),[y,v]=(0,e.useState)(!1),[x,b]=(0,e.useState)(!1),[C,F]=(0,e.useState)([]),[T,L]=(0,e.useState)(void 0),I=(0,O.useSelector)(te.z7),P=(0,e.useId)();return(0,e.useEffect)(()=>(n((0,U.Hg)({canSave:!0})),()=>{n((0,U.Hg)({canSave:!1}))}),[n]),(0,e.useEffect)(()=>{!l&&i!==void 0&&!I?.correlationDirty&&m("label")!==""&&p("label",i)},[I?.correlationDirty,i,m,l,p]),(0,e.useEffect)(()=>{const M=h(z=>{let A=I?.correlationDirty||!1,R=z.description||"";!A&&(z.label!==i||R!=="")?A=!0:A&&z.label===i&&R.trim()===""&&(A=!1),n((0,U.Hg)({label:z.label,description:z.description,correlationDirty:A}))});return()=>M.unsubscribe()},[I?.correlationDirty,i,n,h]),(0,e.useEffect)(()=>{const M=!I?.correlationDirty&&C.length>0?!0:I?.correlationDirty;n((0,U.Hg)({transformations:C,correlationDirty:M}));let z={};C.forEach(A=>{const R=(0,Ot.Y)({type:A.type,expression:A.expression,mapValue:A.mapValue},o.vars[A.field],A.field);Object.keys(R).forEach(D=>{z[D]=R[D]?.value})}),n((0,Ce.Oj)({exploreId:t,correlationEditorHelperData:{resultField:o.resultField,origVars:o.origVars,vars:{...o.origVars,...z}}}))},[n,C]),e.createElement(e.Fragment,null,x&&e.createElement(Fo,{onCancel:()=>{L(void 0),b(!1)},onSave:M=>{if(T!==void 0){const z=[...C];z[T]=M,F(z),L(void 0)}else F([...C,M]);b(!1)},fieldList:o.origVars,transformationToEdit:T!==void 0?C[T]:void 0}),e.createElement(Ze.b,{title:"Correlation details",severity:"info"},"The correlation link will appear by the ",e.createElement("code",null,o.resultField)," field. You can use the following variables to set up your correlations:",e.createElement("pre",null,Object.entries(o.vars).map(M=>`\${${M[0]}} = ${M[1]}
`)),e.createElement(ct.U,{collapsible:!0,isOpen:g,onToggle:()=>{f(!g)},label:e.createElement(Ke.K,{gap:1,direction:"row",wrap:"wrap",alignItems:"center"},"Label / Description",!g&&!l&&e.createElement("span",{className:s.labelCollapseDetails},`Label: ${m("label")||i}`))},e.createElement(we.g,{label:"Label",htmlFor:`${P}-label`},e.createElement(Ye.I,{...u("label"),id:`${P}-label`,onBlur:()=>{m("label")===""&&i!==void 0&&p("label",i)}})),e.createElement(we.g,{label:"Description",htmlFor:`${P}-description`},e.createElement(Ye.I,{...u("description"),id:`${P}-description`}))),e.createElement(ct.U,{collapsible:!0,isOpen:y,onToggle:()=>{v(!y)},label:e.createElement(Ke.K,{gap:1,direction:"row",wrap:"wrap",alignItems:"center"},"Transformations",e.createElement(me.u,{content:"A transformation extracts one or more variables out of a single field."},e.createElement(he.J,{name:"info-circle",size:"sm"})))},e.createElement(V.zx,{variant:"secondary",fill:"outline",onClick:()=>{b(!0)},className:s.transformationAction},"Add transformation"),C.map((M,z)=>{const{type:A,field:R,expression:D,mapValue:w}=M,S=[(w??"").length>0?`Variable name: ${w}`:void 0,(D??"").length>0?e.createElement(e.Fragment,null,"Expression: ",e.createElement("code",null,D)):void 0].filter(k=>k);return e.createElement(ut.Z,{key:`trans-${z}`},e.createElement(ut.Z.Heading,null,R,": ",A),S.length>0&&e.createElement(ut.Z.Meta,{className:s.transformationMeta},S),e.createElement(ut.Z.SecondaryActions,null,e.createElement(We.h,{key:"edit",name:"edit","aria-label":"edit transformation",onClick:()=>{L(z),b(!0)}}),e.createElement(Co.m,{"aria-label":"delete transformation",onConfirm:()=>F(C.filter((k,_)=>z!==_)),closeOnConfirm:!0})))}))))},Oo=t=>({labelCollapseDetails:(0,d.css)({marginLeft:t.spacing(2),...t.typography.bodySmall,fontStyle:"italic"}),transformationAction:(0,d.css)({marginBottom:t.spacing(2)}),transformationMeta:(0,d.css)({alignItems:"baseline"})});var ye=c(74011),Do=c(31524),No=c(43348),Re=c(48011),zo=c(33521),Ao=c(9985);function Ho({width:t,height:o,timeZone:n,state:s,pluginId:a,frames:r,absoluteRange:i,splitOpenFn:l,eventBus:u}){const h=(0,e.useMemo)(()=>({from:(0,ye.CQ)(i.from),to:(0,ye.CQ)(i.to),raw:{from:(0,ye.CQ)(i.from),to:(0,ye.CQ)(i.to)}}),[i.from,i.to]),m=(0,zo.pv)(a),g={dataLinkPostProcessor:(0,Ao.v)(l,h),eventBus:u,eventsScope:"explore"};return e.createElement(No._w,{value:g},e.createElement(Re.fm,{title:m.name,width:t,height:o,loadingState:s},(f,y)=>e.createElement(Do.$,{data:{series:r,state:s,timeRange:h},pluginId:a,title:"",width:f,height:y,timeZone:n})))}var Ve=c(44343),j=c(71199),ln=c(70098),Mo=c(45607),Po=function(){var t=function(o,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(s[r]=a[r])},t(o,n)};return function(o,n){t(o,n);function s(){this.constructor=o}o.prototype=n===null?Object.create(n):(s.prototype=n.prototype,new s)}}(),se=function(){return se=Object.assign||function(t){for(var o,n=1,s=arguments.length;n<s;n++){o=arguments[n];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a])}return t},se.apply(this,arguments)},cn={width:"100%",height:"10px",top:"0px",left:"0px",cursor:"row-resize"},un={width:"10px",height:"100%",top:"0px",left:"0px",cursor:"col-resize"},dt={width:"20px",height:"20px",position:"absolute"},ko={top:se(se({},cn),{top:"-5px"}),right:se(se({},un),{left:void 0,right:"-5px"}),bottom:se(se({},cn),{top:void 0,bottom:"-5px"}),left:se(se({},un),{left:"-5px"}),topRight:se(se({},dt),{right:"-10px",top:"-10px",cursor:"ne-resize"}),bottomRight:se(se({},dt),{right:"-10px",bottom:"-10px",cursor:"se-resize"}),bottomLeft:se(se({},dt),{left:"-10px",bottom:"-10px",cursor:"sw-resize"}),topLeft:se(se({},dt),{left:"-10px",top:"-10px",cursor:"nw-resize"})},$o=function(t){Po(o,t);function o(){var n=t!==null&&t.apply(this,arguments)||this;return n.onMouseDown=function(s){n.props.onResizeStart(s,n.props.direction)},n.onTouchStart=function(s){n.props.onResizeStart(s,n.props.direction)},n}return o.prototype.render=function(){return e.createElement("div",{className:this.props.className||"",style:se(se({position:"absolute",userSelect:"none"},ko[this.props.direction]),this.props.replaceStyles||{}),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart},this.props.children)},o}(e.PureComponent),Bo=function(){var t=function(o,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(s[r]=a[r])},t(o,n)};return function(o,n){t(o,n);function s(){this.constructor=o}o.prototype=n===null?Object.create(n):(s.prototype=n.prototype,new s)}}(),ve=function(){return ve=Object.assign||function(t){for(var o,n=1,s=arguments.length;n<s;n++){o=arguments[n];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a])}return t},ve.apply(this,arguments)},Wo={width:"auto",height:"auto"},pt=function(t,o,n){return Math.max(Math.min(t,n),o)},dn=function(t,o){return Math.round(t/o)*o},Ue=function(t,o){return new RegExp(t,"i").test(o)},ht=function(t){return!!(t.touches&&t.touches.length)},Vo=function(t){return!!((t.clientX||t.clientX===0)&&(t.clientY||t.clientY===0))},pn=function(t,o,n){n===void 0&&(n=0);var s=o.reduce(function(r,i,l){return Math.abs(i-t)<Math.abs(o[r]-t)?l:r},0),a=Math.abs(o[s]-t);return n===0||a<n?o[s]:t},Nt=function(t){return t=t.toString(),t==="auto"||t.endsWith("px")||t.endsWith("%")||t.endsWith("vh")||t.endsWith("vw")||t.endsWith("vmax")||t.endsWith("vmin")?t:t+"px"},mt=function(t,o,n,s){if(t&&typeof t=="string"){if(t.endsWith("px"))return Number(t.replace("px",""));if(t.endsWith("%")){var a=Number(t.replace("%",""))/100;return o*a}if(t.endsWith("vw")){var a=Number(t.replace("vw",""))/100;return n*a}if(t.endsWith("vh")){var a=Number(t.replace("vh",""))/100;return s*a}}return t},Uo=function(t,o,n,s,a,r,i){return s=mt(s,t.width,o,n),a=mt(a,t.height,o,n),r=mt(r,t.width,o,n),i=mt(i,t.height,o,n),{maxWidth:typeof s>"u"?void 0:Number(s),maxHeight:typeof a>"u"?void 0:Number(a),minWidth:typeof r>"u"?void 0:Number(r),minHeight:typeof i>"u"?void 0:Number(i)}},Qo=["as","style","className","grid","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],hn="__resizable_base__",jo=function(t){Bo(o,t);function o(n){var s=t.call(this,n)||this;return s.ratio=1,s.resizable=null,s.parentLeft=0,s.parentTop=0,s.resizableLeft=0,s.resizableRight=0,s.resizableTop=0,s.resizableBottom=0,s.targetLeft=0,s.targetTop=0,s.appendBase=function(){if(!s.resizable||!s.window)return null;var a=s.parentNode;if(!a)return null;var r=s.window.document.createElement("div");return r.style.width="100%",r.style.height="100%",r.style.position="absolute",r.style.transform="scale(0, 0)",r.style.left="0",r.style.flex="0 0 100%",r.classList?r.classList.add(hn):r.className+=hn,a.appendChild(r),r},s.removeBase=function(a){var r=s.parentNode;r&&r.removeChild(a)},s.ref=function(a){a&&(s.resizable=a)},s.state={isResizing:!1,width:typeof(s.propsSize&&s.propsSize.width)>"u"?"auto":s.propsSize&&s.propsSize.width,height:typeof(s.propsSize&&s.propsSize.height)>"u"?"auto":s.propsSize&&s.propsSize.height,direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},s.onResizeStart=s.onResizeStart.bind(s),s.onMouseMove=s.onMouseMove.bind(s),s.onMouseUp=s.onMouseUp.bind(s),s}return Object.defineProperty(o.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"window",{get:function(){return!this.resizable||!this.resizable.ownerDocument?null:this.resizable.ownerDocument.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||Wo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"size",{get:function(){var n=0,s=0;if(this.resizable&&this.window){var a=this.resizable.offsetWidth,r=this.resizable.offsetHeight,i=this.resizable.style.position;i!=="relative"&&(this.resizable.style.position="relative"),n=this.resizable.style.width!=="auto"?this.resizable.offsetWidth:a,s=this.resizable.style.height!=="auto"?this.resizable.offsetHeight:r,this.resizable.style.position=i}return{width:n,height:s}},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"sizeStyle",{get:function(){var n=this,s=this.props.size,a=function(l){if(typeof n.state[l]>"u"||n.state[l]==="auto")return"auto";if(n.propsSize&&n.propsSize[l]&&n.propsSize[l].toString().endsWith("%")){if(n.state[l].toString().endsWith("%"))return n.state[l].toString();var u=n.getParentSize(),h=Number(n.state[l].toString().replace("px","")),m=h/u[l]*100;return m+"%"}return Nt(n.state[l])},r=s&&typeof s.width<"u"&&!this.state.isResizing?Nt(s.width):a("width"),i=s&&typeof s.height<"u"&&!this.state.isResizing?Nt(s.height):a("height");return{width:r,height:i}},enumerable:!1,configurable:!0}),o.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var n=this.appendBase();if(!n)return{width:0,height:0};var s=!1,a=this.parentNode.style.flexWrap;a!=="wrap"&&(s=!0,this.parentNode.style.flexWrap="wrap"),n.style.position="relative",n.style.minWidth="100%",n.style.minHeight="100%";var r={width:n.offsetWidth,height:n.offsetHeight};return s&&(this.parentNode.style.flexWrap=a),this.removeBase(n),r},o.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},o.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},o.prototype.componentDidMount=function(){if(!(!this.resizable||!this.window)){var n=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:n.flexBasis!=="auto"?n.flexBasis:void 0})}},o.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},o.prototype.createSizeForCssProperty=function(n,s){var a=this.propsSize&&this.propsSize[s];return this.state[s]==="auto"&&this.state.original[s]===n&&(typeof a>"u"||a==="auto")?"auto":n},o.prototype.calculateNewMaxFromBoundary=function(n,s){var a=this.props.boundsByDirection,r=this.state.direction,i=a&&Ue("left",r),l=a&&Ue("top",r),u,h;if(this.props.bounds==="parent"){var m=this.parentNode;m&&(u=i?this.resizableRight-this.parentLeft:m.offsetWidth+(this.parentLeft-this.resizableLeft),h=l?this.resizableBottom-this.parentTop:m.offsetHeight+(this.parentTop-this.resizableTop))}else this.props.bounds==="window"?this.window&&(u=i?this.resizableRight:this.window.innerWidth-this.resizableLeft,h=l?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(u=i?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),h=l?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return u&&Number.isFinite(u)&&(n=n&&n<u?n:u),h&&Number.isFinite(h)&&(s=s&&s<h?s:h),{maxWidth:n,maxHeight:s}},o.prototype.calculateNewSizeFromDirection=function(n,s){var a=this.props.scale||1,r=this.props.resizeRatio||1,i=this.state,l=i.direction,u=i.original,h=this.props,m=h.lockAspectRatio,p=h.lockAspectRatioExtraHeight,g=h.lockAspectRatioExtraWidth,f=u.width,y=u.height,v=p||0,x=g||0;return Ue("right",l)&&(f=u.width+(n-u.x)*r/a,m&&(y=(f-x)/this.ratio+v)),Ue("left",l)&&(f=u.width-(n-u.x)*r/a,m&&(y=(f-x)/this.ratio+v)),Ue("bottom",l)&&(y=u.height+(s-u.y)*r/a,m&&(f=(y-v)*this.ratio+x)),Ue("top",l)&&(y=u.height-(s-u.y)*r/a,m&&(f=(y-v)*this.ratio+x)),{newWidth:f,newHeight:y}},o.prototype.calculateNewSizeFromAspectRatio=function(n,s,a,r){var i=this.props,l=i.lockAspectRatio,u=i.lockAspectRatioExtraHeight,h=i.lockAspectRatioExtraWidth,m=typeof r.width>"u"?10:r.width,p=typeof a.width>"u"||a.width<0?n:a.width,g=typeof r.height>"u"?10:r.height,f=typeof a.height>"u"||a.height<0?s:a.height,y=u||0,v=h||0;if(l){var x=(g-y)*this.ratio+v,b=(f-y)*this.ratio+v,C=(m-v)/this.ratio+y,F=(p-v)/this.ratio+y,T=Math.max(m,x),L=Math.min(p,b),I=Math.max(g,C),P=Math.min(f,F);n=pt(n,T,L),s=pt(s,I,P)}else n=pt(n,m,p),s=pt(s,g,f);return{newWidth:n,newHeight:s}},o.prototype.setBoundingClientRect=function(){if(this.props.bounds==="parent"){var n=this.parentNode;if(n){var s=n.getBoundingClientRect();this.parentLeft=s.left,this.parentTop=s.top}}if(this.props.bounds&&typeof this.props.bounds!="string"){var a=this.props.bounds.getBoundingClientRect();this.targetLeft=a.left,this.targetTop=a.top}if(this.resizable){var r=this.resizable.getBoundingClientRect(),i=r.left,l=r.top,u=r.right,h=r.bottom;this.resizableLeft=i,this.resizableRight=u,this.resizableTop=l,this.resizableBottom=h}},o.prototype.onResizeStart=function(n,s){if(!(!this.resizable||!this.window)){var a=0,r=0;if(n.nativeEvent&&Vo(n.nativeEvent)?(a=n.nativeEvent.clientX,r=n.nativeEvent.clientY):n.nativeEvent&&ht(n.nativeEvent)&&(a=n.nativeEvent.touches[0].clientX,r=n.nativeEvent.touches[0].clientY),this.props.onResizeStart&&this.resizable){var i=this.props.onResizeStart(n,s,this.resizable);if(i===!1)return}this.props.size&&(typeof this.props.size.height<"u"&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),typeof this.props.size.width<"u"&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio=typeof this.props.lockAspectRatio=="number"?this.props.lockAspectRatio:this.size.width/this.size.height;var l,u=this.window.getComputedStyle(this.resizable);if(u.flexBasis!=="auto"){var h=this.parentNode;if(h){var m=this.window.getComputedStyle(h).flexDirection;this.flexDir=m.startsWith("row")?"row":"column",l=u.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var p={original:{x:a,y:r,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:ve(ve({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(n.target).cursor||"auto"}),direction:s,flexBasis:l};this.setState(p)}},o.prototype.onMouseMove=function(n){var s=this;if(!(!this.state.isResizing||!this.resizable||!this.window)){if(this.window.TouchEvent&&ht(n))try{n.preventDefault(),n.stopPropagation()}catch{}var a=this.props,r=a.maxWidth,i=a.maxHeight,l=a.minWidth,u=a.minHeight,h=ht(n)?n.touches[0].clientX:n.clientX,m=ht(n)?n.touches[0].clientY:n.clientY,p=this.state,g=p.direction,f=p.original,y=p.width,v=p.height,x=this.getParentSize(),b=Uo(x,this.window.innerWidth,this.window.innerHeight,r,i,l,u);r=b.maxWidth,i=b.maxHeight,l=b.minWidth,u=b.minHeight;var C=this.calculateNewSizeFromDirection(h,m),F=C.newHeight,T=C.newWidth,L=this.calculateNewMaxFromBoundary(r,i);this.props.snap&&this.props.snap.x&&(T=pn(T,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(F=pn(F,this.props.snap.y,this.props.snapGap));var I=this.calculateNewSizeFromAspectRatio(T,F,{width:L.maxWidth,height:L.maxHeight},{width:l,height:u});if(T=I.newWidth,F=I.newHeight,this.props.grid){var P=dn(T,this.props.grid[0]),M=dn(F,this.props.grid[1]),z=this.props.snapGap||0;T=z===0||Math.abs(P-T)<=z?P:T,F=z===0||Math.abs(M-F)<=z?M:F}var A={width:T-f.width,height:F-f.height};if(y&&typeof y=="string"){if(y.endsWith("%")){var R=T/x.width*100;T=R+"%"}else if(y.endsWith("vw")){var D=T/this.window.innerWidth*100;T=D+"vw"}else if(y.endsWith("vh")){var w=T/this.window.innerHeight*100;T=w+"vh"}}if(v&&typeof v=="string"){if(v.endsWith("%")){var R=F/x.height*100;F=R+"%"}else if(v.endsWith("vw")){var D=F/this.window.innerWidth*100;F=D+"vw"}else if(v.endsWith("vh")){var w=F/this.window.innerHeight*100;F=w+"vh"}}var S={width:this.createSizeForCssProperty(T,"width"),height:this.createSizeForCssProperty(F,"height")};this.flexDir==="row"?S.flexBasis=S.width:this.flexDir==="column"&&(S.flexBasis=S.height),(0,Mo.flushSync)(function(){s.setState(S)}),this.props.onResize&&this.props.onResize(n,g,this.resizable,A)}},o.prototype.onMouseUp=function(n){var s=this.state,a=s.isResizing,r=s.direction,i=s.original;if(!(!a||!this.resizable)){var l={width:this.size.width-i.width,height:this.size.height-i.height};this.props.onResizeStop&&this.props.onResizeStop(n,r,this.resizable,l),this.props.size&&this.setState(this.props.size),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:ve(ve({},this.state.backgroundStyle),{cursor:"auto"})})}},o.prototype.updateSize=function(n){this.setState({width:n.width,height:n.height})},o.prototype.renderResizer=function(){var n=this,s=this.props,a=s.enable,r=s.handleStyles,i=s.handleClasses,l=s.handleWrapperStyle,u=s.handleWrapperClass,h=s.handleComponent;if(!a)return null;var m=Object.keys(a).map(function(p){return a[p]!==!1?e.createElement($o,{key:p,direction:p,onResizeStart:n.onResizeStart,replaceStyles:r&&r[p],className:i&&i[p]},h&&h[p]?h[p]:null):null});return e.createElement("div",{className:u,style:l},m)},o.prototype.render=function(){var n=this,s=Object.keys(this.props).reduce(function(i,l){return Qo.indexOf(l)!==-1||(i[l]=n.props[l]),i},{}),a=ve(ve(ve({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(a.flexBasis=this.state.flexBasis);var r=this.props.as||"div";return e.createElement(r,ve({ref:this.ref,style:a,className:this.props.className},s),this.state.isResizing&&e.createElement("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer())},o.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},o}(e.PureComponent);function mn(t){const{width:o,children:n,onResize:s}=t,a=(0,N.l4)(),r=(0,N.wW)(Zo),i=`${o+31.5}px`;return e.createElement(jo,{className:(0,d.cx)(r.container,r.drawerActive),defaultSize:{width:i,height:`${a.components.horizontalDrawer.defaultHeight}px`},handleClasses:{top:r.rzHandle},enable:{top:!0,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},maxHeight:"100vh",maxWidth:i,minWidth:i,onResize:s},n)}const Go=t=>(0,d.keyframes)`
  0% {
    transform: translateY(${t.components.horizontalDrawer.defaultHeight}px);
  }

  100% {
    transform: translateY(0px);
  }
`,Zo=t=>({container:(0,d.css)`
    position: fixed !important;
    bottom: 0;
    background: ${t.colors.background.primary};
    border-top: 1px solid ${t.colors.border.weak};
    margin: ${t.spacing(0,-2,0,-2)};
    box-shadow: ${t.shadows.z3};
    z-index: ${t.zIndex.navbarFixed};
  `,drawerActive:(0,d.css)`
    opacity: 1;
    animation: 0.5s ease-out ${Go(t)};
  `,rzHandle:(0,d.css)`
    background: ${t.colors.secondary.main};
    transition: 0.3s background ease-in-out;
    position: relative;
    width: 200px !important;
    height: 7px !important;
    left: calc(50% - 100px) !important;
    top: -4px !important;
    cursor: grab;
    border-radius: ${t.shape.radius.pill};
    &:hover {
      background: ${t.colors.secondary.shade};
    }
  `});var Ko=c(28945),Yo=c(23811),qo=c(80701),Jo=c(58837),Xo=c(8889);function _o(t){const{width:o,onClose:n,queryResponse:s,timeZone:a}=t,r=s?.series||[];let i=s?.errors;!i?.length&&s?.error&&(i=[s.error]),(0,e.useEffect)(()=>{(0,H.ff)("grafana_explore_query_inspector_opened")},[]);const l={label:"Stats",value:"stats",icon:"chart-line",content:e.createElement(Jo.f,{data:s,timeZone:s?.request?.timezone??j.iT})},u={label:"JSON",value:"json",icon:"brackets-curly",content:e.createElement(qo.W,{data:s,onClose:n})},h={label:"Data",value:"data",icon:"database",content:e.createElement(Ko.E,{data:r,dataName:"Explore",isLoading:s.state===K.Gu.Loading,options:{withTransforms:!1,withFieldConfig:!1},timeZone:a,app:Ve.zj.Explore})},m={label:"Query",value:"query",icon:"info-circle",content:e.createElement(Xo.D,{data:s,onRefreshQuery:()=>t.runQueries({exploreId:t.exploreId})})},p=[l,m,u,h];if(i?.length){const g={label:"Error",value:"error",icon:"exclamation-triangle",content:e.createElement(Yo.l,{errors:i})};p.push(g)}return e.createElement(mn,{width:o},e.createElement(ln.W,{tabs:p,onClose:n,closeIconTooltip:"Close query inspector"}))}function es(t,{exploreId:o}){const s=t.explore.panes[o],{queryResponse:a}=s;return{queryResponse:a}}const ts={runQueries:Q.aA},ns=(0,ge.connect)(es,ts)(_o);var os=c(79977),ss=c(92795),ue=c(73351),gn=c(5460),gt=c(20685),as=c(92810),E=c(53166),rs=c(79228),zt=c(56277),de=c(54359),At=c(75923),fn=c(58838),yn=c(89026),is=c(95822),vn=c(76447);function ls(t){const{onClick:o,isSynced:n}=t,s=()=>{const{isSynced:a}=t,r=a?"Unsync all views":"Sync all views to this time range";return e.createElement(e.Fragment,null,r)};return e.createElement(me.u,{content:s,placement:"bottom"},e.createElement(ue.h,{icon:"link",variant:n?"active":"canvas","aria-label":n?"Synced times":"Unsynced times",onClick:o}))}class cs extends e.Component{constructor(){super(...arguments),this.onMoveTimePicker=o=>{const{range:n,onChangeTime:s,timeZone:a}=this.props,{from:r,to:i}=(0,vn.e)(o,n),l={from:(0,ye.GY)(a,r),to:(0,ye.GY)(a,i)};s(l)},this.onMoveForward=()=>this.onMoveTimePicker(1),this.onMoveBack=()=>this.onMoveTimePicker(-1),this.onChangeTimePicker=o=>{const n=yn.isMathString(o.raw.from)?o.raw.from:o.from,s=yn.isMathString(o.raw.to)?o.raw.to:o.to;this.props.onChangeTime({from:n,to:s}),(0,H.ff)("grafana_explore_time_picker_time_range_changed",{timeRangeFrom:n,timeRangeTo:s})},this.onZoom=()=>{const{range:o,onChangeTime:n,timeZone:s}=this.props,{from:a,to:r}=(0,vn.h)(o,2),i={from:(0,ye.GY)(s,a),to:(0,ye.GY)(s,r)};n(i)}}render(){const{range:o,timeZone:n,fiscalYearStartMonth:s,splitted:a,syncedTimes:r,onChangeTimeSync:i,hideText:l,onChangeTimeZone:u,onChangeFiscalYearStartMonth:h}=this.props,m=a?e.createElement(ls,{onClick:i,isSynced:r}):void 0,p={value:o,timeZone:n,fiscalYearStartMonth:s,onMoveBackward:this.onMoveBack,onMoveForward:this.onMoveForward,onZoom:this.onZoom,hideText:l};return e.createElement(is.a,{isOnCanvas:!0,...p,timeSyncButton:m,isSynced:r,widthOverride:a?window.innerWidth/2:void 0,onChange:this.onChangeTimePicker,onChangeTimeZone:u,onChangeFiscalYearStartMonth:h})}}var bn=c(54756);function us(t){const{start:o,pause:n,resume:s,isLive:a,isPaused:r,stop:i,splitted:l}=t,u=a&&!r?"active":"canvas",h=a?r?s:n:o;return e.createElement(gn.h,null,e.createElement(me.u,{content:a&&!r?e.createElement(e.Fragment,null,"Pause the live stream"):e.createElement(e.Fragment,null,"Start live stream your logs"),placement:"bottom"},e.createElement(ue.h,{iconOnly:l,variant:u,icon:!a||r?"play":"pause",onClick:h},a&&r?"Paused":"Live")),e.createElement(bn.Z,{mountOnEnter:!0,unmountOnExit:!0,timeout:100,in:a,classNames:{enter:ft.stopButtonEnter,enterActive:ft.stopButtonEnterActive,exit:ft.stopButtonExit,exitActive:ft.stopButtonExitActive}},e.createElement(me.u,{content:e.createElement(e.Fragment,null,"Stop and exit the live stream"),placement:"bottom"},e.createElement(ue.h,{variant:u,onClick:i,icon:"square-shape"}))))}const ft={stopButtonEnter:(0,d.css)`
    label: stopButtonEnter;
    width: 0;
    opacity: 0;
    overflow: hidden;
  `,stopButtonEnterActive:(0,d.css)`
    label: stopButtonEnterActive;
    opacity: 1;
    width: 32px;
  `,stopButtonExit:(0,d.css)`
    label: stopButtonExit;
    width: 32px;
    opacity: 1;
    overflow: hidden;
  `,stopButtonExitActive:(0,d.css)`
    label: stopButtonExitActive;
    opacity: 0;
    width: 0;
  `};var qe=c(63424),ds=c(85115),ps=c(71460),Ht=c(67669),Mt=c(42646),He=c(97402);const hs={key:"copy-link",label:(0,E.t)("explore.toolbar.copy-shortened-link","Copy shortened URL"),icon:"share-alt",getUrl:()=>{},shorten:!0,absTime:!1};function ms(){const t=(0,O.useSelector)(te.Ky),[o,n]=(0,e.useState)(!1),[s,a]=(0,e.useState)(hs),r=(u,h,m)=>{u?((0,Mt.L)(m||c.g.location.href),(0,H.ff)("grafana_explore_shortened_link_clicked",{isAbsoluteTime:h})):((0,Lt.n9)(m!==void 0?`${window.location.protocol}//${window.location.host}${G.config.appSubUrl}${m}`:c.g.location.href),(0,H.ff)("grafana_explore_copy_link_clicked",{isAbsoluteTime:h}))},i=[{key:"normal",label:(0,E.t)("explore.toolbar.copy-links-normal-category","Normal URL links"),items:[{key:"copy-shortened-link",icon:"link",label:(0,E.t)("explore.toolbar.copy-shortened-link","Copy shortened URL"),getUrl:()=>{},shorten:!0,absTime:!1},{key:"copy-link",icon:"link",label:(0,E.t)("explore.toolbar.copy-link","Copy URL"),getUrl:()=>{},shorten:!1,absTime:!1}]},{key:"timesync",label:(0,E.t)("explore.toolbar.copy-links-absolute-category","Time-sync URL links (share with time range intact)"),items:[{key:"copy-short-link-abs-time",icon:"clock-nine",label:(0,E.t)("explore.toolbar.copy-shortened-link-abs-time","Copy Absolute Shortened URL"),shorten:!0,getUrl:()=>(0,He.G4)(t),absTime:!0},{key:"copy-link-abs-time",icon:"clock-nine",label:(0,E.t)("explore.toolbar.copy-link-abs-time","Copy Absolute Shortened URL"),shorten:!1,getUrl:()=>(0,He.G4)(t),absTime:!0}]}],l=e.createElement(qe.v,null,i.map(u=>e.createElement(ds.k,{key:u.key,label:u.label},u.items.map(h=>e.createElement(qe.v.Item,{key:h.key,label:h.label,icon:h.icon,onClick:()=>{const m=h.getUrl();r(h.shorten,h.absTime,m),a(h)}})))));return e.createElement(ps.R,null,e.createElement(Ke.K,{gap:0,direction:"row",alignItems:"center",wrap:"nowrap"},e.createElement(ue.h,{tooltip:s.label,icon:s.icon,iconOnly:!0,narrow:!0,onClick:()=>{const u=s.getUrl();r(s.shorten,s.absTime,u)},"aria-label":(0,E.t)("explore.toolbar.copy-shortened-link","Copy shortened URL")}),e.createElement(Ht.L,{overlay:l,placement:"bottom-end",onVisibleChange:n},e.createElement(ue.h,{narrow:!0,isOpen:o,"aria-label":(0,E.t)("explore.toolbar.copy-shortened-link-menu","Open copy link options")}))))}var gs=c(88822),fs=c(90384),ys=c(33500),vs=c(75184),bs=c(99025);const Es=(0,e.lazy)(()=>c.e(4205).then(c.bind(c,74205)).then(({AddToDashboard:t})=>({default:t})));function xs(t){const{exploreId:o,splitted:n}=t,[s,a]=(0,e.useState)(),[r,i]=(0,e.useState)(!1),l=Ss(t),u=Cs(l),h=(0,te.F9)(o),m=(0,O.useSelector)(h)?.queries?.length;if(u.length<=1)return st.contextSrv.hasPermission(O.AccessControlAction.DashboardsCreate)||st.contextSrv.hasPermission(O.AccessControlAction.DashboardsWrite)?e.createElement(e.Suspense,{fallback:null},e.createElement(Es,{exploreId:o})):null;const p=e.createElement(bs.G,{extensions:u,onSelect:a});return e.createElement(e.Fragment,null,e.createElement(Ht.L,{onVisibleChange:i,placement:"bottom-start",overlay:p},e.createElement(ue.h,{"aria-label":"Add",icon:"plus",disabled:!m,variant:"canvas",isOpen:r},n?" ":"Add")),!!s&&!!s.path&&e.createElement(vs.F,{path:s.path,title:s.title,onDismiss:()=>a(void 0)}))}function Ss(t){const{exploreId:o,timeZone:n}=t,a=(0,O.useSelector)(te.z7)?.editorMode||!1,{queries:r,queryResponse:i,range:l}=(0,O.useSelector)((0,te.F9)(o)),u=(0,O.useSelector)((0,te.aM)(o)),h=r.map(g=>g?.datasource?.uid).filter(g=>g!==void 0),m=[...new Set(h)].length,p=st.contextSrv.hasPermission(O.AccessControlAction.DataSourcesWrite);return(0,e.useMemo)(()=>({exploreId:o,targets:r,data:i,timeRange:l.raw,timeZone:(0,gs.Z)({timeZone:n}),shouldShowAddCorrelation:G.config.featureToggles.correlations===!0&&p&&!a&&u&&m===1}),[o,r,i,l.raw,n,p,a,u,m])}function Cs(t){return(0,e.useMemo)(()=>{const{extensions:o}=(0,ys.dj)({extensionPointId:fs.y.ExploreToolbarAction,context:t,limitPerPlugin:3});return o},[t])}var Te=c(64684);function ws(t){const o=(0,O.useDispatch)(),n=(0,e.useCallback)(()=>{o((0,Q.sQ)({exploreId:t,isPaused:!0}))},[t,o]),s=(0,e.useCallback)(()=>{o((0,Q.sQ)({exploreId:t,isPaused:!1}))},[t,o]),a=(0,e.useCallback)(()=>{n(),o((0,Te.oz)({exploreId:t,refreshInterval:gt.dP.offOption.value})),o((0,Q.aA)({exploreId:t}))},[t,o,n]),r=(0,e.useCallback)(()=>{o((0,Te.oz)({exploreId:t,refreshInterval:gt.dP.liveOption.value}))},[t,o]),i=(0,e.useCallback)(()=>{o((0,Q.Sv)({exploreId:t}))},[t,o]);return{pause:n,resume:s,stop:a,start:r,clear:i}}function En(t){const o=ws(t.exploreId);return t.children(o)}const Rs=(t,o)=>({rotateIcon:(0,d.css)({"> div > svg":{transform:"rotate(180deg)"}}),toolbarButton:(0,d.css)({display:"flex",justifyContent:"center",marginRight:t.spacing(.5),width:o&&t.spacing(6)})});function Ts({exploreId:t,onChangeTime:o,onContentOutlineToogle:n,isContentOutlineOpen:s}){const a=(0,de.I0)(),r=(0,de.v9)(te.pd),i=(0,N.wW)(Rs,r),l=(0,de.v9)(B=>(0,lt.Z)(B.user)),u=(0,de.v9)(B=>(0,lt.i)(B.user)),{refreshInterval:h,datasourceInstance:m,range:p,isLive:g,isPaused:f,syncedTimes:y}=(0,de.v9)(B=>({...(0,ie.pick)(B.explore.panes[t],"refreshInterval","datasourceInstance","range","isLive","isPaused"),syncedTimes:B.explore.syncedTimes}),ge.shallowEqual),v=(0,de.v9)((0,Q.$9)(t)),x=(0,de.v9)(B=>B.explore.largerExploreId===t),b=(0,de.v9)(B=>r||B.explore.panes[t].containerWidth<1210),C=(0,de.v9)(B=>B.explore.panes[t].containerWidth<(r?700:800)),F=(0,de.v9)(te.M),T=(0,de.v9)(te.z7),L=T?.editorMode||!1,I=(0,de.v9)((0,te.aM)(t)),P=(0,e.useMemo)(()=>I&&x||!I&&!x,[I,x]),M=v?(0,E.t)("explore.toolbar.refresh-picker-cancel","Cancel"):(0,E.t)("explore.toolbar.refresh-picker-run","Run query"),z=async B=>{L?T?.correlationDirty||T?.queryEditorDirty?a((0,U.Hg)({isExiting:!0,postConfirmAction:{exploreId:t,action:zt.iJ.CHANGE_DATASOURCE,changeDatasourceUid:B.uid,isActionLeft:I}})):(I&&F.forEach(ee=>{a((0,Ce.Oj)({exploreId:ee[0],correlationEditorHelperData:void 0}))}),a((0,ke.zU)({exploreId:t,datasource:B.uid,options:{importQueries:!0}}))):a((0,ke.zU)({exploreId:t,datasource:B.uid,options:{importQueries:!0}}))},A=(B=!1)=>a(B?(0,Q.ci)(t):(0,Q.aA)({exploreId:t})),R=B=>a((0,fn.YT)(B)),D=()=>{a((0,U.bW)()),(0,H.ff)("grafana_explore_split_view_opened",{origin:"menu"})},w=()=>{L?T?.correlationDirty||T?.queryEditorDirty?a((0,U.Hg)({isExiting:!0,postConfirmAction:{exploreId:t,action:zt.iJ.CLOSE_PANE,isActionLeft:I}})):(F.forEach(B=>{a((0,Ce.Oj)({exploreId:B[0],correlationEditorHelperData:void 0}))}),a((0,U.YV)(t)),(0,H.ff)("grafana_explore_split_view_closed")):(a((0,U.YV)(t)),(0,H.ff)("grafana_explore_split_view_closed"))},S=()=>{a(x?(0,U.AP)():(0,U.nL)({exploreId:t}))},k=()=>{a((0,Te.mG)(t))},_=B=>a((0,fn.rf)(B)),X=B=>{a((0,Te.oz)({exploreId:t,refreshInterval:B}))},J=[e.createElement(ms,{key:"share"}),e.createElement("div",{style:{flex:1},key:"spacer0"})];return e.createElement("div",null,h&&e.createElement(os.F,{func:A,interval:h,loading:v}),e.createElement("div",null,e.createElement(as.A,{actions:J})),e.createElement(ss.X,{"aria-label":(0,E.t)("explore.toolbar.aria-label","Explore toolbar"),leftItems:[G.config.featureToggles.exploreContentOutline&&e.createElement(ue.h,{key:"content-outline",variant:"canvas",tooltip:"Content outline",icon:"list-ui-alt",iconOnly:r,onClick:n,"aria-expanded":s,"aria-controls":s?"content-outline-container":void 0,className:i.toolbarButton},"Outline"),e.createElement(rs.q,{key:`${t}-ds-picker`,mixed:!L,onChange:z,current:m?.getRef(),hideTextValue:C,width:C?8:void 0})].filter(Boolean),forceShowLeftItems:!0},[r?e.createElement(gn.h,{key:"split-controls"},e.createElement(ue.h,{variant:"canvas",tooltip:x?(0,E.t)("explore.toolbar.split-narrow","Narrow pane"):(0,E.t)("explore.toolbar.split-widen","Widen pane"),onClick:S,icon:x?"gf-movepane-left":"gf-movepane-right",iconOnly:!0,className:(0,d.cx)(P&&i.rotateIcon)}),e.createElement(ue.h,{tooltip:(0,E.t)("explore.toolbar.split-close-tooltip","Close split pane"),onClick:w,icon:"times",variant:"canvas"},e.createElement(E.cC,{i18nKey:"explore.toolbar.split-close"}," Close "))):e.createElement(ue.h,{variant:"canvas",key:"split",tooltip:(0,E.t)("explore.toolbar.split-tooltip","Split the pane"),onClick:D,icon:"columns",disabled:g},e.createElement(E.cC,{i18nKey:"explore.toolbar.split-title"},"Split")),e.createElement(xs,{splitted:r,key:"toolbar-extension-point",exploreId:t,timeZone:l}),!g&&e.createElement(cs,{key:"timeControls",exploreId:t,range:p,timeZone:l,fiscalYearStartMonth:u,onChangeTime:o,splitted:r,syncedTimes:y,onChangeTimeSync:k,hideText:b,onChangeTimeZone:R,onChangeFiscalYearStartMonth:_}),e.createElement(gt.dP,{key:"refreshPicker",onIntervalChanged:X,value:h,isLoading:v,text:b?void 0:M,tooltip:b?M:void 0,intervals:At.Vt.getValidIntervals(gt.o5),isLive:g,onRefresh:()=>A(v),noIntervalPicker:g,primary:!0,width:(b?35:108)+"px"}),m?.meta.streaming&&e.createElement(En,{key:"liveControls",exploreId:t},B=>{const ee={...B,start:()=>{(0,H.ff)("grafana_explore_logs_live_tailing_clicked",{datasourceType:m?.type}),B.start()}};return e.createElement(us,{splitted:r,isLive:g,isPaused:f,start:ee.start,pause:ee.pause,resume:ee.resume,stop:ee.stop})})].filter(Boolean)))}var Ls=c(65778);function yt(t,o={}){(0,H.ff)(`grafana_flamegraph_${t}`,{app:Ve.zj.Unknown,grafana_version:G.config.buildInfo.version,...o})}const Fs=t=>{const o=(0,N.wW)(n=>Is(n));return e.createElement("div",{className:o.container},e.createElement(Ls.Z,{data:t.dataFrames[0],stickyHeader:!0,getTheme:()=>G.config.theme2,onTableSymbolClick:()=>yt("table_item_selected"),onViewSelected:n=>yt("view_selected",{view:n}),onTextAlignSelected:n=>yt("text_align_selected",{align:n}),onTableSort:n=>yt("table_sort_selected",{sort:n}),disableCollapsing:!G.config.featureToggles.flameGraphItemCollapsing}))},Is=t=>({container:(0,d.css)`
    background: ${t.colors.background.primary};
    display: flow-root;
    padding: 0 ${t.spacing(1)} ${t.spacing(1)} ${t.spacing(1)};
    border: 1px solid ${t.components.panel.borderColor};
    border-radius: ${t.shape.radius.default};
  `});var Os=c(10937),xn=c(37479),Pt=c(40137),Ds=c(44900),Ns=c(71498),be=c(40641),zs=c(29188),As=c(16835);const Sn=150,Hs=({resetKey:t,humanize:o,className:n})=>{const[s,a]=(0,e.useState)(0);return(0,zs.Z)(()=>a(s+Sn),Sn),(0,e.useEffect)(()=>a(0),[t]),e.createElement(As.q,{timeInMs:s,className:n,humanize:o})};var Ms=c(72965);const Ps=t=>({logsRowsLive:(0,d.css)`
    label: logs-rows-live;
    font-family: ${t.typography.fontFamilyMonospace};
    font-size: ${t.typography.bodySmall.fontSize};
    display: flex;
    flex-flow: column nowrap;
    height: 60vh;
    overflow-y: scroll;
    :first-child {
      margin-top: auto !important;
    }
  `,logsRowFade:(0,d.css)`
    label: logs-row-fresh;
    color: ${t.colors.text};
    background-color: ${(0,xn.Z)(t.colors.info.transparent).setAlpha(.25).toString()};
    animation: fade 1s ease-out 1s 1 normal forwards;
    @keyframes fade {
      from {
        background-color: ${(0,xn.Z)(t.colors.info.transparent).setAlpha(.25).toString()};
      }
      to {
        background-color: transparent;
      }
    }
  `,logsRowsIndicator:(0,d.css)`
    font-size: ${t.typography.h6.fontSize};
    padding-top: ${t.spacing(1)};
    display: flex;
    align-items: center;
  `,button:(0,d.css)`
    margin-right: ${t.spacing(1)};
  `,fullWidth:(0,d.css)`
    width: 100%;
  `});class ks extends e.PureComponent{constructor(o){super(o),this.liveEndDiv=null,this.scrollContainerRef=e.createRef(),this.onScroll=n=>{const{isPaused:s,onPause:a}=this.props,{scrollTop:r,clientHeight:i,scrollHeight:l}=n.currentTarget;l-(r+i)>=5&&!s&&a()},this.rowsToRender=()=>{const{isPaused:n}=this.props;let{logRowsToRender:s=[]}=this.state;return n||(s=(0,be.$u)(s,j.UV.Ascending).slice(-100)),s},this.state={logRowsToRender:o.logRows}}static getDerivedStateFromProps(o,n){return o.isPaused&&o.clearedAtIndex?{logRowsToRender:(0,Ms.bG)(o.clearedAtIndex,n.logRowsToRender)}:o.isPaused?null:{logRowsToRender:o.logRows}}render(){const{theme:o,timeZone:n,onPause:s,onResume:a,onClear:r,isPaused:i}=this.props,l=Ps(o),{logsRow:u,logsRowLocalTime:h,logsRowMessage:m}=(0,Ns.h)(o);return e.createElement("div",null,e.createElement("table",{className:l.fullWidth},e.createElement("tbody",{onScroll:i?void 0:this.onScroll,className:l.logsRowsLive,ref:this.scrollContainerRef},this.rowsToRender().map(p=>e.createElement("tr",{className:(0,d.cx)(u,l.logsRowFade),key:p.uid},e.createElement("td",{className:h},(0,Pt.dq)(p.timeEpochMs,{timeZone:n})),e.createElement("td",{className:m},p.hasAnsi?e.createElement(Ds.Q,{value:p.raw}):p.entry))),e.createElement("tr",{ref:p=>{this.liveEndDiv=p,this.liveEndDiv&&this.scrollContainerRef.current?.scrollTo&&!i&&this.scrollContainerRef.current?.scrollTo(0,this.scrollContainerRef.current.scrollHeight)}}))),e.createElement("div",{className:l.logsRowsIndicator},e.createElement(V.zx,{icon:i?"play":"pause",variant:"secondary",onClick:i?a:s,className:l.button},i?"Resume":"Pause"),e.createElement(V.zx,{icon:"trash-alt",variant:"secondary",onClick:r,className:l.button},"Clear logs"),e.createElement(V.zx,{icon:"square-shape",variant:"secondary",onClick:this.props.stopLive,className:l.button},"Exit live mode"),i||this.rowsToRender().length>0&&e.createElement("span",null,"Last line received: ",e.createElement(Hs,{resetKey:this.props.logRows,humanize:!0})," ago")))}}const $s=(0,N.HE)(ks);var Cn=c(93670),wn=c(91977),Bs=c(17201),Ws=c(23006),vt=c(96856),Vs=c(47701),Ee=c(41164),Oe=c(76772),Y=c(39357),De=c(86573),Je=c(23044),q=c(40569),bt=c(76597),Et=c(89719);const Rn=({place:t})=>{const o=t==="above"?"Loading newer logs...":"Loading older logs...";return e.createElement("div",{className:Us},e.createElement("div",null,o," ",e.createElement(Et.$,{inline:!0})))},Us=(0,d.css)`
  display: flex;
  justify-content: center;
`;function Qs(t){return{buttons:(0,d.css)({display:"flex",gap:t.spacing(1)})}}const js=t=>{const o=(0,N.wW)(Qs),{wrapLines:n,onChangeWrapLines:s,onScrollCenterClick:a}=t,r=(0,e.useCallback)(i=>{const l=i.currentTarget.checked;(0,H.ff)("grafana_explore_logs_log_context_toggle_lines_clicked",{state:l}),s(l)},[s]);return e.createElement("div",{className:o.buttons},e.createElement(Oe.x,{showLabel:!0,value:n,onChange:r,label:"Wrap lines"}),e.createElement(V.zx,{variant:"secondary",onClick:a},"Center matched line"))},Gs=t=>({modal:(0,d.css)`
      width: 85vw;
      ${t.breakpoints.down("md")} {
        width: 100%;
      }
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    `,sticky:(0,d.css)`
      position: sticky;
      z-index: 1;
      top: -1px;
      bottom: -1px;
    `,entry:(0,d.css)`
      & > td {
        padding: ${t.spacing(1)} 0 ${t.spacing(1)} 0;
      }
      background: ${t.colors.emphasize(t.colors.background.secondary)};

      & > table {
        margin-bottom: 0;
      }

      & .log-row-menu {
        margin-top: -6px;
      }
    `,datasourceUi:(0,d.css)`
      padding-bottom: ${t.spacing(1.25)};
      display: flex;
      align-items: center;
    `,logRowGroups:(0,d.css)`
      overflow: auto;
      max-height: 75%;
      align-self: stretch;
      display: inline-block;
      border: 1px solid ${t.colors.border.weak};
      border-radius: ${t.shape.radius.default};
      & > table {
        min-width: 100%;
      }
    `,flexColumn:(0,d.css)`
      display: flex;
      flex-direction: column;
      padding: 0 ${t.spacing(3)} ${t.spacing(3)} ${t.spacing(3)};
    `,flexRow:(0,d.css)`
      display: flex;
      flex-direction: row;
      align-items: center;
      & > div:last-child {
        margin-left: auto;
      }
    `,noMarginBottom:(0,d.css)`
      & > table {
        margin-bottom: 0;
      }
    `,hidden:(0,d.css)`
      display: none;
    `,paddingTop:(0,d.css)`
      padding-top: ${t.spacing(1)};
    `,paddingBottom:(0,d.css)`
      padding-bottom: ${t.spacing(1)};
    `,link:(0,d.css)`
      color: ${t.colors.text.secondary};
      font-size: ${t.typography.bodySmall.fontSize};
      :hover {
        color: ${t.colors.text.link};
      }
    `,loadingCell:(0,d.css)`
      position: sticky;
      left: 50%;
      display: inline-block;
      transform: translateX(-50%);
    `}),Tn=()=>({above:{loadingState:K.Gu.NotStarted,rows:[]},below:{loadingState:K.Gu.NotStarted,rows:[]}}),Zs=(t,o)=>t==="above"&&o===j.UV.Descending||t==="below"&&o===j.UV.Ascending?Z.M4.Forward:Z.M4.Backward,Ks=(t,o)=>({...t,dataFrame:{...t.dataFrame,refId:`context_${o.above}_${o.below}`}}),Ys=(t,o)=>t.some(n=>n.entry===o.entry&&n.timeEpochNs===o.timeEpochNs),qs=100,Js=({row:t,open:o,logsSortOrder:n,timeZone:s,getLogRowContextUi:a,getRowContextQuery:r,onClose:i,getRowContext:l})=>{const u=(0,e.useRef)(null),h=(0,e.useRef)(null),m=(0,e.useRef)(null),p=(0,e.useRef)(null),g=(0,e.useRef)(null),f=(0,e.useRef)(null),y=(0,e.useRef)(null),v=(0,e.useRef)({above:0,below:0}),x=(0,O.useDispatch)(),b=(0,N.l4)(),C=Gs(b),[F,T]=(0,e.useState)(!0),[L,I]=(0,e.useState)(Tn()),P=($,ae)=>{I(ne=>{const re={...ne};return re[$]=ae(ne[$]),re})},M=(0,e.useRef)(1),[z,A]=(0,e.useState)(null),[R,D]=(0,e.useState)(Y.Z.getBool(q.h.logContextWrapLogMessage,Y.Z.getBool(q.h.wrapLogMessage,!0))),w=(0,e.useCallback)(()=>{const{below:$,above:ae}=L,ne=(0,be.$u)([...$.rows,t,...ae.rows],j.UV.Ascending),re=ne[0].timeEpochMs;let pe=ne[ne.length-1].timeEpochMs;re===pe&&(pe+=1);const le=(0,ye.CQ)(re),Le=(0,ye.CQ)(pe);return{from:le,to:Le,raw:{from:le,to:Le}}},[L,t]),S=(0,e.useCallback)(async()=>{const $=r?await r(t):null;A($)},[t,r]),k=async()=>{await S(),I(Tn()),v.current={above:0,below:0},M.current+=1},_=async($,ae)=>{v.current[$]+=1;const ne=ae.at($==="above"?0:-1);if(ne==null)throw new Error("should never happen. the array always contains at least 1 item (the middle row)");(0,H.ff)("grafana_explore_logs_log_context_load_more_called",{datasourceType:ne.datasourceType,above:v.current.above,below:v.current.below});const re=Zs($,n),pe=await l(Ks(ne,v.current),{limit:qs,direction:re}),le=(0,bt.aB)(pe.data).rows;return n===j.UV.Ascending&&le.reverse(),le.filter(nt=>!Ys(ae,nt))};(0,e.useEffect)(()=>{o&&S()},[S,o]);const[X,J]=(0,e.useState)([]),B=$=>{X.indexOf($)===-1&&J([...X,$])},ee=$=>{const ae=X.indexOf($);ae>-1&&(X.splice(ae,1),J([...X]))},Se=async $=>{const{below:ae,above:ne}=L;if(L[$].loadingState===K.Gu.Loading)return;P($,le=>({...le,loadingState:K.Gu.Loading}));const pe=M.current;try{const le=[...ne.rows,t,...ae.rows],Le=await _($,le),[nt,qn]=(0,ie.partition)(Le,Ae=>Ae.timeEpochNs>t.timeEpochNs),Jn=n===j.UV.Ascending?qn:nt,Xn=n===j.UV.Ascending?nt:qn;pe===M.current&&I(Ae=>{const Ti=Jn.length>0?(0,be.$u)([...Jn,...Ae.above.rows],n):Ae.above.rows,Li=Xn.length>0?(0,be.$u)([...Ae.below.rows,...Xn],n):Ae.below.rows;return{above:{rows:Ti,loadingState:$==="above"?Le.length===0?K.Gu.Done:K.Gu.NotStarted:Ae.above.loadingState},below:{rows:Li,loadingState:$==="below"?Le.length===0?K.Gu.Done:K.Gu.NotStarted:Ae.below.loadingState}}})}catch{P($,le=>({rows:le.rows,loadingState:K.Gu.Error}))}},Ne=async($,ae)=>{for(const ne of $){if(!ne.isIntersecting)continue;const re=ne.target;re===f.current?Se("above"):re===y.current&&Se("below")}};(0,e.useEffect)(()=>{const $=u.current,ae=f.current,ne=y.current;if($==null)return;const re=new IntersectionObserver(Ne,{root:$});return ae!=null&&re.observe(ae),ne!=null&&re.observe(ne),()=>{re.disconnect()}});const W=(0,e.useCallback)(()=>{m.current?.scrollIntoView({block:"center"}),h.current?.scrollIntoView({block:"center"})},[m,h]);(0,e.useLayoutEffect)(()=>{const $=u.current;if($==null)return;const ae=g.current,ne=$.clientHeight;if(g.current=ne,ae!==ne){W();return}if(v.current.above<=1&&v.current.below<=1){W();return}const re=p.current,pe=$.scrollHeight;if(p.current=pe,re!=null){const le=$.scrollTop+(pe-re);$.scrollTop=le}},[L.above.rows,W]),(0,It.Z)(S,[r,t]);const ze=L.above.loadingState,Qe=L.below.loadingState;return e.createElement(Pe.u,{isOpen:o,title:"Log context",contentClassName:C.flexColumn,className:C.modal,onDismiss:i},G.config.featureToggles.logsContextDatasourceUi&&a&&e.createElement("div",{className:C.datasourceUi},a(t,k)),e.createElement("div",{className:(0,d.cx)(C.flexRow,C.paddingBottom)},e.createElement("div",null,e.createElement(js,{wrapLines:R,onChangeWrapLines:D,onScrollCenterClick:W}))),e.createElement("div",{ref:u,className:C.logRowGroups},e.createElement("table",null,e.createElement("tbody",null,e.createElement("tr",null,e.createElement("td",{className:C.loadingCell},ze!==K.Gu.Done&&ze!==K.Gu.Error&&e.createElement("div",{ref:f},e.createElement(Rn,{place:"above"})),ze===K.Gu.Error&&e.createElement("div",null,"Error loading log more logs."),ze===K.Gu.Done&&e.createElement("div",null,"No more logs available."))),e.createElement("tr",null,e.createElement("td",{className:C.noMarginBottom},e.createElement(Je.w,{logRows:L.above.rows,dedupStrategy:j.Y4.none,showLabels:Y.Z.getBool(q.h.showLabels,!1),showTime:Y.Z.getBool(q.h.showTime,!0),wrapLogMessage:R,prettifyLogMessage:Y.Z.getBool(q.h.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:s,displayedFields:X,onClickShowField:B,onClickHideField:ee}))),e.createElement("tr",{ref:m}),e.createElement("tr",{ref:h,className:(0,d.cx)(C.entry,F?C.sticky:null),"data-testid":"entry-row"},e.createElement("td",{className:C.noMarginBottom},e.createElement(Je.w,{logRows:[t],dedupStrategy:j.Y4.none,showLabels:Y.Z.getBool(q.h.showLabels,!1),showTime:Y.Z.getBool(q.h.showTime,!0),wrapLogMessage:R,prettifyLogMessage:Y.Z.getBool(q.h.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:s,displayedFields:X,onClickShowField:B,onClickHideField:ee,onUnpinLine:()=>T(!1),onPinLine:()=>T(!0),pinnedRowId:F?t.uid:void 0,overflowingContent:!0}))),e.createElement("tr",null,e.createElement("td",null,e.createElement(e.Fragment,null,e.createElement(Je.w,{logRows:L.below.rows,dedupStrategy:j.Y4.none,showLabels:Y.Z.getBool(q.h.showLabels,!1),showTime:Y.Z.getBool(q.h.showTime,!0),wrapLogMessage:R,prettifyLogMessage:Y.Z.getBool(q.h.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:s,displayedFields:X,onClickShowField:B,onClickHideField:ee})))),e.createElement("tr",null,e.createElement("td",{className:C.loadingCell},Qe!==K.Gu.Done&&Qe!==K.Gu.Error&&e.createElement("div",{ref:y},e.createElement(Rn,{place:"below"})),Qe===K.Gu.Error&&e.createElement("div",null,"Error loading log more logs."),Qe===K.Gu.Done&&e.createElement("div",null,"No more logs available.")))))),e.createElement(Pe.u.ButtonRow,null,z?.datasource?.uid&&e.createElement(V.zx,{variant:"secondary",onClick:async()=>{let $=t.uid;t.dataFrame.refId&&($=t.uid.replace(t.dataFrame.refId,z.refId)),x((0,U.bW)({queries:[z],range:w(),datasourceUid:z.datasource.uid,panelsState:{logs:{id:$}}})),i(),(0,H.ff)("grafana_explore_logs_log_context_open_split_view_clicked",{datasourceType:t.datasourceType,logRowUid:t.uid})}},"Open in split view")))};var Ln=c(86555);function Xs({feedbackUrl:t}){const o=(0,N.wW)(_s);return e.createElement(Ke.K,null,e.createElement("a",{href:t,className:o.link,title:"The logs table is new, please let us know how we can improve it",target:"_blank",rel:"noreferrer noopener"},e.createElement(he.J,{name:"comment-alt-message"})," Give feedback"))}function _s(t){return{link:(0,d.css)({color:t.colors.text.secondary,fontSize:t.typography.bodySmall.fontSize,":hover":{color:t.colors.text.link}})}}var ea=c(73386),ta=c.n(ea),na=c(16636),oa=c(5278),sa=c(2178);const Fn=t=>({metaContainer:(0,d.css)`
    flex: 1;
    color: ${t.colors.text.secondary};
    margin-bottom: ${t.spacing(2)};
    min-width: 30%;
    display: flex;
    flex-wrap: wrap;
  `,metaItem:(0,d.css)`
    margin-right: ${t.spacing(2)};
    margin-top: ${t.spacing(.5)};
    display: flex;
    align-items: center;

    .logs-meta-item__error {
      color: ${t.colors.error.text};
    }
  `,metaLabel:(0,d.css)`
    margin-right: calc(${t.spacing(2)} / 2);
    font-size: ${t.typography.bodySmall.fontSize};
    font-weight: ${t.typography.fontWeightMedium};
  `,metaValue:(0,d.css)`
    font-family: ${t.typography.fontFamilyMonospace};
    font-size: ${t.typography.bodySmall.fontSize};
  `}),aa=(0,e.memo)(function(o){const n=(0,N.wW)(Fn),{label:s,value:a}=o;return e.createElement("div",{"data-testid":"meta-info-text-item",className:n.metaItem},s&&e.createElement("span",{className:n.metaLabel},s,":"),e.createElement("span",{className:n.metaValue},a))}),kt=(0,e.memo)(function(o){const n=(0,N.wW)(Fn),{metaItems:s}=o;return e.createElement("div",{className:n.metaContainer,"data-testid":"meta-info-text"},s.map((a,r)=>e.createElement(aa,{key:`${r}-${a.label}`,label:a.label,value:a.value})))}),ra=()=>({metaContainer:(0,d.css)`
    flex: 1;
    display: flex;
    flex-wrap: wrap;
  `});var ia=(t=>(t.Text="text",t.Json="json",t))(ia||{});const In=e.memo(({meta:t,dedupStrategy:o,dedupCount:n,displayedFields:s,clearDetectedFields:a,hasUnescapedContent:r,forceEscape:i,onEscapeNewlines:l,logRows:u})=>{const h=(0,N.wW)(ra),m=f=>{switch((0,H.ff)("grafana_logs_download_logs_clicked",{app:Ve.zj.Explore,format:f,area:"logs-meta-row"}),f){case"text":(0,na.Fc)({meta:t,rows:u},"Explore");break;case"json":const y=(0,be.Di)(u),v=new Blob([JSON.stringify(y)],{type:"application/json;charset=utf-8"}),x=`Explore-logs-${(0,Pt.dq)(new Date)}.json`;ta()(v,x);break}},p=[...t];o!==j.Y4.none&&p.push({label:"Deduplication count",value:n,kind:Z.Ku.Number}),u.some(f=>f.entry.length>sa.n)&&p.push({label:"Info",value:"Logs with more than 100,000 characters could not be parsed and highlighted",kind:Z.Ku.String}),s?.length>0&&p.push({label:"Showing only selected fields",value:On(s,Z.Ku.LabelsMap)},{label:"",value:e.createElement(V.zx,{variant:"secondary",size:"sm",onClick:a},"Show original line")}),r&&p.push({label:"Your logs might have incorrectly escaped content",value:e.createElement(me.u,{content:"Fix incorrectly escaped newline and tab sequences in log lines. Manually review the results to confirm that the replacements are correct.",placement:"right"},e.createElement(V.zx,{variant:"secondary",size:"sm",onClick:l},i?"Remove escaping":"Escape newlines"))});const g=e.createElement(qe.v,null,e.createElement(qe.v.Item,{label:"txt",onClick:()=>m("text")}),e.createElement(qe.v.Item,{label:"json",onClick:()=>m("json")}));return e.createElement(e.Fragment,null,p&&e.createElement("div",{className:h.metaContainer},e.createElement(kt,{metaItems:p.map(f=>({label:f.label,value:"kind"in f?On(f.value,f.kind):f.value}))}),e.createElement(Ht.L,{overlay:g},e.createElement(ue.h,{isOpen:!1,variant:"canvas",icon:"download-alt"},"Download"))))});In.displayName="LogsMetaRow";function On(t,o){return o===Z.Ku.LabelsMap?e.createElement(oa.j,{labels:t}):o===Z.Ku.Error?e.createElement("span",{className:"logs-meta-item__error"},t):t}var la=c(74612),ca=c(74337);function ua({pages:t,currentPageIndex:o,oldestLogsFirst:n,timeZone:s,loading:a,onClick:r}){const i=m=>`${(0,Pt.dq)(m,{format:ca.U6.interval.second,timeZone:s})}`,l=(m,p)=>{if(o===p&&a)return e.createElement(Et.$,null);const g=i(n?m.logsRange.from:m.logsRange.to),f=i(n?m.logsRange.to:m.logsRange.from);return`${g} \u2014 ${f}`},u=(0,N.l4)(),h=da(u,a);return e.createElement(rt.$,{autoHide:!0},e.createElement("div",{className:h.pagesWrapper,"data-testid":"logsNavigationPages"},e.createElement("div",{className:h.pagesContainer},t.map((m,p)=>e.createElement("button",{type:"button","data-testid":`page${p+1}`,className:(0,d.cx)((0,V.gN)(u),h.page),key:m.queryRange.to,onClick:()=>{r(m,p+1)}},e.createElement("div",{className:(0,d.cx)(h.line,{selectedBg:o===p})}),e.createElement("div",{className:(0,d.cx)(h.time,{selectedText:o===p})},l(m,p)))))))}const da=(t,o)=>({pagesWrapper:(0,d.css)`
      height: 100%;
      padding-left: ${t.spacing(.5)};
      display: flex;
      flex-direction: column;
      overflow-y: scroll;
      &::after {
        content: '';
        display: block;
        background: repeating-linear-gradient(
          135deg,
          ${t.colors.background.primary},
          ${t.colors.background.primary} 5px,
          ${t.colors.background.secondary} 5px,
          ${t.colors.background.secondary} 15px
        );
        width: 3px;
        height: inherit;
        margin-bottom: 8px;
      }
    `,pagesContainer:(0,d.css)`
      display: flex;
      padding: 0;
      flex-direction: column;
    `,page:(0,d.css)`
      display: flex;
      margin: ${t.spacing(2)} 0;
      cursor: ${o?"auto":"pointer"};
      white-space: normal;
      .selectedBg {
        background: ${t.colors.primary.main};
      }
      .selectedText {
        color: ${t.colors.primary.main};
      }
    `,line:(0,d.css)`
      width: 3px;
      height: 100%;
      align-items: center;
      background: ${t.colors.text.secondary};
    `,time:(0,d.css)`
      width: 60px;
      min-height: 80px;
      font-size: ${t.v1.typography.size.sm};
      padding-left: ${t.spacing(.5)};
      display: flex;
      align-items: center;
    `});function pa({absoluteRange:t,logsSortOrder:o,timeZone:n,loading:s,onChangeTime:a,scrollToTopLogs:r,visibleRange:i,queries:l,clearCache:u,addResultsToCache:h}){const[m,p]=(0,e.useState)([]),[g,f]=(0,e.useState)(0),y=(0,e.useRef)(),v=(0,e.useRef)(),x=(0,e.useRef)(0),b=o===j.UV.Ascending,C=b?g===m.length-1:g===0,F=b?g===0:g===m.length-1,T=(0,N.l4)(),L=ma(T,b);(0,e.useEffect)(()=>{const R={logsRange:i,queryRange:t};let D=[];if(!(0,ie.isEqual)(v.current,t)||!(0,ie.isEqual)(y.current,l))u(),p([R]),f(0),y.current=l,x.current=t.to-t.from;else{p(S=>(D=S.filter(k=>!(0,ie.isEqual)(R.queryRange,k.queryRange)),D=[...D,R].sort((k,_)=>P(k,_,o)),D));const w=D.findIndex(S=>S.queryRange.to===t.to);f(w)}h()},[i,t,o,l,u,h]),(0,e.useEffect)(()=>{u()},[]);const I=(0,e.useCallback)(({from:R,to:D})=>{v.current={from:R,to:D},a({from:R,to:D})},[a]),P=(R,D,w)=>w===j.UV.Ascending?R.queryRange.to>D.queryRange.to?1:-1:R.queryRange.to>D.queryRange.to?-1:1,M=e.createElement(V.zx,{"data-testid":"olderLogsButton",className:L.navButton,variant:"secondary",onClick:()=>{if((0,H.ff)("grafana_explore_logs_pagination_clicked",{pageType:"olderLogsButton"}),F)I({from:i.from-x.current,to:i.from});else{const R=b?-1:1;I({from:m[g+R].queryRange.from,to:m[g+R].queryRange.to})}r()},disabled:s},e.createElement("div",{className:L.navButtonContent},s?e.createElement(Et.$,null):e.createElement(he.J,{name:b?"angle-up":"angle-down",size:"lg"}),"Older logs")),z=e.createElement(V.zx,{"data-testid":"newerLogsButton",className:L.navButton,variant:"secondary",onClick:()=>{if((0,H.ff)("grafana_explore_logs_pagination_clicked",{pageType:"newerLogsButton"}),!C){const R=b?1:-1;I({from:m[g+R].queryRange.from,to:m[g+R].queryRange.to})}r()},disabled:s||C},e.createElement("div",{className:L.navButtonContent},s&&e.createElement(Et.$,null),C||s?null:e.createElement(he.J,{name:b?"angle-down":"angle-up",size:"lg"}),C?"Start of range":"Newer logs")),A=(0,e.useCallback)((R,D)=>{(0,H.ff)("grafana_explore_logs_pagination_clicked",{pageType:"page",pageNumber:D}),!s&&I({from:R.queryRange.from,to:R.queryRange.to}),r()},[I,s,r]);return e.createElement("div",{className:L.navContainer},b?M:z,e.createElement(ua,{pages:m,currentPageIndex:g,oldestLogsFirst:b,timeZone:n,loading:s,onClick:A}),b?z:M,e.createElement(V.zx,{"data-testid":"scrollToTop",className:L.scrollToTopButton,variant:"secondary",onClick:r,title:"Scroll to top"},e.createElement(he.J,{name:"arrow-up",size:"lg"})))}const ha=(0,e.memo)(pa),ma=(t,o)=>{const n=`calc(100vh - 2*${t.spacing(2)} - 2*${la.$}px)`;return{navContainer:(0,d.css)`
      max-height: ${n};
      display: flex;
      flex-direction: column;
      justify-content: ${o?"flex-start":"space-between"};
      position: sticky;
      top: ${t.spacing(2)};
      right: 0;
    `,navButton:(0,d.css)`
      width: 58px;
      height: 68px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      line-height: 1;
    `,navButtonContent:(0,d.css)`
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      white-space: normal;
    `,scrollToTopButton:(0,d.css)`
      width: 40px;
      height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-top: ${t.spacing(1)};
    `}};var xt=c(28982);function ga(t){return{searchWrap:(0,d.css)({padding:t.spacing(.4)})}}function fa(t){const o=(0,N.l4)(),n=ga(o);return e.createElement(we.g,{className:n.searchWrap},e.createElement(Ye.I,{value:t.value,type:"text",placeholder:"Search fields by name",onChange:t.onChange}))}var ya=c(71892),va=c(98147),St=c(19596),ba=c(96503),Dn=c(86347),Nn=c(85666),$t=c(47687);function Ea(t){const{timeZone:o,splitOpen:n,range:s,logsSortOrder:a,width:r,dataFrame:i,columnsWithMeta:l}=t,[u,h]=(0,e.useState)(void 0),m=(0,e.useCallback)(g=>{if(!g.length)return g;const f=(0,xt.L)(g),y=f?.timeField.index,v=(0,va.aK)(g,y,a===j.UV.Descending),[x]=(0,St.SM)({data:[v],timeZone:o,theme:G.config.theme2,replaceVariables:b=>b,fieldConfig:{defaults:{custom:{}},overrides:[]}});for(const b of x.fields)b.getLinks=C=>(0,He.a_)({field:b,rowIndex:C.valueRowIndex,splitOpenFn:n,range:s,dataFrame:v}),b.config={...b.config,custom:{inspect:!0,filterable:!0,...b.config.custom},filterable:xa(b,f??void 0)};return x},[a,o,n,s]);if((0,e.useEffect)(()=>{(async()=>{const f=i?(0,xt.L)(i):void 0;if(!f){h(void 0);return}const y=Sa(i);let v=Ca(l);const x=wa(v);if(x?y.push(x):y.push({id:"organize",options:{includeByName:{[f.bodyField.name]:!0,[f.timeField.name]:!0}}}),y.length>0){const b=await(0,ya.n)((0,ba.H)(y,[i])),C=m(b[0]);h(C)}else h(m(i))})()},[l,i,a,m]),!u)return null;const p=g=>{const{value:f,key:y,operator:v}=g,{onClickFilterLabel:x,onClickFilterOutLabel:b}=t;!x||!b||(v===it.PT&&x(y,f,i),v===it.tE&&b(y,f,i))};return e.createElement($t.i,{data:u,width:r,onCellFilterAdded:t.onClickFilterLabel&&t.onClickFilterOutLabel?p:void 0,height:t.height,footerOptions:{show:!0,reducer:["count"],countRows:!0}})}const xa=(t,o)=>!(!o||o.bodyField.name===t.name||o.timeField.name===t.name||t.config.links?.length);function Sa(t){return t.fields.filter(o=>{const n=o.typeInfo?.frame==="json.RawMessage"&&o.name==="labels"&&t?.meta?.type!==Dn.P.LogLines,s=o.name==="labels"&&o.type===Nn.fS.other&&t?.meta?.type===Dn.P.LogLines;return n||s}).flatMap(o=>[{id:"extractFields",options:{format:"json",keepTime:!1,replace:!1,source:o.name}}])}function Ca(t){let o={};return Object.keys(t).filter(n=>t[n].active).forEach(n=>{o[n]=!0}),o}function wa(t){return Object.keys(t).length>0?{id:"organize",options:{includeByName:t}}:null}var Ra=c(36356);function Ta(t){return{labelCount:(0,d.css)({marginLeft:t.spacing(.5),marginRight:t.spacing(.5),appearance:"none",background:"none",border:"none",fontSize:t.typography.pxToRem(11)}),wrap:(0,d.css)({display:"flex",alignItems:"center",marginTop:t.spacing(1),marginBottom:t.spacing(1),justifyContent:"space-between"}),checkboxLabel:(0,d.css)({"> :first-child":{position:"sticky",left:0,bottom:0,top:0},"> span":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block",maxWidth:"100%"}}),columnWrapper:(0,d.css)({marginBottom:t.spacing(1.5),paddingLeft:t.spacing(.5)}),empty:(0,d.css)({marginBottom:t.spacing(2),marginLeft:t.spacing(1.75),fontSize:t.typography.fontSize})}}const La=new Intl.Collator(void 0,{sensitivity:"base"});function Fa(t){return(o,n)=>{const s=t[o],a=t[n];return s!=null&&a!=null?+(a.type==="TIME_FIELD")-+(s.type==="TIME_FIELD")||+(a.type==="BODY_FIELD")-+(s.type==="BODY_FIELD")||La.compare(o,n):0}}const zn=t=>{const{labels:o,valueFilter:n,toggleColumn:s}=t,a=(0,N.l4)(),r=Ta(a),i=Object.keys(o).filter(l=>n(l));return i.length?e.createElement("div",{className:r.columnWrapper},i.sort(Fa(o)).map(l=>e.createElement("div",{title:`${l} appears in ${o[l]?.percentOfLinesWithLabel}% of log lines`,className:r.wrap,key:l},e.createElement(Ra.X,{className:r.checkboxLabel,label:l,onChange:()=>s(l),checked:o[l]?.active??!1}),e.createElement("button",{className:r.labelCount,onClick:()=>s(l)},o[l]?.percentOfLinesWithLabel,"%")))):e.createElement("div",{className:r.empty},"No fields")};function Ia(t){return{sidebarWrap:(0,d.css)({overflowY:"scroll",height:"calc(100% - 50px)"}),columnHeaderButton:(0,d.css)({appearance:"none",background:"none",border:"none",fontSize:t.typography.pxToRem(11)}),columnHeader:(0,d.css)({display:"flex",justifyContent:"space-between",fontSize:t.typography.h6.fontSize,background:t.colors.background.secondary,position:"sticky",top:0,left:0,paddingTop:t.spacing(.75),paddingRight:t.spacing(.75),paddingBottom:t.spacing(.75),paddingLeft:t.spacing(1.5),zIndex:3,marginBottom:t.spacing(2)})}}const Oa=t=>{const o=(0,N.l4)(),n=Ia(o);return e.createElement("div",{className:n.sidebarWrap},e.createElement(e.Fragment,null,e.createElement("div",{className:n.columnHeader},"Selected fields",e.createElement("button",{onClick:t.clear,className:n.columnHeaderButton},"Reset")),e.createElement(zn,{toggleColumn:t.toggleColumn,labels:t.filteredColumnsWithMeta??t.columnsWithMeta,valueFilter:s=>t.columnsWithMeta[s]?.active??!1}),e.createElement("div",{className:n.columnHeader},"Fields"),e.createElement(zn,{toggleColumn:t.toggleColumn,labels:t.filteredColumnsWithMeta??t.columnsWithMeta,valueFilter:s=>!t.columnsWithMeta[s]?.active})))};var An=c(20670);const Da=new An.Z({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1});function Hn(t,o,n){const[s,a,r]=Da.search(t,o,0,1e5);let i=[],l=new Set;if(s&&r){const u=(h,m)=>{m&&l.add(h)};for(let h=0;h<r.length;h++){let m=r[h];An.Z.highlight(t[a.idx[m]],a.ranges[m],u),i.push(t[a.idx[m]])}n([i,[...l]])}else o||n([[],[]])}const Ii=(0,ie.debounce)(Hn,300);function Na(t){const{logsFrames:o,updatePanelState:n,panelState:s}=t,a=s?.columns,[r,i]=(0,e.useState)(void 0),[l,u]=(0,e.useState)(void 0),[h,m]=(0,e.useState)(""),p=Pn(),g=t?.panelState?.refId,[f,y]=(0,e.useState)(o.find(w=>w.refId===g)??o[0]),v=(0,e.useCallback)(w=>{const S=t.panelState?.columns;return S&&Object.values(S).forEach(k=>{w[k]&&(w[k].active=!0)}),w},[t.panelState?.columns]),x=(0,xt.L)(f);if((0,e.useEffect)(()=>{if(x?.timeField.name&&x?.bodyField.name&&!a){const w={0:x?.timeField.name??"",1:x?.bodyField.name??""};n({columns:Object.values(w),visualisationType:"table",labelFieldName:x?.getLabelFieldName()??void 0})}},[x,a,n]),(0,e.useEffect)(()=>{const w=o.find(S=>S.refId===g)??o[0];w&&y(w)},[o,g]),(0,e.useEffect)(()=>{if(!r||!l)return;let w={...l},S=!1;Object.keys(r).forEach(k=>{w[k]&&w[k].active!==r[k].active&&(w[k]=r[k],S=!0)}),S&&u(w)},[r,l]),(0,e.useEffect)(()=>{if(!f.length)return;const w=f?f.length:0,S=(0,xt.L)(f),k=S?.getLogFrameLabelsAsLabels(),_=[];S&&_.push(...S.extraFields.filter(ee=>!ee?.config?.custom?.hidden)),S?.severityField&&_.push(S?.severityField),S?.bodyField&&_.push(S?.bodyField),S?.timeField&&_.push(S?.timeField);const X=new Map;let J={};k?.length&&w&&(k.forEach(ee=>{Object.keys(ee).forEach(Ne=>{if(X.has(Ne)){const W=X.get(Ne);W&&X.set(Ne,{percentOfLinesWithLabel:W.percentOfLinesWithLabel+1,active:W?.active})}else X.set(Ne,{percentOfLinesWithLabel:1,active:void 0})})}),J=Object.fromEntries(X),Object.keys(J).forEach(ee=>{J[ee].percentOfLinesWithLabel=Mn(J[ee].percentOfLinesWithLabel,w)})),_.forEach(ee=>{J[ee.name]={percentOfLinesWithLabel:Mn(ee.values.filter(Se=>Se!=null).length,w),active:J[ee.name]?.active}}),J=v(J),Object.keys(J).filter(ee=>J[ee].active).length===0&&(S?.bodyField?.name&&(J[S.bodyField.name].active=!0),S?.timeField?.name&&(J[S.timeField.name].active=!0)),S?.bodyField?.name&&S?.timeField?.name&&(J[S.bodyField.name].type="BODY_FIELD",J[S.timeField.name].type="TIME_FIELD"),i(J)},[f,v]),!r)return null;function b(w){if(r){const S=!r[w]?.active,k=Object.keys(r).filter(X=>r[X]?.active)?.length,_={columnAction:S?"add":"remove",columnCount:S?k+1:k-1,datasourceType:t.datasourceType};(0,H.ff)("grafana_explore_logs_table_column_filter_clicked",_)}}function C(w){(0,H.ff)("grafana_explore_logs_table_text_search_result_count",{resultCount:w,datasourceType:t.datasourceType??"unknown"})}const F=()=>{const w={...r};Object.keys(w).forEach(S=>{w[S].active=!!w[S].type}),i(w)},T=w=>{if(!r||!(w in r)){console.warn("failed to get column",r);return}const S={...r,[w]:{...r[w],active:!r[w]?.active}};if(b(w),i(S),l){const J={...l,[w]:{...l[w],active:!l[w]?.active}};u(J)}const k=Object.assign({},Object.keys(S).filter(J=>S[J]?.active)),_={0:x?.timeField.name??"",1:x?.bodyField.name??""},X={...t.panelState,columns:Object.keys(k).length?k:_,refId:f.refId,visualisationType:"table",labelFieldName:x?.getLabelFieldName()??void 0};n(X)},L=w=>{const S=w[0];let k={},_=0;S.forEach(X=>{X in r&&(k[X]=r[X],_++)}),u(k),C(_)},I=w=>{Hn(Object.keys(r),w,L)},P=w=>{const S=w.currentTarget?.value;m(S),S?I(S):u(void 0)},M=w=>{o.find(k=>k.refId===w.value)&&y(o.find(k=>k.refId===w.value)??o[0]),t.updatePanelState({refId:w.value,labelFieldName:x?.getLabelFieldName()??void 0})},z=220,R=t.width-z,D=za(t.theme,p,z);return e.createElement(e.Fragment,null,e.createElement("div",null,o.length>1&&e.createElement("div",null,e.createElement(Ee._,{label:"Select query",htmlFor:"explore_logs_table_frame_selector",labelWidth:22,tooltip:"Select a query to visualize in the table."},e.createElement(Ie.Ph,{inputId:"explore_logs_table_frame_selector","aria-label":"Select query by name",value:f.refId,options:o.map(w=>({label:w.refId,value:w.refId})),onChange:M})))),e.createElement("div",{className:D.wrapper},e.createElement("section",{className:D.sidebar},e.createElement(fa,{value:h,onChange:P}),e.createElement(Oa,{toggleColumn:T,filteredColumnsWithMeta:l,columnsWithMeta:r,clear:F})),e.createElement(Ea,{onClickFilterLabel:t.onClickFilterLabel,onClickFilterOutLabel:t.onClickFilterOutLabel,logsSortOrder:t.logsSortOrder,range:t.range,splitOpen:t.splitOpen,timeZone:t.timeZone,width:R,dataFrame:f,columnsWithMeta:r,height:p})))}const Mn=(t,o)=>Math.ceil(100*t/o);function za(t,o,n){return{wrapper:(0,d.css)({display:"flex"}),sidebar:(0,d.css)({height:o,fontSize:t.typography.pxToRem(11),overflowY:"hidden",width:n,paddingRight:t.spacing(1.5)})}}const Pn=()=>Math.max(window.innerHeight-500,500);function Bt(t){const[o,n]=(0,e.useState)(!1),s=100,{error:a,title:r,suggestedAction:i,onSuggestedAction:l,onRemove:u,severity:h="warning"}=t,m=a?.message||a?.data?.message||"",p=!o&&m.length>s,g=(0,N.l4)(),f=Aa(g);return e.createElement("div",{className:f.supplementaryErrorContainer},e.createElement(Ze.b,{title:r,severity:h,onRemove:u},e.createElement("div",{className:f.suggestedActionWrapper},p?e.createElement(V.zx,{variant:"secondary",size:"xs",onClick:()=>{n(!0)}},"Show details"):m,i&&l&&e.createElement("div",{className:f.suggestedActionWrapper},e.createElement(V.zx,{variant:"primary",size:"xs",onClick:l},i)))))}const Aa=t=>({supplementaryErrorContainer:(0,d.css)`
      width: 50%;
      min-width: ${t.breakpoints.values.sm}px;
      margin: 0 auto;
    `,suggestedActionWrapper:(0,d.css)`
      height: ${t.spacing(6)};
      button {
        position: absolute;
        right: ${t.spacing(2)};
        top: ${t.spacing(7)};
      }
    `});var Ha=c(12807);function Ma(t){const{width:o,timeZone:n,splitOpen:s,onUpdateTimeRange:a,onHiddenSeriesChanged:r,allLogsVolumeMaximum:i}=t,l=(0,N.l4)(),u=(0,N.wW)(Pa),h=parseInt(l.spacing(2).slice(0,-2),10),m=150,p=t.logsVolumeData,g=(0,be.Js)(p?.data);let f=g?`${g.name}`:"";(0,be.FP)(p.data)&&(f=[f,"This datasource does not support full-range histograms. The graph below is based on the logs seen in the response."].filter(ie.identity).join(". "));let y=e.createElement("span",null,f);return p.state===K.Gu.Streaming&&(y=e.createElement(e.Fragment,null,y,e.createElement(me.u,{content:"Streaming"},e.createElement(he.J,{name:"circle-mono",size:"md",className:u.streaming,"data-testid":"logs-volume-streaming"})))),e.createElement("div",{style:{height:m},className:u.contentContainer},e.createElement(Ha.y,{graphStyle:"lines",loadingState:p.state??K.Gu.Done,data:p.data,height:m,width:o-h*2,absoluteRange:t.absoluteRange,onChangeTime:a,timeZone:n,splitOpenFn:s,tooltipDisplayMode:j.f3.Multi,onHiddenSeriesChanged:r,anchorToZero:!0,yAxisMaximum:i,eventBus:t.eventBus,annotations:t.annotations}),y&&e.createElement("div",{className:u.extraInfoContainer},y))}const Pa=t=>({extraInfoContainer:(0,d.css)`
      display: flex;
      justify-content: end;
      position: absolute;
      right: 5px;
      top: -10px;
      font-size: ${t.typography.bodySmall.fontSize};
      color: ${t.colors.text.secondary};
    `,contentContainer:(0,d.css)`
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    `,streaming:(0,d.css)`
      color: ${t.colors.success.text};
    `});function ka(t){return!t||!t.error&&!t.errors?!1:(t.error?[t.error]:t.errors||[]).some(n=>(`${n.message||n.data?.message}`?.toLowerCase()).includes("timeout"))}const $a=({logsVolumeData:t,absoluteRange:o,onUpdateTimeRange:n,width:s,onLoadLogsVolume:a,onHiddenSeriesChanged:r,eventBus:i,splitOpen:l,timeZone:u,onClose:h})=>{const{logVolumes:m,maximumValue:p,maximumRange:g,annotations:f}=(0,e.useMemo)(()=>{let F=-1/0;const T=t?.data.filter(A=>A.meta?.dataTopic!==j.w5.Annotations),L=t?.data.filter(A=>A.meta?.dataTopic===j.w5.Annotations)||[],I=(0,ie.sortBy)(T||[],"meta.custom.datasourceName"),P=(0,ie.groupBy)(I,"meta.custom.datasourceName"),M=(0,ie.mapValues)(P,A=>{const R=(0,be._c)(A);return F=Math.max(F,R.maximum),R.dataFrames}),z=(0,be.hY)((0,ie.flatten)(Object.values(M)));return{maximumValue:F,maximumRange:z,logVolumes:M,annotations:L}},[t]),y=(0,N.wW)(Ba),v=Object.keys(m).length,x=Object.values(m).some(F=>{const T=Wa(F,o);return!(0,be.FP)(F)&&T&&T<1}),b=ka(t),C={from:Math.max(o.from,g.from),to:Math.min(o.to,g.to)};return t?.state===K.Gu.Loading?e.createElement("span",null,"Loading..."):b?e.createElement(Bt,{title:"The logs volume query has timed out",severity:"info",suggestedAction:"Retry",onSuggestedAction:a,onRemove:h}):t?.error!==void 0?e.createElement(Bt,{error:t.error,title:"Failed to load log volume for this query"}):v===0?e.createElement("div",{className:y.alertContainer},e.createElement(Ze.b,{severity:"info",title:"No logs volume available"},"No volume information available for the current queries and time range.")):e.createElement("div",{className:y.listContainer},Object.keys(m).map((F,T)=>{const L={data:m[F]};return e.createElement(Ma,{key:T,absoluteRange:C,allLogsVolumeMaximum:p,width:s,logsVolumeData:L,onUpdateTimeRange:n,timeZone:u,splitOpen:l,onLoadLogsVolume:a,onHiddenSeriesChanged:v>1?()=>{}:r,eventBus:i,annotations:f})}),x&&e.createElement("div",{className:y.extraInfoContainer},e.createElement(Ee._,{label:"Reload log volume",transparent:!0},e.createElement(V.zx,{size:"xs",icon:"sync",variant:"secondary",onClick:a,id:"reload-volume"}))))},Ba=t=>({listContainer:(0,d.css)`
      padding-top: 10px;
    `,extraInfoContainer:(0,d.css)`
      display: flex;
      justify-content: end;
      position: absolute;
      right: 5px;
      top: 5px;
    `,oldInfoText:(0,d.css)`
      font-size: ${t.typography.bodySmall.fontSize};
      color: ${t.colors.text.secondary};
    `,alertContainer:(0,d.css)`
      width: 50%;
      min-width: ${t.breakpoints.values.sm}px;
      margin: 0 auto;
    `});function Wa(t,o){const n=t&&t[0]&&t[0].meta?.custom?.absoluteRange;return n?(o.from-o.to)/(n.from-n.to):void 0}const Wt=G.config.featureToggles.exploreScrollableLogsContainer,Va=[j.Y4.none,j.Y4.exact,j.Y4.numbers,j.Y4.signature],Vt=()=>Y.Z.get(q.w)==="table"?"table":"logs";class Ua extends e.PureComponent{constructor(o){super(o),this.topLogsRef=(0,e.createRef)(),this.state={showLabels:Y.Z.getBool(q.h.showLabels,!1),showTime:Y.Z.getBool(q.h.showTime,!0),wrapLogMessage:Y.Z.getBool(q.h.wrapLogMessage,!0),prettifyLogMessage:Y.Z.getBool(q.h.prettifyLogMessage,!1),dedupStrategy:j.Y4.none,hiddenLogLevels:[],logsSortOrder:Y.Z.get(q.h.logsSortOrder)||j.UV.Descending,isFlipping:!1,displayedFields:[],forceEscape:!1,contextOpen:!1,contextRow:void 0,tableFrame:void 0,visualisationType:this.props.panelState?.logs?.visualisationType??Vt(),logsContainer:void 0},this.updatePanelState=n=>{const s=(0,De.y0)().explore.panes[this.props.exploreId];s?.panelsState&&(0,De.WI)((0,Ce.km)(this.props.exploreId,"logs",{...s.panelsState.logs,columns:n.columns??this.props.panelState?.logs?.columns,visualisationType:n.visualisationType??this.state.visualisationType,labelFieldName:n.labelFieldName,refId:n.refId??this.props.panelState?.logs?.refId}))},this.onLogRowHover=n=>{n?this.props.eventBus.publish(new Cn.es({point:{time:n.timeEpochMs}})):this.props.eventBus.publish(new Cn.xH)},this.onLogsContainerRef=n=>{this.setState({logsContainer:n})},this.onChangeLogsSortOrder=()=>{this.setState({isFlipping:!0}),this.flipOrderTimer=window.setTimeout(()=>{this.setState(n=>{const s=n.logsSortOrder===j.UV.Descending?j.UV.Ascending:j.UV.Descending;return Y.Z.set(q.h.logsSortOrder,s),{logsSortOrder:s}})},0),this.cancelFlippingTimer=window.setTimeout(()=>this.setState({isFlipping:!1}),1e3)},this.onEscapeNewlines=()=>{this.setState(n=>({forceEscape:!n.forceEscape}))},this.onChangeVisualisation=n=>{this.setState(()=>({visualisationType:n}));const s={...this.props.panelState?.logs,visualisationType:n};this.updatePanelState(s),(0,H.ff)("grafana_explore_logs_visualisation_changed",{newVisualizationType:n,datasourceType:this.props.datasourceType??"unknown"})},this.onChangeDedup=n=>{(0,H.ff)("grafana_explore_logs_deduplication_clicked",{deduplicationType:n,datasourceType:this.props.datasourceType}),this.setState({dedupStrategy:n})},this.onChangeLabels=n=>{const{target:s}=n;if(s){const a=s.checked;this.setState({showLabels:a}),Y.Z.set(q.h.showLabels,a)}},this.onChangeTime=n=>{const{target:s}=n;if(s){const a=s.checked;this.setState({showTime:a}),Y.Z.set(q.h.showTime,a)}},this.onChangeWrapLogMessage=n=>{const{target:s}=n;if(s){const a=s.checked;this.setState({wrapLogMessage:a}),Y.Z.set(q.h.wrapLogMessage,a)}},this.onChangePrettifyLogMessage=n=>{const{target:s}=n;if(s){const a=s.checked;this.setState({prettifyLogMessage:a}),Y.Z.set(q.h.prettifyLogMessage,a)}},this.onToggleLogLevel=n=>{const s=n.map(a=>Z.in[a]);this.setState({hiddenLogLevels:s})},this.onToggleLogsVolumeCollapse=n=>{this.props.onSetLogsVolumeEnabled(!n),(0,H.ff)("grafana_explore_logs_histogram_toggle_clicked",{datasourceType:this.props.datasourceType,type:n?"close":"open"})},this.onClickScan=n=>{n.preventDefault(),this.props.onStartScanning&&(this.props.onStartScanning(),(0,H.ff)("grafana_explore_logs_scanning_button_clicked",{type:"start",datasourceType:this.props.datasourceType}))},this.onClickStopScan=n=>{n.preventDefault(),this.props.onStopScanning&&this.props.onStopScanning()},this.showField=n=>{this.state.displayedFields.indexOf(n)===-1&&this.setState(a=>({displayedFields:a.displayedFields.concat(n)}))},this.hideField=n=>{this.state.displayedFields.indexOf(n)>-1&&this.setState(a=>({displayedFields:a.displayedFields.filter(r=>n!==r)}))},this.clearDetectedFields=()=>{this.setState(n=>({displayedFields:[]}))},this.onCloseContext=()=>{this.setState({contextOpen:!1,contextRow:void 0})},this.onOpenContext=(n,s)=>{this.setState({contextOpen:!0,contextRow:n}),(0,H.ff)("grafana_explore_logs_log_context_opened",{datasourceType:n.datasourceType,logRowUid:n.uid}),this.onCloseContext=()=>{this.setState({contextOpen:!1,contextRow:void 0}),(0,H.ff)("grafana_explore_logs_log_context_closed",{datasourceType:n.datasourceType,logRowUid:n.uid}),s()}},this.onPermalinkClick=async n=>{if(n.rowId===void 0)return;const s=(0,Ln.D)((0,De.y0)().explore.panes[this.props.exploreId]);s.panelsState={...this.props.panelState,logs:{id:n.uid,visualisationType:this.state.visualisationType??Vt()}},s.range={from:new Date(this.props.absoluteRange.from).toISOString(),to:new Date(this.props.absoluteRange.to).toISOString()};const a=(0,wn.S)(s),r=/.*(?=\/explore)/.exec(`${window.location.href}`)[0],i=wn.Cj.renderUrl(`${r}/explore`,{left:a});await(0,Mt.L)(i),(0,H.ff)("grafana_explore_logs_permalink_clicked",{datasourceType:n.datasourceType??"unknown",logRowUid:n.uid,logRowLevel:n.logLevel})},this.scrollIntoView=n=>{if(G.config.featureToggles.exploreScrollableLogsContainer){this.state.logsContainer&&(this.topLogsRef.current?.scrollIntoView(),this.state.logsContainer.scroll({behavior:"smooth",top:this.state.logsContainer.scrollTop+n.getBoundingClientRect().top-window.innerHeight/2}));return}const{scrollElement:s}=this.props;s&&s.scroll({behavior:"smooth",top:s.scrollTop+n.getBoundingClientRect().top-window.innerHeight/2})},this.checkUnescapedContent=(0,$e.Z)(n=>!!n.some(s=>s.hasUnescapedContent)),this.dedupRows=(0,$e.Z)((n,s)=>{const a=(0,bt.UW)(n,s),r=a.reduce((i,l)=>l.duplicates?i+l.duplicates:i,0);return{dedupedRows:a,dedupCount:r}}),this.filterRows=(0,$e.Z)((n,s)=>(0,bt.nu)(n,new Set(s))),this.createNavigationRange=(0,$e.Z)(n=>{if(!n||n.length===0)return;const s=n[0].timeEpochMs,a=n[n.length-1].timeEpochMs;return a<s?{from:a,to:s}:{from:s,to:a}}),this.scrollToTopLogs=()=>{G.config.featureToggles.exploreScrollableLogsContainer?this.state.logsContainer&&this.state.logsContainer.scroll({behavior:"auto",top:0}):this.topLogsRef.current?.scrollIntoView()},this.logsVolumeEventBus=o.eventBus.newScopedBus("logsvolume",{onlyLocal:!1})}componentWillUnmount(){this.flipOrderTimer&&window.clearTimeout(this.flipOrderTimer),this.cancelFlippingTimer&&window.clearTimeout(this.cancelFlippingTimer),(this.props?.panelState?.logs?.columns||this.props?.panelState?.logs?.refId||this.props?.panelState?.logs?.labelFieldName)&&(0,De.WI)((0,Ce.km)(this.props.exploreId,"logs",{...this.props.panelState?.logs,columns:void 0,visualisationType:this.state.visualisationType,labelFieldName:void 0,refId:void 0}))}componentDidUpdate(o){if(this.props.loading&&!o.loading&&this.props.panelState?.logs?.id&&(delete this.props.panelState.logs.id,(0,De.WI)((0,Ce.km)(this.props.exploreId,"logs",{...this.props.panelState}))),this.props.panelState?.logs?.visualisationType!==o.panelState?.logs?.visualisationType){const n=this.props.panelState?.logs?.visualisationType??Vt();this.setState({visualisationType:n}),Y.Z.set(q.w,n)}}render(){const{width:o,splitOpen:n,logRows:s,logsMeta:a,logsVolumeEnabled:r,logsVolumeData:i,loadLogsVolumeData:l,loading:u=!1,onClickFilterLabel:h,onClickFilterOutLabel:m,timeZone:p,scanning:g,scanRange:f,showContextToggle:y,absoluteRange:v,onChangeTime:x,getFieldLinks:b,theme:C,logsQueries:F,clearCache:T,addResultsToCache:L,exploreId:I,getRowContext:P,getLogRowContextUi:M,getRowContextQuery:z}=this.props,{showLabels:A,showTime:R,wrapLogMessage:D,prettifyLogMessage:w,dedupStrategy:S,hiddenLogLevels:k,logsSortOrder:_,isFlipping:X,displayedFields:J,forceEscape:B,contextOpen:ee,contextRow:Se}=this.state,Ne=Pn(),W=ja(C,D,Ne),ze=s&&s.length>0,Qe=this.checkUnescapedContent(s),$=this.filterRows(s,k),{dedupedRows:ae,dedupCount:ne}=this.dedupRows($,S),re=this.createNavigationRange(s),pe=f?`Scanning ${Bs.describeTimeRange(f)}`:"Scanning...";return e.createElement(e.Fragment,null,P&&Se&&e.createElement(Js,{open:ee,row:Se,onClose:this.onCloseContext,getRowContext:(le,Le)=>P(le,Se,Le),getRowContextQuery:z,getLogRowContextUi:M,logsSortOrder:_,timeZone:p}),e.createElement(Re.fm,{title:"Logs volume",collapsible:!0,collapsed:!r,onToggleCollapse:this.onToggleLogsVolumeCollapse},r&&e.createElement($a,{absoluteRange:v,width:o,logsVolumeData:i,onUpdateTimeRange:x,timeZone:p,splitOpen:n,onLoadLogsVolume:l,onHiddenSeriesChanged:this.onToggleLogLevel,eventBus:this.logsVolumeEventBus,onClose:()=>this.onToggleLogsVolumeCollapse(!0)})),e.createElement(Re.fm,{titleItems:[G.config.featureToggles.logsExploreTableVisualisation?this.state.visualisationType==="logs"?null:[e.createElement(Re.fm.TitleItem,{title:"Experimental",key:"A"},e.createElement(Ws.a,{featureState:Ve.CQ.beta,tooltip:"Table view is experimental and may change in future versions"})),e.createElement(Re.fm.TitleItem,{title:"Feedback",key:"B"},e.createElement(Xs,{feedbackUrl:"https://forms.gle/5YyKdRQJ5hzq4c289"}))]:null],title:"Logs",actions:e.createElement(e.Fragment,null,G.config.featureToggles.logsExploreTableVisualisation&&e.createElement("div",{className:W.visualisationType},e.createElement(vt.S,{className:W.visualisationTypeRadio,options:[{label:"Logs",value:"logs",description:"Show results in logs visualisation"},{label:"Table",value:"table",description:"Show results in table visualisation"}],size:"sm",value:this.state.visualisationType,onChange:this.onChangeVisualisation}))),loadingState:u?K.Gu.Loading:K.Gu.Done},e.createElement("div",{className:W.stickyNavigation},this.state.visualisationType!=="table"&&e.createElement("div",{className:W.logOptions},e.createElement(Vs.Z,null,e.createElement(Ee._,{label:"Time",className:W.horizontalInlineLabel,transparent:!0},e.createElement(Oe.x,{value:R,onChange:this.onChangeTime,className:W.horizontalInlineSwitch,transparent:!0,id:`show-time_${I}`})),e.createElement(Ee._,{label:"Unique labels",className:W.horizontalInlineLabel,transparent:!0},e.createElement(Oe.x,{value:A,onChange:this.onChangeLabels,className:W.horizontalInlineSwitch,transparent:!0,id:`unique-labels_${I}`})),e.createElement(Ee._,{label:"Wrap lines",className:W.horizontalInlineLabel,transparent:!0},e.createElement(Oe.x,{value:D,onChange:this.onChangeWrapLogMessage,className:W.horizontalInlineSwitch,transparent:!0,id:`wrap-lines_${I}`})),e.createElement(Ee._,{label:"Prettify JSON",className:W.horizontalInlineLabel,transparent:!0},e.createElement(Oe.x,{value:w,onChange:this.onChangePrettifyLogMessage,className:W.horizontalInlineSwitch,transparent:!0,id:`prettify_${I}`})),e.createElement(Ee._,{label:"Deduplication",className:W.horizontalInlineLabel,transparent:!0},e.createElement(vt.S,{options:Va.map(le=>({label:(0,ie.capitalize)(le),value:le,description:Z.Uv[le]})),value:S,onChange:this.onChangeDedup,className:W.radioButtons}))),e.createElement("div",null,e.createElement(Ee._,{label:"Display results",className:W.horizontalInlineLabel,transparent:!0},e.createElement(vt.S,{disabled:X,options:[{label:"Newest first",value:j.UV.Descending,description:"Show results newest to oldest"},{label:"Oldest first",value:j.UV.Ascending,description:"Show results oldest to newest"}],value:_,onChange:this.onChangeLogsSortOrder,className:W.radioButtons})))),e.createElement("div",{ref:this.topLogsRef}),e.createElement(In,{logRows:s,meta:a||[],dedupStrategy:S,dedupCount:ne,hasUnescapedContent:Qe,forceEscape:B,displayedFields:J,onEscapeNewlines:this.onEscapeNewlines,clearDetectedFields:this.clearDetectedFields})),e.createElement("div",{className:(0,d.cx)(W.logsSection,this.state.visualisationType==="table"?W.logsTable:void 0)},this.state.visualisationType==="table"&&ze&&e.createElement("div",{className:W.logRows,"data-testid":"logRowsTable"},e.createElement(Na,{logsSortOrder:this.state.logsSortOrder,range:this.props.range,splitOpen:this.props.splitOpen,timeZone:p,width:o-80,logsFrames:this.props.logsFrames??[],onClickFilterLabel:h,onClickFilterOutLabel:m,panelState:this.props.panelState?.logs,theme:C,updatePanelState:this.updatePanelState,datasourceType:this.props.datasourceType})),this.state.visualisationType==="logs"&&ze&&e.createElement("div",{className:W.logRows,"data-testid":"logRows",ref:this.onLogsContainerRef},e.createElement(Je.w,{logRows:s,deduplicatedRows:ae,dedupStrategy:S,onClickFilterLabel:h,onClickFilterOutLabel:m,showContextToggle:y,getRowContextQuery:z,showLabels:A,showTime:R,enableLogDetails:!0,forceEscape:B,wrapLogMessage:D,prettifyLogMessage:w,timeZone:p,getFieldLinks:b,logsSortOrder:_,displayedFields:J,onClickShowField:this.showField,onClickHideField:this.hideField,app:Ve.zj.Explore,onLogRowHover:this.onLogRowHover,onOpenContext:this.onOpenContext,onPermalinkClick:this.onPermalinkClick,permalinkedRowId:this.props.panelState?.logs?.id,scrollIntoView:this.scrollIntoView,isFilterLabelActive:this.props.isFilterLabelActive,containerRendered:!!this.state.logsContainer,onClickFilterValue:this.props.onClickFilterValue,onClickFilterOutValue:this.props.onClickFilterOutValue})),!u&&!ze&&!g&&e.createElement("div",{className:W.logRows},e.createElement("div",{className:W.noData},"No logs found.",e.createElement(V.zx,{size:"sm",variant:"secondary",onClick:this.onClickScan},"Scan for older logs"))),g&&e.createElement("div",{className:W.logRows},e.createElement("div",{className:W.noData},e.createElement("span",null,pe),e.createElement(V.zx,{size:"sm",variant:"secondary",onClick:this.onClickStopScan},"Stop scan"))),e.createElement(ha,{logsSortOrder:_,visibleRange:re??v,absoluteRange:v,timeZone:p,onChangeTime:x,loading:u,queries:F??[],scrollToTopLogs:this.scrollToTopLogs,addResultsToCache:L,clearCache:T}))))}}const Qa=(0,N.HE)(Ua),ja=(t,o,n)=>({noData:(0,d.css)`
      > * {
        margin-left: 0.5em;
      }
    `,logOptions:(0,d.css)`
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      flex-wrap: wrap;
      background-color: ${t.colors.background.primary};
      padding: ${t.spacing(1,2)};
      border-radius: ${t.shape.radius.default};
      margin: ${t.spacing(0,0,1)};
      border: 1px solid ${t.colors.border.medium};
    `,headerButton:(0,d.css)`
      margin: ${t.spacing(.5,0,0,1)};
    `,horizontalInlineLabel:(0,d.css)`
      > label {
        margin-right: 0;
      }
    `,horizontalInlineSwitch:(0,d.css)`
      padding: 0 ${t.spacing(1)} 0 0;
    `,radioButtons:(0,d.css)`
      margin: 0;
    `,logsSection:(0,d.css)`
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    `,logsTable:(0,d.css)({maxHeight:`${n}px`}),logRows:(0,d.css)`
      overflow-x: ${Wt?"scroll;":`${o?"unset":"scroll"};`}
      overflow-y: visible;
      width: 100%;
      ${Wt&&"max-height: calc(100vh - 170px);"}
    `,visualisationType:(0,d.css)`
      display: flex;
      flex: 1;
      justify-content: space-between;
    `,visualisationTypeRadio:(0,d.css)`
      margin: 0 0 0 ${t.spacing(1)};
    `,stickyNavigation:(0,d.css)`
      ${Wt&&"margin-bottom: 0px"}
      overflow: visible;
    `}),Ut=500,Qt=100,Ga=(0,$e.Z)(()=>({logsEnter:(0,d.css)`
      label: logsEnter;
      position: absolute;
      opacity: 0;
      height: auto;
      width: 100%;
    `,logsEnterActive:(0,d.css)`
      label: logsEnterActive;
      opacity: 1;
      transition: opacity ${Ut}ms ease-out ${Qt}ms;
    `,logsExit:(0,d.css)`
      label: logsExit;
      position: absolute;
      opacity: 1;
      height: auto;
      width: 100%;
    `,logsExitActive:(0,d.css)`
      label: logsExitActive;
      opacity: 0;
      transition: opacity ${Ut}ms ease-out ${Qt}ms;
    `}));function kn(t){const{visible:o,children:n}=t,s=Ga();return e.createElement(bn.Z,{in:o,mountOnEnter:!0,unmountOnExit:!0,timeout:Ut+Qt,classNames:{enter:s.logsEnter,enterActive:s.logsEnterActive,exit:s.logsExit,exitActive:s.logsExitActive}},n)}class Za extends e.PureComponent{constructor(){super(...arguments),this.state={dsInstances:{}},this.onChangeTime=o=>{const{exploreId:n,updateTimeRange:s}=this.props;s({exploreId:n,absoluteRange:o})},this.getLogRowContext=async(o,n,s)=>{const{logsQueries:a}=this.props;if(!n.dataFrame.refId||!this.state.dsInstances[n.dataFrame.refId])return Promise.resolve([]);const r=this.state.dsInstances[n.dataFrame.refId];if(!(0,Z.Q4)(r))return Promise.resolve([]);const i=this.getQuery(a,n,r);return i?r.getLogRowContext(o,s,i):Promise.resolve([])},this.getLogRowContextQuery=async(o,n,s=!0)=>{const{logsQueries:a}=this.props;if(!o.dataFrame.refId||!this.state.dsInstances[o.dataFrame.refId])return Promise.resolve(null);const r=this.state.dsInstances[o.dataFrame.refId];if(!(0,Z.Q4)(r))return Promise.resolve(null);const i=this.getQuery(a,o,r);return i&&r.getLogRowContextQuery?r.getLogRowContextQuery(o,n,i,s):Promise.resolve(null)},this.getLogRowContextUi=(o,n)=>{const{logsQueries:s}=this.props;if(!o.dataFrame.refId||!this.state.dsInstances[o.dataFrame.refId])return e.createElement(e.Fragment,null);const a=this.state.dsInstances[o.dataFrame.refId];if(!(0,Z.Q4)(a))return e.createElement(e.Fragment,null);const r=this.getQuery(s,o,a);return r&&(0,Z.xW)(a)&&a.getLogRowContextUi?a.getLogRowContextUi(o,n,r):e.createElement(e.Fragment,null)},this.showContextToggle=o=>!o?.dataFrame.refId||!this.state.dsInstances[o.dataFrame.refId]?!1:(0,Z.Q4)(this.state.dsInstances[o.dataFrame.refId]),this.getFieldLinks=(o,n,s)=>{const{splitOpenFn:a,range:r}=this.props;return(0,He.a_)({field:o,rowIndex:n,splitOpenFn:a,range:r,dataFrame:s})},this.logDetailsFilterAvailable=()=>Object.values(this.state.dsInstances).some(o=>o?.modifyQuery||(0,Z._)(o)||(0,Z.Vw)(o)),this.filterValueAvailable=()=>Object.values(this.state.dsInstances).some(o=>(0,Z._)(o)&&o?.getSupportedQueryModifications().includes("ADD_STRING_FILTER")),this.filterOutValueAvailable=()=>Object.values(this.state.dsInstances).some(o=>(0,Z._)(o)&&o?.getSupportedQueryModifications().includes("ADD_STRING_FILTER_OUT"))}componentDidMount(){this.updateDataSourceInstances()}componentDidUpdate(o){o.logsQueries!==this.props.logsQueries&&this.updateDataSourceInstances()}updateDataSourceInstances(){const{logsQueries:o,datasourceInstance:n}=this.props;if(!o||!n)return;const s={};if(n.uid!==Tt.D){o.forEach(({refId:r})=>{s[r]=n}),this.setState({dsInstances:s});return}const a=[];for(const r of o){if(!r.datasource)continue;(!s[r.refId]||s[r.refId].uid!==r.datasource.uid)&&a.push(new Promise(l=>{(0,Be.F)().get(r.datasource).then(u=>{l({ds:u,refId:r.refId})})}))}a.length&&Promise.all(a).then(r=>{r.forEach(({ds:i,refId:l})=>{s[l]=i}),this.setState({dsInstances:s})})}getQuery(o,n,s){return(o??[]).find(a=>a.refId===n.dataFrame.refId&&a.datasource!=null&&a.datasource.type===s.type)}render(){const{loading:o,loadingState:n,logRows:s,logsMeta:a,logsSeries:r,logsQueries:i,loadSupplementaryQueryData:l,setSupplementaryQueryEnabled:u,onClickFilterLabel:h,onClickFilterOutLabel:m,onStartScanning:p,onStopScanning:g,absoluteRange:f,timeZone:y,visibleRange:v,scanning:x,range:b,width:C,splitOpenFn:F,isLive:T,exploreId:L,addResultsToCache:I,clearCache:P,logsVolume:M,scrollElement:z}=this.props;return s?e.createElement(e.Fragment,null,e.createElement(kn,{visible:T},e.createElement(ct.U,{label:"Logs",loading:!1,isOpen:!0},e.createElement(En,{exploreId:L},A=>e.createElement($s,{logRows:s,timeZone:y,stopLive:A.stop,isPaused:this.props.isPaused,onPause:A.pause,onResume:A.resume,onClear:A.clear,clearedAtIndex:this.props.clearedAtIndex})))),e.createElement(kn,{visible:!T},e.createElement(Qa,{exploreId:L,datasourceType:this.props.datasourceInstance?.type,logRows:s,logsMeta:a,logsSeries:r,logsVolumeEnabled:M.enabled,onSetLogsVolumeEnabled:A=>u(L,A,Z.v8.LogsVolume),logsVolumeData:M.data,logsQueries:i,width:C,splitOpen:F,loading:o,loadingState:n,loadLogsVolumeData:()=>l(L,Z.v8.LogsVolume),onChangeTime:this.onChangeTime,onClickFilterLabel:this.logDetailsFilterAvailable()?h:void 0,onClickFilterOutLabel:this.logDetailsFilterAvailable()?m:void 0,onStartScanning:p,onStopScanning:g,absoluteRange:f,visibleRange:v,timeZone:y,scanning:x,scanRange:b.raw,showContextToggle:this.showContextToggle,getRowContext:this.getLogRowContext,getRowContextQuery:this.getLogRowContextQuery,getLogRowContextUi:this.getLogRowContextUi,getFieldLinks:this.getFieldLinks,addResultsToCache:()=>I(L),clearCache:()=>P(L),eventBus:this.props.eventBus,panelState:this.props.panelState,logsFrames:this.props.logsFrames,scrollElement:z,isFilterLabelActive:this.logDetailsFilterAvailable()?this.props.isFilterLabelActive:void 0,range:b,onClickFilterValue:this.filterValueAvailable()?this.props.onClickFilterValue:void 0,onClickFilterOutValue:this.filterOutValueAvailable()?this.props.onClickFilterOutValue:void 0}))):null}}function Ka(t,{exploreId:o}){const s=t.explore.panes[o],{logsResult:a,scanning:r,datasourceInstance:i,isLive:l,isPaused:u,clearedAtIndex:h,range:m,absoluteRange:p,supplementaryQueries:g}=s,f=(0,Q.$9)(o)(t),y=s.panelsState,v=(0,lt.Z)(t.user),x=g[Z.v8.LogsVolume];return{loading:f,logRows:a?.rows,logsMeta:a?.meta,logsSeries:a?.series,logsQueries:a?.queries,visibleRange:a?.visibleRange,scanning:r,timeZone:v,datasourceInstance:i,isLive:l,isPaused:u,clearedAtIndex:h,range:m,absoluteRange:p,logsVolume:x,panelState:y,logsFrames:s.queryResponse.logsFrames}}const Ya={updateTimeRange:Te.cD,addResultsToCache:Q.K8,clearCache:Q.LK,loadSupplementaryQueryData:Q.W1,setSupplementaryQueryEnabled:Q.z0},qa=(0,ge.connect)(Ka,Ya)(Za);function Ja(t){const{queryResponse:o,timeZone:n,enabled:s,setLogsSampleEnabled:a,datasourceInstance:r,queries:i,splitOpen:l}=t,u=(0,N.wW)(Xa),h=g=>{a(g),(0,H.ff)("grafana_explore_logs_sample_toggle_clicked",{datasourceType:r?.type??"unknown",type:g?"open":"close"})},m=()=>{if(!(0,Z.mN)(r,Z.v8.LogsSample))return null;const g=i.map(y=>r.getSupplementaryQuery({type:Z.v8.LogsSample},y)).filter(y=>!!y);if(!g.length)return null;const f=()=>{l({queries:g,datasourceUid:r.uid}),(0,H.ff)("grafana_explore_logs_sample_split_button_clicked",{datasourceType:r?.type??"unknown",queriesCount:g.length})};return e.createElement(V.zx,{size:"sm",className:u.logSamplesButton,onClick:f},"Open logs in split view")};let p;if(o===void 0)p=null;else if(o.error!==void 0)p=e.createElement(Bt,{error:o.error,title:"Failed to load logs sample for this query"});else if(o.state===K.Gu.Loading)p=e.createElement("span",null,"Logs sample is loading...");else if(o.data.length===0||o.data.every(g=>g.length===0))p=e.createElement("span",null,"No logs sample data.");else{const g=(0,bt.aB)(o.data);p=e.createElement(e.Fragment,null,e.createElement(m,null),e.createElement("div",{className:u.logContainer},e.createElement(Je.w,{logRows:g.rows,dedupStrategy:j.Y4.none,showLabels:Y.Z.getBool(q.h.showLabels,!1),showTime:Y.Z.getBool(q.h.showTime,!0),wrapLogMessage:Y.Z.getBool(q.h.wrapLogMessage,!0),prettifyLogMessage:Y.Z.getBool(q.h.prettifyLogMessage,!1),timeZone:n,enableLogDetails:!0})))}return o?.state!==K.Gu.NotStarted?e.createElement(ct.U,{className:u.logsSamplePanel,label:e.createElement("div",null,"Logs sample",e.createElement(me.u,{content:"Show log lines that contributed to visualized metrics"},e.createElement(he.J,{name:"info-circle",className:u.infoTooltip}))),isOpen:s,collapsible:!0,onToggle:h},p):null}const Xa=t=>{const o=G.config.featureToggles.exploreScrollableLogsContainer;return{logsSamplePanel:(0,d.css)`
      ${o&&"max-height: calc(100vh - 115px);"}
    `,logSamplesButton:(0,d.css)`
      position: absolute;
      top: ${t.spacing(1)};
      right: ${t.spacing(1)};
    `,logContainer:(0,d.css)`
      ${o&&"position: relative;"}
      ${o&&"height: 100%;"}
      overflow: scroll;
    `,infoTooltip:(0,d.css)`
      margin-left: ${t.spacing(1)};
    `}},_a=()=>{const t=(0,N.wW)(er);return e.createElement(e.Fragment,null,e.createElement(Ft.l,{"data-testid":"explore-no-data",className:t.wrapper},e.createElement("span",{className:t.message},"No data")))},er=t=>({wrapper:(0,d.css)`
    label: no-data-card;
    padding: ${t.spacing(3)};
    background: ${t.colors.background.primary};
    border-radius: ${t.shape.radius.default};
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-grow: 1;
  `,message:(0,d.css)`
    font-size: ${t.typography.h2.fontSize};
    padding: ${t.spacing(4)};
    color: ${t.colors.text.disabled};
  `});var tr=c(53567);const nr=()=>{const t=(0,N.l4)(),o=At.Vt.hasPermission(O.AccessControlAction.DataSourcesCreate)&&At.Vt.hasPermission(O.AccessControlAction.DataSourcesWrite),n="Explore requires at least one data source. Once you have added a data source, you can query it here.",s=e.createElement(e.Fragment,null,e.createElement(he.J,{name:"rocket"}),e.createElement(e.Fragment,null," ProTip: You can also define data sources through configuration files. "),e.createElement("a",{href:"http://docs.grafana.org/administration/provisioning/?utm_source=explore#data-sources",target:"_blank",rel:"noreferrer",className:"text-link"},"Learn more")),a=e.createElement(V.Qj,{size:"lg",href:"datasources/new",icon:"database",disabled:!o},"Add data source"),r=(0,d.css)`
    max-width: ${t.breakpoints.values.lg}px;
    margin-top: ${t.spacing(2)};
    align-self: center;
  `;return e.createElement(tr._,{callToActionElement:a,className:r,footer:s,message:n})};var jt=c(99841),or=c(77266),sr=c(63804);const ar=t=>({warningText:(0,d.css)`
    label: warningText;
    display: flex;
    align-items: center;
    font-size: ${t.typography.bodySmall.fontSize};
    color: ${t.colors.text.secondary};
  `});function rr(t){const{dataFrames:o,range:n,splitOpenFn:s,withTraceView:a,datasourceType:r}=t,i=(0,He.u8)(n,s),l=(0,N.l4)(),u=(0,N.wW)(ar),h=(0,St.SM)({fieldConfig:{defaults:{},overrides:[]},data:o,replaceVariables:T=>T,theme:l}),{nodes:m}=(0,sr.Y)(h),[p,g]=(0,en.Z)(!0),f=()=>{g(),(0,H.ff)("grafana_traces_node_graph_panel_clicked",{datasourceType:r,grafana_version:G.config.buildInfo.version,isExpanded:!open})},{height:y}=(0,jt.Z)(),v=(0,e.useRef)(null),[x,b]=(0,e.useState)(250);(0,e.useEffect)(()=>{if(v.current){const{top:T}=v.current.getBoundingClientRect();b(T)}},[v]);const C=y-x-32,F=a&&m[0]?.length>1e3?e.createElement("span",{className:u.warningText}," (",m[0].length," nodes, can be slow to load)"):null;return e.createElement(Re.fm,{title:"Node graph",titleItems:F,collapsible:!!a,collapsed:a?p:!1,onToggleCollapse:a?f:void 0},e.createElement("div",{ref:v,style:a?{height:500}:{minHeight:600,height:C}},e.createElement(or.E,{dataFrames:h,getLinks:i})))}function ir(t,{exploreId:o}){return{range:t.explore.panes[o].range}}const lr=(0,ge.connect)(ir,{})(rr);var Xe=c(7261),cr=c(65354),$n=c(97001),ur=c(89636);const dr=t=>{const o=(0,te.F9)(t);return{getQueries:(0,Xe.P1)(o,n=>n.queries),getQueryResponse:(0,Xe.P1)(o,n=>n.queryResponse),getHistory:(0,Xe.P1)(o,n=>n.history),getEventBridge:(0,Xe.P1)(o,n=>n.eventBridge),getDatasourceInstanceSettings:(0,Xe.P1)(o,n=>(0,$n.ak)().getInstanceSettings(n.datasourceInstance?.uid))}},pr=({exploreId:t})=>{const o=(0,O.useDispatch)(),{getQueries:n,getDatasourceInstanceSettings:s,getQueryResponse:a,getHistory:r,getEventBridge:i}=(0,e.useMemo)(()=>dr(t),[t]),l=(0,O.useSelector)(n),u=(0,O.useSelector)(s),h=(0,O.useSelector)(a),m=(0,O.useSelector)(r),p=(0,O.useSelector)(i),g=(0,e.useCallback)(()=>{o((0,Q.aA)({exploreId:t}))},[o,t]),f=(0,e.useCallback)(C=>{o((0,Q.qV)({exploreId:t,queries:C}))},[o,t]),y=(0,e.useCallback)(C=>{f([...l,{...C,refId:(0,cr.Hs)(l)}])},[f,l]),v=()=>{(0,H.ff)("grafana_explore_query_row_copy")},x=()=>{(0,H.ff)("grafana_explore_query_row_remove")},b=C=>{(0,H.ff)("grafana_query_row_toggle",C===void 0?{}:{queryEnabled:C})};return e.createElement(ur.l,{dsSettings:u,queries:l,onQueriesChange:f,onAddQuery:y,onRunQueries:g,onQueryCopied:v,onQueryRemoved:x,onQueryToggled:b,data:h,app:Ve.zj.Explore,history:m,eventBus:p})};var Ct=c(61129),Gt=c(83811),hr=c(21279),mr=c(61231),gr=c(65162),fr=c(34385),Bn=c(78621);const _e={wrapper:(0,d.css)`
    height: 100%;
    overflow: scroll;
  `,switchWrapper:(0,d.css)`
    display: flex;
    flex-direction: row;
    margin-bottom: 0;
  `,switchLabel:(0,d.css)`
    margin-left: 15px;
    margin-bottom: 0;
  `,switch:(0,d.css)`
    margin-left: 10px;
  `,resultCount:(0,d.css)`
    margin-bottom: 4px;
  `,header:(0,d.css)`
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    font-size: 12px;
    line-height: 1.25;
  `},yr=480,vr=2,br=t=>{const{tableResult:o}=t,n=(0,ie.cloneDeep)(o),s=(0,e.useRef)(null),a=n.fields.filter(f=>f.name.includes("Value")),r=(0,Bn.u)(n),{width:i}=(0,jt.Z)(),[l,u]=(0,e.useState)(i<=yr||a.length>vr),h=()=>{u(!l);const f={isExpanded:!l};(0,H.ff)("grafana_explore_prometheus_instant_query_ui_raw_toggle_expand",f)};(0,e.useEffect)(()=>{s.current?.resetAfterIndex(0,!0)},[l]);const m=f=>{if(f<10){let x=0;for(let b=0;b<f;b++)x+=p(b,!0);return Math.min(600,x)}return 600},p=(f,y)=>{if(!y)return 32;const b=r[f];return 1.5*32+(Object.keys(b).length-a.length)*22},g=`isExpandedView ${(0,e.useId)()}`;return e.createElement("section",null,e.createElement("header",{className:_e.header},e.createElement(we.g,{className:_e.switchWrapper,label:"Expand results",htmlFor:"isExpandedView"},e.createElement("div",{className:_e.switch},e.createElement(Oe.r,{onChange:h,id:g,value:l,label:"Expand results"}))),e.createElement("div",{className:_e.resultCount},"Result series: ",r.length)),e.createElement("div",{role:"table"},e.createElement(e.Fragment,null,a.length>1&&!l&&e.createElement(gr.I,{valueLabels:a,expanded:l}),e.createElement(mr.S_,{ref:s,itemCount:r.length,className:_e.wrapper,itemSize:f=>p(f,l),height:m(r.length),width:"100%"},({index:f,style:y})=>{let v;return l&&(v=a.filter(x=>{const b=r[f][x.name];return b&&b!==Bn.T})),e.createElement("div",{role:"row",style:{...y,overflow:"hidden"}},e.createElement(fr.ZP,{isExpandedView:l,valueLabels:v,totalNumberOfValues:a.length,listKey:r[f].__name__,listItemData:r[f]}))}))))};function Er(t,{exploreId:o}){const s=t.explore.panes[o],{tableResult:a,rawPrometheusResult:r,range:i,queryResponse:l}=s,u=r?[r]:[],h=(a?.length??0)>0&&r?a:u;return{loading:l.state,tableResult:h,range:i}}const xr=(0,ge.connect)(Er,{});class Sr extends e.PureComponent{constructor(o){super(o),this.onChangeResultsStyle=n=>{this.setState({resultsStyle:n})},this.renderLabel=()=>{const n=(0,d.css)({display:"flex",justifyContent:"space-between",flex:"1"}),s=zt.zN.map(a=>({value:a,label:a[0].toUpperCase()+a.slice(1).replace(/_/," ")}));return e.createElement("div",{className:n},e.createElement(vt.S,{onClick:()=>{const a={state:this.state.resultsStyle===O.TABLE_RESULTS_STYLE.table?O.TABLE_RESULTS_STYLE.raw:O.TABLE_RESULTS_STYLE.table};(0,H.ff)("grafana_explore_prometheus_instant_query_ui_toggle_clicked",a)},size:"sm",options:s,value:this.state?.resultsStyle,onChange:this.onChangeResultsStyle}))},o.showRawPrometheus&&(this.state={resultsStyle:O.TABLE_RESULTS_STYLE.raw})}getTableHeight(){const{tableResult:o}=this.props;return!o||o.length===0?200:Math.max(Math.min(600,o[0].length*35)+35)}render(){const{loading:o,onCellFilterAdded:n,tableResult:s,width:a,splitOpenFn:r,range:i,ariaLabel:l,timeZone:u}=this.props,h=this.getTableHeight(),m=a-Gt.config.theme.panelPadding*2-hr.QO;let p=s;const g=(0,He.qQ)(r,i);p?.length&&(p=(0,St.SM)({data:p,timeZone:u,theme:Gt.config.theme2,replaceVariables:(0,Ct.J)().replace.bind((0,Ct.J)()),fieldConfig:{defaults:{},overrides:[]},dataLinkPostProcessor:g}));const f=p?.filter(b=>!!b&&b.length!==0),y=this.state.resultsStyle===O.TABLE_RESULTS_STYLE.raw?"Raw":"Table",v=this.state?.resultsStyle!==void 0?this.renderLabel():"Table",x=!this.state?.resultsStyle||this.state?.resultsStyle===O.TABLE_RESULTS_STYLE.table;return e.createElement(Re.fm,{title:y,actions:v,loadingState:o},f?.length&&e.createElement(e.Fragment,null,x&&e.createElement($t.i,{ariaLabel:l,data:f[0],width:m,height:h,onCellFilterAdded:n}),this.state?.resultsStyle===O.TABLE_RESULTS_STYLE.raw&&e.createElement(br,{tableResult:f[0]})),!f?.length&&e.createElement(kt,{metaItems:[{value:"0 series returned"}]}))}}const Cr=xr(Sr);var wr=c(29691);const Rr=t=>{const o={transition:`opacity ${t.duration}ms linear`,opacity:0},n={exited:{opacity:0,display:"none"},entering:{opacity:0},entered:{opacity:1},exiting:{opacity:0}};return e.createElement(wr.ZP,{in:t.in,timeout:t.duration,unmountOnExit:t.unmountOnExit||!1,onExited:t.onExited},s=>e.createElement("div",{style:{...o,...n[s]}},t.children))},Tr=t=>{const{queryError:o}=t,n=!!o,s=n?100:10,a=o?"Query error":"Unknown error",r=o?.message||o?.data?.message||null;return e.createElement(Rr,{in:n,duration:s},e.createElement(Ze.b,{severity:"error",title:a,topSpacing:2},r))};function Lr(t){const o=(0,O.useSelector)(s=>s.explore.panes[t.exploreId].queryResponse),n=o?.state===K.Gu.Error?o?.error:void 0;return n?.refId?null:e.createElement(Tr,{queryError:n})}var xe=c(85105),ce=c(86234),Fr=c(21660),Wn=c(76804),et=c(1727),Ir=c(28718),Or=c(61375),Zt=c(7939),Kt=c(42876),tt=c(74642);function Dr(t,{exploreId:o}){const n=t.explore,{datasourceInstance:s}=n.panes[o];return{exploreId:o,datasourceInstance:s}}const Nr={changeDatasource:ke.zU,deleteHistoryItem:xe.NV,commentHistoryItem:xe.Ff,starHistoryItem:xe.ev,setQueries:Q.KO},zr=(0,ge.connect)(Dr,Nr),Ar=t=>{const o="240px",n="170px",s=t.colors.background.secondary;return{queryCard:(0,d.css)`
      position: relative;
      display: flex;
      flex-direction: column;
      border: 1px solid ${t.colors.border.weak};
      margin: ${t.spacing(1)} 0;
      background-color: ${s};
      border-radius: ${t.shape.radius.default};
      .starred {
        color: ${t.v1.palette.orange};
      }
    `,cardRow:(0,d.css)`
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: ${t.spacing(1)};
      border-bottom: none;
      :first-of-type {
        border-bottom: 1px solid ${t.colors.border.weak};
        padding: ${t.spacing(.5,1)};
      }
      img {
        height: ${t.typography.fontSize}px;
        max-width: ${t.typography.fontSize}px;
        margin-right: ${t.spacing(1)};
      }
    `,queryActionButtons:(0,d.css)`
      max-width: ${n};
      display: flex;
      justify-content: flex-end;
      font-size: ${t.typography.size.base};
      button {
        margin-left: ${t.spacing(1)};
      }
    `,queryContainer:(0,d.css)`
      font-weight: ${t.typography.fontWeightMedium};
      width: calc(100% - ${o});
    `,updateCommentContainer:(0,d.css)`
      width: calc(100% + ${o});
      margin-top: ${t.spacing(1)};
    `,comment:(0,d.css)`
      overflow-wrap: break-word;
      font-size: ${t.typography.bodySmall.fontSize};
      font-weight: ${t.typography.fontWeightRegular};
      margin-top: ${t.spacing(.5)};
    `,commentButtonRow:(0,d.css)`
      > * {
        margin-top: ${t.spacing(1)};
        margin-right: ${t.spacing(1)};
      }
    `,textArea:(0,d.css)`
      width: 100%;
    `,runButton:(0,d.css)`
      max-width: ${n};
      display: flex;
      justify-content: flex-end;
      button {
        height: auto;
        padding: ${t.spacing(.5,2)};
        line-height: 1.4;
        span {
          white-space: normal !important;
        }
      }
    `,loader:(0,d.css)`
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: ${t.colors.background.secondary};
    `}};function Hr(t){const{queryHistoryItem:o,commentHistoryItem:n,starHistoryItem:s,deleteHistoryItem:a,changeDatasource:r,exploreId:i,datasourceInstance:l,setQueries:u}=t,[h,m]=(0,e.useState)(!1),[p,g]=(0,e.useState)(o.comment),{value:f,loading:y}=(0,It.Z)(async()=>{let R;try{R=await(0,Be.F)().get(o.datasourceUid)}catch{}return{datasourceInstance:R,queries:await Promise.all(o.queries.map(async D=>{let w;if(R?.meta.mixed)try{w=await(0,Be.F)().get(D.datasource)}catch{}else w=R;return{query:D,datasource:w}}))}},[o.datasourceUid,o.queries]),v=(0,N.wW)(Ar),x=async()=>{const R=o.queries,D=o.datasourceUid!==l?.uid;D&&await r({exploreId:i,datasource:o.datasourceUid}),u(i,R),(0,H.ff)("grafana_explore_query_history_run",{queryHistoryEnabled:G.config.queryHistoryEnabled,differentDataSource:D})},b=async()=>{const R=[...o.queries.map(w=>w.datasource?.type||"unknown")];if((0,H.ff)("grafana_explore_query_history_copy_query",{datasources:R,mixed:!!f?.datasourceInstance?.meta.mixed}),y||!f)return;const D=f.queries.map(w=>(0,ce.OH)(w.query,w.datasource)).join(`
`);(0,Lt.n9)(D),(0,De.WI)((0,Zt.$l)((0,Kt.AT)((0,E.t)("explore.rich-history-notification.query-copied","Query copied to clipboard"))))},C=async()=>{const R=(0,ce.t2)(o);await(0,Mt.L)(R)},F=()=>{const R=D=>{a(D),(0,De.WI)((0,Zt.$l)((0,Kt.AT)((0,E.t)("explore.rich-history-notification.query-deleted","Query deleted")))),(0,H.ff)("grafana_explore_query_history_deleted",{queryHistoryEnabled:G.config.queryHistoryEnabled})};o.starred?(0,et.N$)().publish(new tt.VJ({title:(0,E.t)("explore.rich-history-card.delete-query-confirmation-title","Delete"),text:(0,E.t)("explore.rich-history-card.delete-starred-query-confirmation-text","Are you sure you want to permanently delete your starred query?"),yesText:(0,E.t)("explore.rich-history-card.confirm-delete","Delete"),icon:"trash-alt",onConfirm:()=>R(o.id)})):R(o.id)},T=()=>{s(o.id,!o.starred),(0,H.ff)("grafana_explore_query_history_starred",{queryHistoryEnabled:G.config.queryHistoryEnabled,newValue:!o.starred})},L=()=>m(!h),I=()=>{n(o.id,p),m(!1),(0,H.ff)("grafana_explore_query_history_commented",{queryHistoryEnabled:G.config.queryHistoryEnabled})},P=()=>{m(!1),g(o.comment)},M=R=>{R.key==="Enter"&&(R.shiftKey||R.ctrlKey)&&I(),R.key==="Escape"&&P()},z=e.createElement("div",{className:v.updateCommentContainer,"aria-label":p?(0,E.t)("explore.rich-history-card.update-comment-form","Update comment form"):(0,E.t)("explore.rich-history-card.add-comment-form","Add comment form")},e.createElement(Ir.K,{onKeyDown:M,value:p,placeholder:p?void 0:(0,E.t)("explore.rich-history-card.optional-description","An optional description of what the query does."),onChange:R=>g(R.currentTarget.value),className:v.textArea}),e.createElement("div",{className:v.commentButtonRow},e.createElement(V.zx,{onClick:I},e.createElement(E.cC,{i18nKey:"explore.rich-history-card.save-comment"},"Save comment")),e.createElement(V.zx,{variant:"secondary",onClick:P},e.createElement(E.cC,{i18nKey:"explore.rich-history-card.cancel"},"Cancel")))),A=e.createElement("div",{className:v.queryActionButtons},e.createElement(We.h,{name:"comment-alt",onClick:L,tooltip:o.comment?.length>0?(0,E.t)("explore.rich-history-card.edit-comment-tooltip","Edit comment"):(0,E.t)("explore.rich-history-card.add-comment-tooltip","Add comment")}),e.createElement(We.h,{name:"copy",onClick:b,tooltip:(0,E.t)("explore.rich-history-card.copy-query-tooltip","Copy query to clipboard")}),f?.datasourceInstance&&e.createElement(We.h,{name:"share-alt",onClick:C,tooltip:e.createElement(E.cC,{i18nKey:"explore.rich-history-card.copy-shortened-link-tooltip"},"Copy shortened link to clipboard")}),e.createElement(We.h,{name:"trash-alt",title:(0,E.t)("explore.rich-history-card.delete-query-title","Delete query"),tooltip:(0,E.t)("explore.rich-history-card.delete-query-tooltip","Delete query"),onClick:F}),e.createElement(We.h,{name:o.starred?"favorite":"star",iconType:o.starred?"mono":"default",onClick:T,tooltip:o.starred?(0,E.t)("explore.rich-history-card.unstar-query-tooltip","Unstar query"):(0,E.t)("explore.rich-history-card.star-query-tooltip","Star query")}));return e.createElement("div",{className:v.queryCard},e.createElement("div",{className:v.cardRow},e.createElement(Vn,{dsApi:f?.datasourceInstance,size:"sm"}),A),e.createElement("div",{className:(0,d.cx)(v.cardRow)},e.createElement("div",{className:v.queryContainer},f?.queries.map((R,D)=>e.createElement(Pr,{query:R,key:`${R}-${D}`,showDsInfo:f?.datasourceInstance?.meta.mixed})),!h&&o.comment&&e.createElement("div",{"aria-label":(0,E.t)("explore.rich-history-card.query-comment-label","Query comment"),className:v.comment},o.comment),h&&z),!h&&e.createElement("div",{className:v.runButton},e.createElement(V.zx,{variant:"secondary",onClick:x,disabled:!f?.datasourceInstance||f.queries.some(R=>!R.datasource)},l?.uid===o.datasourceUid?e.createElement(E.cC,{i18nKey:"explore.rich-history-card.run-query-button"},"Run query"):e.createElement(E.cC,{i18nKey:"explore.rich-history-card.switch-datasource-button"},"Switch data source and run query")))),y&&e.createElement(Or.u,{text:(0,E.t)("explore.rich-history-card.loading-text","loading..."),className:v.loader}))}const Mr=t=>({queryRow:(0,d.css)`
    border-top: 1px solid ${t.colors.border.weak};
    display: flex;
    flex-direction: row;
    padding: 4px 0px;
    gap: 4px;
    :first-child {
      border-top: none;
    }
  `,dsInfoContainer:(0,d.css)`
    display: flex;
    align-items: center;
  `,queryText:(0,d.css)`
    word-break: break-all;
  `}),Pr=({query:t,showDsInfo:o=!1})=>{const n=(0,N.wW)(Mr);return e.createElement("div",{className:n.queryRow},o&&e.createElement("div",{className:n.dsInfoContainer},e.createElement(Vn,{dsApi:t.datasource,size:"md"}),": "),e.createElement("span",{"aria-label":(0,E.t)("explore.rich-history-card.query-text-label","Query text"),className:n.queryText},(0,ce.OH)(t.query,t.datasource)))},kr=t=>o=>(0,d.css)`
  display: flex;
  align-items: center;
  font-size: ${o.typography[t==="sm"?"bodySmall":"body"].fontSize};
  font-weight: ${o.typography.fontWeightMedium};
  white-space: nowrap;
`;function Vn({dsApi:t,size:o}){const n=(0,e.useCallback)(a=>kr(o)(a),[o]),s=(0,N.wW)(n);return e.createElement("div",{className:s},e.createElement("img",{src:t?.meta.info.logos.small||"public/img/icn-datasource.svg",alt:t?.type||(0,E.t)("explore.rich-history-card.datasource-not-exist","Data source does not exist anymore"),"aria-label":(0,E.t)("explore.rich-history-card.datasource-icon-label","Data source icon")}),e.createElement("div",{"aria-label":(0,E.t)("explore.rich-history-card.datasource-name-label","Data source name")},t?.name||(0,E.t)("explore.rich-history-card.datasource-not-exist","Data source does not exist anymore")))}const Un=zr(Hr),$r=(t,o)=>({container:(0,d.css)`
      display: flex;
    `,labelSlider:(0,d.css)`
      font-size: ${t.typography.bodySmall.fontSize};
      &:last-of-type {
        margin-top: ${t.spacing(3)};
      }
      &:first-of-type {
        font-weight: ${t.typography.fontWeightMedium};
        margin-bottom: ${t.spacing(2)};
      }
    `,containerContent:(0,d.css)`
      /* 134px is based on the width of the Query history tabs bar, so the content is aligned to right side of the tab */
      width: calc(100% - 134px);
    `,containerSlider:(0,d.css)`
      width: 129px;
      margin-right: ${t.spacing(1)};
    `,fixedSlider:(0,d.css)`
      position: fixed;
    `,slider:(0,d.css)`
      bottom: 10px;
      height: ${o-180}px;
      width: 129px;
      padding: ${t.spacing(1)} 0;
    `,selectors:(0,d.css)`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,filterInput:(0,d.css)`
      margin-bottom: ${t.spacing(1)};
    `,multiselect:(0,d.css)`
      width: 100%;
      margin-bottom: ${t.spacing(1)};
    `,sort:(0,d.css)`
      width: 170px;
    `,sessionName:(0,d.css)`
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      margin-top: ${t.spacing(3)};
      h4 {
        margin: 0 10px 0 0;
      }
    `,heading:(0,d.css)`
      font-size: ${t.typography.h4.fontSize};
      margin: ${t.spacing(2,.25,1,.25)};
    `,footer:(0,d.css)`
      height: 60px;
      margin: ${t.spacing(3)} auto;
      display: flex;
      justify-content: center;
      font-weight: ${t.typography.fontWeightLight};
      font-size: ${t.typography.bodySmall.fontSize};
      a {
        font-weight: ${t.typography.fontWeightMedium};
        margin-left: ${t.spacing(.25)};
      }
    `,queries:(0,d.css)`
      font-size: ${t.typography.bodySmall.fontSize};
      font-weight: ${t.typography.fontWeightRegular};
      margin-left: ${t.spacing(.5)};
    `});function Br(t){const{queries:o,totalQueries:n,loading:s,richHistorySearchFilters:a,updateFilters:r,clearRichHistoryResults:i,loadMoreRichHistory:l,richHistorySettings:u,exploreId:h,height:m,activeDatasourceInstance:p}=t,g=(0,N.wW)($r,m),f=(0,ce.DR)();if((0,e.useEffect)(()=>{const b=!u.activeDatasourceOnly&&u.lastUsedDatasourceFilters?u.lastUsedDatasourceFilters:[p],C={search:"",sortOrder:ce.As.Descending,datasourceFilters:b,from:0,to:u.retentionPeriod,starred:!1};return r(C),()=>{i()}},[]),!a)return e.createElement("span",null,e.createElement(E.cC,{i18nKey:"explore.rich-history-queries-tab.loading"},"Loading..."),";");const y=(0,ce.k4)(o,a.sortOrder),v=jn(),x=o.length&&o.length!==n;return e.createElement("div",{className:g.container},e.createElement("div",{className:g.containerSlider},e.createElement("div",{className:g.fixedSlider},e.createElement("div",{className:g.labelSlider},e.createElement(E.cC,{i18nKey:"explore.rich-history-queries-tab.filter-history"},"Filter history")),e.createElement("div",{className:g.labelSlider},(0,ce.bQ)(a.from)),e.createElement("div",{className:g.slider},e.createElement(Fr.U,{tooltipAlwaysVisible:!1,min:0,max:u.retentionPeriod,value:[a.from,a.to],orientation:"vertical",formatTooltipResult:ce.bQ,reverse:!0,onAfterChange:b=>{r({from:b[0],to:b[1]})}})),e.createElement("div",{className:g.labelSlider},(0,ce.bQ)(a.to)))),e.createElement("div",{className:g.containerContent,"data-testid":"query-history-queries-tab"},e.createElement("div",{className:g.selectors},!u.activeDatasourceOnly&&e.createElement(Ie.NU,{className:g.multiselect,options:f.map(b=>({value:b.name,label:b.name})),value:a.datasourceFilters,placeholder:(0,E.t)("explore.rich-history-queries-tab.filter-placeholder","Filter queries for data sources(s)"),"aria-label":(0,E.t)("explore.rich-history-queries-tab.filter-aria-label","Filter queries for data sources(s)"),onChange:b=>{r({datasourceFilters:b.map(C=>C.value)})}}),e.createElement("div",{className:g.filterInput},e.createElement(Wn.H,{escapeRegex:!1,placeholder:(0,E.t)("explore.rich-history-queries-tab.search-placeholder","Search queries"),value:a.search,onChange:b=>r({search:b})})),e.createElement("div",{"aria-label":(0,E.t)("explore.rich-history-queries-tab.sort-aria-label","Sort queries"),className:g.sort},e.createElement(Ie.Ph,{value:v.filter(b=>b.value===a.sortOrder),options:v,placeholder:(0,E.t)("explore.rich-history-queries-tab.sort-placeholder","Sort queries by"),onChange:b=>r({sortOrder:b.value})}))),s&&e.createElement("span",null,e.createElement(E.cC,{i18nKey:"explore.rich-history-queries-tab.loading-results"},"Loading results...")),!s&&Object.keys(y).map(b=>e.createElement("div",{key:b},e.createElement("div",{className:g.heading},b," ",e.createElement("span",{className:g.queries},x?e.createElement(E.cC,{i18nKey:"explore.rich-history-queries-tab.displaying-partial-queries",defaults:"Displaying {{ count }} queries",values:{count:y[b].length}}):e.createElement(E.cC,{i18nKey:"explore.rich-history-queries-tab.displaying-queries",defaults:"{{ count }} queries",values:{count:y[b].length}}))),y[b].map(C=>e.createElement(Un,{queryHistoryItem:C,key:C.id,exploreId:h})))),x?e.createElement("div",null,e.createElement(E.cC,{i18nKey:"explore.rich-history-queries-tab.showing-queries",defaults:"Showing {{ shown }} of {{ total }} <0>Load more</0>",values:{shown:o.length,total:n},components:[e.createElement(V.zx,{onClick:l,key:"loadMoreButton"},"Load more")]})):null,e.createElement("div",{className:g.footer},G.config.queryHistoryEnabled?"":(0,E.t)("explore.rich-history-queries-tab.history-local","The history is local to your browser and is not shared with others."))))}var Wr=c(76912);const Vr=t=>({container:(0,d.css)`
      font-size: ${t.typography.bodySmall.fontSize};
    `,spaceBetween:(0,d.css)`
      margin-bottom: ${t.spacing(3)};
    `,input:(0,d.css)`
      max-width: 200px;
    `,bold:(0,d.css)`
      font-weight: ${t.typography.fontWeightBold};
    `,bottomMargin:(0,d.css)`
      margin-bottom: ${t.spacing(1)};
    `}),Qn=[{value:2,label:(0,E.t)("explore.rich-history-settings-tab.retention-period.2-days","2 days")},{value:5,label:(0,E.t)("explore.rich-history-settings-tab.retention-period.5-days","5 days")},{value:7,label:(0,E.t)("explore.rich-history-settings-tab.retention-period.1-week","1 week")},{value:14,label:(0,E.t)("explore.rich-history-settings-tab.retention-period.2-weeks","2 weeks")}];function Ur(t){const{retentionPeriod:o,starredTabAsFirstTab:n,activeDatasourceOnly:s,onChangeRetentionPeriod:a,toggleStarredTabAsFirstTab:r,toggleactiveDatasourceOnly:i,deleteRichHistory:l}=t,u=(0,N.wW)(Vr),h=Qn.find(p=>p.value===o),m=()=>{(0,et.N$)().publish(new tt.VJ({title:(0,E.t)("explore.rich-history-settings-tab.delete-title","Delete"),text:(0,E.t)("explore.rich-history-settings-tab.delete-confirm-text","Are you sure you want to permanently delete your query history?"),yesText:(0,E.t)("explore.rich-history-settings-tab.delete-confirm","Delete"),icon:"trash-alt",onConfirm:()=>{l(),(0,De.WI)((0,Zt.$l)((0,Kt.AT)((0,E.t)("explore.rich-history-settings-tab.query-history-deleted","Query history deleted"))))}}))};return e.createElement("div",{className:u.container},(0,Ge.X)().changeRetention?e.createElement(we.g,{label:(0,E.t)("explore.rich-history-settings-tab.history-time-span","History time span"),description:(0,E.t)("explore.rich-history-settings-tab.history-time-span-description","Select the period of time for which Grafana will save your query history. Up to {{MAX_HISTORY_ITEMS}} entries will be stored.",{MAX_HISTORY_ITEMS:Wr.H6})},e.createElement("div",{className:u.input},e.createElement(Ie.Ph,{value:h,options:Qn,onChange:a}))):e.createElement(Ze.b,{severity:"info",title:(0,E.t)("explore.rich-history-settings-tab.history-time-span","History time span")},(0,E.t)("explore.rich-history-settings-tab.alert-info","Grafana will keep entries up to {{optionLabel}}.Starred entries won't be deleted.",{optionLabel:h?.label})),e.createElement(Ee._,{label:(0,E.t)("explore.rich-history-settings-tab.change-default-tab","Change the default active tab from \u201CQuery history\u201D to \u201CStarred\u201D"),className:u.spaceBetween},e.createElement(Oe.x,{id:"explore-query-history-settings-default-active-tab",value:n,onChange:r})),(0,Ge.X)().onlyActiveDataSource&&e.createElement(Ee._,{label:(0,E.t)("explore.rich-history-settings-tab.only-show-active-datasource","Only show queries for data source currently active in Explore"),className:u.spaceBetween},e.createElement(Oe.x,{id:"explore-query-history-settings-data-source-behavior",value:s,onChange:i})),(0,Ge.X)().clearHistory&&e.createElement("div",null,e.createElement("div",{className:u.bold},e.createElement(E.cC,{i18nKey:"explore.rich-history-settings-tab.clear-query-history"},"Clear query history")),e.createElement("div",{className:u.bottomMargin},e.createElement(E.cC,{i18nKey:"explore.rich-history-settings-tab.clear-history-info"},"Delete all of your query history, permanently.")),e.createElement(V.zx,{variant:"destructive",onClick:m},e.createElement(E.cC,{i18nKey:"explore.rich-history-settings-tab.clear-query-history-button"},"Clear query history"))))}const Qr=t=>({container:(0,d.css)`
      display: flex;
    `,containerContent:(0,d.css)`
      width: 100%;
    `,selectors:(0,d.css)`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,multiselect:(0,d.css)`
      width: 100%;
      margin-bottom: ${t.spacing(1)};
    `,filterInput:(0,d.css)`
      margin-bottom: ${t.spacing(1)};
    `,sort:(0,d.css)`
      width: 170px;
    `,footer:(0,d.css)`
      height: 60px;
      margin-top: ${t.spacing(3)};
      display: flex;
      justify-content: center;
      font-weight: ${t.typography.fontWeightLight};
      font-size: ${t.typography.bodySmall.fontSize};
      a {
        font-weight: ${t.typography.fontWeightMedium};
        margin-left: ${t.spacing(.25)};
      }
    `});function jr(t){const{updateFilters:o,clearRichHistoryResults:n,loadMoreRichHistory:s,activeDatasourceInstance:a,richHistorySettings:r,queries:i,totalQueries:l,loading:u,richHistorySearchFilters:h,exploreId:m}=t,p=(0,N.wW)(Qr),g=(0,ce.DR)();if((0,e.useEffect)(()=>{const y=r.activeDatasourceOnly&&r.lastUsedDatasourceFilters?r.lastUsedDatasourceFilters:[a],v={search:"",sortOrder:ce.As.Descending,datasourceFilters:y,from:0,to:r.retentionPeriod,starred:!0};return o(v),()=>{n()}},[]),!h)return e.createElement("span",null,e.createElement(E.cC,{i18nKey:"explore.rich-history-starred-tab.loading"},"Loading..."),";");const f=jn();return e.createElement("div",{className:p.container},e.createElement("div",{className:p.containerContent},e.createElement("div",{className:p.selectors},!r.activeDatasourceOnly&&e.createElement(Ie.NU,{className:p.multiselect,options:g.map(y=>({value:y.name,label:y.name})),value:h.datasourceFilters,placeholder:(0,E.t)("explore.rich-history-starred-tab.filter-queries-placeholder","Filter queries for data sources(s)"),"aria-label":(0,E.t)("explore.rich-history-starred-tab.filter-queries-aria-label","Filter queries for data sources(s)"),onChange:y=>{o({datasourceFilters:y.map(v=>v.value)})}}),e.createElement("div",{className:p.filterInput},e.createElement(Wn.H,{escapeRegex:!1,placeholder:(0,E.t)("explore.rich-history-starred-tab.search-queries-placeholder","Search queries"),value:h.search,onChange:y=>o({search:y})})),e.createElement("div",{"aria-label":(0,E.t)("explore.rich-history-starred-tab.sort-queries-aria-label","Sort queries"),className:p.sort},e.createElement(Ie.Ph,{value:f.filter(y=>y.value===h.sortOrder),options:f,placeholder:(0,E.t)("explore.rich-history-starred-tab.sort-queries-placeholder","Sort queries by"),onChange:y=>o({sortOrder:y.value})}))),u&&e.createElement("span",null,e.createElement(E.cC,{i18nKey:"explore.rich-history-starred-tab.loading-results"},"Loading results...")),!u&&i.map(y=>e.createElement(Un,{queryHistoryItem:y,key:y.id,exploreId:m})),i.length&&i.length!==l?e.createElement("div",null,e.createElement(E.cC,{i18nKey:"explore.rich-history-starred-tab.showing-queries",defaults:"Showing {{ shown }} of {{ total }} <0>Load more</0>",values:{shown:i.length,total:l},components:[e.createElement(V.zx,{onClick:s,key:"loadMoreButton"},"Load more")]})):null,e.createElement("div",{className:p.footer},G.config.queryHistoryEnabled?"":(0,E.t)("explore.rich-history-starred-tab.local-history-message","The history is local to your browser and is not shared with others."))))}var Yt=(t=>(t.RichHistory="Query history",t.Starred="Starred",t.Settings="Settings",t))(Yt||{});const jn=()=>[{label:(0,E.t)("explore.rich-history.newest-first","Newest first"),value:ce.As.Descending},{label:(0,E.t)("explore.rich-history.oldest-first","Oldest first"),value:ce.As.Ascending},{label:(0,E.t)("explore.rich-history.datasource-a-z","Data source A-Z"),value:ce.As.DatasourceAZ},{label:(0,E.t)("explore.rich-history.datasource-z-a","Data source Z-A"),value:ce.As.DatasourceZA}].filter(t=>(0,Ge.X)().availableFilters.includes(t.value));function Gr(t){const{richHistory:o,richHistoryTotal:n,height:s,exploreId:a,deleteRichHistory:r,onClose:i,firstTab:l,activeDatasourceInstance:u}=t,[h,m]=(0,e.useState)(!1),p=L=>{t.updateHistorySettings({...t.richHistorySettings,...L})},g=L=>{const I={...t.richHistorySearchFilters,...L,page:1};t.updateHistorySearchFilters(t.exploreId,I),f()},f=(0,ie.debounce)(()=>{t.loadRichHistory(t.exploreId),m(!0)},300),y=L=>{L.value!==void 0&&p({retentionPeriod:L.value})},v=()=>p({starredTabAsFirstTab:!t.richHistorySettings.starredTabAsFirstTab}),x=()=>p({activeDatasourceOnly:!t.richHistorySettings.activeDatasourceOnly});(0,e.useEffect)(()=>{m(!1)},[o]);const b={label:(0,E.t)("explore.rich-history.query-history","Query history"),value:"Query history",content:e.createElement(Br,{queries:o,totalQueries:n||0,loading:h,updateFilters:g,clearRichHistoryResults:()=>t.clearRichHistoryResults(t.exploreId),loadMoreRichHistory:()=>t.loadMoreRichHistory(t.exploreId),activeDatasourceInstance:u,richHistorySettings:t.richHistorySettings,richHistorySearchFilters:t.richHistorySearchFilters,exploreId:a,height:s}),icon:"history"},C={label:(0,E.t)("explore.rich-history.starred","Starred"),value:"Starred",content:e.createElement(jr,{queries:o,totalQueries:n||0,loading:h,activeDatasourceInstance:u,updateFilters:g,clearRichHistoryResults:()=>t.clearRichHistoryResults(t.exploreId),loadMoreRichHistory:()=>t.loadMoreRichHistory(t.exploreId),richHistorySettings:t.richHistorySettings,richHistorySearchFilters:t.richHistorySearchFilters,exploreId:a}),icon:"star"},F={label:(0,E.t)("explore.rich-history.settings","Settings"),value:"Settings",content:e.createElement(Ur,{retentionPeriod:t.richHistorySettings.retentionPeriod,starredTabAsFirstTab:t.richHistorySettings.starredTabAsFirstTab,activeDatasourceOnly:t.richHistorySettings.activeDatasourceOnly,onChangeRetentionPeriod:y,toggleStarredTabAsFirstTab:v,toggleactiveDatasourceOnly:x,deleteRichHistory:r}),icon:"sliders-v-alt"};let T=[b,C,F];return e.createElement(ln.W,{tabs:T,onClose:i,defaultTab:l,closeIconTooltip:(0,E.t)("explore.rich-history.close-tooltip","Close query history")})}function Zr(t,{exploreId:o}){const n=t.explore,s=n.panes[o],a=s.richHistorySearchFilters,r=n.richHistorySettings,{datasourceInstance:i}=s,l=r?.starredTabAsFirstTab?Yt.Starred:Yt.RichHistory,{richHistory:u,richHistoryTotal:h}=s;return{richHistory:u,richHistoryTotal:h,firstTab:l,activeDatasourceInstance:i.name,richHistorySettings:r,richHistorySearchFilters:a}}const Kr={initRichHistory:xe.sO,loadRichHistory:xe.TV,loadMoreRichHistory:xe.io,clearRichHistoryResults:xe.Cs,updateHistorySettings:xe.ch,updateHistorySearchFilters:xe.KZ,deleteRichHistory:xe.ik},Yr=(0,ge.connect)(Zr,Kr);function qr(t){const o=(0,N.l4)(),[n,s]=(0,e.useState)(o.components.horizontalDrawer.defaultHeight),{richHistory:a,richHistoryTotal:r,width:i,firstTab:l,activeDatasourceInstance:u,exploreId:h,deleteRichHistory:m,initRichHistory:p,loadRichHistory:g,loadMoreRichHistory:f,clearRichHistoryResults:y,richHistorySettings:v,updateHistorySettings:x,richHistorySearchFilters:b,updateHistorySearchFilters:C,onClose:F}=t;return(0,e.useEffect)(()=>{p(),(0,H.ff)("grafana_explore_query_history_opened",{queryHistoryEnabled:G.config.queryHistoryEnabled})},[p]),v?e.createElement(mn,{width:i,onResize:(T,L,I)=>{s(Number(I.style.height.slice(0,-2)))}},e.createElement(Gr,{richHistory:a,richHistoryTotal:r,firstTab:l,activeDatasourceInstance:u,exploreId:h,onClose:F,height:n,deleteRichHistory:m,richHistorySettings:v,richHistorySearchFilters:b,updateHistorySettings:x,updateHistorySearchFilters:C,loadRichHistory:g,loadMoreRichHistory:f,clearRichHistoryResults:y})):e.createElement("span",null,e.createElement(E.cC,{i18nKey:"explore.rich-history-container.loading"},"Loading..."))}const Jr=Yr(qr);var Xr=c(71081);const _r=t=>({containerMargin:(0,d.css)`
      display: flex;
      flex-wrap: wrap;
      gap: ${t.spacing(1)};
      margin-top: ${t.spacing(2)};
    `});function ei(t){const o=(0,N.l4)(),n=_r(o);return e.createElement("div",{className:n.containerMargin},!t.addQueryRowButtonHidden&&e.createElement(ue.h,{variant:"canvas","aria-label":(0,E.t)("explore.secondary-actions.query-add-button-aria-label","Add query"),onClick:t.onClickAddQueryRowButton,disabled:t.addQueryRowButtonDisabled,icon:"plus"},e.createElement(E.cC,{i18nKey:"explore.secondary-actions.query-add-button"},"Add query")),!t.richHistoryRowButtonHidden&&e.createElement(ue.h,{variant:t.richHistoryButtonActive?"active":"canvas","aria-label":(0,E.t)("explore.secondary-actions.query-history-button-aria-label","Query history"),onClick:t.onClickRichHistoryButton,"data-testid":Xr.z.QueryTab.queryHistoryButton,icon:"history"},e.createElement(E.cC,{i18nKey:"explore.secondary-actions.query-history-button"},"Query history")),e.createElement(ue.h,{variant:t.queryInspectorButtonActive?"active":"canvas","aria-label":(0,E.t)("explore.secondary-actions.query-inspector-button-aria-label","Query inspector"),onClick:t.onClickQueryInspectorButton,icon:"info-circle"},e.createElement(E.cC,{i18nKey:"explore.secondary-actions.query-inspector-button"},"Query inspector")))}var Gn=c(66735);function ti(t,{exploreId:o}){const s=t.explore.panes[o],{tableResult:a,range:r}=s,i=(0,Q.$9)(o);return{loading:a&&a.length>0?!1:i,tableResult:a,range:r}}const ni=(0,ge.connect)(ti,{});class Zn extends e.PureComponent{constructor(){super(...arguments),this.hasSubFrames=o=>o.fields.some(n=>n.type===Nn.fS.nestedFrames)}getTableHeight(o,n){return o===0?200:Math.min(600,Math.max(o*36,n?300:0)+40+46)}getTableTitle(o,n,s){let a=n.name;return!a&&(o?.length??0)>1&&(a=n.refId||`${s}`),a?(0,E.t)("explore.table.title-with-name","Table - {{name}}",{name:a}):(0,E.t)("explore.table.title","Table")}render(){const{loading:o,onCellFilterAdded:n,tableResult:s,width:a,splitOpenFn:r,range:i,ariaLabel:l,timeZone:u,theme:h}=this.props;let m=(0,Gn.yR)(s)?(0,Gn.Bc)(s):s;const p=(0,He.qQ)(r,i);m?.length&&(m=(0,St.SM)({data:m,timeZone:u,theme:Gt.config.theme2,replaceVariables:(0,Ct.J)().replace.bind((0,Ct.J)()),fieldConfig:{defaults:{},overrides:[]},dataLinkPostProcessor:p}));const g=m?.filter(f=>!!f&&f.length!==0);return e.createElement(e.Fragment,null,g&&g.length===0&&e.createElement(Re.fm,{title:(0,E.t)("explore.table.title","Table"),width:a,height:200},()=>e.createElement(kt,{metaItems:[{value:(0,E.t)("explore.table.no-data","0 series returned")}]})),g&&g.length>0&&e.createElement("div",{className:(0,d.css)({display:"flex",flexDirection:"column",gap:h.spacing(1)})},g.map((f,y)=>e.createElement(Re.fm,{key:f.refId||`table-${y}`,title:this.getTableTitle(m,f,y),width:a,height:this.getTableHeight(f.length,this.hasSubFrames(f)),loadingState:o?K.Gu.Loading:void 0},(v,x)=>e.createElement($t.i,{ariaLabel:l,data:f,width:v,height:x,onCellFilterAdded:n})))))}}const zi=(0,N.HE)(Zn),oi=(0,N.HE)(ni(Zn));var si=c(22920),ai=c(81811),ri=c(21675);function ii(t){const o=t.dataFrames[0],{dataFrames:n,splitOpenFn:s,exploreId:a,scrollElement:r}=t,i=(0,e.useMemo)(()=>(0,ri.N)(o),[o]),l=(0,O.useSelector)(u=>u.explore.panes[t.exploreId]?.datasourceInstance??void 0);return i?e.createElement(si.f,{padding:"none",title:"Trace"},e.createElement(ai.m,{exploreId:a,dataFrames:n,splitOpenFn:s,scrollElement:r,traceProp:i,datasource:l})):null}const li=t=>({exploreMain:(0,d.css)({label:"exploreMain",position:"relative",marginTop:"21px",display:"flex",flexDirection:"column",gap:t.spacing(1)}),queryContainer:(0,d.css)({label:"queryContainer",padding:t.spacing(1)}),exploreContainer:(0,d.css)({label:"exploreContainer",display:"flex",flexDirection:"column",paddingRight:t.spacing(2),marginBottom:t.spacing(2)}),left:(0,d.css)({marginBottom:t.spacing(2)}),wrapper:(0,d.css)({position:"absolute",top:0,left:t.spacing(2),right:0,bottom:0,display:"flex"})});var ci=(t=>(t[t.RichHistory=0]="RichHistory",t[t.QueryInspector=1]="QueryInspector",t))(ci||{});class ui extends e.PureComponent{constructor(o){super(o),this.memoizedGetNodeGraphDataFrames=(0,$e.Z)(ho.Ee),this.onChangeTime=n=>{const{updateTimeRange:s,exploreId:a}=this.props;s({exploreId:a,rawRange:n})},this.onClickExample=n=>{this.props.setQueries(this.props.exploreId,[n])},this.onCellFilterAdded=n=>{const{value:s,key:a,operator:r}=n;r===it.PT&&this.onClickFilterLabel(a,s),r===it.tE&&this.onClickFilterOutLabel(a,s)},this.onContentOutlineToogle=()=>{this.setState(n=>((0,H.ff)("explore_toolbar_contentoutline_clicked",{item:"outline",type:n.contentOutlineVisible?"close":"open"}),{contentOutlineVisible:!n.contentOutlineVisible}))},this.isFilterLabelActive=async(n,s,a)=>{const r=this.props.queries.find(l=>l.refId===a);if(!r)return!1;const i=await(0,Be.F)().get(r.datasource);return!!((0,Z.Vw)(i)&&i.queryHasFilter(r,{key:n,value:s}))},this.onClickFilterLabel=(n,s,a)=>{this.onModifyQueries({type:"ADD_FILTER",options:{key:n,value:s},frame:a},a?.refId)},this.onClickFilterOutLabel=(n,s,a)=>{this.onModifyQueries({type:"ADD_FILTER_OUT",options:{key:n,value:s},frame:a},a?.refId)},this.onClickFilterValue=(n,s)=>{this.onModifyQueries({type:"ADD_STRING_FILTER",options:{value:n}},s)},this.onClickFilterOutValue=(n,s)=>{this.onModifyQueries({type:"ADD_STRING_FILTER_OUT",options:{value:n}},s)},this.onClickAddQueryRowButton=()=>{const{exploreId:n,queryKeys:s}=this.props;this.props.addQueryRow(n,s.length)},this.onModifyQueries=(n,s)=>{const a=async(r,i)=>{if(s&&s!==r.refId)return r;const{datasource:l}=r;if(l==null)return r;const u=await(0,Be.F)().get(l),h=["ADD_FILTER","ADD_FILTER_OUT"];return(0,Z.Vw)(u)&&h.includes(i.type)?u.toggleQueryFilter(r,{type:i.type==="ADD_FILTER"?"FILTER_FOR":"FILTER_OUT",options:i.options??{},frame:i.frame}):u.modifyQuery?u.modifyQuery(r,i):r};this.props.modifyQueries(this.props.exploreId,n,a)},this.onResize=n=>{this.props.changeSize(this.props.exploreId,n)},this.onStartScanning=()=>{this.props.scanStart(this.props.exploreId)},this.onStopScanning=()=>{this.props.scanStopAction({exploreId:this.props.exploreId})},this.onUpdateTimeRange=n=>{const{exploreId:s,updateTimeRange:a}=this.props;a({exploreId:s,absoluteRange:n})},this.toggleShowRichHistory=()=>{this.setState(n=>({openDrawer:n.openDrawer===0?void 0:0}))},this.toggleShowQueryInspector=()=>{this.setState(n=>({openDrawer:n.openDrawer===1?void 0:1}))},this.onSplitOpen=n=>async s=>{if(this.props.splitOpen(s),s&&this.props.datasourceInstance){const a=(await(0,Be.F)().get(s.datasourceUid)).type,r=this.props.datasourceInstance.uid===Tt.D?(0,ie.get)(this.props.queries,"0.datasource.type"):this.props.datasourceInstance.type,i={origin:"panel",panelType:n,source:r,target:a,exploreId:this.props.exploreId};(0,H.ff)("grafana_explore_split_view_opened",i)}},this.state={openDrawer:void 0,contentOutlineVisible:!1},this.graphEventBus=o.eventBus.newScopedBus("graph",{onlyLocal:!1}),this.logsEventBus=o.eventBus.newScopedBus("logs",{onlyLocal:!1})}renderEmptyState(o){return e.createElement("div",{className:(0,d.cx)(o)},e.createElement(nr,null))}renderNoData(){return e.createElement(_a,null)}renderCustom(o){const{timeZone:n,queryResponse:s,absoluteRange:a,eventBus:r}=this.props,i=(0,ie.groupBy)(s?.customFrames,"meta.preferredVisualisationPluginId");return Object.entries(i).map(([l,u],h)=>e.createElement(fe,{title:l,icon:"plug",key:h},e.createElement(Ho,{key:h,timeZone:n,pluginId:l,frames:u,state:s.state,absoluteRange:a,height:400,width:o,splitOpenFn:this.onSplitOpen(l),eventBus:r})))}renderGraphPanel(o){const{graphResult:n,absoluteRange:s,timeZone:a,queryResponse:r,showFlameGraph:i}=this.props;return e.createElement(fe,{title:"Graph",icon:"graph-bar"},e.createElement(Os.F,{data:n,height:i?180:400,width:o,absoluteRange:s,timeZone:a,onChangeTime:this.onUpdateTimeRange,annotations:r.annotations,splitOpenFn:this.onSplitOpen("graph"),loadingState:r.state,eventBus:this.graphEventBus}))}renderTablePanel(o){const{exploreId:n,timeZone:s}=this.props;return e.createElement(fe,{title:"Table",icon:"table"},e.createElement(oi,{ariaLabel:at.wl.pages.Explore.General.table,width:o,exploreId:n,onCellFilterAdded:this.onCellFilterAdded,timeZone:s,splitOpenFn:this.onSplitOpen("table")}))}renderRawPrometheus(o){const{exploreId:n,datasourceInstance:s,timeZone:a}=this.props;return e.createElement(fe,{title:"Raw Prometheus",icon:"gf-prometheus"},e.createElement(Cr,{showRawPrometheus:!0,ariaLabel:at.wl.pages.Explore.General.table,width:o,exploreId:n,onCellFilterAdded:s?.modifyQuery?this.onCellFilterAdded:void 0,timeZone:a,splitOpenFn:this.onSplitOpen("table")}))}renderLogsPanel(o){const{exploreId:n,syncedTimes:s,theme:a,queryResponse:r}=this.props,i=parseInt(a.spacing(2).slice(0,-2),10),l=(0,d.css)({display:"flex",flexDirection:"column",gap:a.spacing(1)});return e.createElement(fe,{title:"Logs",icon:"gf-logs",className:l},e.createElement(qa,{exploreId:n,loadingState:r.state,syncedTimes:s,width:o-i,onClickFilterLabel:this.onClickFilterLabel,onClickFilterOutLabel:this.onClickFilterOutLabel,onStartScanning:this.onStartScanning,onStopScanning:this.onStopScanning,eventBus:this.logsEventBus,splitOpenFn:this.onSplitOpen("logs"),scrollElement:this.scrollElement,isFilterLabelActive:this.isFilterLabelActive,onClickFilterValue:this.onClickFilterValue,onClickFilterOutValue:this.onClickFilterOutValue}))}renderLogsSamplePanel(){const{logsSample:o,timeZone:n,setSupplementaryQueryEnabled:s,exploreId:a,datasourceInstance:r,queries:i}=this.props;return e.createElement(fe,{title:"Logs Sample",icon:"gf-logs"},e.createElement(Ja,{queryResponse:o.data,timeZone:n,enabled:o.enabled,queries:i,datasourceInstance:r,splitOpen:this.onSplitOpen("logsSample"),setLogsSampleEnabled:l=>s(a,l,Z.v8.LogsSample)}))}renderNodeGraphPanel(){const{exploreId:o,showTrace:n,queryResponse:s,datasourceInstance:a}=this.props,r=a?a?.type:"unknown";return e.createElement(fe,{title:"Node Graph",icon:"code-branch"},e.createElement(lr,{dataFrames:this.memoizedGetNodeGraphDataFrames(s.series),exploreId:o,withTraceView:n,datasourceType:r,splitOpenFn:this.onSplitOpen("nodeGraph")}))}renderFlameGraphPanel(){const{queryResponse:o}=this.props;return e.createElement(fe,{title:"Flame Graph",icon:"fire"},e.createElement(Fs,{dataFrames:o.flameGraphFrames}))}renderTraceViewPanel(){const{queryResponse:o,exploreId:n}=this.props,s=o.series.filter(a=>a.meta?.preferredVisualisationType==="trace");return s.length&&e.createElement(fe,{title:"Traces",icon:"file-alt"},e.createElement(ii,{exploreId:n,dataFrames:s,splitOpenFn:this.onSplitOpen("traceView"),scrollElement:this.scrollElement}))}render(){const{datasourceInstance:o,exploreId:n,graphResult:s,queryResponse:a,isLive:r,theme:i,showMetrics:l,showTable:u,showRawPrometheus:h,showLogs:m,showTrace:p,showCustom:g,showNodeGraph:f,showFlameGraph:y,timeZone:v,showLogsSample:x,correlationEditorDetails:b,correlationEditorHelperData:C}=this.props,{openDrawer:F,contentOutlineVisible:T}=this.state,L=li(i),I=a&&a.state!==K.Gu.NotStarted,P=F===0,M=!(0,Ge.X)().queryHistoryAvailable,z=F===1,A=a.state===K.Gu.Done&&[a.logsFrames,a.graphFrames,a.nodeGraphFrames,a.flameGraphFrames,a.tableFrames,a.rawPrometheusFrames,a.traceFrames,a.customFrames].every(S=>S.length===0);let R;const D=b?.editorMode;return!!(D||b?.correlationDirty)&&C!==void 0&&(R=e.createElement(Io,{exploreId:n,correlations:C})),e.createElement(yo,null,e.createElement(Ts,{exploreId:n,onChangeTime:this.onChangeTime,onContentOutlineToogle:this.onContentOutlineToogle,isContentOutlineOpen:T}),e.createElement("div",{style:{position:"relative",height:"100%",paddingLeft:i.spacing(2)}},e.createElement("div",{className:L.wrapper},T&&e.createElement("div",{className:L.left},e.createElement(So,{scroller:this.scrollElement,panelId:`content-outline-container-${n}`})),e.createElement(rt.$,{testId:at.wl.pages.Explore.General.scrollView,scrollRefCallback:S=>this.scrollElement=S||void 0,hideHorizontalTrack:!0},e.createElement("div",{className:L.exploreContainer},o?e.createElement(e.Fragment,null,e.createElement(fe,{title:"Queries",icon:"arrow"},e.createElement(Ft.l,{className:L.queryContainer},R,e.createElement(pr,{exploreId:n}),e.createElement(ei,{addQueryRowButtonDisabled:r||D&&o.meta.mixed,addQueryRowButtonHidden:!1,richHistoryRowButtonHidden:M,richHistoryButtonActive:P,queryInspectorButtonActive:z,onClickAddQueryRowButton:this.onClickAddQueryRowButton,onClickRichHistoryButton:this.toggleShowRichHistory,onClickQueryInspectorButton:this.toggleShowQueryInspector}),e.createElement(Lr,{exploreId:n}))),e.createElement(po.Z,{onResize:this.onResize,disableHeight:!0},({width:S})=>S===0?null:e.createElement("main",{className:(0,d.cx)(L.exploreMain),style:{width:S}},e.createElement(oe.z4,null,I&&e.createElement(e.Fragment,null,l&&s&&e.createElement(oe.z4,null,this.renderGraphPanel(S)),h&&e.createElement(oe.z4,null,this.renderRawPrometheus(S)),u&&e.createElement(oe.z4,null,this.renderTablePanel(S)),m&&e.createElement(oe.z4,null,this.renderLogsPanel(S)),f&&e.createElement(oe.z4,null,this.renderNodeGraphPanel()),y&&e.createElement(oe.z4,null,this.renderFlameGraphPanel()),p&&e.createElement(oe.z4,null,this.renderTraceViewPanel()),x&&e.createElement(oe.z4,null,this.renderLogsSamplePanel()),g&&e.createElement(oe.z4,null,this.renderCustom(S)),A&&e.createElement(oe.z4,null,this.renderNoData())),P&&e.createElement(Jr,{width:S,exploreId:n,onClose:this.toggleShowRichHistory}),z&&e.createElement(ns,{exploreId:n,width:S,onClose:this.toggleShowQueryInspector,timeZone:v}))))):this.renderEmptyState(L.exploreContainer))))))}}function di(t,{exploreId:o}){const n=t.explore,{syncedTimes:s}=n,a=n.panes[o],r=(0,lt.Z)(t.user),{datasourceInstance:i,queryKeys:l,queries:u,isLive:h,graphResult:m,tableResult:p,logsResult:g,showLogs:f,showMetrics:y,showTable:v,showTrace:x,showCustom:b,absoluteRange:C,queryResponse:F,showNodeGraph:T,showFlameGraph:L,showRawPrometheus:I,supplementaryQueries:P,correlationEditorHelperData:M}=a,z=(0,Q.$9)(o)(t),A=P[Z.v8.LogsSample],R=!!(A.dataProvider!==void 0&&!g&&(m||p));return{datasourceInstance:i,queryKeys:l,queries:u,isLive:h,graphResult:m,logsResult:g??void 0,absoluteRange:C,queryResponse:F,syncedTimes:s,timeZone:r,showLogs:f,showMetrics:y,showTable:v,showTrace:x,showCustom:b,showNodeGraph:T,showRawPrometheus:I,showFlameGraph:L,splitted:(0,te.pd)(t),loading:z,logsSample:A,showLogsSample:R,correlationEditorHelperData:M,correlationEditorDetails:n.correlationEditorDetails}}const pi={changeSize:Ce.qN,modifyQueries:Q.sK,scanStart:Q.EA,scanStopAction:Q.P4,setQueries:Q.KO,updateTimeRange:Te.cD,addQueryRow:Q.CS,splitOpen:U.bW,setSupplementaryQueryEnabled:Q.z0},hi=(0,ge.connect)(di,pi),mi=(0,N.HE)(hi(ui)),gi=t=>({explore:(0,d.css)`
      label: explorePaneContainer;
      display: flex;
      flex-direction: column;
      min-width: 600px;
      height: 100%;
    `});function fi({exploreId:t}){bi(t);const o=(0,N.wW)(gi),n=(0,e.useRef)(new uo.F),s=(0,e.useRef)(null);return(0,e.useEffect)(()=>{const a=n.current;return()=>a.removeAllListeners()},[]),e.createElement(rt.$,{hideVerticalTrack:!0},e.createElement("div",{className:o.explore,ref:s,"data-testid":at.wl.pages.Explore.General.container},e.createElement(mi,{exploreId:t,eventBus:n.current})))}function yi(t,o){return{pane:t.explore.panes[o.exploreId]}}const vi=(0,ge.connect)(yi)(fi);function bi(t){const o=(0,e.useMemo)(()=>(0,te.F9)(t),[t]),n=(0,e.useRef)();n.current=(0,O.useSelector)(o),(0,e.useEffect)(()=>()=>{(0,Lt.RZ)(n.current?.querySubscription)},[])}var Kn=c(40556),Yn=c(59781);function Ei(t){const o=(0,e.useRef)();o.current=(0,Xt.q)("explore");const n=(0,e.useRef)((0,$n.ak)());(0,e.useEffect)(()=>{if(!t.panes||typeof t.panes!="string")return;let s;try{s=JSON.parse(t.panes)}catch{return}typeof s!="object"||s===null||Promise.allSettled(Object.values(s).map(a=>!a||typeof a!="object"||!(0,Yn.w)("datasource",a)||!a.datasource||typeof a.datasource!="string"?Promise.reject():n.current.get(a.datasource))).then(a=>a.filter(Yn.K).map(r=>r.value)).then(a=>{if(!o.current)return;const r=a.map(i=>i.name);if(r.length===0){c.g.document.title=`${o.current.main.text} - ${Kn.c.AppTitle}`;return}c.g.document.title=`${o.current.main.text} - ${r.join(" | ")} - ${Kn.c.AppTitle}`})},[t.panes])}function xi(){const{keybindings:t}=(0,je.p)(),o=(0,O.useDispatch)();(0,e.useEffect)(()=>{t.setupTimeRangeBindings(!1);const n=[];return n.push((0,et.N$)().subscribe(tt.QI,()=>{o((0,Te.F9)())})),n.push((0,et.N$)().subscribe(tt.Qt,s=>{o((0,Te.a1)(s.payload.direction))})),n.push((0,et.N$)().subscribe(tt.p8,s=>{o((0,Te.vG)(s.payload.scale))})),()=>{n.forEach(s=>s.unsubscribe())}},[o,t])}const Si=t=>{const o=(0,O.useDispatch)(),{width:n}=(0,jt.Z)(),s=(0,O.useSelector)(te.M),a=(0,O.useSelector)(te.pd),[r,i]=(0,e.useState)(.5),l=(0,O.useSelector)(m=>m.explore),u=m=>{const p=n/2,g=(0,ie.inRange)(m,p-100,p+100);o(g?(0,U.Sx)({largerExploreId:void 0}):(0,U.Sx)({largerExploreId:m>p?s[1][0]:s[0][0]})),i(m/n)};let h=0;return a&&(!l.evenSplitPanes&&l.maxedExploreId?h=l.maxedExploreId===s[1][0]?n-t:t:l.evenSplitPanes?h=Math.floor(n/2):r!==void 0&&(h=n*r)),{updateSplitSize:u,widthCalc:h}};function Ci(){const{location:t}=(0,je.p)();(0,e.useEffect)(()=>{const o=t.getSearchObject();(o.from||o.to)&&t.partial({from:void 0,to:void 0},!0)},[t])}const qt=200;function wi(t){const o=(0,N.wW)(Ri),n=(0,N.l4)();Ci(),(0,Ln.N)(t.queryParams),Ei(t.queryParams);const{chrome:s}=(0,je.p)(),a=(0,Xt.q)("explore"),{updateSplitSize:r,widthCalc:i}=Si(qt),l=(0,O.useSelector)(te.M),u=(0,O.useSelector)(te.pd),h=(0,O.useSelector)(te.z7),m=G.config.featureToggles.correlations&&(h?.editorMode||!1);return(0,e.useEffect)(()=>{s.update({sectionNav:a})},[s,a]),xi(),e.createElement("div",{className:(0,d.cx)(o.pageScrollbarWrapper,{[o.correlationsEditorIndicator]:m})},e.createElement(co,null),m&&e.createElement(io,{panes:l}),e.createElement(Fe.U,{splitOrientation:"vertical",paneSize:i,minSize:qt,maxSize:qt*-1,primary:"second",splitVisible:u,parentStyle:m?{height:`calc(100% - ${n.spacing(6)}`}:{},paneStyle:{overflow:"auto",display:"flex",flexDirection:"column"},onDragFinished:p=>p&&r(p)},l.map(([p])=>e.createElement(oe.z4,{key:p,style:"page"},e.createElement(vi,{exploreId:p})))))}const Ri=t=>({pageScrollbarWrapper:(0,d.css)({width:"100%",flexGrow:1,minHeight:0,height:"100%",position:"relative"}),correlationsEditorIndicator:(0,d.css)({borderLeft:`4px solid ${t.colors.primary.main}`,borderRight:`4px solid ${t.colors.primary.main}`,borderBottom:`4px solid ${t.colors.primary.main}`,overflow:"scroll"})})},29188:(Jt,Me,c)=>{c.d(Me,{Z:()=>G});var d=c(31733),e=function(N,oe){var Fe=(0,d.useRef)(function(){});(0,d.useEffect)(function(){Fe.current=N}),(0,d.useEffect)(function(){if(oe!==null){var je=setInterval(function(){return Fe.current()},oe||0);return function(){return clearInterval(je)}}},[oe])};const G=e}}]);

//# sourceMappingURL=explore.7434bac7da2e44a9c443.js.map