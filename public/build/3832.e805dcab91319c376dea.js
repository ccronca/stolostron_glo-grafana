"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3832],{93832:(re,B,a)=>{a.d(B,{l:()=>Ot});var l=a(31733),L=a(55024),K=a(2507),J=a(27524),X=a(26124);function D({children:n,width:e,height:i,onLoad:t,onChange:s}){const o=(0,l.useId)(),[r,c]=(0,l.useState)(!1),[d,h]=(0,l.useState)(!1),g=(0,l.useRef)(null);return(0,X.Z)(()=>{D.addCallback(o,y=>{!r&&y.isIntersecting&&(c(!0),t?.()),h(y.isIntersecting),s?.(y.isIntersecting)});const m=g.current;return m&&D.observer.observe(m),()=>{delete D.callbacks[o],m&&D.observer.unobserve(m),Object.keys(D.callbacks).length===0&&D.observer.disconnect()}}),l.createElement("div",{id:o,ref:g,style:{width:e,height:i}},r&&(typeof n=="function"?n({isInView:d}):n))}const q={};D.callbacks=q,D.addCallback=(n,e)=>D.callbacks[n]=e,D.observer=new IntersectionObserver(n=>{for(const e of n)D.callbacks[e.target.id]&&D.callbacks[e.target.id](e)},{rootMargin:"100px"});var j=a(40510),S=a(20298),_=a(5333),M=a(80091),x=a(48011),N=a(83811),$=a(21279),Z=a(2222),W=a(89660),I=a(51133),v=a(61129),f=a(19690),O=a(85498),p=a(92762),C=a(31285),F=a(71623),A=a(61260),T=a(76932),z=a(63949),U=a(76067),b=a(58037),w=a(49311),le=a(20848),ee=a(63424),Oe=a(67669),Te=a(73351);function Ne({panelLinks:n,onShowPanelLinks:e}){const i=(0,U.wW)(Me),t=()=>{const s=e();return l.createElement(ee.v,null,s?.map((o,r)=>l.createElement(ee.v.Item,{key:r,label:o.title,url:o.href,target:o.target,onClick:o.onClick})))};if(n.length===1){const s=e()[0];return l.createElement(x.fm.TitleItem,{href:s.href,onClick:s.onClick,target:s.target,title:s.title},l.createElement(w.J,{name:"external-link-alt",size:"md"}))}else return l.createElement(Oe.L,{overlay:t},l.createElement(Te.h,{icon:"external-link-alt",iconSize:"md","aria-label":"panel links",className:i.menuTrigger}))}const Me=n=>({menuTrigger:(0,T.css)({height:"100%",background:"inherit",border:"none",borderRadius:`${n.shape.radius.default}`,cursor:"context-menu"})});var xe=a(31365);function Ae(n){const{alertState:e,data:i,panelId:t,onShowPanelLinks:s,panelLinks:o,angularNotice:r}=n,c=(0,U.wW)(Le),d=l.createElement(b.u,{content:e??"unknown"},l.createElement(x.fm.TitleItem,{className:(0,T.cx)({[c.ok]:e===z.Z.OK,[c.pending]:e===z.Z.Pending,[c.alerting]:e===z.Z.Alerting})},l.createElement(w.J,{name:e==="alerting"?"heart-break":"heart",className:"panel-alert-icon",size:"md"}))),h=l.createElement(l.Fragment,null,i.request&&i.request.timeInfo&&l.createElement(b.u,{content:l.createElement(le.IF,{timeRange:i.request?.range,timeZone:i.request?.timezone})},l.createElement(x.fm.TitleItem,{className:c.timeshift},l.createElement(w.J,{name:"clock-nine",size:"md"})," ",i.request?.timeInfo))),g=`This ${Re(r)} requires Angular (deprecated).`,m=l.createElement(b.u,{content:g},l.createElement(x.fm.TitleItem,{className:c.angularNotice,"data-testid":"angular-deprecation-icon"},l.createElement(w.J,{name:"exclamation-triangle",size:"md"})));return l.createElement(l.Fragment,null,o&&o.length>0&&s&&l.createElement(Ne,{onShowPanelLinks:s,panelLinks:o}),l.createElement(xe.f,{panelId:t,frames:i.series}),h,e&&d,r?.show&&m)}const Re=n=>n?.isAngularPanel?"panel":n?.isAngularDatasource?"data source":"panel or data source",Le=n=>({ok:(0,T.css)({color:n.colors.success.text}),pending:(0,T.css)({color:n.colors.warning.text}),alerting:(0,T.css)({color:n.colors.error.text}),timeshift:(0,T.css)({color:n.colors.text.link,gap:n.spacing(.5),whiteSpace:"nowrap","&:hover":{color:n.colors.emphasize(n.colors.text.link,.03)}}),angularNotice:(0,T.css)({color:n.colors.warning.text})});function fe(n){let e=!1;function i(){return n.data.request&&n.data.request.timeInfo?!1:!n.panel.hasTitle()}const t=()=>{const E=(0,v.J)().replace(n.panel.description,n.panel.scopedVars),k=(0,I.a)(E);return e||(p.a.panelDescriptionShown(),e=!0),k},s=()=>{const E=(0,F.H)(n.panel);if(!E)return[];const k=E&&E.getLinks(n.panel.replaceVariables);return k.map(se=>({...se,onClick:(...oe)=>{p.a.panelLinkClicked({has_multiple_links:k.length>1}),se.onClick?.(...oe)}}))},o=(E,k)=>{E.stopPropagation(),f.E1.partial({inspect:n.panel.id,inspectTab:k})},r=E=>{E.stopPropagation(),f.E1.partial({inspect:n.panel.id,inspectTab:C.q.Error}),p.a.panelStatusMessageClicked()},c=()=>{n.panel.getQueryRunner().cancelQuery(),p.a.panelCancelQueryClicked()},d=n.plugin.noPadding?"none":"md",h=n.data.alertState?.state,g=n.panel.datasource?.uid?(0,A.G)(n.panel.datasource?.uid):!1,m=n.panel.isAngularPlugin()&&!n.plugin.meta.angular?.hideDeprecation,y=(O.config.featureToggles.angularDeprecationUI??!1)&&(g||m),ae=(n.panel.links&&n.panel.links.length>0&&s||n.data.series.length>0&&n.data.series.some(E=>(E.meta?.notices?.length??0)>0)||n.data.request&&n.data.request.timeInfo||y||h)&&l.createElement(Ae,{alertState:h,data:n.data,panelId:n.panel.id,panelLinks:n.panel.links,angularNotice:{show:y,isAngularDatasource:g,isAngularPanel:m},onShowPanelLinks:s}),R=n.panel.description?t:void 0,te=!(n.isViewing||n.isEditing)&&(n.isDraggable??!0)?"grid-drag-handle":"",ge=n.panel.getDisplayTitle();return{hasOverlayHeader:i,onShowPanelDescription:t,onShowPanelLinks:s,onOpenInspector:o,onOpenErrorInspect:r,onCancelQuery:c,padding:d,description:R,dragClass:te,title:ge,titleItems:ae,onOpenMenu:()=>{p.a.panelMenuShown()}}}var Fe=a(21568);function Ve({items:n}){const e=i=>i.map(t=>{switch(t.type){case"divider":return l.createElement(ee.v.Divider,{key:t.text});case"group":return l.createElement(ee.v.Group,{key:t.text,label:t.text},t.subMenu?e(t.subMenu):void 0);default:return l.createElement(ee.v.Item,{key:t.text,label:t.text,icon:t.iconClassName,childItems:t.subMenu?e(t.subMenu):void 0,url:t.href,onClick:t.onClick,shortcut:t.shortcut,testId:Fe.wl.components.Panels.Panel.menuItems(t.text)})}});return l.createElement(ee.v,null,e(n))}var Ue=a(42342),be=a(91977),He=a(90384),ke=a(88822),Ge=a(33500),P=a(53166),Ee=a(56811),We=a(82866),ze=a(1636),Q=a(90172),we=a(3002),Qe=a(89154),Be=a(7307),ve=a(86573),Ke=a(81347),Je=a(15359);function je(n,e,i){const t=u=>{u.preventDefault(),f.E1.partial({viewPanel:e.id}),p.a.panelMenuItemClicked("view")},s=u=>{u.preventDefault(),f.E1.partial({editPanel:e.id}),p.a.panelMenuItemClicked("edit")},o=u=>{u.preventDefault(),(0,Q.Po)(n,e),p.a.panelMenuItemClicked("share")},r=u=>{u.preventDefault(),(0,Q.Kq)(n,e),p.a.panelMenuItemClicked("createLibraryPanel")},c=u=>{u.preventDefault(),(0,Q.oe)(e),p.a.panelMenuItemClicked("unlinkLibraryPanel")},d=u=>{f.E1.partial({inspect:e.id,inspectTab:u}),p.a.panelMenuInspectClicked(u??C.q.Data)},h=u=>{u.preventDefault()},g=u=>{u.preventDefault(),(0,Q.jN)(n,e),p.a.panelMenuItemClicked("duplicate")},m=u=>{u.preventDefault(),(0,Q.bY)(e),p.a.panelMenuItemClicked("copy")},y=u=>{u.preventDefault(),(0,Q.WJ)(n,e,!0),p.a.panelMenuItemClicked("remove")},V=u=>{u.preventDefault();const G=u.ctrlKey||u.metaKey?Y=>window.open(`${N.default.appSubUrl}${Y}`):void 0;ve.h.dispatch((0,Je.m$)(e,{timeRange:(0,W.$t)().timeRange(),getExploreUrl:We.H6,openInNewWindow:G})),p.a.panelMenuItemClicked("explore")},ae=u=>{u.preventDefault(),(0,Q.qw)(e),p.a.panelMenuItemClicked("toggleLegend")},R=[];e.isEditing||R.push({text:(0,P.t)("panel.header-menu.view","View"),iconClassName:"eye",onClick:t,shortcut:"v"}),n.canEditPanel(e)&&!e.isEditing&&R.push({text:(0,P.t)("panel.header-menu.edit","Edit"),iconClassName:"edit",onClick:s,shortcut:"e"}),R.push({text:(0,P.t)("panel.header-menu.share","Share"),iconClassName:"share-alt",onClick:o,shortcut:"p s"}),Ee.contextSrv.hasAccessToExplore()&&!(e.plugin&&e.plugin.meta.skipDataQuery)&&e.datasource?.uid!==Be.oe&&R.push({text:(0,P.t)("panel.header-menu.explore","Explore"),iconClassName:"compass",onClick:V,shortcut:"p x"});const te=[];e.plugin&&!e.plugin.meta.skipDataQuery&&(te.push({text:(0,P.t)("panel.header-menu.inspect-data","Data"),onClick:u=>d(C.q.Data)}),n.meta.canEdit&&te.push({text:(0,P.t)("panel.header-menu.query","Query"),onClick:u=>d(C.q.Query)})),te.push({text:(0,P.t)("panel.header-menu.inspect-json","Panel JSON"),onClick:u=>d(C.q.JSON)}),R.push({type:"submenu",text:(0,P.t)("panel.header-menu.inspect","Inspect"),iconClassName:"info-circle",onClick:u=>{const G=u.currentTarget,Y=u.target;(Y===G||Y instanceof HTMLElement&&Y.closest('[role="menuitem"]')===G)&&d()},shortcut:"i",subMenu:te});const ge=async()=>{const u=await(0,ze.aR)(e,n),G=be.Cj.renderUrl("/alerting/new",{defaults:JSON.stringify(u),returnTo:location.pathname+location.search});f.E1.push(G)},me=u=>{u.preventDefault(),ge(),p.a.panelMenuItemClicked("create-alert")},E=[],k=n.canEditPanel(e),se=(0,Ke.iE)();if(e.isViewing||e.isEditing||(k?(E.push({text:(0,P.t)("panel.header-menu.duplicate","Duplicate"),onClick:g,shortcut:"p d"}),E.push({text:(0,P.t)("panel.header-menu.copy","Copy"),onClick:m}),(0,we.V)(e)?E.push({text:(0,P.t)("panel.header-menu.unlink-library-panel","Unlink library panel"),onClick:c}):E.push({text:(0,P.t)("panel.header-menu.create-library-panel","Create library panel"),onClick:r})):Ee.contextSrv.isEditor&&E.push({text:(0,P.t)("panel.header-menu.copy","Copy"),onClick:m})),se&&E.push({text:(0,P.t)("panel.header-menu.new-alert-rule","New alert rule"),onClick:me}),i){const u=i.getScope(),G=u.$$childHead.ctrl,Y=G.getExtendedMenu();for(const ie of Y){const Se={text:ie.text,href:ie.href,shortcut:ie.shortcut};ie.click&&(Se.onClick=()=>{u.$eval(ie.click,{ctrl:G})}),E.push(Se)}}e.options.legend&&E.push({text:e.options.legend.showLegend?(0,P.t)("panel.header-menu.hide-legend","Hide legend"):(0,P.t)("panel.header-menu.show-legend","Show legend"),onClick:ae,shortcut:"p l"}),e.isEditing&&(E.length=0,se&&E.push({text:(0,P.t)("panel.header-menu.new-alert-rule","New alert rule"),onClick:me})),k&&e.plugin&&!e.plugin.meta.skipDataQuery&&E.push({text:(0,P.t)("panel.header-menu.get-help","Get help"),onClick:u=>d(C.q.Help)});const{extensions:oe}=(0,Ge.dj)({extensionPointId:He.y.DashboardPanelMenu,context:$e(e,n),limitPerPlugin:3});return oe.length>0&&!e.isEditing&&R.push({text:"Extensions",iconClassName:"plug",type:"submenu",subMenu:(0,Qe.cS)(oe)}),E.length&&R.push({type:"submenu",text:(0,P.t)("panel.header-menu.more","More..."),iconClassName:"cube",subMenu:E,onClick:h}),n.canEditPanel(e)&&!e.isEditing&&!e.isViewing&&(R.push({type:"divider",text:""}),R.push({text:(0,P.t)("panel.header-menu.remove","Remove"),iconClassName:"trash-alt",onClick:y,shortcut:"p r"})),R}function $e(n,e){return{id:n.id,pluginId:n.type,title:n.title,timeRange:e.time,timeZone:(0,ke.Z)({timeZone:e.timezone}),dashboard:{uid:e.uid,title:e.title,tags:Array.from(e.tags)},targets:n.targets,scopedVars:n.scopedVars,data:n.getQueryRunner().getLastResult()}}function Ze({panel:n,dashboard:e,loadingState:i,children:t}){const[s,o]=(0,l.useState)([]),r=(0,Ue.useSelector)(c=>(0,Z.i)(c,n)?.angularComponent);return(0,l.useEffect)(()=>{o(je(e,n,r))},[e,n,r,i,o]),t({items:s})}function Ce({style:n,panel:e,dashboard:i,loadingState:t}){return l.createElement(Ze,{panel:e,dashboard:i,loadingState:t},({items:s})=>l.createElement(Ve,{style:n,items:s}))}class Ye extends l.PureComponent{constructor(e){super(e),this.element=null,this.timeSrv=(0,W.$t)(),this.subs=new j.w0,this.state={data:{state:S.Gu.NotStarted,series:[],timeRange:(0,_.JK)()}}}componentDidMount(){const{panel:e}=this.props;this.loadAngularPanel();const i=e.getQueryRunner();this.subs.add(i.getData({withTransforms:!1,withFieldConfig:!1}).subscribe({next:t=>this.onPanelDataUpdate(t)}))}onPanelDataUpdate(e){let i;if(e.state===S.Gu.Error){const{error:t}=e;t&&i!==t.message&&(i=t.message)}this.setState({data:e,errorMessage:i})}componentWillUnmount(){this.subs.unsubscribe(),this.props.angularComponent&&this.props.angularComponent?.destroy()}componentDidUpdate(e,i){const{plugin:t,height:s,width:o,panel:r}=this.props;e.plugin!==t&&this.loadAngularPanel(),(e.width!==o||e.height!==s)&&this.scopeProps&&(this.scopeProps.size.height=this.getInnerPanelHeight(),this.scopeProps.size.width=this.getInnerPanelWidth(),r.render())}getInnerPanelHeight(){const{plugin:e,height:i}=this.props,{theme:t}=N.default,s=this.hasOverlayHeader()?0:t.panelHeaderHeight,o=e.noPadding?0:t.panelPadding;return i-s-o*2-$.QO}getInnerPanelWidth(){const{plugin:e,width:i}=this.props,{theme:t}=N.default,s=e.noPadding?0:t.panelPadding;return i-s*2-$.QO}loadAngularPanel(){const{panel:e,dashboard:i,setPanelAngularComponent:t}=this.props;if(!this.element)return;const s=(0,M.w)(),o='<plugin-component type="panel" class="panel-height-helper"></plugin-component>';this.scopeProps={panel:e,dashboard:i,size:{width:this.getInnerPanelWidth(),height:this.getInnerPanelHeight()}},t({key:e.key,angularComponent:s.load(this.element,this.scopeProps,o)})}hasOverlayHeader(){const{panel:e}=this.props,{data:i}=this.state;return i.request&&i.request.timeInfo?!1:!e.hasTitle()}render(){const{dashboard:e,panel:i}=this.props,{errorMessage:t,data:s}=this.state,{transparent:o}=i,r=fe({...this.props,data:s}),c=(i.gridPos?.y??0)===0?-16:void 0,d=l.createElement("div",{"data-testid":"panel-dropdown"},l.createElement(Ce,{panel:i,dashboard:e,loadingState:s.state}));return l.createElement(x.fm,{width:this.props.width,height:this.props.height,title:r.title,loadingState:s.state,statusMessage:t,statusMessageOnClick:r.onOpenErrorInspect,description:r.description,titleItems:r.titleItems,menu:this.props.hideMenu?void 0:d,dragClass:r.dragClass,dragClassCancel:"grid-drag-cancel",padding:r.padding,hoverHeaderOffset:c,hoverHeader:r.hasOverlayHeader(),displayMode:o?"transparent":"default",onCancelQuery:r.onCancelQuery,onOpenMenu:r.onOpenMenu},()=>l.createElement("div",{ref:h=>this.element=h,className:"panel-height-helper"}))}}const Xe=(n,e)=>({angularComponent:(0,Z.i)(n,e.panel)?.angularComponent}),qe={setPanelAngularComponent:J.o8},_e=(0,L.connect)(Xe,qe)(Ye);var et=a(42692),ne=a(44343),ce=a(93670),Pe=a(74011),tt=a(44992),nt=a(98147),at=a(1727),st=a(43348),it=a(8310),ot=a(96787),rt=a(97001),lt=a(97285),ct=a(24111),Ie=a(18198),dt=a(91507);const ht=(n,e,i)=>{const{overrides:t}=i,s=i.overrides.findIndex(h=>h.matcher.id===Ie.mi.byName&&h.matcher.options===n);if(s<0)return{...i,overrides:[...i.overrides,ut(n,e)]};const o=Array.from(t),r=o[s],c=r.properties.findIndex(h=>h.id==="color");if(c<0)return o[s]={...r,properties:[...r.properties,de(e)]},{...i,overrides:o};const d=Array.from(r.properties);return d[c]=de(e),o[s]={...r,properties:d},{...i,overrides:o}},ut=(n,e)=>({matcher:{id:Ie.mi.byName,options:n},properties:[de(e)]}),de=n=>({id:"color",value:{mode:dt.S.Fixed,fixedColor:n}});var pt=a(74642),he=a(90642),ue=a(34576),gt=a(17242),ye=a(47121),H=(n=>(n.FIELD_CONFIG_OVERRIDES_CHANGED_EVENT="field config overrides changed",n.NEW_PANEL_OPTION_EVENT="new panel option",n.PANEL_OPTION_CHANGED_EVENT="panel option changed",n.NEW_DEFAULT_FIELD_CONFIG_EVENT="new default field config",n.DEFAULT_FIELD_CONFIG_CHANGED_EVENT="default field config changed",n.NEW_CUSTOM_FIELD_CONFIG_EVENT="new custom field config",n.CUSTOM_FIELD_CONFIG_CHANGED_EVENT="custom field config changed",n.MEASURE_PANEL_LOAD_TIME_EVENT="measure panel load time",n.THRESHOLDS_COUNT_CHANGED_EVENT="thresholds count changed",n.THRESHOLDS_MODE_CHANGED_EVENT="thresholds mode changed",n.MAPPINGS_COUNT_CHANGED_EVENT="mappings count changed",n.LINKS_COUNT_CHANGED_EVENT="links count changed",n.PANEL_ERROR="panel error",n))(H||{});const mt="overrides",ft="custom",Et=n=>{const e=performance.now();return(0,l.useEffect)(()=>{N.config.grafanaJavascriptAgent.enabled&&requestAnimationFrame(()=>{setTimeout(()=>{ye.s.api.pushMeasurement({type:H.MEASURE_PANEL_LOAD_TIME_EVENT,values:{start_loading_time_ms:e,load_time_ms:performance.now()-e}},{context:{panel_type:n.panelType,panel_id:String(n.panelId),panel_title:n.panelTitle}})},0)})},[]),null};var vt=a(21458),pe=a(73293);class Ct{constructor(e,i,t){this.logChanges=(s,o)=>{this.logPanelOptionChanges(s,this.initialPanelOptions),this.logFieldConfigChanges(o,this.initialFieldConfig),this.initialPanelOptions=s,this.initialFieldConfig=o},this.logPanelEvent=(s,o,r,c)=>{const d={key:o,newValue:r,oldValue:c??"",panelTitle:this.panelLogInfo.panelTitle,panelId:this.panelLogInfo.panelId,panelType:this.panelLogInfo.panelType};ye.s.api.pushEvent(s,d)},this.logPanelOptionChanges=(s,o)=>{if(typeof s!="object"||s===null||typeof o!="object"||o===null)return;const r={...o};for(const[c,d]of Object.entries(s)){const h=typeof d!="string"?JSON.stringify(d):d,g=typeof d!="string"?JSON.stringify(r[c]):String(r[c]);r[c]===void 0?this.logPanelEvent(H.NEW_PANEL_OPTION_EVENT,c,h):g!==h&&this.logPanelEvent(H.PANEL_OPTION_CHANGED_EVENT,c,h,g)}},this.logFieldConfigChanges=(s,o)=>{const r=JSON.stringify(o.overrides),c=JSON.stringify(s.overrides);r!==c&&this.logPanelEvent(H.FIELD_CONFIG_OVERRIDES_CHANGED_EVENT,mt,c,r);const d={...o.defaults};for(const[g,m]of Object.entries(s.defaults)){if(g===ft)continue;const y=typeof m!="string"?JSON.stringify(m):m,V=typeof m!="string"?JSON.stringify(d[g]):String(d[g]);d[g]===void 0?this.logPanelEvent(H.NEW_DEFAULT_FIELD_CONFIG_EVENT,g,y):V!==y&&this.logPanelEvent(H.DEFAULT_FIELD_CONFIG_CHANGED_EVENT,g,y,V)}if(!s.defaults.custom||d.custom===void 0)return;const h={...d.custom};for(const[g,m]of Object.entries(s.defaults.custom)){if(d.custom===null||h[g]===null)continue;const y=typeof m!="string"?JSON.stringify(m):m,V=typeof m!="string"?JSON.stringify(h[g]):String(h[g]);h[g]===void 0?this.logPanelEvent(H.NEW_CUSTOM_FIELD_CONFIG_EVENT,g,y):V!==y&&this.logPanelEvent(H.CUSTOM_FIELD_CONFIG_CHANGED_EVENT,g,y,V)}},this.initialPanelOptions=e,this.initialFieldConfig=i,this.panelLogInfo=t}}const Pt="Error in plugin";class It extends l.PureComponent{constructor(e){super(e),this.timeSrv=(0,W.$t)(),this.subs=new j.w0,this.eventFilter={onlyLocal:!0},this.panelOptionsLogger=void 0,this.getSync=()=>this.props.isEditing?et.m.Off:this.props.dashboard.graphTooltip,this.onInstanceStateChange=t=>{this.props.onInstanceStateChange(t),this.setState({context:{...this.state.context,instanceState:t}})},this.onUpdateData=t=>(0,ct.F)(this.props.panel,t),this.onSeriesColorChange=(t,s)=>{this.onFieldConfigChange(ht(t,s,this.props.panel.fieldConfig))},this.onSeriesVisibilityChange=(t,s)=>{this.onFieldConfigChange((0,vt.N)(t,s,this.props.panel.fieldConfig,this.state.data.series))},this.onToggleLegendSort=t=>{const s=this.props.panel.options.legend;if(!s)return;let o=s.sortDesc,r=s.sortBy;t!==r&&(o=void 0),o===!1?(r=void 0,o=void 0):(o=!o,r=t),this.onOptionsChange({...this.props.panel.options,legend:{...s,sortBy:r,sortDesc:o}})},this.onRefresh=()=>{const{dashboard:t,panel:s,isInView:o,width:r}=this.props;if(!o){s.refreshWhenInView=!0;return}const c=(0,Q.W1)(s,this.timeSrv.timeRange());if(this.wantsQueryExecution){if(r<0)return;s.refreshWhenInView=!1,s.runAllPanelQueries({dashboardUID:t.uid,dashboardTimezone:t.getTimezone(),timeData:c,width:r})}else this.setState({data:{...this.state.data,timeRange:this.timeSrv.timeRange()},renderCounter:this.state.renderCounter+1,liveTime:void 0})},this.onRender=()=>{const t={renderCounter:this.state.renderCounter+1};this.setState(t)},this.onOptionsChange=t=>{this.props.panel.updateOptions(t)},this.onFieldConfigChange=t=>{this.props.panel.updateFieldConfig(t)},this.onPanelError=t=>{N.default.featureToggles.panelMonitoring&&this.getPanelContextApp()===ne.zj.PanelEditor&&this.logPanelChangesOnError();const s=t.message||Pt;this.state.errorMessage!==s&&this.setState({errorMessage:s})},this.onPanelErrorRecover=()=>{this.setState({errorMessage:void 0})},this.onAnnotationCreate=async t=>{const s=t.from!==t.to,o={dashboardUID:this.props.dashboard.uid,panelId:this.props.panel.id,isRegion:s,time:t.from,timeEnd:s?t.to:0,tags:t.tags,text:t.description};await(0,he.xD)(o),(0,ue.kt)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new ce.n1(o))},this.onAnnotationDelete=async t=>{await(0,he.Dl)({id:t}),(0,ue.kt)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new ce.n1({id:t}))},this.onAnnotationUpdate=async t=>{const s=t.from!==t.to,o={id:t.id,dashboardUID:this.props.dashboard.uid,panelId:this.props.panel.id,isRegion:s,time:t.from,timeEnd:s?t.to:0,tags:t.tags,text:t.description};await(0,he._E)(o),(0,ue.kt)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new ce.n1(o))},this.onChangeTimeRange=t=>{this.timeSrv.setTime({from:(0,Pe.zh)(t.from),to:(0,Pe.zh)(t.to)})},this.onAddAdHocFilter=t=>{const{key:s,value:o,operator:r}=t,c=(0,rt.ak)().getInstanceSettings(this.props.panel.datasource),d=c&&(0,tt.iU)(c);d&&(0,ve.WI)((0,lt.m2)({datasource:d,key:s,operator:r,value:o}))};const i=e.dashboard.events.newScopedBus(`panel:${e.panel.id}`,this.eventFilter);if(this.state={isFirstLoad:!0,renderCounter:0,context:{eventsScope:"__global_",eventBus:i,app:this.getPanelContextApp(),sync:this.getSync,onSeriesColorChange:this.onSeriesColorChange,onToggleSeriesVisibility:this.onSeriesVisibilityChange,onAnnotationCreate:this.onAnnotationCreate,onAnnotationUpdate:this.onAnnotationUpdate,onAnnotationDelete:this.onAnnotationDelete,onInstanceStateChange:this.onInstanceStateChange,onToggleLegendSort:this.onToggleLegendSort,canAddAnnotations:e.dashboard.canAddAnnotations.bind(e.dashboard),canEditAnnotations:e.dashboard.canEditAnnotations.bind(e.dashboard),canDeleteAnnotations:e.dashboard.canDeleteAnnotations.bind(e.dashboard),onAddAdHocFilter:this.onAddAdHocFilter,onUpdateData:this.onUpdateData},data:this.getInitialPanelDataState()},N.default.featureToggles.panelMonitoring&&this.getPanelContextApp()===ne.zj.PanelEditor){const t={panelId:String(e.panel.id),panelType:e.panel.type,panelTitle:e.panel.title};this.panelOptionsLogger=new Ct(e.panel.getOptions(),e.panel.fieldConfig,t)}}getPanelContextApp(){return this.props.isEditing?ne.zj.PanelEditor:this.props.isViewing?ne.zj.PanelViewer:ne.zj.Dashboard}getInitialPanelDataState(){return{state:S.Gu.NotStarted,series:[],timeRange:(0,_.JK)()}}componentDidMount(){const{panel:e,dashboard:i}=this.props;if(this.subs.add(e.events.subscribe(at.U5,this.onRefresh)),this.subs.add(e.events.subscribe(pt._z,this.onRender)),i.panelInitialized(this.props.panel),this.hasPanelSnapshot){this.setState({data:(0,gt.y)(e,i),isFirstLoad:!1});return}this.wantsQueryExecution||this.setState({isFirstLoad:!1}),this.subs.add(e.getQueryRunner().getData({withTransforms:!0,withFieldConfig:!0}).subscribe({next:t=>this.onDataUpdate(t)})),pe.A.listen(this)}componentWillUnmount(){this.subs.unsubscribe(),pe.A.remove(this)}liveTimeChanged(e){const{data:i}=this.state;if(i.timeRange){const t=e.to.valueOf()-i.timeRange.to.valueOf();if(t<100){console.log("Skip tick render",this.props.panel.title,t);return}}this.setState({liveTime:e})}componentDidUpdate(e){const{isInView:i,width:t,panel:s}=this.props,{context:o}=this.state,r=this.getPanelContextApp();o.app!==r&&this.setState({context:{...o,app:r}}),i!==e.isInView&&i&&s.refreshWhenInView&&this.onRefresh(),t!==e.width&&pe.A.updateInterval(this)}onDataUpdate(e){const{dashboard:i,panel:t,plugin:s}=this.props;if(s.meta.skipDataQuery){this.setState({data:this.getInitialPanelDataState()});return}let{isFirstLoad:o}=this.state,r;switch(e.state){case S.Gu.Loading:if(this.state.data.state===S.Gu.Loading)return;break;case S.Gu.Error:const{error:c,errors:d}=e;d?.length?d.length===1?r=d[0].message:r="Multiple errors found. Click for more details":c&&r!==c.message&&(r=c.message);break;case S.Gu.Done:i.snapshot&&(t.snapshotData=e.series.map(h=>(0,nt.og)(h))),o&&(o=!1);break}this.setState({isFirstLoad:o,errorMessage:r,data:e,liveTime:void 0})}logPanelChangesOnError(){this.panelOptionsLogger.logChanges(this.props.panel.getOptions(),this.props.panel.fieldConfig)}get hasPanelSnapshot(){const{panel:e}=this.props;return e.snapshotData&&e.snapshotData.length}get wantsQueryExecution(){return!(this.props.plugin.meta.skipDataQuery||this.hasPanelSnapshot)}shouldSignalRenderingCompleted(e,i){return e===S.Gu.Done||e===S.Gu.Error||i.skipDataQuery}skipFirstRender(e){const{isFirstLoad:i}=this.state;return this.wantsQueryExecution&&i&&(e===S.Gu.Loading||e===S.Gu.NotStarted)}renderPanelContent(e,i){const{panel:t,plugin:s,dashboard:o}=this.props,{renderCounter:r,data:c}=this.state,{state:d}=c;if(this.skipFirstRender(d))return null;this.shouldSignalRenderingCompleted(d,s.meta)&&ot.r.renderingCompleted();const h=s.panel,g=this.state.liveTime??c.timeRange??this.timeSrv.timeRange(),m=t.getOptions();return this.eventFilter.onlyLocal=o.graphTooltip===0,l.createElement(l.Fragment,null,l.createElement(st._w,{value:this.state.context},l.createElement(h,{id:t.id,data:c,title:t.title,timeRange:g,timeZone:this.props.dashboard.getTimezone(),options:m,fieldConfig:t.fieldConfig,transparent:t.transparent,width:e,height:i,renderCounter:r,replaceVariables:t.replaceVariables,onOptionsChange:this.onOptionsChange,onFieldConfigChange:this.onFieldConfigChange,onChangeTimeRange:this.onChangeTimeRange,eventBus:o.events}),N.default.featureToggles.panelMonitoring&&this.state.errorMessage===void 0&&l.createElement(Et,{panelType:s.meta.id,panelId:t.id,panelTitle:t.title})))}render(){const{dashboard:e,panel:i,width:t,height:s,plugin:o}=this.props,{errorMessage:r,data:c}=this.state,{transparent:d}=i,h=fe({...this.props,data:c}),g=(i.gridPos?.y??0)===0?-16:void 0,m=l.createElement("div",{"data-testid":"panel-dropdown"},l.createElement(Ce,{panel:i,dashboard:e,loadingState:c.state}));return l.createElement(x.fm,{width:t,height:s,title:h.title,loadingState:c.state,statusMessage:r,statusMessageOnClick:h.onOpenErrorInspect,description:h.description,titleItems:h.titleItems,menu:this.props.hideMenu?void 0:m,dragClass:h.dragClass,dragClassCancel:"grid-drag-cancel",padding:h.padding,hoverHeaderOffset:g,hoverHeader:h.hasOverlayHeader(),displayMode:d?"transparent":"default",onCancelQuery:h.onCancelQuery,onOpenMenu:h.onOpenMenu},(y,V)=>l.createElement(l.Fragment,null,l.createElement(it.SV,{dependencies:[c,o,i.getOptions()],onError:this.onPanelError,onRecover:this.onPanelErrorRecover},({error:ae})=>ae?null:this.renderPanelContent(y,V))))}}const yt=(n,e)=>{const i=n.panels[e.stateKey];return i?{plugin:i.plugin,instanceState:i.instanceState}:{plugin:void 0}},Dt={initPanelState:K.JI,setPanelInstanceState:J.pC},St=(0,L.connect)(yt,Dt);class De extends l.PureComponent{constructor(){super(...arguments),this.onInstanceStateChange=e=>{this.props.setPanelInstanceState({key:this.props.stateKey,value:e})},this.onVisibilityChange=e=>{this.props.panel.isInView=e},this.onPanelLoad=()=>{this.props.plugin||this.props.initPanelState(this.props.panel)},this.renderPanel=({isInView:e})=>{const{dashboard:i,panel:t,isViewing:s,isEditing:o,width:r,height:c,plugin:d,timezone:h,hideMenu:g,isDraggable:m=!0}=this.props;return d?d&&d.angularPanelCtrl?l.createElement(_e,{plugin:d,panel:t,dashboard:i,isViewing:s,isEditing:o,isInView:e,isDraggable:m,width:r,height:c}):l.createElement(It,{plugin:d,panel:t,dashboard:i,isViewing:s,isEditing:o,isInView:e,isDraggable:m,width:r,height:c,onInstanceStateChange:this.onInstanceStateChange,timezone:h,hideMenu:g}):null}}componentDidMount(){this.props.panel.isInView=!this.props.lazy,this.props.lazy||this.onPanelLoad()}render(){const{width:e,height:i,lazy:t}=this.props;return t?l.createElement(D,{width:e,height:i,onChange:this.onVisibilityChange,onLoad:this.onPanelLoad},this.renderPanel):this.renderPanel({isInView:!0})}}De.defaultProps={lazy:!0};const Ot=St(De)},21458:(re,B,a)=>{a.d(B,{N:()=>_});var l=a(68235),L=a(31414),K=a(18198),J=a(85666),X=a(27957),D=a(85610),q=a(74779);const j="hideSeriesFrom",S=(0,l.Y4)(j);function _(I,v,f,O){const{overrides:p}=f,C=I,F=p.findIndex(S);if(F<0){if(v===q.R.ToggleSelection){const w=M([C,...W(p,O)]);return{...f,overrides:[...f.overrides,w]}}const U=Z(O,C),b=M(U);return{...f,overrides:[...f.overrides,b]}}const A=Array.from(p),[T]=A.splice(F,1);if(v===q.R.ToggleSelection){let U=N(T);const b=W(A,O);if(b.length>0&&(U=U.filter(le=>b.indexOf(le)<0)),U[0]===C&&U.length===1)return{...f,overrides:A};const w=M([C,...b]);return{...f,overrides:[...A,w]}}const z=x(T,C);return $(z,O)?{...f,overrides:A}:{...f,overrides:[...A,z]}}function M(I,v=L.Ys.exclude,f){return f=f??{id:"custom.hideFrom",value:{viz:!0,legend:!1,tooltip:!1}},{__systemRef:j,matcher:{id:K.mi.byNames,options:{mode:v,names:I,prefix:v===L.Ys.exclude?"All except:":void 0,readOnly:!0}},properties:[{...f,value:{viz:!0,legend:!1,tooltip:!1}}]}}const x=(I,v,f=L.Ys.exclude)=>{const O=I.properties.find(F=>F.id==="custom.hideFrom"),p=N(I),C=p.findIndex(F=>F===v);return C<0?p.push(v):p.splice(C,1),M(p,f,O)},N=I=>{const v=I.matcher.options?.names;return Array.isArray(v)?[...v]:[]},$=(I,v)=>N(I).length===Z(v).length,Z=(I,v)=>{const f=new Set;for(const O of I)for(const p of O.fields){if(p.type!==J.fS.number)continue;const C=(0,X.CZ)(p,O,I);C!==v&&f.add(C)}return Array.from(f)},W=(I,v)=>{let f=[];for(const O of I){const p=O.properties.find(C=>C.id==="custom.hideFrom");if(p!==void 0&&p.value?.legend===!0){const F=D.Ls.get(O.matcher.id).get(O.matcher.options);for(const A of v)for(const T of A.fields){if(T.type!==J.fS.number)continue;const z=(0,X.CZ)(T,A,v);F(T,A,v)&&f.push(z)}}}return f}},17242:(re,B,a)=>{a.d(B,{y:()=>_});var l=a(98147),L=a(5333),K=a(47206),J=a(20298),X=a(19596),D=a(83811),q=a(75502),j=a(89660),S=a(90172);function _(M,x){const N=(0,l.F9)(M.snapshotData),$=new q.g,Z={dashboard:x,range:(0,L.JK)()},W=$.canWork(Z)?$.getAnnotationsInSnapshot(x,M.id):[],I=[(0,K.P)(W)];return{timeRange:(0,S.W1)(M,(0,j.$t)().timeRange()).timeRange,state:J.Gu.Done,series:(0,X.SM)({data:N,fieldConfig:{defaults:{},overrides:[]},replaceVariables:M.replaceVariables,fieldConfigRegistry:M.plugin.fieldConfigRegistry,theme:D.config.theme2,timeZone:x.getTimezone()}),structureRev:1,annotations:I}}},2222:(re,B,a)=>{a.d(B,{i:()=>l});function l(L,K){return L.panels[K.key]}}}]);

//# sourceMappingURL=3832.e805dcab91319c376dea.js.map