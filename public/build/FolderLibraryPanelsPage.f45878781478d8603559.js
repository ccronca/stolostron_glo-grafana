"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3778],{10441:(L,u,e)=>{e.r(u),e.d(u,{BrowseFolderLibraryPanelsPage:()=>D,default:()=>E});var a=e(31733),M=e(50186),r=e(68446),t=e(31509),h=e(77566),n=e(83559),o=e(52368);function D({match:C}){const{uid:l}=C.params,{data:s}=(0,o.t4)(l),[i,O]=(0,a.useState)(void 0),[f]=(0,o.vN)(),_=(0,a.useMemo)(()=>{if(!s)return;const d=(0,t.B1)(s),m=(0,t.AZ)(s.uid),c=d.children?.find(P=>P.id===m);return c&&(c.active=!0),d},[s]),v=l?async d=>{if(s){const m=await f({...s,title:d});if("error"in m)throw m.error}}:void 0;return a.createElement(M.T,{navId:"dashboards/browse",pageNav:_,onEditTitle:v,actions:a.createElement(a.Fragment,null,s&&a.createElement(r.A,{folder:s}))},a.createElement(M.T.Contents,null,a.createElement(h.N,{onClick:O,currentFolderUID:l,showSecondaryActions:!0,showSort:!0,showPanelFilter:!0}),i?a.createElement(n.b,{onDismiss:()=>O(void 0),libraryPanel:i}):null))}const E=D},77196:(L,u,e)=>{e.d(u,{p:()=>C});var a=e(31733),M=e(51925),r=e(85498),t=e(90069),h=e(36717),n=e(25111),o=e(53166),D=e(52368),E=e(32166);const C=({onConfirm:l,onDismiss:s,selectedItems:i,...O})=>{const{data:f}=(0,D.zs)(i),_=!r.config.featureToggles.nestedFolders&&f&&(f.alertRule||f.libraryPanel),[v,d]=(0,a.useState)(!1),m=async()=>{d(!0);try{await l(),d(!1),s()}catch{d(!1)}};return a.createElement(t.s,{body:a.createElement(a.Fragment,null,a.createElement(h.x,{element:"p"},a.createElement(o.cC,{i18nKey:"browse-dashboards.action.delete-modal-text"},"This action will delete the following content:")),a.createElement(E.X,{selectedItems:i}),a.createElement(M.T,{v:2})),description:a.createElement(a.Fragment,null,_?a.createElement(n.b,{severity:"warning",title:(0,o.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder")},a.createElement(o.cC,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text"},"One or more folders contain library panels or alert rules. Delete these first in order to proceed.")):null),confirmationText:"Delete",confirmText:v?(0,o.t)("browse-dashboards.action.deleting","Deleting..."):(0,o.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:s,onConfirm:m,title:(0,o.t)("browse-dashboards.action.delete-modal-title","Delete"),...O})}},77992:(L,u,e)=>{e.d(u,{_:()=>l});var a=e(31733),M=e(51925),r=e(5572),t=e(25111),h=e(36717),n=e(85765),o=e(51343),D=e(26371),E=e(53166),C=e(32166);const l=({onConfirm:s,onDismiss:i,selectedItems:O,...f})=>{const[_,v]=(0,a.useState)(),[d,m]=(0,a.useState)(!1),c=Object.keys(O.folder).filter(I=>O.folder[I]),P=async()=>{if(_!==void 0){m(!0);try{await s(_),m(!1),i()}catch{m(!1)}}};return a.createElement(r.u,{title:(0,E.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:i,...f},c.length>0&&a.createElement(t.b,{severity:"info",title:(0,E.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),a.createElement(h.x,{element:"p"},a.createElement(E.cC,{i18nKey:"browse-dashboards.action.move-modal-text"},"This action will move the following content:")),a.createElement(C.X,{selectedItems:O}),a.createElement(M.T,{v:3}),a.createElement(n.g,{label:(0,E.t)("browse-dashboards.action.move-modal-field-label","Folder name")},a.createElement(D.E,{value:_,excludeUIDs:c,onChange:v})),a.createElement(r.u.ButtonRow,null,a.createElement(o.zx,{onClick:i,variant:"secondary",fill:"outline"},a.createElement(E.cC,{i18nKey:"browse-dashboards.action.cancel-button"},"Cancel")),a.createElement(o.zx,{disabled:_===void 0||d,onClick:P,variant:"primary"},d?(0,E.t)("browse-dashboards.action.moving","Moving..."):(0,E.t)("browse-dashboards.action.move-button","Move"))))}},68446:(L,u,e)=>{e.d(u,{A:()=>m});var a=e(31733),M=e(85498),r=e(64704),t=e(19690),h=e(63424),n=e(46213),o=e(67669),D=e(51343),E=e(49311),C=e(59899),l=e(49465),s=e(75923),i=e(53166),O=e(74642),f=e(52368),_=e(18972),v=e(77196),d=e(77992);function m({folder:c}){const[P,I]=(0,a.useState)(!1),[A,B]=(0,a.useState)(!1),[T]=(0,f.OH)(),[U]=(0,f.yC)(),{canEditFolders:R,canDeleteFolders:g,canViewPermissions:K,canSetPermissions:p}=(0,_.a)(c),W=M.config.featureToggles.nestedFolders&&R,y=async b=>{await T({folder:c,destinationUID:b}),(0,r.ff)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},F=async()=>{await U(c),(0,r.ff)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:b}=c,$=b&&b.length?b[b.length-1].url:"/dashboards";t.E1.push($)},S=()=>{s.h$.publish(new O.Dn({component:d._,props:{selectedItems:{folder:{[c.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:y}}))},w=()=>{s.h$.publish(new O.Dn({component:v.p,props:{selectedItems:{folder:{[c.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:F}}))},x=(0,i.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),z=(0,i.t)("browse-dashboards.folder-actions-button.move","Move"),V=(0,i.t)("browse-dashboards.folder-actions-button.delete","Delete"),N=a.createElement(h.v,null,K&&a.createElement(n.s,{onClick:()=>B(!0),label:x}),W&&a.createElement(n.s,{onClick:S,label:z}),g&&a.createElement(n.s,{destructive:!0,onClick:w,label:V}));return!K&&!W&&!g?null:a.createElement(a.Fragment,null,a.createElement(o.L,{overlay:N,onVisibleChange:I},a.createElement(D.zx,{variant:"secondary"},a.createElement(i.cC,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions"},"Folder actions"),a.createElement(E.J,{name:P?"angle-up":"angle-down"}))),A&&a.createElement(C.d,{title:(0,i.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:c.title,onClose:()=>B(!1),size:"md"},a.createElement(l.P,{resource:"folders",resourceId:c.uid,canSetPermissions:p})))}},18972:(L,u,e)=>{e.d(u,{a:()=>h});var a=e(85498),M=e(75923),r=e(42342);function t(n,o){return o?M.Vt.hasPermissionInMetadata(n,o):M.Vt.hasPermission(n)}function h(n){const o=t(r.AccessControlAction.DashboardsCreate,n),D=!!((!n||a.config.featureToggles.nestedFolders)&&t(r.AccessControlAction.FoldersCreate)),E=t(r.AccessControlAction.FoldersDelete,n),C=t(r.AccessControlAction.DashboardsWrite,n),l=t(r.AccessControlAction.FoldersWrite,n),s=t(r.AccessControlAction.FoldersPermissionsWrite,n),i=t(r.AccessControlAction.FoldersPermissionsRead,n);return{canCreateDashboards:o,canCreateFolders:D,canDeleteFolders:E,canEditDashboards:C,canEditFolders:l,canSetPermissions:s,canViewPermissions:i}}},83559:(L,u,e)=>{e.d(u,{b:()=>i});var a=e(76932),M=e(8806),r=e.n(M),t=e(31733),h=e(91977),n=e(19690),o=e(76067),D=e(5572),E=e(38834),C=e(51343),l=e(53166),s=e(39501);function i({libraryPanel:_,onDismiss:v}){const d=(0,o.wW)(f),[m,c]=(0,t.useState)(!1),[P,I]=(0,t.useState)(0),[A,B]=(0,t.useState)(void 0);(0,t.useEffect)(()=>{(async()=>{const K=await(0,s.Ef)(_.uid);I(K.length)})()},[_.uid]);const T=(0,t.useCallback)(g=>O(_.uid,g,c),[_.uid]),U=(0,t.useMemo)(()=>r()(T,300,{leading:!0}),[T]),R=g=>{g.preventDefault(),n.E1.push(h.Cj.renderUrl(`/d/${A?.value?.uid}`,{}))};return t.createElement(D.u,{title:(0,l.t)("library-panels.modal.title","View panel in dashboard"),onDismiss:v,onClickBackdrop:v,isOpen:!0},t.createElement("div",{className:d.container},P===0?t.createElement("span",null,t.createElement(l.cC,{i18nKey:"library-panels.modal.panel-not-linked"},"Panel is not linked to a dashboard. Add the panel to a dashboard and retry.")):null,P>0?t.createElement(t.Fragment,null,t.createElement("p",null,t.createElement(l.cC,{i18nKey:"library-panels.modal.body",count:P},"This panel is being used in ",{count:P}," dashboard. Please choose which dashboard to view the panel in:")),t.createElement(E.qb,{isClearable:!0,isLoading:m,defaultOptions:!0,loadOptions:U,onChange:B,placeholder:(0,l.t)("library-panels.modal.select-placeholder","Start typing to search for dashboard"),noOptionsMessage:(0,l.t)("library-panels.modal.select-no-options-message","No dashboards found")})):null),t.createElement(D.u.ButtonRow,null,t.createElement(C.zx,{variant:"secondary",onClick:v,fill:"outline"},t.createElement(l.cC,{i18nKey:"library-panels.modal.button-cancel"},"Cancel")),t.createElement(C.zx,{onClick:R,disabled:!A},A?(0,l.t)("library-panels.modal.button-view-panel1","View panel in {{label}}...",{label:A?.label}):(0,l.t)("library-panels.modal.button-view-panel2","View panel in dashboard..."))))}async function O(_,v,d){d(!0);const c=(await(0,s.E8)(_)).filter(P=>P.title.toLowerCase().includes(v.toLowerCase())).map(P=>({label:P.title,value:P}));return d(!1),c}function f(_){return{container:(0,a.css)``}}}}]);

//# sourceMappingURL=FolderLibraryPanelsPage.f45878781478d8603559.js.map