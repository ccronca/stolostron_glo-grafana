"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4074],{89962:(Y,x,t)=>{t.d(x,{P:()=>w});var n=t(31733),e=t(59326),y=t(38834),g=t(49311),p=t(86434),E=t(4502);const v=()=>(0,E.getGrafanaSearcher)().getSortOptions();function w({onChange:T,value:F,placeholder:U,filter:B,getSortOptions:D,isClearable:b}){const I=(0,e.Z)(async()=>{const m=await(D??v)();return B?m.filter(z=>B.includes(z.value)):m},[D,B]);if(I.loading)return null;const R=!!(F?.includes("desc")||F?.startsWith("-"));return n.createElement(y.Ph,{key:F,width:28,onChange:T,value:I.value?.find(m=>m.value===F)??null,options:I.value,"aria-label":"Sort",placeholder:U??`Sort (Default ${p.yw.label})`,prefix:n.createElement(g.J,{name:R?"sort-amount-down":"sort-amount-up"}),isClearable:b})}},91573:(Y,x,t)=>{t.r(x),t.d(x,{default:()=>Rt});var n=t(76932),e=t(31733),y=t(43741),g=t(64704),p=t(76067),E=t(76804),v=t(50186),w=t(42342),T=t(31509),F=t(69781),U=t(19690),B=t(66841),D=t(39357),b=t(86434),I=t(24017),R=t(4502),m=t(40884),z=t(84265);const V={query:"",tag:[],starred:!1,layout:m.A.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search"},W={sort:null,starred:null,query:null,tag:null,layout:null},te=()=>localStorage.getItem(b.rh)===m.A.List?m.A.List:m.A.Folders;class ae extends B.b{constructor(){super(...arguments),this.updateLocation=(0,F.debounce)(a=>U.E1.partial(a,!0),300),this.doSearchWithDebounce=(0,F.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...W})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=a=>{this.setStateAndDoSearch({query:a})},this.onRemoveTag=a=>{this.setStateAndDoSearch({tag:this.state.tag.filter(o=>o!==a)})},this.onTagFilterChange=a=>{this.setStateAndDoSearch({tag:a})},this.onAddTag=a=>{this.state.tag&&this.state.tag.includes(a)||this.setStateAndDoSearch({tag:[...this.state.tag,a]})},this.onDatasourceChange=a=>{this.setStateAndDoSearch({datasource:a})},this.onPanelTypeChange=a=>{this.setStateAndDoSearch({panel_type:a})},this.onStarredFilterChange=a=>{const o=a.currentTarget.checked;this.setStateAndDoSearch({starred:o})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSortChange=a=>{a?localStorage.setItem(b.qb,a):localStorage.removeItem(b.qb),this.state.layout===m.A.Folders?this.setStateAndDoSearch({sort:a,layout:m.A.List}):this.setStateAndDoSearch({sort:a})},this.onLayoutChange=a=>{localStorage.setItem(b.rh,a),this.state.sort&&a===m.A.Folders?this.setStateAndDoSearch({layout:a,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:a,sort:this.state.prevSort})},this.onSetIncludePanels=a=>{this.setStateAndDoSearch({includePanels:a}),D.Z.set(b.to,a)},this.getTagOptions=()=>{const a=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,R.getGrafanaSearcher)().tags(a)},this.onSearchItemClicked=a=>{(0,I.OY)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})},this.onReportSearchUsage=()=>{(0,I.Qw)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})}}initStateFromUrl(a,o=!0){const r=(0,z.vj)(U.E1.getSearchObject());(r.query||r.datasource||r.panel_type)&&(r.layout=m.A.List);const l=te(),i=localStorage.getItem(b.qb)??void 0,c=l===m.A.List?r.sort||i:null;k.setState({...V,...r,layout:l,sort:c??V.sort,prevSort:i,folderUid:a,eventTrackingNamespace:a?"manage_dashboards":"dashboard_search"}),o&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(a){const o=a.sort||this.state.sort||localStorage.getItem(b.qb)||void 0;this.setState({sort:o,...a}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.layout===m.A.List}getSearchQuery(){const a={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred};return a.sort?.length&&!a.sort.includes("name")&&(a.kind=["dashboard","folder"]),a.query?.length||(a.query="*",a.location||(a.kind=["dashboard","folder"])),!this.state.includePanels&&!a.kind&&(a.kind=["dashboard","folder"]),a.panel_type?.length&&(a.kind=["panel"]),a}doSearch(){const a={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels};(0,I.Jy)(this.state.eventTrackingNamespace,a),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const o=(0,R.getGrafanaSearcher)(),r=Date.now();(this.state.starred?o.starred(this.lastQuery):o.search(this.lastQuery)).then(i=>{r>this.lastSearchTimestamp&&(this.setState({result:i,loading:!1}),this.lastSearchTimestamp=r)}).catch(i=>{(0,I.TP)(this.state.eventTrackingNamespace,{...a,error:i?.message}),this.setState({loading:!1})})}}let k;function ce(){if(!k){const a=localStorage.getItem(b.rh)??V.layout;let o=D.Z.getBool(b.to,!0);o&&(o=!1),k=new ae({...V,layout:a,includePanels:o})}return k}function _(){const s=ce();return[s.useState(),s]}var j=t(41273),X=t(52368),se=t(85498),Z=t(51343),me=t(58037),ne=t(83599),C=t(53166),de=t(74642),S=t(86021),ge=t(77196),fe=t(77992);function Ee(){const s=(0,p.wW)(ve),a=(0,w.useDispatch)(),o=(0,S.m2)(),[r]=(0,X.zu)(),[l]=(0,X.jL)(),[,i]=_(),c=(0,e.useMemo)(()=>!se.config.featureToggles.nestedFolders&&Object.values(o.folder).some(h=>h),[o]),u=i.hasSearchFilters(),f=()=>{a((0,S.u6)({isSelected:!1,folderUID:void 0})),u&&i.doSearchWithDebounce()},M=async()=>{await r({selectedItems:o}),G("delete",o),f()},d=async h=>{await l({selectedItems:o,destinationUID:h}),G("move",o),f()},A=()=>{ne.Z.publish(new de.Dn({component:fe._,props:{selectedItems:o,onConfirm:d}}))},O=()=>{ne.Z.publish(new de.Dn({component:ge.p,props:{selectedItems:o,onConfirm:M}}))},L=e.createElement(Z.zx,{onClick:A,variant:"secondary",disabled:c},e.createElement(C.cC,{i18nKey:"browse-dashboards.action.move-button"},"Move"));return e.createElement("div",{className:s.row,"data-testid":"manage-actions"},c?e.createElement(me.u,{content:(0,C.t)("browse-dashboards.action.cannot-move-folders","Folders cannot be moved")},L):L,e.createElement(Z.zx,{onClick:O,variant:"destructive"},e.createElement(C.cC,{i18nKey:"browse-dashboards.action.delete-button"},"Delete")))}const ve=s=>({row:(0,n.css)({display:"flex",flexDirection:"row",gap:s.spacing(1),marginBottom:s.spacing(2)})}),Ce={move:"grafana_manage_dashboards_item_moved",delete:"grafana_manage_dashboards_item_deleted"};function G(s,a){const o=Object.keys(a.dashboard).filter(l=>a.dashboard[l]),r=Object.keys(a.folder).filter(l=>a.folder[l]);(0,g.ff)(Ce[s],{item_counts:{folder:r.length,dashboard:o.length},source:"tree_actions"})}var oe=t(79106),re=t(36356),Ne=t(96856),Ue=t(89962),ze=t(41374);function Ve(){return[{value:m.A.Folders,icon:"folder",description:(0,C.t)("search.actions.view-as-folders","View by folders")},{value:m.A.List,icon:"list-ul",description:(0,C.t)("search.actions.view-as-list","View as list")}]}function He(s){const a=s.layout??m.A.Folders;return a===m.A.Folders&&(s.query||s.sort||s.starred||s.tag.length>0)?m.A.List:a}const Se=({onLayoutChange:s,onSortChange:a,onStarredFilterChange:o=()=>{},onTagFilterChange:r,getTagOptions:l,getSortOptions:i,sortPlaceholder:c,onDatasourceChange:u,onPanelTypeChange:f,onSetIncludePanels:M,state:d,showStarredFilter:A,hideLayout:O})=>{const L=(0,p.wW)($e),h=He(d),P=d.tag.length||d.starred||d.query||d.datasource||d.panel_type?[m.A.Folders]:[];return e.createElement("div",{className:L.actionRow},e.createElement(oe.Lh,{spacing:"md",width:"auto"},e.createElement(ze.D,{isClearable:!1,tags:d.tag,tagOptions:l,onChange:r}),se.config.featureToggles.panelTitleSearch&&e.createElement(re.X,{"data-testid":"include-panels",disabled:h===m.A.Folders,value:d.includePanels,onChange:()=>M(!d.includePanels),label:(0,C.t)("search.actions.include-panels","Include panels")}),A&&e.createElement("div",{className:L.checkboxWrapper},e.createElement(re.X,{label:(0,C.t)("search.actions.starred","Starred"),onChange:o,value:d.starred})),d.datasource&&e.createElement(Z.zx,{icon:"times",variant:"secondary",onClick:()=>u(void 0)},e.createElement(C.cC,{i18nKey:"search.actions.remove-datasource-filter"},"Datasource: ",{datasource:d.datasource})),d.panel_type&&e.createElement(Z.zx,{icon:"times",variant:"secondary",onClick:()=>f(void 0)},"Panel: ",d.panel_type)),e.createElement(oe.Lh,{spacing:"md",width:"auto"},!O&&e.createElement(Ne.S,{options:Ve(),disabledOptions:P,onChange:s,value:h}),e.createElement(Ue.P,{onChange:H=>a(H?.value),value:d.sort,getSortOptions:i,placeholder:c||(0,C.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})))};Se.displayName="ActionRow";const $e=s=>({actionRow:(0,n.css)`
      display: none;

      ${s.breakpoints.up("md")} {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: ${s.spacing(2)};
        width: 100%;
      }
    `,checkboxWrapper:(0,n.css)`
      label {
        line-height: 1.2;
      }
    `});function Ze(){const[s,a]=_();return e.createElement("div",null,e.createElement(Se,{showStarredFilter:!0,state:s,getTagOptions:a.getTagOptions,getSortOptions:(0,R.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,R.getGrafanaSearcher)().sortPlaceholder,includePanels:s.includePanels??!1,onLayoutChange:a.onLayoutChange,onStarredFilterChange:a.onStarredFilterChange,onSortChange:a.onSortChange,onTagFilterChange:a.onTagFilterChange,onDatasourceChange:a.onDatasourceChange,onPanelTypeChange:a.onPanelTypeChange,onSetIncludePanels:a.onSetIncludePanels}))}var Qe=t(53567),Ge=t(88511),je=t(60426),K=(s=>(s[s.Unselected=0]="Unselected",s[s.Selected=1]="Selected",s[s.Mixed=2]="Mixed",s))(K||{}),Xe=t(37109),Je=t(61231),Ye=t(97253),ke=t(20298),le=t(21568);function _e({row:{original:s},isSelected:a,onItemSelectionChange:o}){const r=(0,p.wW)(qe),l=s.item;if(!a)return e.createElement("span",{className:r.checkboxSpacer});if(l.kind==="ui")return l.uiKind==="pagination-placeholder"?e.createElement(re.X,{disabled:!0,value:!1}):e.createElement("span",{className:r.checkboxSpacer});const i=a(l);return e.createElement(re.X,{"data-testid":le.wl.pages.BrowseDashboards.table.checkbox(l.uid),"aria-label":(0,C.t)("browse-dashboards.dashboards-tree.select-checkbox","Select"),value:i===K.Selected,indeterminate:i===K.Mixed,onChange:c=>o?.(l,c.currentTarget.checked)})}const qe=s=>({checkboxSpacer:(0,n.css)({paddingLeft:s.spacing(2)})});function et({isSelected:s,onAllSelectionChange:a}){const o=s?.("$all")??K.Unselected;return e.createElement(re.X,{value:o===K.Selected,indeterminate:o===K.Mixed,"aria-label":(0,C.t)("browse-dashboards.dashboards-tree.select-all-header-checkbox","Select all"),onChange:r=>{o===K.Mixed?a?.(!1):a?.(r.currentTarget.checked)}})}var tt=t(49876),Me=t(36717),at=t(41354),st=t(89719),Ae=t(49311),nt=t(34037),Te=t(44047),ot=t(82113),Ie=t(15130);function Oe(s,a){return s+a.uid}const ye="md",Le="sm";function rt({row:{original:s},onFolderClick:a,treeID:o}){const r=(0,p.wW)(lt),{item:l,level:i,isOpen:c}=s,u=(0,S.$H)(),f=c&&!u[l.uid],M=(0,ot.J6)(s.item.kind,c);return l.kind==="ui"?e.createElement(e.Fragment,null,e.createElement(Ie.A,{level:i,spacing:{xs:1,md:3}}),e.createElement("span",{className:r.folderButtonSpacer}),l.uiKind==="empty-folder"?e.createElement("em",{className:r.emptyText},e.createElement(Me.x,{variant:"body",color:"secondary",truncate:!0},"No items")):e.createElement(tt.Z,{width:200})):e.createElement(e.Fragment,null,e.createElement(Ie.A,{level:i,spacing:{xs:1,md:3}}),l.kind==="folder"?e.createElement(at.h,{size:ye,className:r.chevron,onClick:()=>{a(l.uid,!c)},name:c?"angle-down":"angle-right","aria-label":c?(0,C.t)("browse-dashboards.dashboards-tree.collapse-folder-button","Collapse folder {{title}}",{title:l.title}):(0,C.t)("browse-dashboards.dashboards-tree.expand-folder-button","Expand folder {{title}}",{title:l.title})}):e.createElement("span",{className:r.folderButtonSpacer}),e.createElement("div",{className:r.iconNameContainer},f?e.createElement(st.$,{size:Le}):e.createElement(Ae.J,{size:Le,name:M}),e.createElement(Me.x,{variant:"body",truncate:!0,id:o&&Oe(o,l)},l.url?e.createElement(nt.r,{onClick:()=>{(0,g.ff)("manage_dashboards_result_clicked")},href:l.url,className:r.link},l.title):l.title)))}const lt=s=>({chevron:(0,n.css)({marginRight:s.spacing(1),width:(0,Te.Bm)(ye)}),emptyText:(0,n.css)({overflow:"hidden"}),folderButtonSpacer:(0,n.css)({paddingLeft:`calc(${(0,Te.Bm)(ye)}px + ${s.spacing(1)})`}),iconNameContainer:(0,n.css)({alignItems:"center",display:"flex",gap:s.spacing(1),overflow:"hidden"}),link:(0,n.css)({"&:hover":{textDecoration:"underline"}})});var we=t(60196);function it({row:{original:s}}){const a=(0,p.wW)(ct),o=s.item;return o.kind==="ui"?o.uiKind==="pagination-placeholder"?e.createElement(we.P.Skeleton,null):null:o.tags?e.createElement(we.P,{className:a.tagList,tags:o.tags}):null}function ct(s){return{tagList:(0,n.css)({justifyContent:"flex-start",flexWrap:"nowrap"})}}var dt=t(90403);const Fe=36,Be=36;function ht({items:s,width:a,height:o,isSelected:r,onFolderClick:l,onAllSelectionChange:i,onItemSelectionChange:c,isItemLoaded:u,requestLoadMore:f,canSelect:M=!1}){const d=(0,e.useId)(),A=(0,e.useRef)(null),O=(0,p.wW)(Re);(0,e.useEffect)(()=>{A.current&&A.current.resetloadMoreItemsCache(!0)},[s]);const L=(0,e.useMemo)(()=>{const $={id:"checkbox",width:0,Header:et,Cell:_e},ee={id:"name",width:3,Header:e.createElement("span",{style:{paddingLeft:24}},e.createElement(C.cC,{i18nKey:"browse-dashboards.dashboards-tree.name-column"},"Name")),Cell:Pe=>e.createElement(rt,{...Pe,onFolderClick:l})},ie={id:"tags",width:2,Header:(0,C.t)("browse-dashboards.dashboards-tree.tags-column","Tags"),Cell:it};return[M&&$,ee,ie].filter(ke.fQ)},[l,M]),h=(0,Xe.useTable)({columns:L,data:s},dt._),{getTableProps:P,getTableBodyProps:H,headerGroups:J}=h,N=(0,e.useMemo)(()=>({table:h,isSelected:r,onAllSelectionChange:i,onItemSelectionChange:c,treeID:d}),[h,r,i,c,s,d]),Q=(0,e.useCallback)($=>u($),[u]),ue=(0,e.useCallback)(($,ee)=>{const{parentUID:ie}=s[$];f(ie)},[f,s]);return e.createElement("div",{...P(),role:"table"},J.map($=>{const{key:ee,...ie}=$.getHeaderGroupProps({style:{width:a}});return e.createElement("div",{key:ee,...ie,className:(0,n.cx)(O.row,O.headerRow)},$.headers.map(be=>{const{key:Pe,...xt}=be.getHeaderProps();return e.createElement("div",{key:Pe,...xt,role:"columnheader",className:O.cell},be.render("Header",{isSelected:r,onAllSelectionChange:i}))}))}),e.createElement("div",{...H(),"data-testid":le.wl.pages.BrowseDashboards.table.body},e.createElement(Ye.Z,{ref:A,itemCount:s.length,isItemLoaded:Q,loadMoreItems:ue},({onItemsRendered:$,ref:ee})=>e.createElement(Je.t7,{ref:ee,height:o-Fe,width:a,itemCount:s.length,itemData:N,itemSize:Be,onItemsRendered:$},ut))))}function ut({index:s,style:a,data:o}){const r=(0,p.wW)(Re),{table:l,isSelected:i,onItemSelectionChange:c,treeID:u}=o,{rows:f,prepareRow:M}=l,d=f[s];return M(d),e.createElement("div",{...d.getRowProps({style:a}),className:(0,n.cx)(r.row,r.bodyRow),"aria-labelledby":Oe(u,d.original.item),"data-testid":le.wl.pages.BrowseDashboards.table.row("title"in d.original.item?d.original.item.title:d.original.item.uid)},d.cells.map(A=>{const{key:O,...L}=A.getCellProps();return e.createElement("div",{key:O,...L,className:r.cell},A.render("Cell",{isSelected:i,onItemSelectionChange:c,treeID:u}))}))}const Re=s=>({row:(0,n.css)({gap:s.spacing(1)}),headerRow:(0,n.css)({backgroundColor:s.colors.background.secondary,height:Fe}),bodyRow:(0,n.css)({height:Be,"&:hover":{backgroundColor:s.colors.emphasize(s.colors.background.primary,.03)}}),cell:(0,n.css)({padding:s.spacing(1),overflow:"hidden",display:"flex",alignItems:"center"}),link:(0,n.css)({"&:hover":{textDecoration:"underline"}})});function mt({folderUID:s,width:a,height:o,canSelect:r}){const l=(0,S.zw)(s),i=(0,w.useDispatch)(),c=(0,S.Sk)(s),u=(0,S.aw)(),f=(0,S.$H)(),M=(0,e.useCallback)((h,P)=>{i((0,S.xm)({folderUID:h,isOpen:P})),P&&i((0,S.si)({parentUID:h,pageSize:je.IV}))},[i]),d=(0,e.useCallback)((h,P)=>{i((0,S.wk)({item:h,isSelected:P}))},[i]),A=(0,e.useCallback)(h=>{if(h==="$all"){if(u.$all)return K.Selected;for(const J of Object.values(u))if(typeof J!="boolean"){for(const N in J)if(J[N])return K.Mixed}return K.Unselected}return u[h.kind][h.uid]?K.Selected:xe(h,f,u)?K.Mixed:K.Unselected},[u,f]),O=(0,e.useCallback)(h=>{const P=c[h];if(!P)return!1;const H=P.item;return!(H.kind==="ui"&&H.uiKind==="pagination-placeholder")},[c]),L=(0,S.D$)();return l==="fulfilled"&&c.length===0?e.createElement("div",{style:{width:a}},r?e.createElement(Ge.Z,{title:s?"This folder doesn't have any dashboards yet":"No dashboards yet. Create your first!",buttonIcon:"plus",buttonTitle:"Create Dashboard",buttonLink:s?`dashboard/new?folderUid=${s}`:"dashboard/new",proTip:s&&"Add/move dashboards to your folder at ->",proTipLink:s&&"dashboards",proTipLinkTitle:s&&"Browse dashboards",proTipTarget:""}):e.createElement(Qe._,{callToActionElement:e.createElement("span",null,"This folder is empty")})):e.createElement(ht,{canSelect:r,items:c,width:a,height:o,isSelected:A,onFolderClick:M,onAllSelectionChange:h=>i((0,S.u6)({isSelected:h,folderUID:s})),onItemSelectionChange:d,isItemLoaded:O,requestLoadMore:L})}function xe(s,a,o){const r=a[s.uid];return r?r.items.some(l=>{const i=o[l.kind][l.uid];return i||xe(l,a,o)}):!1}var gt=t(97890),ft=t(63424),pe=t(46213),Et=t(67669),vt=t(59899),Ct=t(17618),yt=t(85765),pt=t(64516),Dt=t(8239);const bt={folderName:""};function Pt({onCancel:s,onConfirm:a}){const o=(0,C.t)("browse-dashboards.action.new-folder-name-required-phrase","Folder name is required."),r=async i=>{try{return await Dt.t.validateNewFolderName(i),!0}catch(c){if(c instanceof Error)return c.message;throw c}},l=(0,C.t)("browse-dashboards.new-folder-form.name-label","Folder name");return e.createElement(Ct.l,{defaultValues:bt,onSubmit:i=>a(i.folderName),"data-testid":le.wl.pages.BrowseDashboards.NewFolderForm.form},({register:i,errors:c})=>e.createElement(e.Fragment,null,e.createElement(yt.g,{label:l,invalid:!!c.folderName,error:c.folderName&&c.folderName.message},e.createElement(pt.I,{"data-testid":le.wl.pages.BrowseDashboards.NewFolderForm.nameInput,id:"folder-name-input",...i("folderName",{required:o,validate:async u=>await r(u)})})),e.createElement(oe.Lh,null,e.createElement(Z.zx,{variant:"secondary",fill:"outline",onClick:s},e.createElement(C.cC,{i18nKey:"browse-dashboards.new-folder-form.cancel-label"},"Cancel")),e.createElement(Z.zx,{type:"submit"},e.createElement(C.cC,{i18nKey:"browse-dashboards.new-folder-form.create-label"},"Create")))))}function St({parentFolder:s,canCreateDashboard:a,canCreateFolder:o}){const[r,l]=(0,e.useState)(!1),i=(0,gt.TH)(),[c]=(0,X.wo)(),[u,f]=(0,e.useState)(!1),M=async A=>{try{await c({title:A,parentUid:s?.uid});const O=s?.parents?s.parents.length+1:0;(0,g.ff)("grafana_manage_dashboards_folder_created",{is_subfolder:!!s?.uid,folder_depth:O})}finally{f(!1)}},d=e.createElement(ft.v,null,a&&e.createElement(pe.s,{label:(0,j.Z)(),onClick:()=>(0,g.ff)("grafana_menu_item_clicked",{url:he("/dashboard/new",s?.uid),from:i.pathname}),url:he("/dashboard/new",s?.uid)}),o&&e.createElement(pe.s,{onClick:()=>f(!0),label:(0,j.tH)()}),a&&e.createElement(pe.s,{label:(0,j.F)(),onClick:()=>(0,g.ff)("grafana_menu_item_clicked",{url:he("/dashboard/import",s?.uid),from:i.pathname}),url:he("/dashboard/import",s?.uid)}));return e.createElement(e.Fragment,null,e.createElement(Et.L,{overlay:d,onVisibleChange:l},e.createElement(Z.zx,null,(0,j.Fl)(),e.createElement(Ae.J,{name:r?"angle-up":"angle-down"}))),u&&e.createElement(vt.d,{title:(0,j.tH)(),subtitle:s?.title?`Location: ${s.title}`:void 0,onClose:()=>f(!1),size:"sm"},e.createElement(Pt,{onConfirm:M,onCancel:()=>f(!1)})))}function he(s,a){return a?s+"?folderUid="+a:s}var Mt=t(68446),At=t(46901),Tt=t(98147),De=t(96305),It=t(39793),Ot=t(55517);const q=50,Lt={view:new At.U((0,Tt.g0)({fields:[{name:"uid",display:!0,values:Array(q).fill(null)},{name:"kind",display:!0,values:Array(q).fill("dashboard")},{name:"name",display:!0,values:Array(q).fill("")},{name:"location",display:!0,values:Array(q).fill("")},{name:"tags",display:!0,values:Array(q).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:q};function wt({width:s,height:a,canSelect:o}){const r=(0,w.useDispatch)(),l=(0,w.useSelector)(h=>h.browseDashboards.selectedItems),i=(0,S.QD)(),{keyboardEvents:c}=(0,It.A)(),[u,f]=_(),M=u.result??Lt,d=(0,e.useCallback)((h,P)=>h?h==="*"&&P==="*"?i:h==="*"?!1:l[We(h)][P]??!1:!1,[l,i]),A=(0,e.useCallback)(()=>{r((0,S.u6)({isSelected:!1,folderUID:void 0}))},[r]),O=(0,e.useCallback)((h,P)=>{const H=!d(h,P);r((0,S.wk)({item:{kind:We(h),uid:P},isSelected:H}))},[d,r]);if(M.totalRows===0)return e.createElement("div",{style:{width:s}},e.createElement(De.Z,null,e.createElement(De.Z.Heading,null,e.createElement(C.cC,{i18nKey:"browse-dashboards.no-results.text"},"No results found for your query.")),e.createElement(De.Z.Actions,null,e.createElement(Z.zx,{variant:"secondary",onClick:f.onClearSearchAndFilters},e.createElement(C.cC,{i18nKey:"browse-dashboards.no-results.clear"},"Clear search and filters")))));const L={response:M,selection:o?d:void 0,selectionToggle:o?O:void 0,clearSelection:A,width:s,height:a,onTagSelected:f.onAddTag,keyboardEvents:c,onDatasourceChange:u.datasource?f.onDatasourceChange:void 0,onClickItem:f.onSearchItemClicked};return e.createElement(Ot.Q,{...L})}function We(s){switch(s){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+s)}var Ft=t(18972);const Ke=(0,e.memo)(({match:s})=>{const{uid:a}=s.params,o=(0,w.useDispatch)(),r=(0,p.wW)(Bt),[l,i]=_(),c=i.hasSearchFilters();(0,e.useEffect)(()=>{i.initStateFromUrl(a),o((0,S.u6)({isSelected:!1,folderUID:void 0}))},[o,a,i]),(0,e.useEffect)(()=>{!c&&l.result&&i.setState({result:void 0,includePanels:void 0})},[c,l.result,i]);const{data:u}=(0,X.t4)(a??X.CN),[f]=(0,X.vN)(),M=(0,e.useMemo)(()=>{if(!u)return;const N=(0,T.B1)(u),Q=(0,T.Pr)(u.uid),ue=N.children?.find($=>$.id===Q);return ue&&(ue.active=!0),N},[u]),d=(0,S.QD)(),{canEditFolders:A,canEditDashboards:O,canCreateDashboards:L,canCreateFolders:h}=(0,Ft.a)(u),P=A&&a,H=A||O,J=async N=>{if(u){const Q=await f({...u,title:N});if("error"in Q)throw(0,g.ff)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_with_error",error:Q.error}),Q.error;(0,g.ff)("grafana_browse_dashboards_page_edit_folder_name",{status:"success"})}else(0,g.ff)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_no_folderDTO"})};return e.createElement(v.T,{navId:"dashboards/browse",pageNav:M,onEditTitle:P?J:void 0,actions:e.createElement(e.Fragment,null,u&&e.createElement(Mt.A,{folder:u}),(L||h)&&e.createElement(St,{parentFolder:u,canCreateDashboard:L,canCreateFolder:h}))},e.createElement(v.T.Contents,{className:r.pageContents},e.createElement(E.H,{placeholder:(0,j.nV)(l.includePanels),value:l.query,escapeRegex:!1,onChange:N=>i.onQueryChange(N)}),d?e.createElement(Ee,null):e.createElement(Ze,null),e.createElement("div",{className:r.subView},e.createElement(y.Z,null,({width:N,height:Q})=>c?e.createElement(wt,{canSelect:H,width:N,height:Q}):e.createElement(mt,{canSelect:H,width:N,height:Q,folderUID:a})))))}),Bt=s=>({pageContents:(0,n.css)({display:"grid",gridTemplateRows:"auto auto 1fr",height:"100%",rowGap:s.spacing(1)}),subView:(0,n.css)({height:"100%"})});Ke.displayName="BrowseDashboardsPage";const Rt=Ke},77196:(Y,x,t)=>{t.d(x,{p:()=>F});var n=t(31733),e=t(51925),y=t(85498),g=t(90069),p=t(36717),E=t(25111),v=t(53166),w=t(52368),T=t(32166);const F=({onConfirm:U,onDismiss:B,selectedItems:D,...b})=>{const{data:I}=(0,w.zs)(D),R=!y.config.featureToggles.nestedFolders&&I&&(I.alertRule||I.libraryPanel),[m,z]=(0,n.useState)(!1),V=async()=>{z(!0);try{await U(),z(!1),B()}catch{z(!1)}};return n.createElement(g.s,{body:n.createElement(n.Fragment,null,n.createElement(p.x,{element:"p"},n.createElement(v.cC,{i18nKey:"browse-dashboards.action.delete-modal-text"},"This action will delete the following content:")),n.createElement(T.X,{selectedItems:D}),n.createElement(e.T,{v:2})),description:n.createElement(n.Fragment,null,R?n.createElement(E.b,{severity:"warning",title:(0,v.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder")},n.createElement(v.cC,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text"},"One or more folders contain library panels or alert rules. Delete these first in order to proceed.")):null),confirmationText:"Delete",confirmText:m?(0,v.t)("browse-dashboards.action.deleting","Deleting..."):(0,v.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:B,onConfirm:V,title:(0,v.t)("browse-dashboards.action.delete-modal-title","Delete"),...b})}},77992:(Y,x,t)=>{t.d(x,{_:()=>U});var n=t(31733),e=t(51925),y=t(5572),g=t(25111),p=t(36717),E=t(85765),v=t(51343),w=t(26371),T=t(53166),F=t(32166);const U=({onConfirm:B,onDismiss:D,selectedItems:b,...I})=>{const[R,m]=(0,n.useState)(),[z,V]=(0,n.useState)(!1),W=Object.keys(b.folder).filter(ae=>b.folder[ae]),te=async()=>{if(R!==void 0){V(!0);try{await B(R),V(!1),D()}catch{V(!1)}}};return n.createElement(y.u,{title:(0,T.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:D,...I},W.length>0&&n.createElement(g.b,{severity:"info",title:(0,T.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),n.createElement(p.x,{element:"p"},n.createElement(T.cC,{i18nKey:"browse-dashboards.action.move-modal-text"},"This action will move the following content:")),n.createElement(F.X,{selectedItems:b}),n.createElement(e.T,{v:3}),n.createElement(E.g,{label:(0,T.t)("browse-dashboards.action.move-modal-field-label","Folder name")},n.createElement(w.E,{value:R,excludeUIDs:W,onChange:m})),n.createElement(y.u.ButtonRow,null,n.createElement(v.zx,{onClick:D,variant:"secondary",fill:"outline"},n.createElement(T.cC,{i18nKey:"browse-dashboards.action.cancel-button"},"Cancel")),n.createElement(v.zx,{disabled:R===void 0||z,onClick:te,variant:"primary"},z?(0,T.t)("browse-dashboards.action.moving","Moving..."):(0,T.t)("browse-dashboards.action.move-button","Move"))))}},68446:(Y,x,t)=>{t.d(x,{A:()=>V});var n=t(31733),e=t(85498),y=t(64704),g=t(19690),p=t(63424),E=t(46213),v=t(67669),w=t(51343),T=t(49311),F=t(59899),U=t(49465),B=t(75923),D=t(53166),b=t(74642),I=t(52368),R=t(18972),m=t(77196),z=t(77992);function V({folder:W}){const[te,ae]=(0,n.useState)(!1),[k,ce]=(0,n.useState)(!1),[_]=(0,I.OH)(),[j]=(0,I.yC)(),{canEditFolders:X,canDeleteFolders:se,canViewPermissions:Z,canSetPermissions:me}=(0,R.a)(W),ne=e.config.featureToggles.nestedFolders&&X,C=async G=>{await _({folder:W,destinationUID:G}),(0,y.ff)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},de=async()=>{await j(W),(0,y.ff)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:G}=W,oe=G&&G.length?G[G.length-1].url:"/dashboards";g.E1.push(oe)},S=()=>{B.h$.publish(new b.Dn({component:z._,props:{selectedItems:{folder:{[W.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:C}}))},ge=()=>{B.h$.publish(new b.Dn({component:m.p,props:{selectedItems:{folder:{[W.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:de}}))},fe=(0,D.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),Ee=(0,D.t)("browse-dashboards.folder-actions-button.move","Move"),ve=(0,D.t)("browse-dashboards.folder-actions-button.delete","Delete"),Ce=n.createElement(p.v,null,Z&&n.createElement(E.s,{onClick:()=>ce(!0),label:fe}),ne&&n.createElement(E.s,{onClick:S,label:Ee}),se&&n.createElement(E.s,{destructive:!0,onClick:ge,label:ve}));return!Z&&!ne&&!se?null:n.createElement(n.Fragment,null,n.createElement(v.L,{overlay:Ce,onVisibleChange:ae},n.createElement(w.zx,{variant:"secondary"},n.createElement(D.cC,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions"},"Folder actions"),n.createElement(T.J,{name:te?"angle-up":"angle-down"}))),k&&n.createElement(F.d,{title:(0,D.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:W.title,onClose:()=>ce(!1),size:"md"},n.createElement(U.P,{resource:"folders",resourceId:W.uid,canSetPermissions:me})))}},18972:(Y,x,t)=>{t.d(x,{a:()=>p});var n=t(85498),e=t(75923),y=t(42342);function g(E,v){return v?e.Vt.hasPermissionInMetadata(E,v):e.Vt.hasPermission(E)}function p(E){const v=g(y.AccessControlAction.DashboardsCreate,E),w=!!((!E||n.config.featureToggles.nestedFolders)&&g(y.AccessControlAction.FoldersCreate)),T=g(y.AccessControlAction.FoldersDelete,E),F=g(y.AccessControlAction.DashboardsWrite,E),U=g(y.AccessControlAction.FoldersWrite,E),B=g(y.AccessControlAction.FoldersPermissionsWrite,E),D=g(y.AccessControlAction.FoldersPermissionsRead,E);return{canCreateDashboards:v,canCreateFolders:w,canDeleteFolders:T,canEditDashboards:F,canEditFolders:U,canSetPermissions:B,canViewPermissions:D}}},41273:(Y,x,t)=>{t.d(x,{F:()=>p,Fl:()=>E,Z:()=>y,nV:()=>e,tH:()=>g});var n=t(53166);function e(v=!1){return v?(0,n.t)("search.search-input.include-panels-placeholder","Search for dashboards, folders, and panels"):(0,n.t)("search.search-input.placeholder","Search for dashboards and folders")}function y(){return(0,n.t)("search.dashboard-actions.new-dashboard","New dashboard")}function g(){return(0,n.t)("search.dashboard-actions.new-folder","New folder")}function p(){return(0,n.t)("search.dashboard-actions.import","Import")}function E(){return(0,n.t)("search.dashboard-actions.new","New")}}}]);

//# sourceMappingURL=DashboardListPage.f110aebdc9526b73bb99.js.map