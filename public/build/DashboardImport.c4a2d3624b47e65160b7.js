"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8808],{18504:(_,L,t)=>{t.d(L,{p:()=>B});var c=t(76932),e=t(31733),r=t(49876),F=t(85498),g=t(76067),v=t(49311),O=t(34037),T=t(95885),S=t(103),R=t(73213),b=t(20298),p=t(5572),$=t(51343),E=t(64213),D=t(3630),j=t(39501),z=t(4579);const H={loadingState:b.Gu.Loading,dashboardTitles:[]},l=(0,z.PH)("libraryPanels/delete/searchCompleted"),x=(n=H,h)=>l.match(h)?{...n,dashboardTitles:h.payload.dashboards.map(P=>P.title),loadingState:b.Gu.Done}:n;function J(n){return async function(h){const P=await(0,j.E8)(n.uid);h(l({dashboards:P}))}}const I=({libraryPanel:n,onDismiss:h,onConfirm:P})=>{const M=(0,g.wW)(E.J),[{dashboardTitles:K,loadingState:A},V]=(0,e.useReducer)(x,H),Q=(0,e.useMemo)(()=>(0,D.tb)(V),[V]);(0,e.useEffect)(()=>{Q(J(n))},[Q,n]);const X=!!K.length,Z=A===b.Gu.Done;return e.createElement(p.u,{className:M.modal,title:"Delete library panel",icon:"trash-alt",onDismiss:h,isOpen:!0},Z?null:e.createElement(u,null),Z?e.createElement("div",null,X?e.createElement(y,{dashboardTitles:K}):null,X?null:e.createElement(W,null),e.createElement(p.u.ButtonRow,null,e.createElement($.zx,{variant:"secondary",onClick:h,fill:"outline"},"Cancel"),e.createElement($.zx,{variant:"destructive",onClick:P,disabled:X},"Delete"))):null)},u=()=>e.createElement("span",null,"Loading library panel..."),W=()=>{const n=(0,g.wW)(E.J);return e.createElement("div",{className:n.modalText},"Do you want to delete this panel?")},y=({dashboardTitles:n})=>{const h=(0,g.wW)(E.J),P=n.length===1?"dashboard.":"dashboards.",M=`${n.length} ${P}`;return n.length===0?null:e.createElement("div",null,e.createElement("p",{className:h.textInfo},"This library panel can not be deleted because it is connected to ",e.createElement("strong",null,M)," Remove the library panel from the dashboards listed below and retry."),e.createElement("table",{className:h.myTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Dashboard name"))),e.createElement("tbody",null,n.map((K,A)=>e.createElement("tr",{key:`dash-title-${A}`},e.createElement("td",null,K))))))},C=({libraryPanel:n,onClick:h,onDelete:P,showSecondaryActions:M})=>{const[K,A]=(0,e.useState)(!1),V=()=>{P?.(n),A(!1)},Q=F.config.panels[n.model.type]??(0,S.X)(n.model.type).meta;return e.createElement(e.Fragment,null,e.createElement(R.X,{isCurrent:!1,title:n.name,description:n.description,plugin:Q,onClick:()=>h?.(n),onDelete:M?()=>A(!0):void 0},e.createElement(G,{libraryPanel:n})),K&&e.createElement(I,{libraryPanel:n,onConfirm:V,onDismiss:()=>A(!1)}))},U=({showSecondaryActions:n,rootProps:h})=>{const P=(0,g.wW)(ee);return e.createElement(R.X.Skeleton,{hasDelete:n,...h},e.createElement(r.Z,{containerClassName:P.metaContainer,width:80}))},B=(0,T.y)(C,U);function G({libraryPanel:n}){const h=(0,g.wW)(ee);return!n.meta?.folderUid&&!n.meta?.folderName?null:n.meta.folderUid?e.createElement("span",{className:h.metaContainer},e.createElement(O.r,{href:`/dashboards/f/${n.meta.folderUid}`},e.createElement(v.J,{name:"folder-upload",size:"sm"}),e.createElement("span",null,n.meta.folderName))):e.createElement("span",{className:h.metaContainer},e.createElement(v.J,{name:"folder",size:"sm"}),e.createElement("span",null,n.meta.folderName))}function ee(n){return{metaContainer:(0,c.css)({display:"flex",alignItems:"center",color:n.colors.text.secondary,fontSize:n.typography.bodySmall.fontSize,paddingTop:n.spacing(.5),svg:{marginRight:n.spacing(.5),marginBottom:3}})}}},3630:(_,L,t)=>{t.d(L,{UO:()=>z,Xu:()=>j,tb:()=>H});var c=t(40510),e=t(57298),r=t(86457),F=t(26722),g=t(96506),v=t(89582),O=t(56183),T=t(30914),S=t(57423),R=t(79163),b=t(50014),p=t(85498),$=t(95471),E=t(39501),D=t(69757);function j(l){const x=(I,u)=>I.id===u.type,J=(I,u)=>{const W=(0,$.xW)();return I.filter(y=>{const C=W.find(U=>x(U,y));return u?!!C?.skipDataQuery:!C?.skipDataQuery})};return function(I){const u=new c.w0,W=(0,e.D)((0,E.Pq)({searchString:l.searchString,perPage:l.perPage,page:l.page,excludeUid:l.currentPanelId,sortDirection:l.sortDirection,typeFilter:l.panelFilter,folderFilterUIDs:l.folderFilterUIDs})).pipe((0,v.z)(y=>{const{elements:C}=y;if(p.config.featureToggles.vizAndWidgetSplit&&l.isWidget!==void 0){const U=J(C,l.isWidget);return(0,r.of)({...y,elements:U})}return(0,r.of)({...y,elements:C})}),(0,v.z)(({perPage:y,elements:C,page:U,totalCount:B})=>(0,r.of)((0,D.zK)({libraryPanels:C,page:U,perPage:y,totalCount:B}))),(0,O.K)(y=>(console.error(y),(0,r.of)((0,D.zK)({...D.p$,page:l.page,perPage:l.perPage})))),(0,T.x)(()=>u.unsubscribe()),(0,S.B)());u.add((0,F.T)((0,g.H)(50).pipe((0,R.h)((0,D.xU)()),(0,b.R)(W)),W).subscribe(I))}}function z(l,x){return async function(J){try{await(0,E.UO)(l),j(x)(J)}catch(I){console.error(I)}}}function H(l){return function(x){return x instanceof Function?x(l):l(x)}}},69757:(_,L,t)=>{t.d(L,{_p:()=>O,oO:()=>v,p$:()=>r,xU:()=>F,zK:()=>g});var c=t(4579),e=t(20298);const r={loadingState:e.Gu.Loading,libraryPanels:[],totalCount:0,perPage:40,page:1,numberOfPages:0,currentPanelId:void 0},F=(0,c.PH)("libraryPanels/view/initSearch"),g=(0,c.PH)("libraryPanels/view/searchCompleted"),v=(0,c.PH)("libraryPanels/view/changePage"),O=(T,S)=>{if(F.match(S))return{...T,loadingState:e.Gu.Loading};if(g.match(S)){const{libraryPanels:R,page:b,perPage:p,totalCount:$}=S.payload,E=Math.ceil($/p);return{...T,libraryPanels:R,perPage:p,totalCount:$,loadingState:e.Gu.Done,numberOfPages:E,page:b>E?b-1:b}}return v.match(S)?{...T,page:S.payload.page}:T}},64213:(_,L,t)=>{t.d(L,{J:()=>e});var c=t(76932);function e(r){return{myTable:(0,c.css)`
      max-height: 204px;
      overflow-y: auto;
      margin-top: 11px;
      margin-bottom: 28px;
      border-radius: ${r.shape.radius.default};
      border: 1px solid ${r.colors.action.hover};
      background: ${r.colors.background.primary};
      color: ${r.colors.text.secondary};
      font-size: ${r.typography.h6.fontSize};
      width: 100%;

      thead {
        color: #538ade;
        font-size: ${r.typography.bodySmall.fontSize};
      }

      th,
      td {
        padding: 6px 13px;
        height: ${r.spacing(4)};
      }

      tbody > tr:nth-child(odd) {
        background: ${r.colors.background.secondary};
      }
    `,noteTextbox:(0,c.css)`
      margin-bottom: ${r.spacing(4)};
    `,textInfo:(0,c.css)`
      color: ${r.colors.text.secondary};
      font-size: ${r.typography.size.sm};
    `,dashboardSearch:(0,c.css)`
      margin-top: ${r.spacing(2)};
    `,modal:(0,c.css)`
      width: 500px;
    `,modalText:(0,c.css)`
      font-size: ${r.typography.h4.fontSize};
      color: ${r.colors.text.primary};
      margin-bottom: ${r.spacing(4)};
      padding-top: ${r.spacing(2)};
    `}}},50532:(_,L,t)=>{t.r(L),t.d(L,{default:()=>xe});var c=t(76932),e=t(31733),r=t(55024),F=t(56821),g=t(20298),v=t(21568),O=t(64704),T=t(85498),S=t(94746),R=t(54679),b=t(17618),p=t(85765),$=t(36667),E=t(64516),D=t(51343),j=t(28718),z=t(79106),H=t(89719),l=t(76067),x=t(33227),J=t(83599),I=t(50186),u=t(53166),W=t(92089),y=t(40137),C=t(19690),U=t(67683),B=t(51450),G=t(4554),ee=t(65821),n=t(32901),h=t(33204),P=t(79228),M=t(70576),K=t(69391),A=t(8239);const V=o=>{let a;try{a=JSON.parse(o)}catch{return(0,M.t)("dashboard.validation.invalid-json","Not valid JSON")}if(a&&a.hasOwnProperty("tags"))if(Array.isArray(a.tags)){if(a.tags.some(d=>typeof d!="string"))return(0,M.t)("dashboard.validation.tags-expected-strings","tags expected array of strings")}else return(0,M.t)("dashboard.validation.tags-expected-array","tags expected array");return!0},Q=o=>{const a=/(^\d+$)|dashboards\/(\d+)/.exec(o);return a&&(a[1]||a[2])?!0:(0,M.t)("dashboard.validation.invalid-dashboard-id","Could not find a valid Grafana.com ID")},X=(o,a)=>A.t.validateNewDashboardName(a,o).then(()=>!0).catch(f=>{if(f.type==="EXISTING")return f.message}),Z=o=>(0,K.i)().get(`/api/dashboards/uid/${o}`).then(a=>`Dashboard named '${a?.dashboard.title}' in folder '${a?.meta.folderTitle}' has the same UID`).catch(a=>(a.isHandled=!0,!0));var ie=t(18504);function re({inputs:o,label:a,description:f,folderName:d}){const s=(0,l.wW)(ce);return o?.length?e.createElement("div",{className:s.spacer},e.createElement(p.g,{label:a,description:f},e.createElement(e.Fragment,null,o.map((i,Y)=>{const w=`elements[${Y}]`,k=i.state===G.KQ.New?{...i.model,meta:{...i.model.meta,folderName:d??"General"}}:{...i.model};return e.createElement("div",{className:s.item,key:w},e.createElement(ie.p,{libraryPanel:k,onClick:()=>{}}))})))):null}function ce(o){return{spacer:(0,c.css)`
      margin-bottom: ${o.spacing(2)};
    `,item:(0,c.css)`
      margin-bottom: ${o.spacing(1)};
    `}}const me=({register:o,errors:a,control:f,getValues:d,uidReset:s,inputs:i,initialFolderUid:Y,onUidReset:w,onCancel:k,onSubmit:te,watch:ae})=>{const[ne,Le]=(0,e.useState)(!1),Oe=ae("dataSources"),de=ae("folder");(0,e.useEffect)(()=>{ne&&(a.title||a.uid)&&te(d())},[a,d,ne,te]);const Te=i?.libraryPanels?.filter(m=>m.state===G.KQ.New)??[],Ue=i?.libraryPanels?.filter(m=>m.state===G.KQ.Exists)??[];return e.createElement(e.Fragment,null,e.createElement(U.D,null,"Options"),e.createElement(p.g,{label:"Name",invalid:!!a.title,error:a.title&&a.title.message},e.createElement(E.I,{...o("title",{required:"Name is required",validate:async m=>await X(m,d().folder.uid)}),type:"text","data-testid":v.wl.components.ImportDashboardForm.name})),e.createElement(p.g,{label:"Folder"},e.createElement(n.g,{render:({field:{ref:m,...N}})=>e.createElement(h.Fz,{...N,enableCreateNew:!0,initialFolderUid:Y}),name:"folder",control:f})),e.createElement(p.g,{label:"Unique identifier (UID)",description:`The unique identifier (UID) of a dashboard can be used for uniquely identify a dashboard between multiple Grafana installs.
                The UID allows having consistent URLs for accessing dashboards so changing the title of a dashboard will not break any
                bookmarked links to that dashboard.`,invalid:!!a.uid,error:a.uid&&a.uid.message},e.createElement(e.Fragment,null,s?e.createElement(E.I,{...o("uid",{required:!0,validate:async m=>await Z(m)})}):e.createElement(E.I,{disabled:!0,...o("uid",{validate:async m=>await Z(m)}),addonAfter:!s&&e.createElement(D.zx,{onClick:w},"Change uid")}))),i.dataSources&&i.dataSources.map((m,N)=>{if(m.pluginId===ee.hr.type)return null;const q=`dataSources.${N}`,Me=Oe??[];return e.createElement(p.g,{label:m.label,description:m.description,key:q,invalid:a.dataSources&&!!a.dataSources[N],error:a.dataSources&&a.dataSources[N]&&"A data source is required"},e.createElement(n.g,{name:q,render:({field:{ref:Re,...Ne}})=>e.createElement(P.q,{...Ne,noDefault:!0,placeholder:m.info,pluginId:m.pluginId,current:Me[N]?.uid}),control:f,rules:{required:!0}}))}),i.constants&&i.constants.map((m,N)=>{const q=`constants.${N}`;return e.createElement(p.g,{label:m.label,error:a.constants&&a.constants[N]&&`${m.label} needs a value`,invalid:a.constants&&!!a.constants[N],key:q},e.createElement(E.I,{...o(q,{required:!0}),defaultValue:m.value}))}),e.createElement(re,{inputs:Te,label:"New library panels",description:"List of new library panels that will get imported.",folderName:de.title}),e.createElement(re,{inputs:Ue,label:"Existing library panels",description:"List of existing library panels. These panels are not affected by the import.",folderName:de.title}),e.createElement(z.Lh,null,e.createElement(D.zx,{type:"submit","data-testid":v.wl.components.ImportDashboardForm.submit,variant:ue(a),onClick:()=>{Le(!0)}},he(a)),e.createElement(D.zx,{type:"reset",variant:"secondary",onClick:k},"Cancel")))};function ue(o){return o&&(o.title||o.uid)?"destructive":"primary"}function he(o){return o&&(o.title||o.uid)?"Import (Overwrite)":"Import"}const pe="dashboard_import_imported",fe=o=>{const a=C.E1.getSearchObject();return{dashboard:o.importDashboard.dashboard,meta:o.importDashboard.meta,source:o.importDashboard.source,inputs:o.importDashboard.inputs,folder:a.folderUid?{uid:String(a.folderUid)}:{uid:""}}},ge={clearLoadedDashboard:B.ys,importDashboard:B.$j},Ee=(0,r.connect)(fe,ge);class ve extends e.PureComponent{constructor(){super(...arguments),this.state={uidReset:!1},this.onSubmit=a=>{(0,O.ff)(pe),this.props.importDashboard(a)},this.onCancel=()=>{this.props.clearLoadedDashboard()},this.onUidReset=()=>{this.setState({uidReset:!0})}}render(){const{dashboard:a,inputs:f,meta:d,source:s,folder:i}=this.props,{uidReset:Y}=this.state;return e.createElement(e.Fragment,null,s===G.G7.Gcom&&e.createElement("div",{style:{marginBottom:"24px"}},e.createElement("div",null,e.createElement(U.D,null,"Importing dashboard from"," ",e.createElement("a",{href:`https://grafana.com/dashboards/${a.gnetId}`,className:"external-link",target:"_blank",rel:"noreferrer"},"Grafana.com"))),e.createElement("table",{className:"filter-table form-inline"},e.createElement("tbody",null,e.createElement("tr",null,e.createElement("td",null,"Published by"),e.createElement("td",null,d.orgName)),e.createElement("tr",null,e.createElement("td",null,"Updated on"),e.createElement("td",null,(0,y.dq)(d.updatedAt)))))),e.createElement(b.l,{onSubmit:this.onSubmit,defaultValues:{...a,constants:[],dataSources:[],elements:[],folder:i},validateOnMount:!0,validateFieldsOnMount:["title","uid"],validateOn:"onChange"},({register:w,errors:k,control:te,watch:ae,getValues:ne})=>e.createElement(me,{register:w,errors:k,control:te,getValues:ne,uidReset:Y,inputs:f,onCancel:this.onCancel,onUidReset:this.onUidReset,onSubmit:this.onSubmit,watch:ae,initialFolderUid:i.uid})))}}const se=Ee(ve);se.displayName="ImportDashboardOverview";const oe="dashboard_import_loaded",be=`{
    "title": "Example - Repeating Dictionary variables",
    "uid": "_0HnEoN4z",
    "panels": [...]
    ...
}
`,De=o=>({loadingState:o.importDashboard.state}),ye={fetchGcomDashboard:B.q_,importDashboardJson:B.nQ,cleanUpAction:W.e},Pe=(0,r.connect)(De,ye);class Ie extends e.PureComponent{constructor(a){super(a),this.fileListRenderer=(d,s)=>null,this.onFileUpload=d=>{(0,O.ff)(oe,{import_source:"json_uploaded"});try{this.props.importDashboardJson(JSON.parse(String(d)))}catch(s){s instanceof Error&&J.Z.emit(F.SI.alertError,["Import failed","JSON -> JS Serialization failed: "+s.message]);return}},this.getDashboardFromJson=d=>{(0,O.ff)(oe,{import_source:"json_pasted"}),this.props.importDashboardJson(JSON.parse(d.dashboardJson))},this.getGcomDashboard=d=>{(0,O.ff)(oe,{import_source:"gcom"});let s;const i=/(^\d+$)|dashboards\/(\d+)/.exec(d.gcomDashboard);i&&i[1]?s=i[1]:i&&i[2]&&(s=i[2]),s&&this.props.fetchGcomDashboard(s)},this.pageNav={text:"Import dashboard",subTitle:"Import dashboard from file or Grafana.com"};const{gcomDashboardId:f}=this.props.queryParams;if(f){this.getGcomDashboard({gcomDashboard:f});return}}componentWillUnmount(){this.props.cleanUpAction({cleanupAction:a=>a.importDashboard=G.wg})}renderImportForm(){const a=Ce(this.props.theme),f=()=>e.createElement(S.h,{variant:"bodySmall",href:"https://grafana.com/grafana/dashboards/",external:!0},"grafana.com/dashboards");return e.createElement(e.Fragment,null,e.createElement("div",{className:a.option},e.createElement(R.Yo,{options:{multiple:!1,accept:[".json",".txt"]},readAs:"readAsText",fileListRenderer:this.fileListRenderer,onLoad:this.onFileUpload},e.createElement(R.A_,{primaryText:(0,u.t)("dashboard-import.file-dropzone.primary-text","Upload dashboard JSON file"),secondaryText:(0,u.t)("dashboard-import.file-dropzone.secondary-text","Drag and drop here or click to browse")}))),e.createElement("div",{className:a.option},e.createElement(b.l,{onSubmit:this.getGcomDashboard,defaultValues:{gcomDashboard:""}},({register:d,errors:s})=>e.createElement(p.g,{label:e.createElement($._,{className:a.labelWithLink,htmlFor:"url-input"},e.createElement("span",null,e.createElement(u.cC,{i18nKey:"dashboard-import.gcom-field.label"},"Find and import dashboards for common applications at ",e.createElement(f,null)))),invalid:!!s.gcomDashboard,error:s.gcomDashboard&&s.gcomDashboard.message},e.createElement(E.I,{id:"url-input",placeholder:(0,u.t)("dashboard-import.gcom-field.placeholder","Grafana.com dashboard URL or ID"),type:"text",...d("gcomDashboard",{required:(0,u.t)("dashboard-import.gcom-field.validation-required","A Grafana dashboard URL or ID is required"),validate:Q}),addonAfter:e.createElement(D.zx,{type:"submit"},e.createElement(u.cC,{i18nKey:"dashboard-import.gcom-field.load-button"},"Load"))})))),e.createElement("div",{className:a.option},e.createElement(b.l,{onSubmit:this.getDashboardFromJson,defaultValues:{dashboardJson:""}},({register:d,errors:s})=>e.createElement(e.Fragment,null,e.createElement(p.g,{label:(0,u.t)("dashboard-import.json-field.label","Import via dashboard JSON model"),invalid:!!s.dashboardJson,error:s.dashboardJson&&s.dashboardJson.message},e.createElement(j.K,{...d("dashboardJson",{required:(0,u.t)("dashboard-import.json-field.validation-required","Need a dashboard JSON model"),validate:V}),"data-testid":v.wl.components.DashboardImportPage.textarea,id:"dashboard-json-textarea",rows:10,placeholder:be})),e.createElement(z.Lh,null,e.createElement(D.zx,{type:"submit","data-testid":v.wl.components.DashboardImportPage.submit},e.createElement(u.cC,{i18nKey:"dashboard-import.form-actions.load"},"Load")),e.createElement(D.Qj,{variant:"secondary",href:`${T.config.appSubUrl}/dashboards`},e.createElement(u.cC,{i18nKey:"dashboard-import.form-actions.cancel"},"Cancel")))))))}render(){const{loadingState:a}=this.props;return e.createElement(I.T,{navId:"dashboards/browse",pageNav:this.pageNav},e.createElement(I.T.Contents,null,a===g.Gu.Loading&&e.createElement(z.wc,{justify:"center"},e.createElement(z.Lh,{justify:"center"},e.createElement(H.$,{size:"xxl"}))),[g.Gu.Error,g.Gu.NotStarted].includes(a)&&this.renderImportForm(),a===g.Gu.Done&&e.createElement(se,null)))}}const Se=(0,l.HE)(Ie),le=Pe(Se);le.displayName="DashboardImport";const xe=le,Ce=(0,x.B)(o=>({option:(0,c.css)`
      margin-bottom: ${o.spacing(4)};
      max-width: 600px;
    `,labelWithLink:(0,c.css)`
      max-width: 100%;
    `,linkWithinLabel:(0,c.css)`
      font-size: inherit;
    `}))}}]);

//# sourceMappingURL=DashboardImport.c4a2d3624b47e65160b7.js.map