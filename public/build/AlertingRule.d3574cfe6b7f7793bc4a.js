"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4679],{66770:(H,W,e)=>{e.r(W),e.d(W,{default:()=>B,defaultPageNav:()=>z});var n=e(31733),V=e(85498),x=e(25111),A=e(8310),Q=e(42943),I=e(97923),h=e(17415),K=e(97503);const M=(0,Q.Q)(()=>Promise.all([e.e(6826),e.e(4937),e.e(937),e.e(763),e.e(2385),e.e(2659)]).then(e.bind(e,2659))),c=n.lazy(()=>Promise.all([e.e(6826),e.e(4937),e.e(937),e.e(763),e.e(2385),e.e(791)]).then(e.bind(e,791))),L=!!V.config.featureToggles.alertingDetailsViewV2,y=f=>L?n.createElement(Z,{...f}):n.createElement(Y,{...f}),z={id:"alert-rule-view",text:""},Y=f=>n.createElement(M,{...f}),Z=f=>{const N=(0,K.s4)(f.match.params),S=(0,n.useMemo)(()=>{if(!N)throw new Error("Rule ID is required");return(0,K.Qc)(N,!0)},[N]),{loading:T,error:t,result:a}=(0,h.HO)({ruleIdentifier:S});return t?typeof t=="string"?t:n.createElement(x.b,{title:"Uh-oh"},"Something went wrong loading the rule"):T?n.createElement(I.J,{pageNav:z,navId:"alert-list",isLoading:!0},n.createElement(n.Fragment,null)):a?n.createElement(c,{rule:a,identifier:S}):null},B=(0,A.Pf)(y,{style:"page"})},97923:(H,W,e)=>{e.d(W,{J:()=>m,O:()=>v});var n=e(31733),V=e(56423),x=e(50186),A=e(85498),Q=e(94746),I=e(76932),h=e(50370),K=e(76067),M=e(79106),c=e(58037),L=e(51343),y=e(25111);const z=({localStoreKey:r,startClosed:i=!1,severity:s="error",collapseText:R,collapseTooltip:F,collapseJustify:U="flex-end",alertTitle:l,children:P})=>{const E=(0,K.l4)(),D=Y(E,s),[O,G]=(0,h.Z)(r,i);return n.createElement(n.Fragment,null,O&&n.createElement(M.Lh,{justify:U},n.createElement(c.u,{content:F,placement:"bottom"},n.createElement(L.zx,{fill:"text",variant:"secondary",icon:(0,y.j)(s),className:D.warningButton,onClick:()=>G(!1)},R))),!O&&n.createElement(y.b,{severity:s,title:l,onRemove:()=>G(!0)},P))},Y=(r,i)=>{const s=r.colors[i];return{warningButton:(0,I.css)({color:s.text,"&:hover":{background:s.transparent}})}},Z="grafana.unifiedalerting.upgrade.previewNotice",B=()=>A.config.unifiedAlertingEnabled||!A.config.featureToggles.alertingPreviewUpgrade?null:n.createElement(z,{localStoreKey:Z,alertTitle:"This is a preview of the upgraded Grafana Alerting",collapseText:"Grafana Alerting Preview",collapseTooltip:"Show preview warning",severity:"warning"},n.createElement("p",null,"No rules are being evaluated and legacy alerting is still running.",n.createElement("br",null),"Please contact your administrator to upgrade permanently."),n.createElement(Q.h,{external:!0,href:"https://grafana.com/docs/grafana/latest/alerting/set-up/migrating-alerts/"},"Read about upgrading"));var f=e(1203),N=e(41164),S=e(38834),T=e(67451);function t(r){return r.name===T.GC?"Grafana":r.name.slice(0,37)}const a=({disabled:r=!1})=>{const i=(0,K.wW)(u),{selectedAlertmanager:s,availableAlertManagers:R,setSelectedAlertmanager:F}=(0,f.ZA)(),U=(0,n.useMemo)(()=>R.map(l=>({label:t(l),value:l.name,imgUrl:l.imgUrl,meta:l.meta})),[R]);return n.createElement(N._,{className:i.field,label:r?"Alertmanager":"Choose Alertmanager",disabled:r||U.length===1,"data-testid":"alertmanager-picker"},n.createElement(S.Ph,{"aria-label":r?"Alertmanager":"Choose Alertmanager",width:29,className:"ds-picker select-container",backspaceRemovesValue:!1,onChange:l=>{l?.value&&F(l.value)},options:U,maxMenuHeight:500,noOptionsMessage:"No datasources found",value:s,getOptionLabel:l=>l.label}))},u=r=>({field:(0,I.css)`
    margin: 0;
  `}),o=()=>n.createElement(y.b,{title:"No Alertmanager found",severity:"warning"},"We could not find any external Alertmanagers and you may not have access to the built-in Grafana Alertmanager."),p=()=>n.createElement(y.b,{title:"Selected Alertmanager not found.",severity:"warning"},"The selected Alertmanager no longer exists or you may not have permission to access it. You can select a different Alertmanager from the dropdown."),g=({availableAlertManagers:r})=>{const i=r.length>0;return n.createElement("div",null,i?n.createElement(p,null):n.createElement(o,null))},m=({children:r,isLoading:i,...s})=>n.createElement(x.T,{...s},n.createElement(x.T.Contents,{isLoading:i},n.createElement("div",null,n.createElement(B,null),r))),v=({children:r,accessType:i,...s})=>{const R=d();return n.createElement(f.h5,{accessType:i},n.createElement(m,{...s,actions:n.createElement(a,{disabled:R})},n.createElement(C,null,r)))};function d(){const r=(0,V.Z)();return["/edit","/new"].some(s=>r?.pathname?.includes(s))}const C=({children:r})=>{const{availableAlertManagers:i,selectedAlertmanager:s}=(0,f.ZA)();return s?n.createElement(n.Fragment,null,r):n.createElement(g,{availableAlertManagers:i})}},17415:(H,W,e)=>{e.d(W,{F3:()=>Y,HO:()=>f,eq:()=>T});var n=e(31733),V=e(59326),x=e(42342),A=e(15546),Q=e(22500),I=e(84415),h=e(67451),K=e(39138),M=e(97503),c=e(96198),L=e(41216),y=e(68144);function z(t,a){const u=Z(a),o=useCombinedRuleNamespaces(a),p=useMemo(()=>{if(!t||!a||o.length===0)return[];const g=[];for(const m of o)for(const v of m.groups)for(const d of v.rules)d.name===t&&g.push(d);return g},[t,a,o]);return{...u,result:p}}function Y(t,a,u){const o=(0,h.c$)(a),{dsFeatures:p,isLoadingDsFeatures:g}=T(a),{currentData:m=[],isLoading:v,error:d}=A.alertRuleApi.endpoints.prometheusRuleNamespaces.useQuery({ruleSourceName:a,ruleName:t,namespace:u?.namespace,groupName:u?.groupName}),[C]=A.alertRuleApi.endpoints.rulerRuleGroup.useLazyQuery(),{loading:r,error:i,value:s}=(0,V.Z)(async()=>{if(!o)throw new Error("Unable to obtain data source settings");if(d)throw new Error("Unable to obtain Prometheus rules");const R=[];if(p?.rulerConfig){const l=p.rulerConfig,P=m.map(E=>E.groups.map(D=>({namespace:E,group:D}))).flat();await Promise.allSettled(P.map(async E=>{const D=await C({rulerConfig:l,namespace:E.namespace.name,group:E.group.name}).unwrap();R.push(D)}))}return m.map(l=>(0,L.K$)(o,l,R)).flatMap(l=>l.groups.flatMap(P=>P.rules))},[o,p,v,d,m,C]);return{loading:g||r,error:i,rules:s}}function Z(t,a){const u=useDispatch(),o=useUnifiedAlertingSelector(d=>d.promRules),p=B(t,o),g=useUnifiedAlertingSelector(d=>d.rulerRules),m=B(t,g),{loading:v}=useAsync(async()=>{t&&await u(fetchPromAndRulerRulesAction({rulesSourceName:t,identifier:a}))},[u,t]);return{loading:v,error:p.error??isRulerNotSupportedResponse(m)?void 0:m.error,dispatched:p.dispatched&&m.dispatched}}function B(t,a){if(!t)return initialAsyncRequestState;const u=a[t];return u||initialAsyncRequestState}function f({ruleIdentifier:t}){const{ruleSourceName:a}=t,u=(0,h.c$)(a),{dsFeatures:o,isLoadingDsFeatures:p}=T(a),{currentData:g,isLoading:m,error:v}=A.alertRuleApi.endpoints.prometheusRuleNamespaces.useQuery({ruleSourceName:t.ruleSourceName,namespace:(0,c.qE)(t)||(0,c.E4)(t)?t.namespace:void 0,groupName:(0,c.qE)(t)||(0,c.E4)(t)?t.groupName:void 0,ruleName:(0,c.qE)(t)||(0,c.E4)(t)?t.ruleName:void 0}),[d,{currentData:C,isLoading:r,error:i}]=A.alertRuleApi.endpoints.rulerRuleGroup.useLazyQuery(),[s,{currentData:R,isLoading:F,error:U}]=A.alertRuleApi.endpoints.rulerRules.useLazyQuery();(0,n.useEffect)(()=>{o?.rulerConfig&&(o.rulerConfig&&(0,c.E4)(t)?d({rulerConfig:o.rulerConfig,namespace:t.namespace,group:t.groupName}):(0,c.Kl)(t)&&s({rulerConfig:o.rulerConfig}))},[o,d,s,t]);const l=(0,n.useMemo)(()=>{if(g){if((0,c.Kl)(t)){const P=(0,L.bU)("grafana",g,R);for(const E of P)for(const D of E.groups)for(const O of D.rules){const G=M.Yd(a,O);if(M.Dg(G,t))return O}}if(u&&g.length>0&&((0,c.E4)(t)||(0,c.qE)(t))){const P=g.map(E=>(0,L.K$)(u,E,C?[C]:[]));for(const E of P)for(const D of E.groups)for(const O of D.rules){const G=M.Yd(a,O);if(M.Dg(G,t))return O}}}},[t,a,g,C,R,u]);return{loading:p||m||r||F,error:v??i??U,result:l}}const S={rulerConfig:{dataSourceName:h.GC,apiVersion:"legacy"}};function T(t){const a=(0,h.HY)(t),{currentData:u,isLoading:o}=Q.T.endpoints.discoverDsFeatures.useQuery({rulesSourceName:t},{skip:a});return a?{isLoadingDsFeatures:!1,dsFeatures:S}:{isLoadingDsFeatures:o,dsFeatures:u}}}}]);

//# sourceMappingURL=AlertingRule.d3574cfe6b7f7793bc4a.js.map