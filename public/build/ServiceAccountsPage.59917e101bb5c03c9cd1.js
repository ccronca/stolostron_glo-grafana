"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1337],{10500:(oe,M,n)=>{n.r(M),n.d(M,{ServiceAccountsListPageUnconnected:()=>$,default:()=>le,getStyles:()=>Y});var o=n(76932),l=n(86504),C=n.n(l),e=n(31733),h=n(55024),m=n(76067),r=n(51343),A=n(41164),z=n(76804),g=n(96856),y=n(37739),R=n(47808),L=n(90069),Z=n(88511),O=n(50186),N=n(83811),i=n(75923),c=n(42342),s=n(73725),a=n(49876),P=n(49311),u=n(41354),p=n(95885),B=n(17806),W=n(48334);const v=t=>`Edit service account's ${t} details`,I=(0,e.memo)(({serviceAccount:t,onRoleChange:f,roleOptions:te,onRemoveButtonClick:j,onDisable:G,onEnable:ne,onAddTokenClick:q})=>{const b=`org/serviceaccounts/${t.id}`,D=(0,m.wW)(F),w=i.Vt.hasPermissionInMetadata(c.AccessControlAction.ServiceAccountsWrite,t),_=i.Vt.hasPermission(c.AccessControlAction.ActionRolesList)&&i.Vt.hasPermission(c.AccessControlAction.ActionUserRolesList);return e.createElement("tr",{key:t.id,className:(0,o.cx)({[D.disabled]:t.isDisabled})},e.createElement("td",{className:"width-4 text-center link-td"},e.createElement("a",{href:b,"aria-label":v(t.name)},e.createElement("img",{className:"filter-table__avatar",src:t.avatarUrl,alt:`Avatar for user ${t.name}`}))),e.createElement("td",{className:"link-td max-width-10"},e.createElement("a",{className:"ellipsis",href:b,title:t.name,"aria-label":v(t.name)},t.name)),e.createElement("td",{className:"link-td max-width-10"},e.createElement("a",{className:D.accountId,href:b,title:t.login,"aria-label":v(t.name)},t.login)),i.Vt.licensedAccessControlEnabled()?e.createElement("td",null,_&&e.createElement(B.R,{userId:t.id,orgId:t.orgId,basicRole:t.role,roles:t.roles||[],onBasicRoleChange:Q=>f(Q,t),roleOptions:te,basicRoleDisabled:!w,disabled:t.isExternal||t.isDisabled,width:40})):e.createElement("td",null,e.createElement(W.A,{"aria-label":"Role",value:t.role,disabled:t.isExternal||!w||t.isDisabled,onChange:Q=>f(Q,t)})),e.createElement("td",{className:"link-td max-width-10"},e.createElement("a",{className:"ellipsis",href:b,title:"Tokens","aria-label":v(t.name)},e.createElement("div",{className:(0,o.cx)(D.tokensInfo,{[D.tokensInfoSecondary]:!t.tokens})},e.createElement("span",null,e.createElement(P.J,{name:"key-skeleton-alt"})),t.tokens||"No tokens"))),e.createElement("td",null,!t.isExternal&&e.createElement(y.K,{alignItems:"center",justifyContent:"flex-end"},i.Vt.hasPermission(c.AccessControlAction.ServiceAccountsWrite)&&!t.tokens&&e.createElement(r.zx,{onClick:()=>q(t),disabled:t.isDisabled,className:D.actionButton},"Add token"),i.Vt.hasPermissionInMetadata(c.AccessControlAction.ServiceAccountsWrite,t)&&(t.isDisabled?e.createElement(r.zx,{variant:"primary",onClick:()=>ne(t),className:D.actionButton},"Enable"):e.createElement(r.zx,{variant:"secondary",onClick:()=>G(t),className:D.actionButton},"Disable")),i.Vt.hasPermissionInMetadata(c.AccessControlAction.ServiceAccountsDelete,t)&&e.createElement(u.h,{className:D.deleteButton,name:"trash-alt",size:"md",onClick:()=>j(t),tooltip:`Delete service account ${t.name}`})),t.isExternal&&e.createElement(y.K,{alignItems:"center",justifyContent:"flex-end"},e.createElement(u.h,{disabled:!0,name:"lock",size:"md",tooltip:"This is a managed service account and cannot be modified."}))))});I.displayName="ServiceAccountListItem";const U=({rootProps:t})=>{const f=(0,m.wW)(T);return e.createElement("tr",{...t},e.createElement("td",{className:"width-4 text-center"},e.createElement(a.Z,{containerClassName:f.blockSkeleton,circle:!0,width:25,height:25})),e.createElement("td",{className:"max-width-10"},e.createElement(a.Z,{width:100})),e.createElement("td",{className:"max-width-10"},e.createElement(a.Z,{width:100})),e.createElement("td",null,e.createElement(a.Z,{containerClassName:f.blockSkeleton,width:"100%",height:32})),e.createElement("td",{className:"max-width-10"},e.createElement(a.Z,{width:40})),e.createElement("td",null,e.createElement(y.K,{alignItems:"center",justifyContent:"flex-end"},e.createElement(a.Z,{containerClassName:f.blockSkeleton,width:102,height:32}),e.createElement(a.Z,{containerClassName:f.blockSkeleton,width:85,height:32}),e.createElement(a.Z,{containerClassName:(0,o.cx)(f.blockSkeleton,f.deleteButton),width:16,height:16}))))},x=(0,p.y)(I,U),T=t=>({blockSkeleton:(0,o.css)({display:"block",lineHeight:1}),deleteButton:(0,o.css)({marginRight:t.spacing(.5)})}),F=t=>({iconRow:(0,o.css)({svg:{marginLeft:t.spacing(.5)}}),accountId:(0,o.cx)("ellipsis",(0,o.css)({color:t.colors.text.secondary})),deleteButton:(0,o.css)({color:t.colors.text.secondary}),tokensInfo:(0,o.css)({span:{marginRight:t.spacing(1)}}),tokensInfoSecondary:(0,o.css)({color:t.colors.text.secondary}),disabled:(0,o.css)({"td a":{color:t.colors.text.secondary}}),actionButton:(0,o.css)({minWidth:85})}),k=x;var S=n(80586);function H(t){return{...t.serviceAccounts}}const K={changePage:S.oO,changeQuery:S.R5,fetchACOptions:S.bX,fetchServiceAccounts:S.Xd,deleteServiceAccount:S.yN,updateServiceAccount:S.TL,changeStateFilter:S.XE,createServiceAccountToken:S.fT},ee=(0,h.connect)(H,K),J=[{label:"All",value:c.ServiceAccountStateFilter.All},{label:"With expired tokens",value:c.ServiceAccountStateFilter.WithExpiredTokens},{label:"Disabled",value:c.ServiceAccountStateFilter.Disabled}];(N.default.featureToggles.externalServiceAccounts||N.default.featureToggles.externalServiceAuth)&&J.push({label:"Managed",value:c.ServiceAccountStateFilter.External});const $=({page:t,changePage:f,totalPages:te,serviceAccounts:j,isLoading:G,roleOptions:ne,query:q,serviceAccountStateFilter:b,changeQuery:D,fetchACOptions:w,fetchServiceAccounts:_,deleteServiceAccount:Q,updateServiceAccount:ae,changeStateFilter:ge,createServiceAccountToken:ve})=>{const se=(0,m.wW)(Y),[fe,ce]=(0,e.useState)(!1),[he,ie]=(0,e.useState)(!1),[pe,re]=(0,e.useState)(!1),[Se,de]=(0,e.useState)(""),[E,V]=(0,e.useState)(null);(0,e.useEffect)(()=>{_({withLoadingIndicator:!0}),i.Vt.licensedAccessControlEnabled()&&w()},[w,_]);const me=j.length===0&&b===c.ServiceAccountStateFilter.All&&!q,De=async(d,Oe)=>{const Ne={...Oe,role:d};ae(Ne),i.Vt.licensedAccessControlEnabled()&&w()},Ce=d=>{D(d)},ye=d=>{ge(d)},xe=d=>{V(d),ie(!0)},Te=async()=>{E&&Q(E.id),ue()},Ae=d=>{V(d),re(!0)},Pe=()=>{E&&ae({...E,isDisabled:!0}),Ee()},Ie=d=>{ae({...d,isDisabled:!1})},ke=d=>{V(d),ce(!0)},be=async d=>{E&&ve(E.id,d,de)},Me=()=>{ce(!1),V(null),de("")},ue=()=>{ie(!1),V(null)},Ee=()=>{re(!1),V(null)},Re=e.createElement("a",{className:"external-link",href:"https://grafana.com/docs/grafana/latest/administration/service-accounts/",target:"_blank",rel:"noopener noreferrer"},"documentation."),Le=e.createElement("span",null,"Service accounts and their tokens can be used to authenticate against the Grafana API. Find out more in our"," ",Re);return e.createElement(O.T,{navId:"serviceaccounts",subTitle:Le,actions:e.createElement(e.Fragment,null,!me&&i.Vt.hasPermission(c.AccessControlAction.ServiceAccountsCreate)&&e.createElement(r.Qj,{href:"org/serviceaccounts/create",variant:"primary"},"Add service account"))},e.createElement(O.T.Contents,null,e.createElement("div",{className:"page-action-bar"},e.createElement(A._,{grow:!0},e.createElement(z.H,{placeholder:"Search service account by name",value:q,onChange:Ce,width:50})),e.createElement(g.S,{options:J,onChange:ye,value:b,className:se.filter})),!G&&me&&e.createElement(e.Fragment,null,e.createElement(Z.Z,{title:"You haven't created any service accounts yet.",buttonIcon:"key-skeleton-alt",buttonLink:"org/serviceaccounts/create",buttonTitle:"Add service account",buttonDisabled:!i.Vt.hasPermission(c.AccessControlAction.ServiceAccountsCreate),proTip:"Remember, you can provide specific permissions for API access to other applications.",proTipLink:"",proTipLinkTitle:"",proTipTarget:"_blank"})),(G||j.length!==0)&&e.createElement(e.Fragment,null,e.createElement("div",{className:(0,o.cx)(se.table,"admin-list-table")},e.createElement("table",{className:"filter-table filter-table--hover"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Account"),e.createElement("th",null,"ID"),e.createElement("th",null,"Roles"),e.createElement("th",null,"Tokens"),e.createElement("th",{style:{width:"120px"}}))),e.createElement("tbody",null,G?e.createElement(e.Fragment,null,e.createElement(k.Skeleton,null),e.createElement(k.Skeleton,null),e.createElement(k.Skeleton,null)):j.map(d=>e.createElement(k,{serviceAccount:d,key:d.id,roleOptions:ne,onRoleChange:De,onRemoveButtonClick:xe,onDisable:Ae,onEnable:Ie,onAddTokenClick:ke})))),e.createElement(y.K,{justifyContent:"flex-end"},e.createElement(R.t,{hideWhenSinglePage:!0,currentPage:t,numberOfPages:te,onNavigate:f})))),E&&e.createElement(e.Fragment,null,e.createElement(L.s,{isOpen:he,body:`Are you sure you want to delete '${E.name}'${E.tokens?` and ${E.tokens} accompanying ${C()("token",E.tokens)}`:""}?`,confirmText:"Delete",title:"Delete service account",onConfirm:Te,onDismiss:ue}),e.createElement(L.s,{isOpen:pe,title:"Disable service account",body:`Are you sure you want to disable '${E.name}'?`,confirmText:"Disable service account",onConfirm:Pe,onDismiss:Ee}),e.createElement(s.m,{isOpen:fe,token:Se,serviceAccountLogin:E.login,onCreateToken:be,onClose:Me}))))},Y=t=>({table:(0,o.css)({marginTop:t.spacing(3)}),filter:(0,o.css)({margin:`0 ${t.spacing(1)}`}),row:(0,o.css)({display:"flex",alignItems:"center",height:"100% !important",a:{padding:`${t.spacing(.5)} 0 !important`}}),unitTooltip:(0,o.css)({display:"flex",flexDirection:"column"}),unitItem:(0,o.css)({cursor:"pointer",padding:t.spacing(.5,0),marginRight:t.spacing(1)}),disabled:(0,o.css)({color:t.colors.text.disabled}),link:(0,o.css)({color:"inherit",cursor:"pointer",textDecoration:"underline"}),pageHeader:(0,o.css)({display:"flex",marginBottom:t.spacing(2)}),apiKeyInfoLabel:(0,o.css)({marginLeft:t.spacing(1),lineHeight:2.2,flexGrow:1,color:t.colors.text.secondary,span:{padding:t.spacing(.5)}}),filterDelimiter:(0,o.css)({flexGrow:1})}),le=ee($)},73725:(oe,M,n)=>{n.d(M,{m:()=>Z});var o=n(76932),l=n(31733),C=n(79117),e=n(85498),h=n(76067),m=n(5572),r=n(85765),A=n(64516),z=n(96856),g=n(46606),y=n(51343),R=n(5334);const L=[{label:"No expiration",value:!1},{label:"Set expiration date",value:!0}],Z=({isOpen:i,token:c,serviceAccountLogin:s,onCreateToken:a,onClose:P})=>{const u=new Date;u.setDate(u.getDate()+1);const p=new Date;e.config.tokenExpirationDayLimit!==void 0&&e.config.tokenExpirationDayLimit>-1?p.setDate(p.getDate()+e.config.tokenExpirationDayLimit+1):p.setDate(864e13);const B=e.config.tokenExpirationDayLimit!==void 0&&e.config.tokenExpirationDayLimit>0,[W,v]=(0,l.useState)(""),[I,U]=(0,l.useState)(""),[x,T]=(0,l.useState)(B),[F,k]=(0,l.useState)(u),[S,H]=(0,l.useState)(F!==""),K=(0,h.wW)(N);(0,l.useEffect)(()=>{i&&v(`${s}-${(0,C.Z)()}`)},[s,i]);const ee=X=>{H(X!==""),k(X)},J=()=>{a({name:I||W,secondsToLive:x?O(F):void 0})},$=()=>{U(""),v(""),T(B),k(u),H(F!==""),P()},Y=c?"Service account token created":"Add service account token";return l.createElement(m.u,{isOpen:i,title:Y,onDismiss:$,className:K.modal,contentClassName:K.modalContent},c?l.createElement(l.Fragment,null,l.createElement(r.g,{label:"Token",description:"Copy the token now as you will not be able to see it again. Losing a token requires creating a new one."},l.createElement("div",{className:K.modalTokenRow},l.createElement(A.I,{name:"tokenValue",value:c,readOnly:!0}),l.createElement(R.m,{className:K.modalCopyToClipboardButton,variant:"primary",size:"md",icon:"copy",getText:()=>c},"Copy clipboard"))),l.createElement(m.u.ButtonRow,null,l.createElement(R.m,{variant:"primary",getText:()=>c,onClipboardCopy:$},"Copy to clipboard and close"),l.createElement(y.zx,{variant:"secondary",onClick:$},"Close"))):l.createElement("div",null,l.createElement(r.g,{label:"Display name",description:"Name to easily identify the token",required:!0},l.createElement(A.I,{name:"tokenName",value:I,placeholder:W,onChange:X=>{U(X.currentTarget.value)}})),l.createElement(r.g,{label:"Expiration"},l.createElement(z.S,{options:L,value:x,onChange:T,size:"md"})),x&&l.createElement(r.g,{label:"Expiration date"},l.createElement(g.d,{onChange:ee,value:F,placeholder:"",minDate:u,maxDate:p})),l.createElement(m.u.ButtonRow,null,l.createElement(y.zx,{onClick:J,disabled:x&&!S},"Generate token"))))},O=i=>{const c=new Date(i),s=new Date;return Math.ceil((c.getTime()-s.getTime())/1e3)},N=i=>({modal:(0,o.css)`
      width: 550px;
    `,modalContent:(0,o.css)`
      overflow: visible;
    `,modalTokenRow:(0,o.css)`
      display: flex;
    `,modalCopyToClipboardButton:(0,o.css)`
      margin-left: ${i.spacing(.5)};
    `})},80586:(oe,M,n)=>{n.d(M,{R5:()=>N,TL:()=>R,XE:()=>i,Xd:()=>g,bX:()=>z,fT:()=>Z,oO:()=>c,yN:()=>L});var o=n(69781),l=n.n(o),C=n(69391),e=n(59256),h=n(56811),m=n(42342),r=n(45413);const A="/api/serviceaccounts";function z(){return async s=>{try{if(h.contextSrv.licensedAccessControlEnabled()&&h.contextSrv.hasPermission(m.AccessControlAction.ActionRolesList)){const a=await(0,e.ul)();s((0,r.Dn)(a))}}catch(a){console.error(a)}}}function g({withLoadingIndicator:s}={withLoadingIndicator:!1}){return async(a,P)=>{try{if(h.contextSrv.hasPermission(m.AccessControlAction.ServiceAccountsRead)){s&&a((0,r.pN)());const{perPage:u,page:p,query:B,serviceAccountStateFilter:W}=P().serviceAccounts,v=await(0,C.i)().get(`/api/serviceaccounts/search?perpage=${u}&page=${p}&query=${B}${O(W)}&accesscontrol=true`);if(h.contextSrv.licensedAccessControlEnabled()&&h.contextSrv.hasPermission(m.AccessControlAction.ActionUserRolesList)){a((0,r.Fy)());const I=h.contextSrv.user.orgId,U=v?.serviceAccounts.map(T=>T.id),x=await(0,C.i)().post("/api/access-control/users/roles/search",{userIds:U,orgId:I});v.serviceAccounts.forEach(T=>{T.roles=x?x[T.id]||[]:[]}),a((0,r.BR)())}a((0,r.Ub)(v))}}catch(u){console.error(u)}finally{a((0,r.dt)())}}}const y=(0,o.debounce)(s=>s(g()),500,{leading:!0});function R(s){return async a=>{await(0,C.i)().patch(`${A}/${s.id}?accesscontrol=true`,{...s}),a(g())}}function L(s){return async a=>{await(0,C.i)().delete(`${A}/${s}`),a(g())}}function Z(s,a,P){return async u=>{const p=await(0,C.i)().post(`${A}/${s}/tokens`,a);P(p.key),u(g())}}const O=s=>{switch(s){case m.ServiceAccountStateFilter.WithExpiredTokens:return"&expiredTokens=true";case m.ServiceAccountStateFilter.Disabled:return"&disabled=true";case m.ServiceAccountStateFilter.External:return"&external=true";default:return""}};function N(s){return async a=>{a((0,r.aj)(s)),y(a)}}function i(s){return async a=>{a((0,r.M4)(s)),a(g())}}function c(s){return async a=>{a((0,r.PJ)(s)),a(g())}}}}]);

//# sourceMappingURL=ServiceAccountsPage.59917e101bb5c03c9cd1.js.map