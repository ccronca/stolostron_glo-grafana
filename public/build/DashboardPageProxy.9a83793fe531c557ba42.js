"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8443],{54151:(be,V,o)=>{o.d(V,{E:()=>L,z:()=>e});const e=()=>({type:"query",query:{params:["A","5m","now"]},reducer:{type:"avg",params:[]},evaluator:{type:"gt",params:[null]},operator:{type:"and"}}),L=async(b,M,F,j)=>{if(M.length===0)return"Could not find any metric queries";if(b&&b.length)return"Transformations are not supported in alert queries";let E=0,B=0;for(const K of M){const q=K.datasource||j,u=await F.get(q);u.meta.alerting?u.targetContainsTemplate&&u.targetContainsTemplate(K)&&B++:E++}return E===M.length?"The datasource does not support alerting queries":B===M.length?"Template variables are not supported in alert queries":""}},79695:(be,V,o)=>{o.d(V,{C0:()=>j,Uv:()=>M,Xq:()=>F});var e=o(31733),L=o(25111),b=o(50248),M=(E=>(E.ContactPoint="contact point",E.Template="template",E.MuteTiming="mute timing",E.AlertRule="alert rule",E.RootNotificationPolicy="root notification policy",E))(M||{});const F=({resource:E})=>e.createElement(L.b,{title:`This ${E} cannot be edited through the UI`,severity:"info"},"This ",E," has been provisioned, that means it was created by config. Please contact your server admin to update this ",E,"."),j=()=>e.createElement(b.C,{text:"Provisioned",color:"purple"})},23890:(be,V,o)=>{o.r(V),o.d(V,{default:()=>Po});var e=o(31733),L=o(59326),b=o(85498),M=o(57247),F=o(50186),j=o(42474),E=o(42342),B=o(18128);function K({match:t,route:n}){const a=(0,B.wc)(),{dashboard:s,isLoading:r,loadError:i}=a.useState();return(0,e.useEffect)(()=>(n.routeName===E.DashboardRoutes.Home?a.loadDashboard(n.routeName):a.loadDashboard(t.params.uid),()=>{a.clearState()}),[a,t.params.uid,n.routeName]),s?e.createElement(s.Component,{model:s}):e.createElement(F.T,{layout:M.Q.Canvas,"data-testid":"dashboard-scene-page"},r&&e.createElement(j.Z,null),i&&e.createElement("h2",null,i))}const q=K;var u=o(76932),x=o(55024),Q=o(84912),y=o(21568),D=o(19690),T=o(76067),lt=o(7939),bn=o(65923),Cn=o(79999),ct=o(42876);function Tn(t){switch(t.kiosk){case"tv":return E.KioskMode.TV;case"1":case!0:return E.KioskMode.Full;default:return null}}var dt=o(90845),ut=o(48510),re=o(64704),_=o(25111),pt=o(85853);const Sn="grafana.angularDeprecation.dashboardNotice.isDismissed";function Pn(t){return Sn+"."+t}function xn({dashboardUid:t}){return e.createElement(pt.G,{storageKey:Pn(t),defaultValue:!1},(n,a)=>n?null:e.createElement("div",null,e.createElement(_.b,{severity:"warning",title:"This dashboard depends on Angular, which is deprecated and will stop working in future releases of Grafana.",onRemove:()=>{(0,re.ff)("angular_deprecation_notice_dismissed"),a(!0)}},e.createElement("div",{className:"markdown-html"},e.createElement("ul",null,e.createElement("li",null,e.createElement("a",{href:"https://grafana.com/docs/grafana/latest/developers/angular_deprecation/",className:"external-link",target:"_blank",rel:"noreferrer"},"Read our deprecation notice and migration advice.")))))))}var xo=o(83935);function wo(t){const n=t.match.params.slug??"",a=useAsync(()=>getGrafanaStorage().list("content/"+n),[n]),s=n.length>0?`g/${n}/`:"g/",r=mt(n),i=()=>a.value?a.value.fields[0].values.map(d=>{let p=d;const m=p.indexOf(".")<0,g=!m&&p.endsWith(".json"),h=`${s}${p}`;return React.createElement(Card,{key:p,href:m||g?h:void 0},React.createElement(Card.Heading,null,p),React.createElement(Card.Figure,null,React.createElement(Icon,{name:m?"folder":g?"gf-grid":"file-alt",size:"sm"})))}):a.loading?React.createElement(Spinner,null):React.createElement("div",null,"?"),c=gt();return React.createElement(Page,{navModel:c,pageNav:r},i())}function mt(t){const n=t.split("/");let a=[],s="g",r;for(let i=0;i<n.length;i++)s+=`/${n[i]}`,a.push({text:n[i],url:s,parentItem:r}),r=a[a.length-1];return r}function gt(){return{main:{text:"C:"},node:{text:"Content",url:"/g"}}}const Do=null;var J=o(74642),ht=o(43773),wn=o(77378),Y=o(5572),se=o(64516),X=o(49311),oe=o(37758),ft=o(63711),Dn=o(67507),vt=o(95471);const In=()=>{const t=(0,T.wW)(Nn),[n,a]=(0,e.useState)(""),s=(0,E.useSelector)(l=>l.dashboard.getModel()),r=(0,e.useMemo)(()=>(0,vt.Ry)(),[]),i=(0,e.useMemo)(()=>(0,vt.rw)(r,n),[r,n]),c=()=>{D.E1.partial({addWidget:null})};return e.createElement(Y.u,{title:"Select widget type",closeOnEscape:!0,closeOnBackdropClick:!0,isOpen:!0,className:t.modal,onClickBackdrop:c,onDismiss:c},e.createElement(se.I,{type:"search",autoFocus:!0,className:t.searchInput,value:n,prefix:e.createElement(X.J,{name:"search"}),placeholder:"Search widget",onChange:l=>{a(l.currentTarget.value)}}),e.createElement(oe.$,null,e.createElement("div",{className:t.grid},i.map((l,d)=>e.createElement(Dn.u,{disabled:!1,key:l.id,isCurrent:!1,plugin:l,onClick:p=>{const m=(0,ft.AI)(s,l.id);D.E1.partial({editPanel:m,addWidget:null})}})))))},Nn=t=>({modal:(0,u.css)`
    width: 65%;
    max-width: 960px;

    ${t.breakpoints.down("md")} {
      width: 100%;
    }
  `,searchInput:(0,u.css)`
    margin-bottom: ${t.spacing(2)};
  `,grid:(0,u.css)`
    display: grid;
    grid-gap: ${t.spacing(1)};
  `});var On=o(93258),Rn=o(99648),An=o(314),ee=o(69781),Fe=o(97890),Et=o(58947),Mn=o(83599),Ce=o(56811),$n=o(24789),w=o(51343),Ln=o(39501),Fn=o(64213),Wn=o(21236);const yt=({panel:t,folderUid:n,isUnsavedPrompt:a,onDismiss:s,onConfirm:r,onDiscard:i})=>{const[c,l]=(0,e.useState)(""),d=(0,L.Z)(async()=>{const C=await(0,Ln.E8)(t.libraryPanel.uid);return C.length>0?C.map(I=>I.title):[]},[t.libraryPanel.uid]),[p,m]=(0,e.useState)([]);(0,$n.Z)(()=>d.value?m(d.value.filter(C=>C.toLowerCase().includes(c.toLowerCase()))):m([]),300,[d.value,c]);const{saveLibraryPanel:g}=(0,Wn.E)(),h=(0,T.wW)(Fn.J),f=(0,e.useCallback)(()=>{i()},[i]),v=a?"Unsaved library panel changes":"Save library panel";return e.createElement(Y.u,{title:v,icon:"save",onDismiss:s,isOpen:!0},e.createElement("div",null,e.createElement("p",{className:h.textInfo},"This update will affect ",e.createElement("strong",null,t.libraryPanel.meta?.connectedDashboards," ",t.libraryPanel.meta?.connectedDashboards===1?"dashboard":"dashboards","."),"The following dashboards using the panel will be affected:"),e.createElement(se.I,{className:h.dashboardSearch,prefix:e.createElement(X.J,{name:"search"}),placeholder:"Search affected dashboards",value:c,onChange:C=>l(C.currentTarget.value)}),d.loading?e.createElement("p",null,"Loading connected dashboards..."):e.createElement("table",{className:h.myTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Dashboard name"))),e.createElement("tbody",null,p.map((C,I)=>e.createElement("tr",{key:`dashrow-${I}`},e.createElement("td",null,C))))),e.createElement(Y.u.ButtonRow,null,e.createElement(w.zx,{variant:"secondary",onClick:s,fill:"outline"},"Cancel"),a&&e.createElement(w.zx,{variant:"destructive",onClick:f},"Discard"),e.createElement(w.zx,{onClick:()=>{g(t,n).then(()=>{r()})}},"Update all"))))};var Un=o(40931),We=o(39357),Ue=o(90172),Te=o(2507),bt=o(27524),Z=o(90300);function zn(t,n){return async a=>{const s=n.initEditPanel(t);a((0,Z.Hl)({panel:s,sourcePanel:t}))}}function Ct(){return async(t,n)=>{const{getPanel:a}=n().panelEditor;a().configRev=0,t((0,Z.yi)(!0))}}function Bn(t,n){return a=>{if(t.libraryPanel?.uid===void 0||!n)return;const s=t.getSaveModel();for(const r of n.panels){if(Vn(t,r))continue;r.restoreModel({...s,...(0,ee.pick)(r,"gridPos","id")});const i=r.plugin?.meta.id!==t.plugin?.meta.id;r.plugin=t.plugin,r.configRev++,i&&(r.generateNewKey(),a((0,bt.bc)({key:r.key,plugin:r.plugin}))),setTimeout(()=>{r.getQueryRunner().useLastResultFrom(t.getQueryRunner())},20)}t.repeat&&setTimeout(()=>n.processRepeats(),20)}}function Vn(t,n){return!!(n.libraryPanel?.uid!==t.libraryPanel.uid||n.id&&n.id===t.id||n.repeatPanelId)}function kn(){return async(t,n)=>{const a=n().dashboard.getModel(),{getPanel:s,getSourcePanel:r,shouldDiscardChanges:i}=n().panelEditor,c=s();a&&a.exitPanelEditor();const l=r();if(Hn(c)&&!i){const d=c.getSaveModel(),p=l.type!==c.type;t(Bn(c,a)),l.restoreModel(d),l.configRev++,p&&(l.plugin=c.plugin,l.generateNewKey(),await t((0,bt.bc)({key:l.key,plugin:c.plugin}))),setTimeout(()=>{l.getQueryRunner().useLastResultFrom(c.getQueryRunner()),l.render(),c.hasSavedPanelEditChange&&!c.hasChanged&&(l.configRev=0)},20)}l.isNew&&(i?a&&(0,Ue.WJ)(a,l,!0):delete l.isNew),t((0,Te.qj)(c.key)),t((0,Z.my)())}}function Hn(t){return t.hasChanged||t.hasSavedPanelEditChange||t.isAngularPlugin()}function ze(t){return(n,a)=>{const s={...a().panelEditor.ui,...t};n((0,Z.K9)(s));try{We.Z.setObject(Z.jy,s)}catch(r){console.error(r)}}}var Gn=o(9526);const jn=({dashboard:t,onSaveSuccess:n,onDiscard:a,onDismiss:s})=>e.createElement(Y.u,{isOpen:!0,title:"Unsaved changes",onDismiss:s,icon:"exclamation-triangle",className:(0,u.css)`
        width: 500px;
      `},e.createElement("h5",null,"Do you want to save your changes?"),e.createElement(Y.u.ButtonRow,null,e.createElement(w.zx,{variant:"secondary",onClick:s,fill:"outline"},"Cancel"),e.createElement(w.zx,{variant:"destructive",onClick:a},"Discard"),e.createElement(Gn.i,{dashboard:t,onSaveSuccess:n}))),Tt=e.memo(({dashboard:t})=>{const[n,a]=(0,e.useState)({original:null}),s=(0,E.useDispatch)(),{original:r,originalPath:i}=n,{showModal:c,hideModal:l}=(0,e.useContext)(Et.kr);(0,e.useEffect)(()=>{const p=setTimeout(()=>{const g=D.E1.getLocation().pathname,h=t.getSaveModelCloneOld();a({originalPath:g,original:h})},1e3),m=Mn.h.subscribe(J.Jd,()=>{const g=t.getSaveModelCloneOld();a({originalPath:i,original:g})});return()=>{clearTimeout(p),m.unsubscribe()}},[t,i]),(0,e.useEffect)(()=>{const p=m=>{St(t,r)||xt(t,r)&&(m.preventDefault(),m.returnValue="")};return window.addEventListener("beforeunload",p),()=>window.removeEventListener("beforeunload",p)},[t,r]);const d=p=>{const m=t.panelInEdit,g=new URLSearchParams(p.search);return m&&m.libraryPanel&&m.hasChanged&&!g.has("editPanel")?(c(yt,{isUnsavedPrompt:!0,panel:t.panelInEdit,folderUid:t.meta.folderUid??"",onConfirm:()=>{l(),Se(p)},onDiscard:()=>{s(Ct()),Se(p),l()},onDismiss:l}),!1):i===p.pathname||!r?(m&&!g.has("editPanel")&&s(kn()),!0):St(t,r)||!xt(t,r)?!0:(c(jn,{dashboard:t,onSaveSuccess:()=>{l(),Se(p)},onDiscard:()=>{a({...n,original:null}),l(),Se(p)},onDismiss:l}),!1)};return e.createElement(Fe.NL,{when:!0,message:d})});Tt.displayName="DashboardPrompt";function Se(t){t&&setTimeout(()=>D.E1.push(t),10)}function St(t,n){if(!n||n.version===0||!Ce.contextSrv.isSignedIn||!t)return!0;const{canSave:a,fromScript:s,fromFile:r}=t.meta;return!Ce.contextSrv.isEditor&&!a?!0:!a||s||r}function Pt(t){const n=new Un.f(t);n.expandRows();const a=n.getSaveModelClone();if(delete a.time,a.refresh="",a.schemaVersion=0,delete a.timezone,a.panels=[],a.templating?.list)for(const s of a.templating.list)delete s.current,delete s.options,delete s.filters;return a}function xt(t,n){if(t.hasUnsavedChanges())return!0;const a=Pt(t.getSaveModelCloneOld()),s=Pt(n),r=(0,ee.find)(a.nav,{type:"timepicker"}),i=(0,ee.find)(s.nav,{type:"timepicker"});r&&i&&(r.now=i.now);const c=JSON.stringify(a,null),l=JSON.stringify(s,null);return c!==l}var Kn=o(84326),W=o(31285),Pe=o(2222),xe=o(43741),wt=o(44343),we=o(59899),ue=o(37739),Jn=o(23006),Be=o(88062),pe=o(4981),Zn=o(89719),ie=o(85765),Ve=o(38834),ke=o(5334),Qn=o(73642),$=o(79106),te=o(76772),Yn=o(73386),Xn=o.n(Yn),qn=o(40137),De=o(86850),_n=o(66841),ea=o(12458),le=o(89660),ta=o(25353),Dt=o(16356),It=o(97522),me=(t=>(t[t.Support=0]="Support",t[t.Data=1]="Data",t))(me||{}),Ie=(t=>(t[t.PanelSnapshot=0]="PanelSnapshot",t[t.GithubComment=1]="GithubComment",t))(Ie||{});class na extends _n.b{constructor(n){super({panel:n,panelTitle:n.replaceVariables(n.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:"GitHub comment",description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:"Panel support snapshot",description:"Dashboard JSON used to help troubleshoot visualization issues",value:0}]}),this.onCurrentTabChange=a=>{this.setState({currentTab:a})},this.onShowMessageChange=a=>{this.setState({showMessage:a.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:a}=this.state,s=Math.pow(1024,2)*1.5;return a.length>s?(this.setState({error:{title:"Copy to clipboard failed",message:"Snapshot is too large, consider download and attaching a file instead"}}),""):a},this.onDownloadDashboard=()=>{const{snapshotText:a,panelTitle:s}=this.state,r=new Blob([a],{type:"text/plain"}),i=`debug-${s}-${(0,qn.dq)(new Date)}.json.txt`;Xn()(r,i)},this.onSetSnapshotText=a=>{this.setState({snapshotText:a})},this.onToggleRandomize=a=>{const{randomize:s}=this.state;this.setState({randomize:{...s,[a]:!s[a]}})},this.onPreviewDashboard=()=>{const{snapshot:a}=this.state;a&&((0,Dt.$M)({meta:{},dashboard:a}),o.g.open(b.config.appUrl+"dashboard/new","_blank"))}}async buildDebugDashboard(){const{panel:n,randomize:a,snapshotUpdate:s}=this.state,r=await(0,It.$R)(n,a,(0,le.$t)().timeRange()),i=JSON.stringify(r,null,2),c=(0,It.S$)(n,i),l=(0,De.zc)((0,De.Cf)("bytes")(i?.length??0));let d;if(!n.isAngularPlugin())try{const p=new ta.f(r);d=(0,ea.Yz)(p).state.body}catch(p){console.log("Error creating scene:",p)}this.setState({snapshot:r,snapshotText:i,markdownText:c,snapshotSize:l,snapshotUpdate:s+1,scene:d})}}function aa({panel:t,plugin:n,onClose:a}){const s=(0,T.wW)(ra),r=(0,e.useMemo)(()=>new na(t),[t]),{currentTab:i,loading:c,error:l,options:d,showMessage:p,snapshotSize:m,markdownText:g,snapshotText:h,randomize:f,panelTitle:v,scene:C}=r.useState();if((0,e.useEffect)(()=>{r.buildDebugDashboard()},[r,n,f]),!n)return null;const I=[{label:"Snapshot",value:me.Support},{label:"Data",value:me.Data}],N=b.config.supportBundlesEnabled&&Ce.contextSrv.hasPermission(E.AccessControlAction.ActionSupportBundlesCreate);return e.createElement(we.d,{title:"Get help with this panel",size:"lg",onClose:a,subtitle:e.createElement(ue.K,{direction:"column",gap:1},e.createElement(ue.K,{direction:"row",gap:1},e.createElement(Jn.a,{featureState:wt.CQ.beta}),e.createElement("a",{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",target:"blank",className:"external-link",rel:"noopener noreferrer"},"Troubleshooting docs ",e.createElement(X.J,{name:"external-link-alt"}))),e.createElement("span",{className:"muted"},"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings."),N&&e.createElement("span",{className:"muted"},"You can also retrieve a support bundle containing information concerning your Grafana instance and configured datasources in the ",e.createElement("a",{href:"/support-bundles"},"support bundles section"),".")),tabs:e.createElement(Be.J,null,I.map((P,G)=>e.createElement(pe.O,{key:`${P.value}-${G}`,label:P.label,active:P.value===i,onChangeTab:()=>r.onCurrentTabChange(P.value)})))},c&&e.createElement(Zn.$,null),l&&e.createElement(_.b,{title:l.title},l.message),i===me.Data&&e.createElement("div",{className:s.code},e.createElement("div",{className:s.opts},e.createElement(ie.g,{label:"Template",className:s.field},e.createElement(Ve.Ph,{options:d,value:p,onChange:r.onShowMessageChange})),p===Ie.GithubComment?e.createElement(ke.m,{icon:"copy",getText:r.onGetMarkdownForClipboard},"Copy to clipboard"):e.createElement(w.zx,{icon:"download-alt",onClick:r.onDownloadDashboard},"Download (",m,")")),e.createElement(xe.Z,{disableWidth:!0},({height:P})=>e.createElement(Qn.p,{width:"100%",height:P,language:p===Ie.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:p===Ie.GithubComment?g:h,readOnly:!1,onBlur:r.onSetSnapshotText}))),i===me.Support&&e.createElement(e.Fragment,null,e.createElement(ie.g,{label:"Randomize data",description:"Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal."},e.createElement($.Lh,null,e.createElement(te.x,{label:"Labels",id:"randomize-labels",showLabel:!0,value:!!f.labels,onChange:()=>r.onToggleRandomize("labels")}),e.createElement(te.x,{label:"Field names",id:"randomize-field-names",showLabel:!0,value:!!f.names,onChange:()=>r.onToggleRandomize("names")}),e.createElement(te.x,{label:"String values",id:"randomize-string-values",showLabel:!0,value:!!f.values,onChange:()=>r.onToggleRandomize("values")}))),e.createElement(ie.g,{label:"Support snapshot",description:`Panel: ${v}`},e.createElement(ue.K,null,e.createElement(w.zx,{icon:"download-alt",onClick:r.onDownloadDashboard},"Dashboard (",m,")"),e.createElement(ke.m,{icon:"github",getText:r.onGetMarkdownForClipboard,title:"Copy a complete GitHub comment to the clipboard"},"Copy to clipboard"),e.createElement(w.zx,{onClick:r.onPreviewDashboard,variant:"secondary",title:"Open support snapshot dashboard in a new tab"},"Preview"))),e.createElement(xe.Z,{disableWidth:!0},({height:P})=>e.createElement("div",{style:{height:P,overflow:"auto"}},C&&e.createElement(C.Component,{model:C})))))}const ra=t=>({code:(0,u.css)`
    flex-grow: 1;
    height: 100%;
    overflow: scroll;
  `,field:(0,u.css)`
    width: 100%;
  `,opts:(0,u.css)`
    display: flex;
    display: flex;
    width: 100%;
    flex-grow: 0;
    align-items: center;
    justify-content: flex-end;

    button {
      margin-left: 8px;
    }
  `});var He=o(20298);const Ge=(t,n,a)=>{const s=(0,e.useRef)(),[r,i]=(0,e.useState)();return(0,e.useEffect)(()=>{let c=-1,l=0;return s.current=t.getQueryRunner().getData({withTransforms:n.withTransforms,withFieldConfig:!1}).subscribe({next:d=>{if(a){if(c===d.structureRev){const p=Date.now();if(p-l<1e4)return;l=p}c=d.structureRev??-1}i(d)}}),()=>{s.current&&s.current.unsubscribe()}},[t,n.withTransforms]),{data:r,isLoading:r?.state===He.Gu.Loading,hasSeries:r?!!r.series:!1,hasError:!!(r&&(r.error||r?.errors?.length||r.state===He.Gu.Error))}};var je=o(61129),ge=o(53166),sa=o(28945),oa=o(23811),ia=o(80701);const la=({data:t,metadataDatasource:n})=>!n||!n.components?.MetadataInspector?e.createElement(ge.cC,{i18nKey:"dashboard.inspect-meta.no-inspector"},"No Metadata Inspector"):e.createElement(n.components.MetadataInspector,{datasource:n,data:t.series});var ca=o(58837),da=o(8889);const ua=({panel:t,plugin:n,dashboard:a,tabs:s,data:r,isDataLoading:i,dataOptions:c,metadataDatasource:l,defaultTab:d,onDataOptionsChange:p,onClose:m})=>{const[g,h]=(0,e.useState)(d??W.q.Data);if(!n)return null;let f=pa(r),v=g;s.find(N=>N.value===g)||(v=W.q.JSON);const C=(0,je.J)().replace(t.title,t.scopedVars,"text")||"Panel",I=(0,ge.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:C});return e.createElement(we.d,{title:I,subtitle:r&&ma(r),onClose:m,tabs:e.createElement(Be.J,null,s.map((N,P)=>e.createElement(pe.O,{key:`${N.value}-${P}`,label:N.label,active:N.value===v,onChangeTab:()=>h(N.value||W.q.Data)})))},v===W.q.Data&&e.createElement(sa.E,{dataName:t.getDisplayTitle(),panelPluginId:t.type,fieldConfig:t.fieldConfig,hasTransformations:!!t.transformations?.length,data:r&&r.series,isLoading:i,options:c,onOptionsChange:p,timeZone:a.timezone,app:wt.zj.Dashboard}),r&&v===W.q.Meta&&e.createElement(la,{data:r,metadataDatasource:l}),v===W.q.JSON&&e.createElement(ia.W,{panel:t,dashboard:a,data:r,onClose:m}),v===W.q.Error&&e.createElement(oa.l,{errors:f}),r&&v===W.q.Stats&&e.createElement(ca.f,{data:r,timeZone:a.getTimezone()}),r&&v===W.q.Query&&e.createElement(da.D,{data:r,onRefreshQuery:()=>t.refresh()}))};function pa(t){let n=t?.errors??[];return t?.error&&!n.includes(t.error)&&(n=[t.error,...n]),!n.length&&t?.state===He.Gu.Error?[{message:"Error loading data"}]:n}function ma(t){const{request:n}=t;if(!n||(0,ee.isEmpty)(n))return"";const a=n.targets.length,s=n.endTime?n.endTime-n.startTime:0,r=(0,De.zc)((0,De.Cf)("ms")(s));return e.createElement(ge.cC,{i18nKey:"dashboard.inspect.subtitle"},{queryCount:a}," queries with total query time of ",{formatted:r})}var Nt=o(87047);const ga=({panel:t,dashboard:n,plugin:a})=>{const s=(0,Fe.TH)(),r=new URLSearchParams(s.search).get("inspectTab"),[i,c]=(0,e.useState)({withTransforms:r===W.q.Error,withFieldConfig:!0}),{data:l,isLoading:d,hasError:p}=Ge(t,i,!1),m=(0,Nt.pV)(l),g=(0,Nt.WM)(t,n,a,p,m),h=()=>{D.E1.partial({inspect:null,inspectTab:null})};return a?r===W.q.Help?e.createElement(aa,{panel:t,plugin:a,onClose:h}):e.createElement(ua,{dashboard:n,panel:t,plugin:a,defaultTab:r,tabs:g,data:l,isDataLoading:d,dataOptions:i,onDataOptionsChange:c,metadataDatasource:m,onClose:h}):null},ha=(t,n)=>{const a=(0,Pe.i)(t,n.panel);return a?{plugin:a.plugin}:{plugin:null}},fa=(0,x.connect)(ha)(ga);var Ot=o(40510),Ne=o(96856),Ke=o(73351),va=o(71460),Rt=o(33227),Ea=o(92810),At=o(26635),ya=o(75923),Je=o(59970),he=o(58037),ba=o(73731),Ca=o(46769);const Ta=t=>{const n=(0,e.useMemo)(()=>ba.z.get(t.variable.type).picker,[t.variable]);return t.variable?e.createElement("div",{className:"gf-form"},e.createElement(Sa,{variable:t.variable}),t.variable.hide!==Je.bU.hideVariable&&n&&e.createElement(n,{variable:t.variable,readOnly:t.readOnly??!1})):e.createElement("div",null,"Couldn't load variable")};function Sa({variable:t}){const n=(0,e.useMemo)(()=>t.label||t.name,[t]);if(t.hide!==Je.bU.dontHide)return null;const a=Ca.IG+t.id;return t.description?e.createElement(he.u,{content:t.description,placement:"bottom"},e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":y.wl.pages.Dashboard.SubMenu.submenuItemLabels(n),htmlFor:a},n)):e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":y.wl.pages.Dashboard.SubMenu.submenuItemLabels(n),htmlFor:a},n)}const Mt=({variables:t,readOnly:n})=>{const[a,s]=(0,e.useState)([]);return(0,e.useEffect)(()=>{s(t.filter(r=>r.hide!==Je.bU.hideVariable))},[t]),a.length===0?null:e.createElement(e.Fragment,null,a.map(r=>e.createElement("div",{key:r.id,className:"submenu-item gf-form-inline","data-testid":y.wl.pages.Dashboard.SubMenu.submenuItem},e.createElement(Ta,{variable:r,readOnly:n}))))};var Pa=o(58838),xa=o(37061),fe=o(3002),Ze=o(99282),wa=o(93832),Da=o(50798),Ia=o(69760),$t=o(76804),Na=o(96841),Lt=o(80091);function Oa(t,n){We.Z.set(`panel-edit-section-${t}`,n?"true":"false")}function Ra(t,n){return We.Z.getBool(`panel-edit-section-${t}`,n)}const Ft=(t,n)=>({angularPanelComponent:(0,Pe.i)(t,n.panel)?.angularComponent}),Wt={changePanelPlugin:Te.Kc},Io=(0,x.connect)(Ft,Wt);class Aa extends e.PureComponent{constructor(n){super(n)}componentDidMount(){this.loadAngularOptions()}componentDidUpdate(n){(this.props.plugin!==n.plugin||this.props.angularPanelComponent!==n.angularPanelComponent)&&this.cleanUpAngularOptions(),this.loadAngularOptions()}componentWillUnmount(){this.cleanUpAngularOptions()}cleanUpAngularOptions(){this.angularOptions&&(this.angularOptions.destroy(),this.angularOptions=null)}loadAngularOptions(){const{panel:n,angularPanelComponent:a,changePanelPlugin:s}=this.props;if(!this.element||!a||this.angularOptions)return;const r=a.getScope();if(!r.$$childHead){setTimeout(()=>{this.forceUpdate()});return}const i=r.$$childHead.ctrl;i.initEditMode(),i.onPluginTypeChange=p=>{s({panel:n,pluginId:p.id})};let c="";for(let p=0;p<i.editorTabs.length;p++){const m=i.editorTabs[p];m.isOpen=Ra(m.title,p===0),c+=`
      <div class="panel-options-group" ng-cloak>
        <div class="panel-options-group__header" ng-click="toggleOptionGroup(${p})" aria-label="${m.title} section">
          <div class="panel-options-group__icon">
            <icon name="ctrl.editorTabs[${p}].isOpen ? 'angle-down' : 'angle-right'"></icon>
          </div>
          <div class="panel-options-group__title">${m.title}</div>
        </div>
        <div class="panel-options-group__body" ng-if="ctrl.editorTabs[${p}].isOpen">
          <panel-editor-tab editor-tab="ctrl.editorTabs[${p}]" ctrl="ctrl"></panel-editor-tab>
        </div>
      </div>
      `}const l=(0,Lt.w)(),d={ctrl:i,toggleOptionGroup:p=>{const m=i.editorTabs[p];m.isOpen=!m.isOpen,Oa(m.title,!!m.isOpen)}};this.angularOptions=l.load(this.element,d,c),this.angularOptions.digest()}render(){return e.createElement("div",{ref:n=>this.element=n})}}const Ma=(0,x.connect)(Ft,Wt)(Aa);var Qe=o(18072),Ut=o(85610),Oe=o(68235),zt=o(45418),Bt=o(84333),Ye=o(95639),$a=o(82732),La=o.n($a),Fa=o(36667),Wa=o(2431),ve=o(41354);const Ua=({property:t,context:n,registry:a,onChange:s,onRemove:r,isSystemOverride:i,searchQuery:c})=>{const l=(0,T.wW)(za),d=a?.getIfExists(t.id),p=(0,e.useId)();if(!d)return null;const m=Array.isArray(t.value)||t.id===Oe.qb.Thresholds||t.id===Oe.qb.Links||t.id===Oe.qb.Mappings,g=d.category?.filter(v=>v!==d.name);let h;const f=(v=!0,C=!1)=>(I=!1)=>e.createElement($.Lh,{justify:"space-between"},e.createElement(Fa._,{category:g,description:v?d.description:void 0,htmlFor:p},e.createElement(La(),{textToHighlight:d.name,searchWords:[c],highlightClassName:"search-fragment-highlight"}),!I&&C&&d.getItemsCount&&e.createElement(Wa.A,{value:d.getItemsCount(t.value)})),!i&&e.createElement("div",null,e.createElement(ve.h,{name:"times",onClick:r,tooltip:"Remove label"})));return m?h=e.createElement(Qe.u,{id:d.name,renderTitle:f(!1,!0),className:(0,u.css)`
          padding-left: 0;
          padding-right: 0;
        `,isNested:!0,isOpenDefault:t.value!==void 0},e.createElement(d.override,{value:t.value,onChange:v=>{s(v)},item:d,context:n})):h=e.createElement("div",null,e.createElement(ie.g,{label:f()(),description:d.description},e.createElement(d.override,{value:t.value,onChange:v=>{s(v)},item:d,context:n,id:p}))),e.createElement("div",{className:(0,u.cx)(m&&l.collapsibleOverrideEditor,!m&&"dynamicConfigValueEditor--nonCollapsible")},h)},za=t=>({collapsibleOverrideEditor:(0,u.css)`
      label: collapsibleOverrideEditor;
      & + .dynamicConfigValueEditor--nonCollapsible {
        margin-top: ${t.spacing(1)};
      }
    `});var ne=o(99940),U=o(68469);const Vt=({isExpanded:t,registry:n,matcherUi:a,overrideName:s,override:r,onOverrideRemove:i})=>{const c=(0,T.wW)(Ba),d=r.properties.map(m=>n.getIfExists(m.id)).filter(m=>!!m).map(m=>m?.name).join(", "),p=a.optionsToLabel(r.matcher.options);return e.createElement("div",null,e.createElement($.Lh,{justify:"space-between"},e.createElement("div",null,s),e.createElement(ve.h,{name:"trash-alt",onClick:i,tooltip:"Remove override"})),!t&&e.createElement("div",{className:c.overrideDetails},e.createElement("div",{className:c.options,title:p},p," ",e.createElement(X.J,{name:"angle-right"})," ",d)))};Vt.displayName="OverrideTitle";const Ba=t=>({matcherUi:(0,u.css)`
      padding: ${t.spacing(1)};
    `,propertyPickerWrapper:(0,u.css)`
      margin-top: ${t.spacing(2)};
    `,overrideDetails:(0,u.css)`
      font-size: ${t.typography.bodySmall.fontSize};
      color: ${t.colors.text.secondary};
      font-weight: ${t.typography.fontWeightRegular};
    `,options:(0,u.css)`
      overflow: hidden;
      padding-right: ${t.spacing(4)};
    `,unknownLabel:(0,u.css)`
      margin-bottom: 0;
    `});function Va(t,n){const a=[],s=t.panel.fieldConfig,r=t.plugin.fieldConfigRegistry,i=t.data?.series??[];if(r.isEmpty())return[];const c=(m,g)=>{let h=(0,ee.cloneDeep)(s.overrides);h[m]=g,t.onFieldConfigsChange({...s,overrides:h})},l=m=>{let g=(0,ee.cloneDeep)(s.overrides);g.splice(m,1),t.onFieldConfigsChange({...s,overrides:g})},d=m=>{const g=Ut.Ls.get(m.value);g&&t.onFieldConfigsChange({...s,overrides:[...s.overrides,{matcher:{id:g.id,options:g.defaultOptions},properties:[]}]})},p={data:i,getSuggestions:m=>(0,Ye.PW)(i,m),isOverride:!0};for(let m=0;m<s.overrides.length;m++){const g=s.overrides[m],h=`Override ${m+1}`,f=zt.i.get(g.matcher.id),v=ka(r),C=(0,Oe.v3)(g),I=g.properties.length===0?1:0,N=new ne.j({title:h,id:h,forceOpen:I,renderTitle:function(S){return e.createElement(Vt,{override:g,isExpanded:S,registry:r,overrideName:h,matcherUi:f,onOverrideRemove:()=>l(m)})}}),P=R=>{g.matcher.options=R,c(m,g)},G=(R,S)=>{const z=r.get(S.value),ce={id:z.id,value:z.defaultValue};g.properties?R.properties.push(ce):R.properties=[ce],c(m,R)};N.addItem(new U.a({title:f.name,render:function(){return e.createElement(f.component,{id:`${f.matcher.id}-${m}`,matcher:f.matcher,data:t.data?.series??[],options:g.matcher.options,onChange:P})}}));for(let R=0;R<g.properties.length;R++){const S=g.properties[R],z=r.getIfExists(S.id);if(!z)continue;const ce=de=>{g.properties[R].value=de,c(m,g)},it=()=>{g.properties.splice(R,1),c(m,g)};N.addItem(new U.a({title:z.name,skipField:!0,render:function(){return e.createElement(Ua,{key:`${S.id}/${R}`,isSystemOverride:C,onChange:ce,onRemove:it,property:S,registry:r,context:p,searchQuery:n})}}))}!C&&g.matcher.options&&N.addItem(new U.a({title:"----------",skipField:!0,render:function(){return e.createElement(Bt.b,{key:"Add override property",label:"Add override property",variant:"secondary",isFullWidth:!0,icon:"plus",menuPlacement:"auto",options:v,onChange:S=>G(g,S)})}})),a.push(N)}return a.push(new ne.j({title:"add button",id:"add button",customRender:function(){return e.createElement(Ha,{key:"Add override"},e.createElement(Bt.b,{icon:"plus",label:"Add field override",variant:"secondary",menuPlacement:"auto",isFullWidth:!0,size:"md",options:zt.i.list().filter(g=>!g.excludeFromPicker).map(g=>({label:g.name,value:g.id,description:g.description})),onChange:g=>d(g)}))}})),a}function ka(t){return t.list().filter(n=>!n.hideFromOverrides).map(n=>{let a=n.name;return n.category&&(a=[...n.category,n.name].join(" > ")),{label:a,value:n.id,description:n.description}})}function Ha({children:t}){const n=(0,T.wW)(Ga);return e.createElement("div",{className:n},t)}function Ga(t){return(0,u.css)({borderTop:`1px solid ${t.colors.border.weak}`,padding:`${t.spacing(2)}`,display:"flex"})}const ja=({panel:t,formatDate:n})=>{const a=(0,T.wW)(Ka),s=t.libraryPanel?.meta;return s?e.createElement("div",{className:a.info},e.createElement("div",{className:a.libraryPanelInfo},`Used on ${s.connectedDashboards} `,s.connectedDashboards===1?"dashboard":"dashboards"),e.createElement("div",{className:a.libraryPanelInfo},"Last edited on ",n?.(s.updated,"L")??s.updated," by",s.updatedBy.avatarUrl&&e.createElement("img",{width:"22",height:"22",className:a.userAvatar,src:s.updatedBy.avatarUrl,alt:`Avatar for ${s.updatedBy.name}`}),s.updatedBy.name)):null},Ka=t=>({info:(0,u.css)`
      line-height: 1;
    `,libraryPanelInfo:(0,u.css)`
      color: ${t.colors.text.secondary};
      font-size: ${t.typography.bodySmall.fontSize};
    `,userAvatar:(0,u.css)`
      border-radius: ${t.shape.radius.circle};
      box-sizing: content-box;
      width: 22px;
      height: 22px;
      padding-left: ${t.spacing(1)};
      padding-right: ${t.spacing(1)};
    `});function Ja(t){const{panel:n,onPanelConfigChange:a,dashboard:s}=t,r=new ne.j({title:"Library panel options",id:"Library panel options",isOpenDefault:!0});return(0,fe.V)(n)&&r.addItem(new U.a({title:"Name",value:n.libraryPanel.name,popularRank:1,render:function(){return e.createElement(se.I,{id:"LibraryPanelFrameName",defaultValue:n.libraryPanel.name,onBlur:c=>a("libraryPanel",{...n.libraryPanel,name:c.currentTarget.value})})}})).addItem(new U.a({title:"Information",render:function(){return e.createElement(ja,{panel:n,formatDate:s.formatDate})}})),r}var Za=o(28718),Qa=o(7122),Re=o(60490),kt=o(31386),Ht=o(74071),k=o(16005);const Ya=`You are an expert in creating Grafana Panels.
You will be given the title and description of the dashboard the panel is in as well as the JSON for the panel.
Your goal is to write a descriptive and concise panel description.
The panel description is meant to explain the purpose of the panel, not just its attributes.
Do not refer to the panel; simply describe its purpose.
There should be no numbers in the description except for thresholds.
The description should be, at most, 200 characters.`,Xa=({onGenerate:t,panel:n})=>{const a=e.useMemo(()=>qa(n),[n]);return e.createElement(kt.v,{messages:a,onGenerate:t,eventTrackingSrc:Ht.dG.panelDescription,toggleTipTitle:"Improve your panel description"})};function qa(t){const n=(0,Re.h4)().getCurrent(),a=(0,k.wH)(t);return[{content:Ya,role:k.uU.system},{content:`The panel is part of a dashboard with the title: ${n.title}`,role:k.uU.system},{content:`The panel is part of a dashboard with the description: ${n.description}`,role:k.uU.system},{content:`This is the JSON which defines the panel: ${a}`,role:k.uU.user}]}const _a="You are an expert in creating Grafana Panels.Your goal is to write short, descriptive, and concise panel title.The title should be shorter than 50 characters.",er=({onGenerate:t,panel:n})=>{const a=e.useMemo(()=>tr(n),[n]);return e.createElement(kt.v,{messages:a,onGenerate:t,eventTrackingSrc:Ht.dG.panelTitle,toggleTipTitle:"Improve your panel title"})};function tr(t){const n=(0,Re.h4)().getCurrent(),a=(0,k.wH)(t);return[{content:_a,role:k.uU.system},{content:`The panel is part of a dashboard with the title: ${n.title}`,role:k.uU.system},{content:`The panel is part of a dashboard with the description: ${n.description}`,role:k.uU.system},{content:`Use this JSON object which defines the panel: ${a}`,role:k.uU.system}]}var nr=o(58672);function ar(t){const{panel:n,onPanelConfigChange:a}=t,s=new ne.j({title:"Panel options",id:"Panel options",isOpenDefault:!0}),r=c=>{const l=document.getElementById("PanelFrameTitle");l instanceof HTMLInputElement&&(l.value=c,a("title",c))},i=c=>{const l=document.getElementById("description-text-area");l instanceof HTMLTextAreaElement&&(l.value=c,a("description",c))};return s.addItem(new U.a({title:"Title",value:n.title,popularRank:1,render:function(){return e.createElement(se.I,{id:"PanelFrameTitle",defaultValue:n.title,onBlur:l=>a("title",l.currentTarget.value)})},addon:b.config.featureToggles.dashgpt&&e.createElement(er,{onGenerate:r,panel:n})})).addItem(new U.a({title:"Description",description:n.description,value:n.description,render:function(){return e.createElement(Za.K,{id:"description-text-area",defaultValue:n.description,onBlur:l=>a("description",l.currentTarget.value)})},addon:b.config.featureToggles.dashgpt&&e.createElement(Xa,{onGenerate:i,panel:n})})).addItem(new U.a({title:"Transparent background",render:function(){return e.createElement(te.r,{value:n.transparent,id:"transparent-background",onChange:l=>a("transparent",l.currentTarget.checked)})}})).addCategory(new ne.j({title:"Panel links",id:"Panel links",isOpenDefault:!1,itemsCount:n.links?.length}).addItem(new U.a({title:"Panel links",render:function(){return e.createElement(Qa.d,{links:n.links,onChange:l=>a("links",l),getSuggestions:Ye.PR,data:[]})}}))).addCategory(new ne.j({title:"Repeat options",id:"Repeat options",isOpenDefault:!1}).addItem(new U.a({title:"Repeat by variable",description:"Repeat this panel for each value in the selected variable. This is not visible while in edit mode. You need to go back to dashboard and then update the variable or reload the dashboard.",render:function(){return e.createElement(nr.X,{id:"repeat-by-variable-select",repeat:n.repeat,onChange:l=>{a("repeat",l)}})}})).addItem(new U.a({title:"Repeat direction",showIf:()=>!!n.repeat,render:function(){const l=[{label:"Horizontal",value:"h"},{label:"Vertical",value:"v"}];return e.createElement(Ne.S,{options:l,value:n.repeatDirection||"h",onChange:d=>a("repeatDirection",d)})}})).addItem(new U.a({title:"Max per row",showIf:()=>!!(n.repeat&&n.repeatDirection==="h"),render:function(){const l=[2,3,4,6,8,12].map(d=>({label:d.toString(),value:d}));return e.createElement(Ve.Ph,{options:l,value:n.maxPerRow,onChange:d=>a("maxPerRow",d.value)})}})))}var rr=o(63801);class sr{constructor(n,a){this.categories=n,this.overrides=a}search(n){const a=new RegExp(n,"i"),r=this.collectHits(this.categories,a,[]).sort(Gt).map(l=>l.item),c=this.collectHits(this.overrides,a,[]).sort(Gt).map(l=>l.item);return{optionHits:r,overrideHits:this.buildOverrideHitCategories(c),totalCount:this.getAllOptionsCount(this.categories)}}collectHits(n,a,s){for(const r of n){const i=a.test(r.props.title);for(const c of r.items){if(a.test(c.props.title)){s.push({item:c,rank:1});continue}if(c.props.description&&a.test(c.props.description)){s.push({item:c,rank:2});continue}i&&s.push({item:c,rank:3})}r.categories.length>0&&this.collectHits(r.categories,a,s)}return s}getAllOptionsCount(n){let a=0;for(const s of n)a+=s.items.length,s.categories.length>0&&(a+=this.getAllOptionsCount(s.categories));return a}buildOverrideHitCategories(n){const a={};for(const s of n){let r=a[s.parent.props.title];r||(r=a[s.parent.props.title]=new ne.j(s.parent.props),r.addItem(s.parent.items[0])),r.items[0].props.title!==s.props.title&&r.addItem(s)}return Object.values(a)}}function Gt(t,n){return t.rank-n.rank}function or(t){const n=[];for(const a of t)for(const s of a.items)s.props.title==="Unit"&&(s.props.popularRank=2),s.props.title==="Min"&&(s.props.popularRank=3),s.props.title==="Max"&&(s.props.popularRank=4),s.props.title==="Display name"&&(s.props.popularRank=5),s.props.popularRank&&n.push(s);return n.sort((a,s)=>a.props.popularRank-s.props.popularRank)}const ir=t=>{const{plugin:n,dashboard:a,panel:s}=t,[r,i]=(0,e.useState)(""),[c,l]=(0,e.useState)("All"),d=(0,T.wW)(ur),[p,m,g]=(0,e.useMemo)(()=>[ar(t),(0,rr.AL)(t),Ja(t)],[s.configRev,t.data,t.instanceState,r]),h=(0,e.useMemo)(()=>Va(t,r),[s.configRev,t.data,t.instanceState,r]),f=[],v=r.length>0,C=(0,e.useMemo)(lr,[]),I=(0,fe.V)(s)?[g,p,...m]:[p,...m];if(v)f.push(dr(I,h,r)),t.plugin.angularPanelCtrl&&f.push(e.createElement("div",{className:d.searchNotice,key:"Search notice"},"This is an old visualization type that does not support searching all options."));else switch(c){case"All":(0,fe.V)(s)&&f.push(g.render()),f.push(p.render()),t.plugin.angularPanelCtrl&&f.push(e.createElement(Ma,{plugin:n,dashboard:a,panel:s,key:"AngularOptions"}));for(const P of m)f.push(P.render());for(const P of h)f.push(P.render());break;case"Overrides":for(const P of h)f.push(P.render());break;case"Recent":f.push(e.createElement(Qe.u,{id:"Recent options",title:"Recent options",key:"Recent options",forceOpen:1},or(I).map(P=>P.render())));break}const N=!v&&!n.fieldConfigRegistry.isEmpty();return e.createElement("div",{className:d.wrapper},e.createElement("div",{className:d.formBox},s.isAngularPlugin()&&!n.meta.angular?.hideDeprecation&&e.createElement(Na.Y,{className:d.angularDeprecationWrapper,showPluginDetailsLink:!0,pluginId:n.meta.id,pluginType:n.meta.type,angularSupportEnabled:b.config?.angularSupportEnabled,interactionElementId:"panel-options"}),e.createElement("div",{className:d.formRow},e.createElement($t.H,{width:0,value:r,onChange:i,placeholder:"Search options"})),N&&e.createElement("div",{className:d.formRow},e.createElement(Ne.S,{options:C,value:c,fullWidth:!0,onChange:l}))),e.createElement("div",{className:d.scrollWrapper},e.createElement(oe.$,{autoHeightMin:"100%"},e.createElement("div",{className:d.mainBox},f))))};function lr(){return[{label:"All",value:"All"},{label:"Overrides",value:"Overrides"}]}var cr=(t=>(t.All="All",t.Overrides="Overrides",t.Recent="Recent",t))(cr||{});function dr(t,n,a){const s=new sr(t,n),{optionHits:r,totalCount:i,overrideHits:c}=s.search(a);return e.createElement("div",{key:"search results"},e.createElement(Qe.u,{id:"Found options",title:`Matched ${r.length}/${i} options`,key:"Normal options",forceOpen:1},r.map(l=>l.render(a))),c.map(l=>l.render(a)))}const ur=t=>({wrapper:(0,u.css)`
    height: 100%;
    display: flex;
    flex-direction: column;
    flex: 1 1 0;

    .search-fragment-highlight {
      color: ${t.colors.warning.text};
      background: transparent;
    }
  `,searchBox:(0,u.css)`
    display: flex;
    flex-direction: column;
    min-height: 0;
  `,formRow:(0,u.css)`
    margin-bottom: ${t.spacing(1)};
  `,formBox:(0,u.css)`
    padding: ${t.spacing(1)};
    background: ${t.colors.background.primary};
    border: 1px solid ${t.components.panel.borderColor};
    border-top-left-radius: ${t.shape.borderRadius(1.5)};
    border-bottom: none;
  `,closeButton:(0,u.css)`
    margin-left: ${t.spacing(1)};
  `,searchHits:(0,u.css)`
    padding: ${t.spacing(1,1,0,1)};
  `,scrollWrapper:(0,u.css)`
    flex-grow: 1;
    min-height: 0;
  `,searchNotice:(0,u.css)`
    font-size: ${t.typography.size.sm};
    color: ${t.colors.text.secondary};
    padding: ${t.spacing(1)};
    text-align: center;
  `,mainBox:(0,u.css)`
    background: ${t.colors.background.primary};
    border: 1px solid ${t.components.panel.borderColor};
    border-top: none;
    flex-grow: 1;
  `,angularDeprecationWrapper:(0,u.css)`
    padding: ${t.spacing(1)};
  `});var jt=o(5460),pr=o(103);const Kt=t=>n=>n.plugins.panels[t]||(0,pr.X)(`Panel plugin not found (${t})`,!0),Xe=({panel:t})=>{const n=(0,E.useDispatch)(),a=(0,E.useSelector)(Kt(t.type)),s=(0,E.useSelector)(l=>l.panelEditor.ui.isPanelOptionsVisible),r=(0,E.useSelector)(l=>l.panelEditor.isVizPickerOpen),i=()=>{n((0,Z.g_)(!r))},c=()=>{n(ze({isPanelOptionsVisible:!s}))};return a?e.createElement("div",{className:Jt.wrapper},e.createElement(jt.h,null,e.createElement(Ke.h,{className:Jt.vizButton,tooltip:"Click to change visualization",imgSrc:a.meta.info.logos.small,isOpen:r,onClick:i,"data-testid":y.wl.components.PanelEditor.toggleVizPicker,"aria-label":"Change Visualization",variant:"canvas",fullWidth:!0},a.meta.name),e.createElement(Ke.h,{tooltip:s?"Close options pane":"Show options pane",icon:s?"angle-right":"angle-left",onClick:c,variant:"canvas","data-testid":y.wl.components.PanelEditor.toggleVizOptions,"aria-label":s?"Close options pane":"Show options pane"}))):null};Xe.displayName="VisualizationTab";const Jt={wrapper:(0,u.css)`
    display: flex;
    flex-direction: column;
  `,vizButton:(0,u.css)`
    text-align: left;
  `};var mr=o(50370),Zt=o(21279),gr=o(4714),hr=o(96870),Ae=o(90069);const fr=({onConfirm:t,onDismiss:n,panel:a})=>{const s=(0,fe.V)(a),r=`${s?"Changing":"Replace with"} library panel`,i=`${s?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return e.createElement(Ae.s,{onConfirm:t,onDismiss:n,confirmText:s?"Change":"Replace",title:r,body:i,dismissText:"Cancel",isOpen:!0})};var vr=o(21435);const Er=({panel:t,searchQuery:n,isWidget:a=!1})=>{const[s,r]=(0,e.useState)(!1),[i,c]=(0,e.useState)(void 0),[l,d]=(0,e.useState)([]),p=(0,e.useCallback)(C=>{d(C.map(I=>I.id))},[d]),m=(0,Re.h4)().getCurrent(),g=(0,E.useDispatch)(),h=async()=>{i&&(c(void 0),g((0,Te.ih)(t,i)))},f=()=>r(!0),v=()=>c(void 0);return e.createElement($.wc,{spacing:"md"},!t.libraryPanel&&e.createElement($.wc,{align:"center"},e.createElement(w.zx,{icon:"plus",onClick:f,variant:"secondary",fullWidth:!0},"Create new library panel")),e.createElement(gr.j,{onChange:p,isWidget:a}),e.createElement("div",{className:yr.libraryPanelsView},e.createElement(vr.u,{currentPanelId:t.libraryPanel?.uid,searchString:n,panelFilter:l,onClickCard:c,showSecondaryActions:!0,isWidget:a})),s&&e.createElement(hr.c,{panel:t,onDismiss:()=>r(!1),initialFolderUid:m?.meta.folderUid,isOpen:s}),i&&e.createElement(fr,{panel:t,onDismiss:v,onConfirm:h}))},yr={libraryPanelsView:(0,u.css)`
    width: 100%;
  `};var qe=o(55632),br=o(33521);const Cr=["timeseries","barchart","gauge","stat","piechart","bargauge","table","state-timeline","status-history","logs","candlestick","flamegraph"];async function Tr(t,n){const a=new qe.mi(t,n);for(const r of Cr){const c=(await(0,br.Ub)(r)).getSuggestionsSupplier();c&&c.getSuggestionsForData(a)}const s=a.getList();if(!b.config.featureToggles.vizAndWidgetSplit&&a.dataSummary.fieldCount===0)for(const r of Object.values(b.config.panels))!r.skipDataQuery||r.hideFromList||s.push({name:r.name,pluginId:r.id,description:r.info.description,cardOptions:{imgSrc:r.info.logos.small}});return s.sort((r,i)=>{if(a.dataSummary.preferredVisualisationType){if(r.pluginId===a.dataSummary.preferredVisualisationType)return-1;if(i.pluginId===a.dataSummary.preferredVisualisationType)return 1}return(i.score??qe._.OK)-(r.score??qe._.OK)})}var Qt=o(66883);function Sr({data:t,suggestion:n,onChange:a,width:s}){const r=(0,T.wW)(Pr),{innerStyles:i,outerStyles:c,renderWidth:l,renderHeight:d}=xr(s),p=n.cardOptions??{},m={"aria-label":n.name,className:r.vizBox,"data-testid":y.wl.components.VisualizationPreview.card(n.name),style:c,onClick:()=>{a({pluginId:n.pluginId,options:n.options,fieldConfig:n.fieldConfig})}};if(p.imgSrc)return e.createElement(he.u,{content:n.description??n.name},e.createElement("button",{...m,className:(0,u.cx)(r.vizBox,r.imgBox)},e.createElement("div",{className:r.name},n.name),e.createElement("img",{className:r.img,src:p.imgSrc,alt:n.name})));let g=n;return n.cardOptions?.previewModifier&&(g=(0,ee.cloneDeep)(n),n.cardOptions.previewModifier(g)),e.createElement("button",{...m},e.createElement(he.u,{content:n.name},e.createElement("div",{style:i,className:r.renderContainer},e.createElement(Qt.$,{title:"",data:t,pluginId:n.pluginId,width:l,height:d,options:g.options,fieldConfig:g.fieldConfig}),e.createElement("div",{className:r.hoverPane}))))}const Pr=t=>({hoverPane:(0,u.css)({position:"absolute",top:0,right:0,left:0,borderRadius:t.spacing(2),bottom:0}),vizBox:(0,u.css)`
      position: relative;
      background: none;
      border-radius: ${t.shape.radius.default};
      cursor: pointer;
      border: 1px solid ${t.colors.border.medium};

      transition: ${t.transitions.create(["background"],{duration:t.transitions.duration.short})};

      &:hover {
        background: ${t.colors.background.secondary};
      }
    `,imgBox:(0,u.css)`
      display: flex;
      flex-direction: column;
      height: 100%;

      justify-self: center;
      color: ${t.colors.text.primary};
      width: 100%;
      display: flex;

      justify-content: center;
      align-items: center;
      text-align: center;
    `,name:(0,u.css)`
      padding-bottom: ${t.spacing(.5)};
      margin-top: ${t.spacing(-1)};
      font-size: ${t.typography.bodySmall.fontSize};
      white-space: nowrap;
      overflow: hidden;
      color: ${t.colors.text.secondary};
      font-weight: ${t.typography.fontWeightMedium};
      text-overflow: ellipsis;
    `,img:(0,u.css)`
      max-width: ${t.spacing(8)};
      max-height: ${t.spacing(8)};
    `,renderContainer:(0,u.css)`
      position: absolute;
      transform-origin: left top;
      top: 6px;
      left: 6px;
    `});function xr(t){const a=t,s=t*(1/1.6),r=350,i=r*(1/1.6),c=6,l=(a-c*2)/r,d=(s-c*2)/i;return{renderHeight:i,renderWidth:r,outerStyles:{width:a,height:s},innerStyles:{width:r,height:i,transform:`scale(${l}, ${d})`}}}function wr({searchQuery:t,onChange:n,data:a,panel:s}){const r=(0,T.wW)(Ir),{value:i}=(0,L.Z)(()=>Tr(a,s),[a,s]),c=Dr(t,i);return e.createElement(xe.Z,{disableHeight:!0,style:{width:"100%",height:"100%"}},({width:l})=>{if(!l)return null;const d=Math.floor(l/170),p=8*(d-1),m=(l-p)/d;return e.createElement("div",null,e.createElement("div",{className:r.filterRow},e.createElement("div",{className:r.infoText},"Based on current data")),e.createElement("div",{className:r.grid,style:{gridTemplateColumns:`repeat(auto-fill, ${m-1}px)`}},c.map((g,h)=>e.createElement(Sr,{key:h,data:a,suggestion:g,onChange:n,width:m})),t&&c.length===0&&e.createElement("div",{className:r.infoText},"No results matched your query")))})}function Dr(t,n){if(!t||!n)return n||[];const a=new RegExp(t,"i");return n.filter(s=>a.test(s.name)||a.test(s.pluginId))}const Ir=t=>({heading:(0,u.css)({...t.typography.h5,margin:t.spacing(0,.5,1)}),filterRow:(0,u.css)({display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",paddingBottom:"8px"}),infoText:(0,u.css)({fontSize:t.typography.bodySmall.fontSize,color:t.colors.text.secondary,fontStyle:"italic"}),grid:(0,u.css)({display:"grid",gridGap:t.spacing(1),gridTemplateColumns:"repeat(auto-fill, 144px)",marginBottom:t.spacing(1),justifyContent:"space-evenly"})});var Yt=o(36965),O=o(46536);const Xt=({panel:t,data:n})=>{const a=(0,E.useSelector)(Kt(t.type)),[s,r]=(0,e.useState)(""),i=!!a.meta.skipDataQuery,c=!!(i&&b.config.featureToggles.vizAndWidgetSplit),l=c?Zt.Hk:Zt.FL,d=c?O.Ok.Widgets:O.Ok.Visualizations,[p,m]=(0,mr.Z)(l,d),g=(0,E.useDispatch)(),h=(0,T.wW)(Nr),f=(0,e.useRef)(null),v=(0,e.useCallback)(P=>{g((0,Te.Kc)({panel:t,...P})),P.withModKey||g((0,Z.g_)(!1))},[g,t]),C=()=>{g((0,Z.g_)(!1))};if(!a)return null;const I=[{label:"Visualizations",value:O.Ok.Visualizations},{label:"Suggestions",value:O.Ok.Suggestions},{label:"Library panels",value:O.Ok.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}],N=[{label:"Widgets",value:O.Ok.Widgets},{label:"Library panels",value:O.Ok.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}];return e.createElement("div",{className:h.openWrapper},e.createElement("div",{className:h.formBox},e.createElement("div",{className:h.searchRow},e.createElement($t.H,{value:s,onChange:r,ref:f,autoFocus:!0,placeholder:"Search for..."}),e.createElement(w.zx,{title:"Close",variant:"secondary",icon:"angle-up",className:h.closeButton,"aria-label":y.wl.components.PanelEditor.toggleVizPicker,onClick:C})),e.createElement(ie.g,{className:h.customFieldMargin},e.createElement(Ne.S,{options:c?N:I,value:p,onChange:m,fullWidth:!0}))),e.createElement("div",{className:h.scrollWrapper},e.createElement(oe.$,{autoHeightMin:"100%"},e.createElement("div",{className:h.scrollContent},p===O.Ok.Visualizations&&e.createElement(Yt.G,{pluginId:a.meta.id,onChange:v,searchQuery:s}),p===O.Ok.Widgets&&e.createElement(Yt.G,{pluginId:a.meta.id,onChange:v,searchQuery:s,isWidget:!0}),p===O.Ok.Suggestions&&e.createElement(wr,{onChange:v,searchQuery:s,panel:t,data:n}),p===O.Ok.LibraryPanels&&e.createElement(Er,{searchQuery:s,panel:t,key:"Panel Library",isWidget:i})))))};Xt.displayName="VisualizationSelectPane";const Nr=t=>({icon:(0,u.css)`
      color: ${t.v1.palette.gray33};
    `,wrapper:(0,u.css)`
      display: flex;
      flex-direction: column;
      flex: 1 1 0;
      height: 100%;
    `,vizButton:(0,u.css)`
      text-align: left;
    `,scrollWrapper:(0,u.css)`
      flex-grow: 1;
      min-height: 0;
    `,scrollContent:(0,u.css)`
      padding: ${t.spacing(1)};
    `,openWrapper:(0,u.css)`
      display: flex;
      flex-direction: column;
      flex: 1 1 100%;
      height: 100%;
      background: ${t.colors.background.primary};
      border: 1px solid ${t.colors.border.weak};
    `,searchRow:(0,u.css)`
      display: flex;
      margin-bottom: ${t.spacing(1)};
    `,closeButton:(0,u.css)`
      margin-left: ${t.spacing(1)};
    `,customFieldMargin:(0,u.css)`
      margin-bottom: ${t.spacing(1)};
    `,formBox:(0,u.css)`
      padding: ${t.spacing(1)};
      padding-bottom: 0;
    `}),Or=({plugin:t,panel:n,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:r,dashboard:i,instanceState:c})=>{const l=(0,T.wW)(Rr),d=(0,E.useSelector)(m=>m.panelEditor.isVizPickerOpen),{data:p}=Ge(n,{withTransforms:!0,withFieldConfig:!1},!0);return e.createElement("div",{className:l.wrapper,"aria-label":y.wl.components.PanelEditor.OptionsPane.content},!d&&e.createElement(e.Fragment,null,e.createElement("div",{className:l.vizButtonWrapper},e.createElement(Xe,{panel:n})),e.createElement("div",{className:l.optionsWrapper},e.createElement(ir,{panel:n,dashboard:i,plugin:t,instanceState:c,data:p,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:r}))),d&&e.createElement(Xt,{panel:n,data:p}))},Rr=t=>({wrapper:(0,u.css)`
      height: 100%;
      width: 100%;
      display: flex;
      flex: 1 1 0;
      flex-direction: column;
      padding: 0;
    `,optionsWrapper:(0,u.css)`
      flex-grow: 1;
      min-height: 0;
    `,vizButtonWrapper:(0,u.css)`
      padding: 0 ${t.spacing(2,2)} 0;
    `,legacyOptions:(0,u.css)`
      label: legacy-options;
      .panel-options-grid {
        display: flex;
        flex-direction: column;
      }
      .panel-options-group {
        margin-bottom: 0;
      }
      .panel-options-group__body {
        padding: ${t.spacing(2)} 0;
      }

      .section {
        display: block;
        margin: ${t.spacing(2)} 0;

        &:first-child {
          margin-top: 0;
        }
      }
    `});var qt=o(1727),Ar=o(48011),Mr=o(51133),$r=(t=>(t.Error="Error",t.Info="Info",t.Links="Links",t))($r||{});class Lr extends e.Component{constructor(){super(...arguments),this.timeSrv=(0,le.$t)(),this.getInfoMode=()=>{const{panel:n,error:a}=this.props;if(a)return"Error";if(n.description)return"Info";if(n.links&&n.links.length)return"Links"},this.getInfoContent=()=>{const{panel:n}=this.props,a=n.description||"",s=(0,je.J)().replace(a,n.scopedVars),r=(0,Mr.a)(s),i=this.props.links&&this.props.links.getLinks(n.replaceVariables);return e.createElement("div",{className:"panel-info-content markdown-html"},e.createElement("div",{dangerouslySetInnerHTML:{__html:r}}),i&&i.length>0&&e.createElement("ul",{className:"panel-info-corner-links"},i.map((c,l)=>e.createElement("li",{key:l},e.createElement("a",{className:"panel-info-corner-links__item",href:c.href,target:c.target},c.title)))))},this.onClickError=()=>{D.E1.partial({inspect:this.props.panel.id,inspectTab:W.q.Error})}}renderCornerType(n,a,s){const r=n==="Error"?"error":"info",i=`panel-info-corner panel-info-corner--${n.toLowerCase()}`,c=y.wl.components.Panels.Panel.headerCornerInfo(n.toLowerCase());return e.createElement(he.u,{content:a,placement:"top-start",theme:r,interactive:!0},e.createElement("button",{type:"button",className:i,onClick:s,"aria-label":c},e.createElement("i",{"aria-hidden":!0,className:"fa"}),e.createElement("span",{className:"panel-info-corner-inner"})))}render(){const{error:n}=this.props,a=this.getInfoMode();return a?a==="Error"&&n?this.renderCornerType(a,n,this.onClickError):a==="Info"||a==="Links"?this.renderCornerType(a,this.getInfoContent):null:null}}const Fr=Lr;function Wr({width:t,height:n,panel:a,dashboard:s}){const{data:r}=Ge(a,{withTransforms:!0,withFieldConfig:!1},!1),[i,c]=(0,e.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});if((0,e.useEffect)(()=>{const d=(0,le.$t)(),p=a.events.subscribe(qt.U5,()=>{const m=(0,Ue.W1)(a,d.timeRange());a.runAllPanelQueries({dashboardUID:s.uid,dashboardTimezone:s.getTimezone(),timeData:m,width:t})});return()=>{p.unsubscribe()}},[a,s,t]),!r)return null;const l=r?.errors?r.errors.length>1?"Multiple errors found. Click for more details":r.errors[0].message:r?.error?.message;return e.createElement(Ar.fm,{width:t,height:n,padding:"none"},(d,p)=>e.createElement(e.Fragment,null,e.createElement(Fr,{panel:a,error:l}),e.createElement(Qt.$,{title:"Raw data",pluginId:"table",width:d,height:p,data:r,options:i,onOptionsChange:c})))}var _t=o(52386),_e=o(48018),Ur=o(31805),zr=o(83994),Br=o(66261),Vr=o(88511);function en({message:t}){const n=(0,e.useCallback)(()=>{D.E1.partial({tab:O.Ip.Query})},[]);return e.createElement($.Ar,{justify:"center",style:{marginTop:"100px"}},e.createElement($.wc,{spacing:"md"},e.createElement("h2",null,t),e.createElement("div",null,e.createElement(w.zx,{size:"md",variant:"secondary",icon:"arrow-left",onClick:n},"Go back to Queries"))))}var et=o(69391),kr=o(65420),tn=o(74201);class Hr extends e.PureComponent{constructor(){super(...arguments),this.state={stateHistoryItems:[]},this.clearHistory=async()=>{const{dashboard:n,panelId:a,onRefresh:s}=this.props;await(0,et.i)().post("/api/annotations/mass-delete",{dashboardId:n.id,panelId:a}),this.setState({stateHistoryItems:[]}),s()}}componentDidMount(){const{dashboard:n,panelId:a}=this.props;(0,et.i)().get(`/api/annotations?dashboardId=${n.id}&panelId=${a}&limit=50&type=alert`,{},`state-history-${n.id}-${a}`).then(s=>{const r=s.map(i=>({stateModel:tn.Z.getStateDisplayModel(i.newState),time:n.formatDate(i.time,"MMM D, YYYY HH:mm:ss"),info:tn.Z.getAlertAnnotationInfo(i)}));this.setState({stateHistoryItems:r})})}render(){const{stateHistoryItems:n}=this.state;return e.createElement("div",null,n.length>0&&e.createElement("div",{className:"p-b-1"},e.createElement("span",{className:"muted"},"Last 50 state changes"),e.createElement(kr.p,{onConfirm:this.clearHistory,confirmVariant:"destructive",confirmText:"Clear"},e.createElement(w.zx,{className:(0,u.css)`
                  direction: ltr;
                `,variant:"destructive",icon:"trash-alt"},"Clear history"))),e.createElement("ol",{className:"alert-rule-list"},n.length>0?n.map((a,s)=>e.createElement("li",{className:"alert-rule-item",key:`${a.time}-${s}`},e.createElement("div",{className:`alert-rule-item__icon ${a.stateModel.stateClass}`},e.createElement(X.J,{name:a.stateModel.iconClass,size:"xl"})),e.createElement("div",{className:"alert-rule-item__body"},e.createElement("div",{className:"alert-rule-item__header"},e.createElement("p",{className:"alert-rule-item__name"},a.alertName),e.createElement("div",{className:"alert-rule-item__text"},e.createElement("span",{className:`${a.stateModel.stateClass}`},a.stateModel.text))),a.info),e.createElement("div",{className:"alert-rule-item__time"},a.time))):e.createElement("i",null,"No state changes recorded")))}}const Gr=Hr;var nn=o(61375),tt=o(79300);class jr extends e.PureComponent{constructor(){super(...arguments),this.state={isLoading:!1,allNodesExpanded:null,testRuleResponse:{}},this.setFormattedJson=n=>{this.formattedJson=n},this.getTextForClipboard=()=>JSON.stringify(this.formattedJson,null,2),this.onToggleExpand=()=>{this.setState(n=>({...n,allNodesExpanded:!this.state.allNodesExpanded}))},this.getNrOfOpenNodes=()=>this.state.allNodesExpanded===null?3:this.state.allNodesExpanded?20:1,this.renderExpandCollapse=()=>{const{allNodesExpanded:n}=this.state,a=e.createElement(e.Fragment,null,e.createElement(X.J,{name:"minus-circle"})," Collapse All"),s=e.createElement(e.Fragment,null,e.createElement(X.J,{name:"plus-circle"})," Expand All");return n?a:s}}componentDidMount(){this.testRule()}async testRule(){const{dashboard:n,panel:a}=this.props,s=n.getSaveModelCloneOld();s.panels=s.panels.map(c=>c.id===a.id?a.getSaveModel():c);const r={dashboard:s,panelId:a.id};this.setState({isLoading:!0});const i=await(0,et.i)().post("/api/alerts/test",r);this.setState({isLoading:!1,testRuleResponse:i})}render(){const{testRuleResponse:n,isLoading:a}=this.state,s=(0,w.gN)(this.props.theme);if(a===!0)return e.createElement(nn.u,{text:"Evaluating rule"});const r=this.getNrOfOpenNodes();return e.createElement(e.Fragment,null,e.createElement("div",{className:"pull-right"},e.createElement($.Lh,{spacing:"md"},e.createElement("button",{type:"button",className:s,onClick:this.onToggleExpand},this.renderExpandCollapse()),e.createElement(ke.m,{getText:this.getTextForClipboard,icon:"copy"},"Copy to Clipboard"))),e.createElement(tt.g,{json:n,open:r,onDidRender:this.setFormattedJson}))}}const Kr=(0,T.HE)(jr);var Jr=o(54151);class Zr extends e.PureComponent{constructor(){super(...arguments),this.state={validationMessage:"",showStateHistory:!1,showDeleteConfirmation:!1,showTestRule:!1},this.onAngularPanelUpdated=()=>{this.forceUpdate()},this.onAddAlert=()=>{this.panelCtrl?._enableAlert(),this.component?.digest(),this.forceUpdate()},this.onToggleModal=n=>{const a=this.state[n];this.setState({...this.state,[n]:!a})},this.renderTestRule=()=>{if(!this.state.showTestRule)return null;const{panel:n,dashboard:a}=this.props,s=()=>this.onToggleModal("showTestRule");return e.createElement(Y.u,{isOpen:!0,icon:"bug",title:"Testing rule",onDismiss:s,onClickBackdrop:s},e.createElement(Kr,{panel:n,dashboard:a}))},this.renderDeleteConfirmation=()=>{if(!this.state.showDeleteConfirmation)return null;const{panel:n}=this.props,a=()=>this.onToggleModal("showDeleteConfirmation");return e.createElement(Ae.s,{isOpen:!0,icon:"trash-alt",title:"Delete",body:e.createElement("div",null,"Are you sure you want to delete this alert rule?",e.createElement("br",null),e.createElement("small",null,"You need to save dashboard for the delete to take effect.")),confirmText:"Delete alert",onDismiss:a,onConfirm:()=>{delete n.alert,n.thresholds=[],this.panelCtrl&&(this.panelCtrl.alertState=null,this.panelCtrl.render()),this.component?.digest(),a()}})},this.renderStateHistory=()=>{if(!this.state.showStateHistory)return null;const{panel:n,dashboard:a}=this.props,s=()=>this.onToggleModal("showStateHistory");return e.createElement(Y.u,{isOpen:!0,icon:"history",title:"State history",onDismiss:s,onClickBackdrop:s},e.createElement(Gr,{dashboard:a,panelId:n.id,onRefresh:()=>this.panelCtrl?.refresh()}))}}async componentDidMount(){b.config.angularSupportEnabled?(await Promise.all([o.e(5888),o.e(5718)]).then(o.bind(o,65204)),this.loadAlertTab()):alert("Angular support disabled, legacy alerting cannot function without angular support")}componentDidUpdate(n){this.loadAlertTab()}componentWillUnmount(){this.component&&this.component.destroy()}async loadAlertTab(){const{panel:n,angularPanelComponent:a}=this.props;if(!this.element||this.component)return;if(a){const l=a.getScope();if(!l.$$childHead){setTimeout(()=>{this.forceUpdate()});return}this.panelCtrl=l.$$childHead.ctrl}else this.panelCtrl=this.getReactAlertPanelCtrl();const s=(0,Lt.w)(),r="<alert-tab />",i={ctrl:this.panelCtrl};this.component=s.load(this.element,i,r);const c=await(0,Jr.E)(n.transformations,n.targets,(0,Br.F)(),n.datasource);c&&this.setState({validationMessage:c})}getReactAlertPanelCtrl(){return{panel:this.props.panel,events:new zr.F,render:()=>{this.props.panel.render()}}}render(){const{alert:n,transformations:a}=this.props.panel,{validationMessage:s}=this.state,r=a&&a.length>0;if(!n&&s)return e.createElement(en,{message:s});const i={title:"Panel has no alert rule defined",buttonIcon:"bell",onClick:this.onAddAlert,buttonTitle:"Create Alert"};return e.createElement(e.Fragment,null,e.createElement(oe.$,{autoHeightMin:"100%"},e.createElement($.W2,{padding:"md"},e.createElement("div",{"data-testid":y.wl.components.AlertTab.content},n&&r&&e.createElement(_.b,{severity:E.AppNotificationSeverity.Error,title:"Transformations are not supported in alert queries"}),e.createElement("div",{ref:c=>this.element=c}),n&&e.createElement($.Lh,null,e.createElement(w.zx,{onClick:()=>this.onToggleModal("showStateHistory"),variant:"secondary"},"State history"),e.createElement(w.zx,{onClick:()=>this.onToggleModal("showTestRule"),variant:"secondary"},"Test rule"),e.createElement(w.zx,{onClick:()=>this.onToggleModal("showDeleteConfirmation"),variant:"destructive"},"Delete")),!n&&!s&&e.createElement(Vr.Z,{...i})))),this.renderTestRule(),this.renderDeleteConfirmation(),this.renderStateHistory())}}const Qr=(t,n)=>({angularPanelComponent:(0,Pe.i)(t,n.panel)?.angularComponent}),Yr={},Xr=(0,x.connect)(Qr,Yr)(Zr);var qr=o(91977),an=o(80127),_r=o(1636);const rn=({dashboard:t,panel:n,className:a})=>{const s=(0,E.useSelector)(d=>d.templating),r=(0,Fe.TH)(),{loading:i,value:c}=(0,L.Z)(()=>(0,_r.aR)(n,t),[n,t,s]);if(i)return e.createElement(w.zx,{disabled:!0},"New alert rule");if(!c)return e.createElement(_.b,{severity:"info",title:"No alerting capable query found"},"Cannot create alerts from this panel because no query to an alerting capable datasource is found.");const l=qr.Cj.renderUrl("alerting/new",{defaults:JSON.stringify(c),returnTo:r.pathname+r.search});return e.createElement(w.Qj,{icon:"bell",onClick:()=>(0,an.PN)(an.z7.alertRuleFromPanel),href:l,className:a,"data-testid":"create-alert-rule-button"},"New alert rule")};var es=o(624),sn=o(84415),nt=o(98319),Ee=o(67451),on=o(39138),ts=o(41216),ln=o(68144);function cn({dashboard:t,panel:n,poll:a=!1}){const s=(0,E.useDispatch)(),r=(0,ln._)(m=>m.promRules[Ee.GC])??on.oq,i=(0,ln._)(m=>m.rulerRules[Ee.GC])??on.oq;(0,e.useEffect)(()=>{const m=()=>{s((0,sn.y6)({rulesSourceName:Ee.GC,filter:{dashboardUID:t.uid,panelId:n.id}})),s((0,sn.UR)({rulesSourceName:Ee.GC,filter:{dashboardUID:t.uid,panelId:n.id}}))};if(m(),a){const g=setInterval(m,nt.p4);return()=>{clearInterval(g)}}return()=>{}},[s,a,n.id,t.uid]);const c=r.loading||i.loading,l=[r.error,i.error].filter(m=>!!m),d=(0,ts.Zo)(Ee.GC);return{rules:(0,e.useMemo)(()=>d.flatMap(m=>m.groups).flatMap(m=>m.rules).filter(m=>m.annotations[nt.q6.dashboardUID]===t.uid&&m.annotations[nt.q6.panelID]===String(n.id)),[d,t,n]),errors:l,loading:c}}var ns=o(81347);const as=({dashboard:t,panel:n})=>{const a=(0,T.wW)(rs),{errors:s,loading:r,rules:i}=cn({dashboard:t,panel:n,poll:!0}),c=(0,ns.Bz)("grafana"),l=Ce.contextSrv.hasPermission(c.create),d=s.length?e.createElement(_.b,{title:"Errors loading rules",severity:"error"},s.map((p,m)=>e.createElement("div",{key:m},"Failed to load Grafana rules state: ",p.message||"Unknown error."))):null;return r&&!i.length?e.createElement("div",{className:a.innerWrapper},d,e.createElement(nn.u,{text:"Loading rules..."})):i.length?e.createElement(oe.$,{autoHeightMin:"100%"},e.createElement("div",{className:a.innerWrapper},d,e.createElement(es.i,{rules:i}),!!t.meta.canSave&&l&&e.createElement(rn,{className:a.newButton,panel:n,dashboard:t}))):e.createElement("div",{"data-testid":y.wl.components.PanelAlertTabContent.content,className:a.noRulesWrapper},d,!!t.uid&&e.createElement(e.Fragment,null,e.createElement("p",null,"There are no alert rules linked to this panel."),!!t.meta.canSave&&l&&e.createElement(rn,{panel:n,dashboard:t})),!t.uid&&!!t.meta.canSave&&e.createElement(_.b,{severity:"info",title:"Dashboard not saved"},"Dashboard must be saved before alerts can be added."))},rs=t=>({newButton:(0,u.css)`
    margin-top: ${t.spacing(3)};
  `,innerWrapper:(0,u.css)`
    padding: ${t.spacing(2)};
  `,noRulesWrapper:(0,u.css)`
    margin: ${t.spacing(2)};
    background-color: ${t.colors.background.secondary};
    padding: ${t.spacing(3)};
  `}),ss=b.config.unifiedAlertingEnabled?as:Xr,os=({panel:t,dashboard:n,...a})=>{const{rules:s,loading:r}=cn({panel:t,dashboard:n});return e.createElement(pe.O,{...a,counter:r?null:s.length})};var dn=o(4113),Me=o(39729),is=o(68833),un=o(36717),H=o(83811),at=o(83870),ls=o(18198),$e=o(71199),ye=o(48229),cs=o(87243),rt=o(51767),ds=o(89582),st=o(96503);const us=({debugMode:t,index:n,data:a,uiConfig:s,configs:r,onChange:i,toggleShowDebug:c})=>{const l=(0,T.wW)(ps),[d,p]=(0,e.useState)([]),[m,g]=(0,e.useState)([]),h=(0,e.useMemo)(()=>r[n],[r,n]);(0,e.useEffect)(()=>{const v=r[n].transformation,C=v.filter?.options?(0,Ut.b9)(v.filter):void 0,I=r.slice(0,n).map(S=>S.transformation),N=r.slice(n,n+1).map(S=>S.transformation),P={interpolate:S=>(0,je.J)().replace(S)},G=(0,st.H)(I,a,P).subscribe(S=>{C&&(S=a.filter(z=>C(z))),p(S)}),R=(0,st.H)(I,a,P).pipe((0,ds.z)(S=>(0,st.H)(N,S,P))).subscribe(g);return function(){G.unsubscribe(),R.unsubscribe()}},[n,a,r]);const f=(0,e.useMemo)(()=>e.createElement(s.editor,{options:{...s.transformation.defaultOptions,...h.transformation.options},input:d,onChange:v=>{i(n,{...h.transformation,options:v})}}),[s.editor,s.transformation.defaultOptions,h.transformation,d,i,n]);return e.createElement("div",{className:l.editor,"data-testid":y.wl.components.TransformTab.transformationEditor(s.name)},f,t&&e.createElement(we.d,{title:"Debug transformation",subtitle:s.name,onClose:c},e.createElement("div",{className:l.debugWrapper,"data-testid":y.wl.components.TransformTab.transformationEditorDebugger(s.name)},e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Input data"),e.createElement("div",{className:l.debugJson},e.createElement(tt.g,{json:d}))),e.createElement("div",{className:l.debugSeparator},e.createElement(X.J,{name:"arrow-right"})),e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Output data"),e.createElement("div",{className:l.debugJson},m&&e.createElement(tt.g,{json:m}))))))},ps=t=>({title:(0,u.css)`
      display: flex;
      padding: 4px 8px 4px 8px;
      position: relative;
      height: 35px;
      border-radius: 4px 4px 0 0;
      flex-wrap: nowrap;
      justify-content: space-between;
      align-items: center;
    `,name:(0,u.css)`
      font-weight: ${t.typography.fontWeightMedium};
      color: ${t.colors.primary.text};
    `,iconRow:(0,u.css)`
      display: flex;
    `,icon:(0,u.css)`
      background: transparent;
      border: none;
      box-shadow: none;
      cursor: pointer;
      color: ${t.colors.text.secondary};
      margin-left: ${t.spacing(1)};
      &:hover {
        color: ${t.colors.text};
      }
    `,editor:(0,u.css)``,debugWrapper:(0,u.css)`
      display: flex;
      flex-direction: row;
    `,debugSeparator:(0,u.css)`
      width: 48px;
      min-height: 300px;
      display: flex;
      align-items: center;
      align-self: stretch;
      justify-content: center;
      margin: 0 ${t.spacing(.5)};
      color: ${t.colors.primary.text};
    `,debugTitle:(0,u.css)`
      padding: ${t.spacing(1)} ${t.spacing(.25)};
      font-family: ${t.typography.fontFamilyMonospace};
      font-size: ${t.typography.bodySmall.fontSize};
      color: ${t.colors.text};
      border-bottom: 1px solid ${t.colors.border.weak};
      flex-grow: 0;
      flex-shrink: 1;
    `,debug:(0,u.css)`
      margin-top: ${t.spacing(1)};
      padding: 0 ${t.spacing(1,1,1)};
      border: 1px solid ${t.colors.border.weak};
      background: ${t.isLight?t.v1.palette.white:t.v1.palette.gray05};
      border-radius: ${t.shape.radius.default};
      width: 100%;
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-self: stretch;
    `,debugJson:(0,u.css)`
      flex-grow: 1;
      height: 100%;
      overflow: hidden;
      padding: ${t.spacing(.5)};
    `});var ms=o(48529),gs=o(2592);const hs=({isOpen:t,onCloseClick:n,transformer:a})=>{const{transformation:{name:s},help:r}=a,i=r||(0,gs.X)(),c=`Transformation help - ${s}`;return e.createElement(Y.u,{title:c,isOpen:t,onClickBackdrop:()=>n(!1),onDismiss:()=>n(!1)},e.createElement(ms.h,{markdown:i,styleOverrides:{borderTop:"2px solid"}}))};var fs=o(44818);const vs=({index:t,data:n,config:a,onChange:s})=>{const r=(0,T.wW)(Es),i=(0,e.useMemo)(()=>({context:{data:n.series},showTopic:!0,showFilter:a.topic!==$e.w5.Annotations,source:[{value:$e.w5.Series,label:"Query results"},{value:$e.w5.Annotations,label:"Annotation data"}]}),[n,a.topic]);return e.createElement("div",{className:r.wrapper},e.createElement(ie.g,{label:"Apply transformation to"},e.createElement(e.Fragment,null,i.showTopic&&e.createElement(Ve.Ph,{isClearable:!0,options:i.source,value:i.source.find(c=>c.value===a.topic),placeholder:i.source[0].label,className:r.padded,onChange:c=>{s(t,{...a,topic:c?.value})}}),i.showFilter&&e.createElement(fs.M,{value:a.filter,context:i.context,item:{},onChange:c=>s(t,{...a,filter:c})}))))},Es=t=>{const n=t.shape.radius.default;return{wrapper:(0,u.css)({padding:t.spacing(2),border:`2px solid ${t.colors.background.secondary}`,borderTop:"none",borderRadius:`0 0 ${n} ${n}`,position:"relative",top:"-4px"}),padded:(0,u.css)({marginBottom:t.spacing(1)})}},ys=({onRemove:t,index:n,id:a,data:s,configs:r,uiConfig:i,onChange:c})=>{const[l,d]=(0,at.Z)(!1),[p,m]=(0,at.Z)(!1),[g,h]=(0,at.Z)(!1),f=!!r[n].transformation.disabled,v=r[n].transformation.topic,C=r[n].transformation.filter!=null||v!=null,I=C||s.series.length>1||(s.annotations?.length??0)>0,N=(0,e.useCallback)(S=>{const z=r[S].transformation;c(S,{...z,disabled:z.disabled?void 0:!0})},[c,r]),P=(0,e.useCallback)(()=>{let S={...r[n].transformation};S.filter?delete S.filter:S.filter={id:ls.E4.byRefId,options:""},c(n,S)},[c,n,r]),G=(0,e.useCallback)((S,z,ce)=>it=>{let de="panel_editor_tabs_transformations_toggle";H.default.featureToggles.transformationsRedesign&&(de="transformations_redesign_"+de),(0,re.ff)(de,{action:ce?"off":"on",toggleId:z,transformationId:r[n].transformation.id}),S(it)},[r,n]),R=()=>e.createElement(e.Fragment,null,i.state&&e.createElement(rt.u,{state:i.state}),e.createElement(ye.V,{title:"Show transform help",icon:"info-circle",onClick:G(h,"help",g),active:g}),I&&e.createElement(ye.V,{title:"Filter",icon:"filter",onClick:G(P,"filter",C),active:C}),e.createElement(ye.V,{title:"Debug",icon:"bug",onClick:G(m,"debug",p),active:p}),e.createElement(ye.V,{title:"Disable transformation",icon:f?"eye-slash":"eye",onClick:G(()=>N(n),"disabled",f),active:f}),e.createElement(ye.y,{title:"Remove",icon:"trash-alt",onClick:()=>H.default.featureToggles.transformationsRedesign?d(!0):t(n)}),H.default.featureToggles.transformationsRedesign&&e.createElement(Ae.s,{isOpen:l,title:`Delete ${i.name}?`,body:"Note that removing one transformation may break others. If there is only a single transformation, you will go back to the main selection screen.",confirmText:"Delete",onConfirm:()=>{d(!1),t(n)},onDismiss:()=>d(!1)}));return e.createElement(e.Fragment,null,e.createElement(cs.t,{id:a,index:n,title:`${n+1} - ${i.name}`,draggable:!0,actions:R,disabled:f,expanderMessages:{close:"Collapse transformation row",open:"Expand transformation row"}},C&&e.createElement(vs,{index:n,config:r[n].transformation,data:s,onChange:c}),e.createElement(us,{debugMode:p,index:n,data:v===$e.w5.Annotations?s.annotations??[]:s.series,configs:r,uiConfig:i,onChange:c,toggleShowDebug:m})),e.createElement(hs,{transformer:i,isOpen:g,onCloseClick:h}))},bs=({data:t,onChange:n,onRemove:a,configs:s})=>e.createElement(e.Fragment,null,s.map((r,i)=>{const c=Me.Z.getIfExists(r.transformation.id);return c?e.createElement(ys,{index:i,id:`${r.id}`,key:`${r.id}`,data:t,configs:s,uiConfig:c,onRemove:a,onChange:n}):null}));var Le=o(60496),ae=o(96305);const Cs={[Le.x.Transformations]:"https://grafana.com/docs/grafana/latest/panels/transformations",[Le.x.FieldConfig]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/",[Le.x.FieldConfigOverrides]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/#override-a-field"},Ts=t=>Cs[t],Ss="dashboard.components.TransformationEditor.featureInfoBox.isDismissed";function Ps(t){const{noTransforms:n,search:a,xforms:s,onSearchChange:r,onSearchKeyDown:i,onTransformationAdd:c,suffix:l}=t;return e.createElement($.wc,null,n&&e.createElement($.W2,{grow:1},e.createElement(pt.G,{storageKey:Ss,defaultValue:!1},(d,p)=>d?null:e.createElement(_.b,{title:"Transformations",severity:"info",onRemove:()=>{p(!0)}},e.createElement("p",null,"Transformations allow you to join, calculate, re-order, hide, and rename your query results before they are visualized. ",e.createElement("br",null),"Many transforms are not suitable if you're using the Graph visualization, as it currently only supports time series data. ",e.createElement("br",null),"It can help to switch to the Table visualization to understand what a transformation is doing."," "),e.createElement("a",{href:Ts(Le.x.Transformations),className:"external-link",target:"_blank",rel:"noreferrer"},"Read more")))),e.createElement(se.I,{"data-testid":y.wl.components.Transforms.searchInput,value:a??"",autoFocus:!n,placeholder:"Search for transformation",onChange:r,onKeyDown:i,suffix:l}),s.map(d=>e.createElement(xs,{key:d.name,transform:d,onClick:()=>{c({value:d.id})}})))}function xs({transform:t,onClick:n}){const a=(0,T.wW)(ws);return e.createElement(ae.Z,{className:a.card,"data-testid":y.wl.components.TransformTab.newTransform(t.name),onClick:n},e.createElement(ae.Z.Heading,null,t.name),e.createElement(ae.Z.Description,null,t.description),t.state&&e.createElement(ae.Z.Tags,null,e.createElement(rt.u,{state:t.state})))}function ws(t){return{card:(0,u.css)({margin:"0",padding:`${t.spacing(1)}`})}}var Ds=o(56528),A=o(20447),Is=o(65050),Ns=o(20003);const Os=[["viewAll","View all"],...Object.entries(Ns.Vx)];function Rs(t){const n=(0,T.wW)(As),{noTransforms:a,suffix:s,setState:r,xforms:i,search:c,onSearchChange:l,onSearchKeyDown:d,showIllustrations:p,onTransformationAdd:m,selectedFilter:g,data:h}=t;return e.createElement(we.d,{size:"md",onClose:()=>r({showPicker:!1}),title:"Add another transformation"},e.createElement("div",{className:n.searchWrapper},e.createElement(se.I,{"data-testid":y.wl.components.Transforms.searchInput,className:n.searchInput,value:c??"",autoFocus:!a,placeholder:"Search for transformation",onChange:l,onKeyDown:d,suffix:s}),e.createElement("div",{className:n.showImages},e.createElement("span",{className:n.illustationSwitchLabel},"Show images")," ",e.createElement(te.r,{value:p,onChange:()=>r({showIllustrations:!p})}))),e.createElement("div",{className:n.filterWrapper},Os.map(([f,v])=>e.createElement(Is.B,{key:f,onClick:()=>r({selectedFilter:f}),label:v,selected:g===f}))),e.createElement(Ms,{showIllustrations:p,transformations:i,data:h,onClick:f=>{m({value:f})}}))}function As(t){return{showImages:(0,u.css)({flexBasis:"0",display:"flex",gap:"8px",alignItems:"center"}),pickerInformationLine:(0,u.css)({fontSize:"16px",marginBottom:`${t.spacing(2)}`}),pickerInformationLineHighlight:(0,u.css)({verticalAlign:"middle"}),searchWrapper:(0,u.css)({display:"flex",flexWrap:"wrap",columnGap:"27px",rowGap:"16px",width:"100%"}),searchInput:(0,u.css)({flexGrow:"1",width:"initial"}),illustationSwitchLabel:(0,u.css)({whiteSpace:"nowrap"}),filterWrapper:(0,u.css)({padding:`${t.spacing(1)} 0`,display:"flex",flexWrap:"wrap",rowGap:`${t.spacing(1)}`,columnGap:`${t.spacing(.5)}`})}}function Ms({showIllustrations:t,transformations:n,onClick:a,data:s}){const r=(0,T.wW)($s);return e.createElement("div",{className:r.grid},n.map(i=>{let c=Ds.s.Applicable;i.transformation.isApplicable!==void 0&&(c=i.transformation.isApplicable(s));const l=c>0;let d=null;i.transformation.isApplicableDescription!==void 0&&(typeof i.transformation.isApplicableDescription=="function"?d=i.transformation.isApplicableDescription(s):d=i.transformation.isApplicableDescription);let p=r.newCard;return l||(p=(0,u.cx)(r.newCard,r.cardDisabled)),e.createElement(ae.Z,{className:p,"data-testid":y.wl.components.TransformTab.newTransform(i.name),onClick:()=>a(i.id),key:i.id},e.createElement(ae.Z.Heading,{className:r.heading},e.createElement("span",null,i.name),e.createElement("span",{className:r.pluginStateInfoWrapper},e.createElement(rt.u,{state:i.state}))),e.createElement(ae.Z.Description,{className:r.description},e.createElement("span",null,Ws(i.id)),t&&e.createElement("span",null,e.createElement("img",{className:r.image,src:Ls(i.id,!l),alt:i.name})),!l&&d!==null&&e.createElement(ve.h,{className:r.cardApplicableInfo,name:"info-circle",tooltip:d})))}))}function $s(t){return{heading:(0,u.css)`
            font-weight: 400,
            > button: {
                width: '100%',
                display: 'flex',
                justify-content: 'space-between',
                align-items: 'center',
                flex-wrap: 'no-wrap',
        },`,description:(0,u.css)({fontSize:"12px",display:"flex",flexDirection:"column",justifyContent:"space-between"}),image:(0,u.css)({display:"block",maxEidth:"100%`",marginTop:`${t.spacing(2)}`}),grid:(0,u.css)({display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gridAutoRows:"1fr",gap:`${t.spacing(2)} ${t.spacing(1)}`,width:"100%"}),cardDisabled:(0,u.css)({backgroundColor:"rgb(204, 204, 220, 0.045)",color:`${t.colors.text.disabled} !important`}),cardApplicableInfo:(0,u.css)({position:"absolute",bottom:`${t.spacing(1)}`,right:`${t.spacing(1)}`}),newCard:(0,u.css)({gridTemplateRows:"min-content 0 1fr 0"}),pluginStateInfoWrapper:(0,u.css)({marginLeft:"5px"})}}const Ls=(t,n)=>{let a=null;return n?a="disabled":a=H.default.theme2.isDark?"dark":"light",`public/img/transformations/${a}/${t}.svg`},Fs={[A.W.concatenate]:"Combine all fields into a single frame.",[A.W.configFromData]:"Set unit, min, max and more.",[A.W.fieldLookup]:"Use a field value to lookup countries, states, or airports.",[A.W.filterFieldsByName]:"Remove parts of the query results using a regex pattern.",[A.W.filterByRefId]:"Remove rows from the data based on origin query",[A.W.filterByValue]:"Remove rows from the query results using user-defined filters.",[A.W.groupBy]:"Group data by a field value and create aggregate data.",[A.W.groupingToMatrix]:"Summarize and reorganize data based on three fields.",[A.W.joinByField]:"Combine rows from 2+ tables, based on a related field.",[A.W.labelsToFields]:"Group series by time and return labels or tags as fields.",[A.W.merge]:"Merge multiple series. Values will be combined into one row.",[A.W.organize]:"Re-order, hide, or rename fields.",[A.W.partitionByValues]:"Split a one-frame dataset into multiple series.",[A.W.prepareTimeSeries]:"Stretch data frames from the wide format into the long format.",[A.W.reduce]:"Reduce all rows or data points to a single value (ex. max, mean).",[A.W.renameByRegex]:"Rename parts of the query results using a regular expression and replacement pattern.",[A.W.seriesToRows]:"Merge multiple series. Return time, metric and values as a row."},Ws=t=>Fs[t]||Me.Z.getIfExists(t)?.description||"",pn="viewAll";class Us extends e.PureComponent{constructor(n){super(n),this.onSearchChange=r=>{this.setState({search:r.target.value})},this.onSearchKeyDown=r=>{if(r.key==="Enter"){const{search:i}=this.state;if(i){const c=i.toLowerCase(),l=Me.Z.list().filter(d=>(d.name+d.description).toLowerCase().indexOf(c)>=0);l.length>0&&this.onTransformationAdd({value:l[0].id})}}else r.keyCode===27&&(this.setState({search:"",showPicker:!1}),r.stopPropagation())},this.getTransformationNextId=r=>{const{transformations:i}=this.state;let c=0;const l=i.filter(d=>d.id.startsWith(r)).map(d=>d.id);return l.length!==0&&(c=Math.max(...l.map(d=>parseInt(d.match(/\d+/)[0],10)))+1),`${r}-${c}`},this.onTransformationAdd=r=>{let i="panel_editor_tabs_transformations_management";H.default.featureToggles.transformationsRedesign&&(i="transformations_redesign_"+i),(0,re.ff)(i,{action:"add",transformationId:r.value});const{transformations:c}=this.state,l=this.getTransformationNextId(r.value);this.setState({search:"",showPicker:!1}),this.onChange([...c,{id:l,transformation:{id:r.value,options:{}}}])},this.onTransformationChange=(r,i)=>{const{transformations:c}=this.state,l=Array.from(c);let d="panel_editor_tabs_transformations_management";H.default.featureToggles.transformationsRedesign&&(d="transformations_redesign_"+d),(0,re.ff)(d,{action:"change",transformationId:l[r].transformation.id}),l[r].transformation=i,this.onChange(l)},this.onTransformationRemove=r=>{const{transformations:i}=this.state,c=Array.from(i);let l="panel_editor_tabs_transformations_management";H.default.featureToggles.transformationsRedesign&&(l="transformations_redesign_"+l),(0,re.ff)(l,{action:"remove",transformationId:c[r].transformation.id}),c.splice(r,1),this.onChange(c)},this.onTransformationRemoveAll=()=>{this.onChange([]),this.setState({showRemoveAllModal:!1})},this.onDragEnd=r=>{const{transformations:i}=this.state;if(!r||!r.destination)return;const c=r.source.index,l=r.destination.index;if(c===l)return;const d=Array.from(i),[p]=d.splice(c,1);d.splice(l,0,p),this.onChange(d)},this.renderEmptyMessage=()=>e.createElement(is.x,{alignItems:"center",padding:4},e.createElement(ue.K,{direction:"column",alignItems:"center",gap:2},e.createElement(un.x,{element:"h3",textAlignment:"center"},e.createElement(ge.cC,{key:"transformations.empty.add-transformation-header"},"Start transforming data")),e.createElement(un.x,{element:"p",textAlignment:"center","data-testid":y.wl.components.Transforms.noTransformationsMessage},e.createElement(ge.cC,{key:"transformations.empty.add-transformation-body"},"Transformations allow data to be changed in various ways before your visualization is shown.",e.createElement("br",null),"This includes joining data together, renaming fields, making calculations, formatting data for display, and more.")),e.createElement(w.zx,{icon:"plus",variant:"primary",size:"md",onClick:()=>{this.setState({showPicker:!0})},"data-testid":y.wl.components.Transforms.addTransformationButton},"Add transformation"))),this.renderTransformationEditors=()=>{const{data:r,transformations:i}=this.state;return e.createElement(dn.Z5,{onDragEnd:this.onDragEnd},e.createElement(dn.bK,{droppableId:"transformations-list",direction:"vertical"},c=>e.createElement("div",{ref:c.innerRef,...c.droppableProps},e.createElement(bs,{configs:i,data:r,onRemove:this.onTransformationRemove,onChange:this.onTransformationChange}),c.placeholder)))};const a=n.panel.transformations||[],s=this.buildTransformationIds(a);this.state={transformations:a.map((r,i)=>({transformation:r,id:s[i]})),data:{series:[]},search:"",selectedFilter:pn,showIllustrations:!0}}buildTransformationIds(n){const a={},s=[];for(let r=0;r<n.length;r++){const i=n[r];a[i.id]===void 0?a[i.id]=0:a[i.id]+=1,s.push(`${n[r].id}-${a[n[r].id]}`)}return s}componentDidMount(){this.subscription=this.props.panel.getQueryRunner().getData({withTransforms:!1,withFieldConfig:!1}).subscribe({next:n=>this.setState({data:n})})}componentWillUnmount(){this.subscription&&this.subscription.unsubscribe()}componentDidUpdate(n,a){if(H.default.featureToggles.transformationsRedesign){const r=!(a.transformations.length>0)||a.showPicker,c=!(this.state.transformations.length>0)||this.state.showPicker;if(r!==c){const l=Math.random()/2;this.setState({scrollTop:c?l:Number.MAX_SAFE_INTEGER})}}}onChange(n){this.setState({transformations:n}),this.props.panel.setTransformations(n.map(a=>a.transformation))}renderTransformsPicker(){let{showPicker:n}=this.state;const{transformations:a,search:s}=this.state,{transformationsRedesign:r}=H.default.featureToggles,i=!a?.length,c=a.length>0;let l=null,d=Me.Z.list().sort((h,f)=>h.name>f.name?1:f.name>h.name?-1:0);if(!r&&i&&(n=!0),this.state.selectedFilter!==pn&&(d=d.filter(h=>h.categories&&this.state.selectedFilter&&h.categories.has(this.state.selectedFilter))),s){const h=s.toLowerCase(),f=d.filter(v=>(v.name+v.description).toLowerCase().indexOf(h)>=0);l=e.createElement(e.Fragment,null,f.length," / ",d.length," \xA0\xA0",e.createElement(ve.h,{name:"times",onClick:()=>{this.setState({search:""})},tooltip:"Clear search"})),d=f}!l&&n&&!i&&(l=e.createElement(ve.h,{name:"times",onClick:()=>{this.setState({showPicker:!1})},tooltip:"Close picker"}));let p=null,m=null;r?(p=e.createElement(Rs,{noTransforms:i,search:s,suffix:l,xforms:d,setState:this.setState.bind(this),onSearchChange:this.onSearchChange,onSearchKeyDown:this.onSearchKeyDown,onTransformationAdd:this.onTransformationAdd,data:this.state.data.series,selectedFilter:this.state.selectedFilter,showIllustrations:this.state.showIllustrations}),m=e.createElement(e.Fragment,null,e.createElement(w.zx,{icon:"times",variant:"secondary",onClick:()=>this.setState({showRemoveAllModal:!0}),style:{marginLeft:this.props.theme.spacing.md}},"Delete all transformations"),e.createElement(Ae.s,{isOpen:!!this.state.showRemoveAllModal,title:"Delete all transformations?",body:"By deleting all transformations, you will go back to the main selection screen.",confirmText:"Delete all",onConfirm:()=>this.onTransformationRemoveAll(),onDismiss:()=>this.setState({showRemoveAllModal:!1})}))):p=e.createElement(Ps,{noTransforms:i,search:s,suffix:l,xforms:d,onSearchChange:this.onSearchChange,onSearchKeyDown:this.onSearchKeyDown,onTransformationAdd:this.onTransformationAdd});const g=e.createElement(jt.h,null,e.createElement(w.zx,{icon:"plus",variant:"secondary",onClick:()=>{this.setState({showPicker:!0})},"data-testid":y.wl.components.Transforms.addTransformationButton},"Add another transformation"),m);return e.createElement(e.Fragment,null,n&&p,r&&c&&g||!r&&!n&&c&&g)}render(){const{panel:{alert:n}}=this.props,{transformations:a}=this.state,s=a.length>0;if(n){const r=s?"Transformations can't be used on a panel with alerts":"Transformations can't be used on a panel with existing alerts";return e.createElement(en,{message:r})}return e.createElement(oe.$,{scrollTop:this.state.scrollTop,autoHeightMin:"100%"},e.createElement($.W2,{padding:"lg"},e.createElement("div",{"data-testid":y.wl.components.TransformTab.content},!s&&H.default.featureToggles.transformationsRedesign&&this.renderEmptyMessage(),s&&this.renderTransformationEditors(),this.renderTransformsPicker())))}}const zs=(0,T.Zz)(Us);var Bs=o(44992),Vs=o(66051),ot=o(97001),ks=o(64571);class Hs extends e.PureComponent{constructor(n){super(n),this.updateLastUsedDatasource=a=>{(0,Vs.rJ)(a)},this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{D.E1.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=a=>{const{panel:s}=this.props;s.updateQueries(a),a.dataSource.uid!==s.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(n){const a=n.datasource??{default:!0},s=(0,ot.ak)().getInstanceSettings(a);return this.updateLastUsedDatasource(a),{cacheTimeout:s?.meta.queryOptions?.cacheTimeout?n.cacheTimeout:void 0,dataSource:{default:s?.isDefault,type:s?.type,uid:s?.uid},queryCachingTTL:s?.cachingConfig?.enabled?n.queryCachingTTL:void 0,queries:n.targets,maxDataPoints:n.maxDataPoints,minInterval:n.interval,timeRange:{from:n.timeFrom,shift:n.timeShift,hide:n.hideTimeOverride}}}async componentDidMount(){const{panel:n}=this.props;if(!n.datasource){let a;const s=(0,Re.h4)().getCurrent()?.uid??"",r=(0,ft.$N)(s);r?.datasourceUid!==null&&(a=(0,ot.ak)().getInstanceSettings(r?.datasourceUid)),a||(a=(0,ot.ak)().getInstanceSettings(null)),n.datasource=(0,Bs.iU)(a),this.forceUpdate()}}render(){const{panel:n}=this.props;if(!n.datasource)return null;const a=this.buildQueryOptions(n);return e.createElement(ks.D,{options:a,queryRunner:n.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const mn=e.memo(({panel:t,dashboard:n,tabs:a,onChangeTab:s})=>{const r=(0,_t.N)(),i=(0,T.wW)(js),c=(0,e.useCallback)(d=>{let p="panel_editor_tabs_changed";b.config.featureToggles.transformationsRedesign&&(p="transformations_redesign_"+p),d.active||(0,re.ff)(p,{tab_id:d.id}),s(d)},[s]);(0,e.useEffect)(()=>{const d=new Ot.w0;return d.add(t.events.subscribe(J.pO,r)),d.add(t.events.subscribe(J.Xw,r)),()=>d.unsubscribe()},[t,n,r]);const l=a.find(d=>d.active);return a.length===0?null:e.createElement("div",{className:i.wrapper},e.createElement(Be.J,{className:i.tabBar,hideBorder:!0},a.map(d=>d.id===O.Ip.Alert?Gs(d,t,n,c):e.createElement(pe.O,{key:d.id,label:d.text,active:d.active,onChangeTab:()=>c(d),icon:(0,_e.toIconName)(d.icon),counter:gn(t,d)}))),e.createElement(Ur.I,{className:i.tabContent},l.id===O.Ip.Query&&e.createElement(Hs,{panel:t,queries:t.targets}),l.id===O.Ip.Alert&&e.createElement(ss,{panel:t,dashboard:n}),l.id===O.Ip.Transform&&e.createElement(zs,{panel:t})))});mn.displayName="PanelEditorTabs";function gn(t,n){switch(n.id){case O.Ip.Query:return t.targets.length;case O.Ip.Alert:return t.alert?1:0;case O.Ip.Transform:return(t.getTransformations()??[]).length}return null}function Gs(t,n,a,s){return!b.config.alertingEnabled&&!b.config.unifiedAlertingEnabled?null:b.config.unifiedAlertingEnabled?e.createElement(os,{key:t.id,label:t.text,active:t.active,onChangeTab:()=>s(t),icon:(0,_e.toIconName)(t.icon),panel:n,dashboard:a}):b.config.alertingEnabled?e.createElement(pe.O,{key:t.id,label:t.text,active:t.active,onChangeTab:()=>s(t),icon:(0,_e.toIconName)(t.icon),counter:gn(n,t)}):null}const js=t=>({wrapper:(0,u.css)`
      display: flex;
      flex-direction: column;
      height: 100%;
    `,tabBar:(0,u.css)`
      padding-left: ${t.spacing(2)};
    `,tabContent:(0,u.css)`
      padding: 0;
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
      background: ${t.colors.background.primary};
      border: 1px solid ${t.components.panel.borderColor};
      border-left: none;
      border-bottom: none;
      border-top-right-radius: ${t.shape.borderRadius(1.5)};
    `});var Ks=o(22813),Js=o(60971);const Zs=(t,n)=>{const a=t.panelEditor.getPanel(),s=(0,Pe.i)(t,a);return{panel:a,plugin:s?.plugin,instanceState:s?.instanceState,initDone:t.panelEditor.initDone,uiState:t.panelEditor.ui,tableViewEnabled:t.panelEditor.tableViewEnabled,variables:(0,Ze.gt)(n.dashboard.uid,t)}},Qs={initPanelEditor:zn,discardPanelChanges:Ct,updatePanelEditorUIState:ze,updateTimeZoneForSession:Pa.YT,toggleTableView:Z.OT,notifyApp:lt.$l},Ys=(0,x.connect)(Zs,Qs);class Xs extends e.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{D.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{ya.h$.publish(new J.Dn({component:Ia.d,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,fe.V)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=n=>{D.E1.partial({tab:n.id})},this.onFieldConfigChange=n=>{this.props.panel.updateFieldConfig({...n})},this.onPanelOptionsChanged=n=>{this.props.panel.updateOptions(n)},this.onPanelConfigChanged=(n,a)=>{this.props.panel.setProperty(n,a),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=n=>{const{updatePanelEditorUIState:a}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),a({mode:n})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{D.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:n,initDone:a}=this.props;a&&!this.eventSubs&&(this.eventSubs=new Ot.w0,this.eventSubs.add(n.events.subscribe(J.Wj,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(n,a){const{dashboard:s,panel:r,uiState:i,tableViewEnabled:c,theme:l}=this.props;return e.createElement("div",{className:n.mainPaneWrapper,key:"panel"},this.renderPanelToolbar(n),e.createElement("div",{className:n.panelWrapper},e.createElement(xe.Z,null,({width:d,height:p})=>{if(d<3||p<3)return null;if(a&&(p-=l.spacing.gridSize*2),c)return e.createElement(Wr,{width:d,height:p,panel:r,dashboard:s});const m=(0,Js.jF)(i.mode,d,p,r);return e.createElement("div",{className:n.centeringContainer,style:{width:d,height:p}},e.createElement("div",{style:m,"data-panelid":r.id},e.createElement(wa.l,{key:r.key,stateKey:r.key,dashboard:s,panel:r,isEditing:!0,isViewing:!1,lazy:!1,width:m.width,height:m.height})))})))}renderPanelAndEditor(n,a){const{panel:s,dashboard:r,plugin:i,tab:c}=this.props,l=(0,Ks.b)(c,i),d=l.length===0,p=this.renderPanel(a,d);return l.length===0?e.createElement("div",{className:a.onlyPanel},p):e.createElement(At.U,{splitOrientation:"horizontal",maxSize:-200,paneSize:n.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:m=>{m&&ze({topPaneSize:m/window.innerHeight})}},p,e.createElement("div",{className:a.tabsWrapper,"aria-label":y.wl.components.PanelEditor.DataPane.content,key:"panel-editor-tabs"},e.createElement(mn,{key:s.key,panel:s,dashboard:r,tabs:l,onChangeTab:this.onChangeTab})))}renderTemplateVariables(n){const{variables:a}=this.props;return a.length?e.createElement("div",{className:n.variablesWrapper},e.createElement(Mt,{variables:a})):null}renderPanelToolbar(n){const{dashboard:a,uiState:s,variables:r,updateTimeZoneForSession:i,panel:c,tableViewEnabled:l}=this.props;return e.createElement("div",{className:n.panelToolbar},e.createElement($.Lh,{justify:r.length>0?"space-between":"flex-end",align:"flex-start"},this.renderTemplateVariables(n),e.createElement(ue.K,{gap:1},e.createElement(te.x,{label:"Table view",showLabel:!0,id:"table-view",value:l,onClick:this.onToggleTableView,"aria-label":y.wl.components.PanelEditor.toggleTableView}),e.createElement(Ne.S,{value:s.mode,options:O.d7,onChange:this.onDisplayModeChange}),e.createElement(Da.C,{dashboard:a,onChangeTimeZone:i,isOnCanvas:!0}),!s.isPanelOptionsVisible&&e.createElement(Xe,{panel:c}))))}renderEditorActions(){const n="sm";let a=[e.createElement(w.zx,{onClick:this.onDiscard,title:"Undo all changes",key:"discard",size:n,variant:"destructive",fill:"outline"},"Discard"),this.props.panel.libraryPanel?e.createElement(w.zx,{onClick:this.onSaveLibraryPanel,variant:"primary",size:n,title:"Apply changes and save library panel",key:"save-panel"},"Save library panel"):e.createElement(w.zx,{onClick:this.onSaveDashboard,title:"Apply changes and save dashboard",key:"save",size:n,variant:"secondary"},"Save"),e.createElement(w.zx,{onClick:this.onBack,variant:"primary",title:"Apply changes and go back to dashboard","data-testid":y.wl.components.PanelEditor.applyButton,key:"apply",size:n},"Apply")];return this.props.panel.libraryPanel&&(a.splice(1,0,e.createElement(Et.JY,{key:"unlink-controller"},({showModal:s,hideModal:r})=>e.createElement(Ke.h,{onClick:()=>{s(xa.i,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:r,isOpen:!0})},title:"Disconnects this panel from the library panel so that you can edit it regularly.",key:"unlink"},"Unlink"))),a.pop()),a}renderOptionsPane(){const{plugin:n,dashboard:a,panel:s,instanceState:r}=this.props;return n?e.createElement(Or,{plugin:n,dashboard:a,panel:s,instanceState:r,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):e.createElement("div",null)}render(){const{initDone:n,uiState:a,theme:s,sectionNav:r,pageNav:i,className:c,updatePanelEditorUIState:l}=this.props,d=_s(s,this.props);return n?e.createElement(F.T,{navModel:r,pageNav:i,"aria-label":y.wl.components.PanelEditor.General.content,layout:M.Q.Custom,className:c},e.createElement(Ea.A,{actions:e.createElement(va.R,{alignment:"right"},this.renderEditorActions())}),e.createElement("div",{className:d.wrapper},e.createElement("div",{className:d.verticalSplitPanesWrapper},a.isPanelOptionsVisible?e.createElement(At.U,{splitOrientation:"vertical",maxSize:-300,paneSize:a.rightPaneSize,primary:"second",onDragFinished:p=>{p&&l({rightPaneSize:p/window.innerWidth})}},this.renderPanelAndEditor(a,d),this.renderOptionsPane()):this.renderPanelAndEditor(a,d)),this.state.showSaveLibraryPanelModal&&e.createElement(yt,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel}))):null}}const qs=(0,T.HE)(Ys(Xs)),_s=(0,Rt.B)((t,n)=>{const{uiState:a}=n,s=t.spacing(2);return{wrapper:(0,u.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:t.spacing(2)}),verticalSplitPanesWrapper:(0,u.css)`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      position: relative;
    `,mainPaneWrapper:(0,u.css)`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      padding-right: ${a.isPanelOptionsVisible?0:s};
    `,variablesWrapper:(0,u.css)`
      label: variablesWrapper;
      display: flex;
      flex-grow: 1;
      flex-wrap: wrap;
      gap: ${t.spacing(1,2)};
    `,panelWrapper:(0,u.css)`
      flex: 1 1 0;
      min-height: 0;
      width: 100%;
      padding-left: ${s};
    `,tabsWrapper:(0,u.css)`
      height: 100%;
      width: 100%;
    `,panelToolbar:(0,u.css)`
      display: flex;
      padding: 0 0 ${s} ${s};
      justify-content: space-between;
      flex-wrap: wrap;
    `,angularWarning:(0,u.css)`
      display: flex;
      height: theme.spacing(4);
      align-items: center;
    `,toolbarLeft:(0,u.css)`
      padding-left: ${t.spacing(1)};
    `,centeringContainer:(0,u.css)`
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      flex-direction: column;
    `,onlyPanel:(0,u.css)`
      height: 100%;
      position: absolute;
      overflow: hidden;
      width: 100%;
    `}});var eo=o(64878),to=o(47701),no=o(41164),ao=o(23913),ro=o(34576);const so=({annotation:t,events:n,onEnabledChanged:a})=>{const[s,r]=(0,e.useState)(!1),i=(0,T.wW)(oo),c=()=>(0,ro.kt)().cancel(t);return(0,e.useEffect)(()=>{const l=n.getStream(J.z).subscribe({next:p=>{p.payload===t&&r(!0)}}),d=n.getStream(J.RB).subscribe({next:p=>{p.payload===t&&r(!1)}});return()=>{l.unsubscribe(),d.unsubscribe()}}),e.createElement("div",{key:t.name,className:i.annotation},e.createElement(to.Z,null,e.createElement(no._,{label:t.name,disabled:s,"data-testid":y.wl.pages.Dashboard.SubMenu.Annotations.annotationLabel(t.name)},e.createElement(te.x,{label:t.name,value:t.enable,onChange:()=>a(t),disabled:s,"data-testid":y.wl.pages.Dashboard.SubMenu.Annotations.annotationToggle(t.name)})),e.createElement("div",{className:i.indicator},e.createElement(ao.T,{loading:s,onCancel:c}))))};function oo(t){return{annotation:(0,u.css)`
      display: inline-block;
      margin-right: ${t.spacing(1)};

      .fa-caret-down {
        font-size: 75%;
        padding-left: ${t.spacing(1)};
      }

      .gf-form-inline .gf-form {
        margin-bottom: 0;
      }
    `,indicator:(0,u.css)`
      align-self: center;
      padding: 0 ${t.spacing(.5)};
    `}}const io=({annotations:t,onAnnotationChanged:n,events:a})=>{const[s,r]=(0,e.useState)([]);return(0,e.useEffect)(()=>{r(t.filter(i=>i.hide!==!0))},[t]),s.length===0?null:e.createElement("div",{"data-testid":y.wl.pages.Dashboard.SubMenu.Annotations.annotationsWrapper},s.map(i=>e.createElement(so,{events:a,annotation:i,onEnabledChanged:n,key:i.name})))};var lo=o(26124),co=o(77901),uo=o(93466),hn=o(97919);const po=({dashboard:t,links:n})=>{const a=(0,_t.N)();return(0,lo.Z)(()=>{const s=t.events.subscribe(qt.md,a);return()=>s.unsubscribe()}),n.length?e.createElement(e.Fragment,null,n.map((s,r)=>{const i=(0,Ye.Bq)().getAnchorInfo(s),c=`${s.title}-$${r}`;if(s.type==="dashboards")return e.createElement(hn.Ul,{key:c,link:s,linkInfo:i,dashboardUID:t.uid});const l=uo.xy[s.icon],d=e.createElement(hn.MM,{href:(0,co.Nm)(i.href),target:s.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":y.wl.components.DashboardLinks.link,icon:l},i.title);return e.createElement("div",{key:c,"data-testid":y.wl.components.DashboardLinks.container},s.tooltip?e.createElement(he.u,{content:i.tooltip},d):d)})):null};class mo extends e.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=n=>{for(let a=0;a<this.props.dashboard.annotations.list.length;a++){const s=this.props.dashboard.annotations.list[a];if(s.name===n.name){s.enable=!s.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()},this.disableSubmitOnEnter=n=>{n.preventDefault()}}render(){const{dashboard:n,variables:a,links:s,annotations:r,theme:i}=this.props,c=ho(i);if(!n.isSubMenuVisible())return null;const l=n.meta.isSnapshot??!1;return e.createElement("div",{className:c.submenu},e.createElement("form",{"aria-label":"Template variables",className:c.formStyles,onSubmit:this.disableSubmitOnEnter},e.createElement(Mt,{variables:a,readOnly:l})),e.createElement(io,{annotations:r,onAnnotationChanged:this.onAnnotationStateChanged,events:n.events}),e.createElement("div",{className:c.spacer}),n&&e.createElement(po,{dashboard:n,links:s}))}}const go=(t,n)=>{const{uid:a}=n.dashboard,s=(0,Ze.AE)(a,t);return{variables:(0,Ze.IV)(a,s.variables)}},ho=(0,Rt.B)(t=>({formStyles:(0,u.css)`
      display: flex;
      flex-wrap: wrap;
      display: contents;
    `,submenu:(0,u.css)`
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      align-content: flex-start;
      align-items: flex-start;
      gap: ${t.spacing(1)} ${t.spacing(2)};
      padding: 0 0 ${t.spacing(1)} 0;
    `,spacer:(0,u.css)({flexGrow:1})})),fn=(0,T.HE)((0,x.connect)(go)(mo));fn.displayName="SubMenu";var fo=o(22954),vo=o(73293),Eo=o(93793);const yo=t=>({initPhase:t.dashboard.initPhase,initError:t.dashboard.initError,dashboard:t.dashboard.getModel(),navIndex:t.navIndex}),bo={initDashboard:Dt.mV,cleanUpDashboardAndVariables:Eo.lw,notifyApp:lt.$l,cancelVariables:ht.wX,templateVarsChangedInUrl:ht.xs},Co=(0,x.connect)(yo,bo);class vn extends e.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.updateLiveTimer=()=>{let n;this.props.dashboard?.liveNow&&(n=(0,le.$t)().timeRange()),vo.A.setLiveTimeRange(n)},this.onAddPanel=()=>{const{dashboard:n}=this.props;n&&(n.panels.length>0&&n.panels[0].type==="add-panel"||(n.addPanel({type:"add-panel",gridPos:(0,Ue.lg)(n),title:"Panel Title"}),this.setState({updateScrollTop:0})))},this.setScrollRef=n=>{this.setState({scrollElement:n})},this.onCloseShareModal=()=>{D.E1.partial({shareView:null})}}getCleanState(){return{editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.history.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:n,match:a,queryParams:s}=this.props;n&&this.closeDashboard(),this.props.initDashboard({urlSlug:a.params.slug,urlUid:a.params.uid,urlType:a.params.type,urlFolderUid:s.folderUid,panelType:s.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:a.params.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(n,a){const{dashboard:s,match:r,templateVarsChangedInUrl:i}=this.props,c=this.props.history.location.state?.routeReloadCounter;if(s){if(n.match.params.uid!==r.params.uid||c!==void 0&&this.forceRouteReloadCounter!==c){this.initDashboard(),this.forceRouteReloadCounter=c;return}if(n.location.search!==this.props.location.search){const l=n.queryParams,d=this.props.queryParams;(d?.from!==l?.from||d?.to!==l?.to)&&((0,le.$t)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!l?.refresh&&d?.refresh&&(0,le.$t)().setAutoRefresh(d.refresh);const p=(0,wn.xT)(this.props.queryParams,n.queryParams);p&&i(s.uid,p)}this.state.editPanel&&!a.editPanel&&(ut.H.setEditingState(!0),this.props.dashboard?.events.publish(new J.xF(this.state.editPanel.id))),!this.state.editPanel&&a.editPanel&&(ut.H.setEditingState(!1),this.props.dashboard?.events.publish(new J.Yr(a.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,ct.t_)("Permission to edit panel denied")),D.E1.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,ct.t_)("Panel not found")),D.E1.partial({editPanel:null,viewPanel:null}))}}static getDerivedStateFromProps(n,a){const{dashboard:s,queryParams:r}=n,i=r.editPanel,c=r.viewPanel;if(!s)return a;const l={...a};if(!a.editPanel&&i){const d=s.getPanelByUrlId(i);d?s.canEditPanel(d)?(l.editPanel=d,l.rememberScrollTop=a.scrollElement?.scrollTop):l.editPanelAccessDenied=!0:l.panelNotFound=!0}else a.editPanel&&!i&&(l.editPanel=null,l.updateScrollTop=a.rememberScrollTop);if(!a.viewPanel&&c){const d=s.getPanelByUrlId(c);d?(s.initViewPanel(d),l.viewPanel=d,l.rememberScrollTop=a.scrollElement?.scrollTop,l.updateScrollTop=0):l.panelNotFound=!0}else a.viewPanel&&!c&&(s.exitViewPanel(a.viewPanel),l.viewPanel=null,l.updateScrollTop=a.rememberScrollTop);return(a.panelNotFound||a.editPanelAccessDenied&&!i)&&(l.panelNotFound=!1,l.editPanelAccessDenied=!1),To(n,l)}getInspectPanel(){const{dashboard:n,queryParams:a}=this.props,s=a.inspect;if(!n||!s)return null;const r=n.getPanelById(parseInt(s,10));return r||null}render(){const{dashboard:n,initError:a,queryParams:s}=this.props,{editPanel:r,viewPanel:i,updateScrollTop:c,pageNav:l,sectionNav:d}=this.state,p=Tn(this.props.queryParams);if(!n||!l||!d)return e.createElement(An.B,{initPhase:this.props.initPhase});const m=this.getInspectPanel(),g=!r&&!p&&!this.props.queryParams.editview,h=p!==E.KioskMode.Full&&!s.editview,f=(0,u.cx)({"panel-in-fullscreen":!!i,"page-hidden":!!(s.editview||r)});return n.meta.dashboardNotFound?e.createElement(F.T,{navId:"dashboards/browse",layout:M.Q.Canvas,pageNav:{text:"Not found"}},e.createElement(bn.j,{entity:"Dashboard"})):e.createElement(e.Fragment,null,e.createElement(F.T,{navModel:d,pageNav:l,layout:M.Q.Canvas,className:f,scrollRef:this.setScrollRef,scrollTop:c},h&&e.createElement("header",{"data-testid":y.wl.pages.Dashboard.DashNav.navV2},e.createElement(On.t,{dashboard:n,title:n.title,folderTitle:n.meta.folderTitle,isFullscreen:!!i,onAddPanel:this.onAddPanel,kioskMode:p,hideTimePicker:n.timepicker.hidden})),e.createElement(Tt,{dashboard:n}),a&&e.createElement(Rn.u,null),g&&e.createElement("section",{"aria-label":y.wl.pages.Dashboard.SubMenu.submenu},e.createElement(fn,{dashboard:n,annotations:n.annotations.list,links:n.links})),b.config.featureToggles.angularDeprecationUI&&n.hasAngularPlugins()&&n.uid!==null&&e.createElement(xn,{dashboardUid:n.uid}),e.createElement(fo.Z,{dashboard:n,isEditable:!!n.meta.canEdit,viewPanel:i,editPanel:r}),m&&e.createElement(fa,{dashboard:n,panel:m}),s.shareView&&e.createElement(eo.ShareModal,{dashboard:n,onDismiss:this.onCloseShareModal})),r&&e.createElement(qs,{dashboard:n,sourcePanel:r,tab:this.props.queryParams.tab,sectionNav:d,pageNav:l}),s.editview&&e.createElement(Kn.D,{dashboard:n,editview:s.editview,pageNav:l,sectionNav:d}),s.addWidget&&b.config.featureToggles.vizAndWidgetSplit&&e.createElement(In,null))}}vn.contextType=Cn.h;function To(t,n){const{dashboard:a,navIndex:s}=t;if(!a)return n;let r=n.pageNav,i=n.sectionNav;(!r||a.title!==r.text||a.meta.folderUrl!==r.parentItem?.url)&&(r={text:a.title,url:Q.u.getUrlForPartial(t.history.location,{editview:null,editPanel:null,viewPanel:null})});const{folderUid:c}=a.meta;if(c&&r){const l=(0,dt.ht)(s,`folder-dashboards-${c}`).main;l.id!=="not-found"&&(r={...r,parentItem:l})}if(t.route.routeName===E.DashboardRoutes.Path){i=gt();const l=mt(t.match.params.slug);l?.parentItem&&(l.parentItem=l.parentItem)}else i=(0,dt.ht)(t.navIndex,"dashboards/browse");return(n.editPanel||n.viewPanel)&&(r={...r,text:`${n.editPanel?"Edit":"View"} panel`,parentItem:r,url:void 0}),n.pageNav===r&&n.sectionNav===i?n:{...n,pageNav:r,sectionNav:i}}const En=(0,T.HE)(vn);En.displayName="DashboardPage";const yn=Co(En);function So(t){if(b.config.featureToggles.dashboardScene||t.queryParams.scenes)return e.createElement(q,{...t});const n=(0,B.wc)(),a=!!(t.route.routeName===E.DashboardRoutes.Home||t.route.routeName===E.DashboardRoutes.Normal&&t.match.params.uid),s=(0,L.Z)(async()=>{const r=t.route.routeName===E.DashboardRoutes.Home?t.route.routeName:t.match.params.uid;return r?n.fetchDashboard(r):null},[t.match.params.uid,t.route.routeName]);return b.config.featureToggles.dashboardSceneForViewers?s.loading?null:s.value&&!s.value.meta.canEdit&&a?e.createElement(q,{...t}):e.createElement(yn,{...t}):e.createElement(yn,{...t})}const Po=So},83935:(be,V,o)=>{o.d(V,{$:()=>K,J:()=>E});var e=o(20498),L=o(28073),b=o(69391),M=o(85498),F=o(41327);class j{constructor(){}async get(u){const x=`api/storage/read/${u}`.replace("//","/");return(0,b.i)().get(x)}async list(u){let x="api/storage/list/";u&&(x+=u+"/");const Q=await(0,b.i)().get(x);if(Q?.data){const y=(0,e.vP)(Q);for(const D of y.fields)D.display=(0,L.U)({field:D,theme:M.config.theme2});return y}}async createFolder(u){const x=await(0,b.i)().post("/api/storage/createFolder",JSON.stringify({path:u}));return x.success?{}:{error:x.message??"unknown error"}}async deleteFolder(u){const x=await(0,b.i)().post("/api/storage/deleteFolder",JSON.stringify(u));return x.success?{}:{error:x.message??"unknown error"}}async deleteFile(u){const x=await(0,b.i)().post(`/api/storage/delete/${u.path}`);return x.success?{}:{error:x.message??"unknown error"}}async delete(u){return u.isFolder?this.deleteFolder({path:u.path,force:!0}):this.deleteFile({path:u.path})}async upload(u,x,Q){const y=new FormData;y.append("folder",u),y.append("file",x),y.append("overwriteExistingFile",String(Q));const D=await fetch("/api/storage/upload",{method:"POST",body:y});let T=await D.json();return T||(T={}),T.status=D.status,T.statusText=D.statusText,D.status!==200&&!T.err&&(T.err=!0),T}async write(u,x){return F.ae.post(`/api/storage/write/${u}`,x)}async getConfig(){return(0,b.i)().get("/api/storage/config")}async getOptions(u){return(0,b.i)().get(`/api/storage/options/${u}`)}}function E(q,u){const Q=q.toLowerCase().trim();return u.map(D=>D.trim().toLowerCase()).includes(Q)}let B;function K(){return B||(B=new j),B}},44818:(be,V,o)=>{o.d(V,{M:()=>M});var e=o(31733),L=o(18198),b=o(33279);const M=({value:F,context:j,onChange:E})=>{const B=(0,e.useCallback)(K=>{E(K?.length?{id:L.E4.byRefId,options:K}:void 0)},[E]);return e.createElement(b.O,{value:F?.options,onChange:B,data:j.data,placeholder:"Change filter"})}}}]);

//# sourceMappingURL=DashboardPageProxy.9a83793fe531c557ba42.js.map